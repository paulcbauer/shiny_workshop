<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Workshop: Interactive Data Analysis with Shiny - Server: Reactive programming II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BVZNWTMFX1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BVZNWTMFX1', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Workshop: Interactive Data Analysis with Shiny - Server: Reactive programming II">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05-server-reactive-programming-ii.html">Server: Reactive programming II</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Interactive Data Analysis with Shiny</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://training.gesis.org/?site=pDetails&amp;child=full&amp;pID=0x0D17F8F738B14E0991504DBF8823A002" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-cursor-fill"></i></a>
    <a href="https://github.com/paulcbauer/shiny_workshop" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://github.com/paulcbauer/shiny_workshop/issues" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bug-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-user-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User Interface (UI): Designing the front end</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-server-reactive-programming-i.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Server: Reactive programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-server-reactive-programming-ii.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Server: Reactive programming II</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelling and visualizing data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strengthen &amp; Deploy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-build-your-own.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Build your own app</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-full-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example app: Full code</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basics" id="toc-basics" class="nav-link active" data-scroll-target="#basics"><span class="header-section-number">1</span> Basics</a></li>
  <li><a href="#overview-of-the-reactivity-workflow" id="toc-overview-of-the-reactivity-workflow" class="nav-link" data-scroll-target="#overview-of-the-reactivity-workflow"><span class="header-section-number">2</span> Overview of the reactivity workflow</a></li>
  <li><a href="#reactives-versus-observers" id="toc-reactives-versus-observers" class="nav-link" data-scroll-target="#reactives-versus-observers"><span class="header-section-number">3</span> Reactives versus observers</a>
  <ul class="collapse">
  <li><a href="#reactive" id="toc-reactive" class="nav-link" data-scroll-target="#reactive"><span class="header-section-number">3.1</span> Reactive</a></li>
  <li><a href="#observers" id="toc-observers" class="nav-link" data-scroll-target="#observers"><span class="header-section-number">3.2</span> Observers</a></li>
  </ul></li>
  <li><a href="#events" id="toc-events" class="nav-link" data-scroll-target="#events"><span class="header-section-number">4</span> Events</a>
  <ul class="collapse">
  <li><a href="#bindevent" id="toc-bindevent" class="nav-link" data-scroll-target="#bindevent"><span class="header-section-number">4.1</span> <code>bindEvent</code></a></li>
  <li><a href="#arguments-to-bindevent" id="toc-arguments-to-bindevent" class="nav-link" data-scroll-target="#arguments-to-bindevent"><span class="header-section-number">4.2</span> Arguments to <code>bindEvent</code></a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">4.3</span> Example</a></li>
  </ul></li>
  <li><a href="#updaters" id="toc-updaters" class="nav-link" data-scroll-target="#updaters"><span class="header-section-number">5</span> Updaters</a>
  <ul class="collapse">
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="header-section-number">5.1</span> Implementation</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1"><span class="header-section-number">5.2</span> Example</a></li>
  </ul></li>
  <li><a href="#truthiness" id="toc-truthiness" class="nav-link" data-scroll-target="#truthiness"><span class="header-section-number">6</span> Truthiness</a>
  <ul class="collapse">
  <li><a href="#required-values-req" id="toc-required-values-req" class="nav-link" data-scroll-target="#required-values-req"><span class="header-section-number">6.1</span> Required values (<code>req</code>)</a></li>
  <li><a href="#example-2" id="toc-example-2" class="nav-link" data-scroll-target="#example-2"><span class="header-section-number">6.2</span> Example</a></li>
  <li><a href="#one-step-further-validation" id="toc-one-step-further-validation" class="nav-link" data-scroll-target="#one-step-further-validation"><span class="header-section-number">6.3</span> One step further: Validation</a></li>
  </ul></li>
  <li><a href="#other-important-concepts" id="toc-other-important-concepts" class="nav-link" data-scroll-target="#other-important-concepts"><span class="header-section-number">7</span> Other important concepts</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">8</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#observers-and-reactives" id="toc-observers-and-reactives" class="nav-link" data-scroll-target="#observers-and-reactives"><span class="header-section-number">8.1</span> Observers and reactives</a></li>
  <li><a href="#updates-and-events" id="toc-updates-and-events" class="nav-link" data-scroll-target="#updates-and-events"><span class="header-section-number">8.2</span> Updates and events</a></li>
  <li><a href="#truthiness-and-validation" id="toc-truthiness-and-validation" class="nav-link" data-scroll-target="#truthiness-and-validation"><span class="header-section-number">8.3</span> Truthiness and validation</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/paulcbauer/shiny_workshop/edit/main/05-server-reactive-programming-ii.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/paulcbauer/shiny_workshop/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Server: Reactive programming II</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li>Learning outcomes
<ul>
<li>Become familiar with reactive functions and observers</li>
<li>Understand how to change the UI reactively through updaters</li>
<li>Control the reactive graph through events, isolation, and truthiness</li>
<li>Let Shiny’s reactive flow work for, not against you</li>
</ul></li>
</ul>
<section id="basics" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Basics</h1>
<ul>
<li>In the last section, you learned about what reactivity means in Shiny</li>
<li>Recall:
<ul>
<li>The programmer provides R with a “recipe”</li>
<li>R creates an order of expressions under the hood (or “reactive graph”)</li>
<li>R executes these expressions whenever an input changes</li>
</ul></li>
<li>So far we have worked with inputs (e.g.&nbsp;<code>input$slider</code>), outputs (e.g.&nbsp;<code>output$plot</code>), and reactive functions (e.g.&nbsp;<code>reactive(input$slider + 1)</code>)</li>
<li>In a Shiny app, these three elements are by far the most widely used</li>
<li>In this section, you will learn about new mechanisms to control the reactive graph:
<ul>
<li><strong>Observers</strong>: Reactively perform side effects</li>
<li><strong>Updaters</strong>: Change inputs</li>
<li><strong>Events</strong>: Control when reactive elements are executed</li>
<li><strong>Isolation</strong>: Sever expressions from the reactive graph</li>
<li><strong>Truthiness</strong>: Stop reactivity based on arbitrary conditions</li>
</ul></li>
</ul>
</section>
<section id="overview-of-the-reactivity-workflow" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Overview of the reactivity workflow</h1>
<ul>
<li>This workflow chart is an overview of the most important mechanisms of Shiny’s server function</li>
<li>We do not address all elements on this map, but at the end of the workshop you should get the general idea of what is going on here</li>
</ul>
<p><img src="resources/reactivity_workflow.svg" class="img-fluid"></p>
</section>
<section id="reactives-versus-observers" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Reactives versus observers</h1>
<section id="reactive" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="reactive"><span class="header-section-number">3.1</span> Reactive</h2>
<ul>
<li>Reactives (<code>reactive()</code>) wrapped up:
<ul>
<li>Reactives wrap an R expression to create a reactive expression</li>
<li>They “react” to an input, i.e.&nbsp;are evaluated when an input changes.</li>
<li>They are both reactive producers and consumer. They take reactive values and return a reactive value.</li>
<li>They <strong>must be assigned</strong> to a name. They can be referred to by other reactive consumers by being called like a function.</li>
<li>They are evaluated <strong>lazily</strong>, i.e.&nbsp;they only run if they are forced to, for example when they are called by another reactive.</li>
<li>They are <strong>cached</strong>, i.e.&nbsp;when called back-to-back, without any dependency changing, then they return the same value twice</li>
</ul></li>
<li>Reactives have two clear uses:
<ul>
<li>They reduce the amount of computation that needs to be done by Shiny</li>
<li>They reduce the mental strain in trying to understand complex Shiny code</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>val <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb1-2"><a href="#cb1-2"></a>  num <span class="ot">&lt;-</span> input<span class="sc">$</span>number</span>
<span id="cb1-3"><a href="#cb1-3"></a>  num <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conceptually and technically, reactives may be compared to traditional R functions. Functional programming follows the <a href="https://en.wikipedia.org/wiki/Rule_of_three_(computer_programming)">“rule of three”</a>: If code would be duplicated three times, wrap it in a function. Shiny follows the rule of two. This is because reactives not only simplify code for humans but also for machines: R only evaluates reactives if it has to. This can dramatically speed up an application.</p>
<p>Also, reactives <em>literally</em> are functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">is.function</span>(<span class="fu">reactive</span>({}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] TRUE</code></pre>
</div>
</div>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 48%">
<col style="width: 3%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/840574f96b31b47295cc1ec44d359c0493a6e1bb/4d300/diagrams/basic-reactivity/case-study-1.png" class="img-fluid figure-img"></p>
<figcaption>Reactive graph without reactives</figcaption>
</figure>
</div></th>
<th></th>
<th><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://d33wubrfki0l68.cloudfront.net/7037f40071103105203cef484ca816fa0f72555f/97d14/diagrams/basic-reactivity/case-study-2.png" class="img-fluid figure-img"></p>
<figcaption>Reactive graph with reactives</figcaption>
</figure>
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Reactive graph without reactives</td>
<td></td>
<td>Reactive graph with reactives</td>
</tr>
</tbody>
</table>
</section>
<section id="observers" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="observers"><span class="header-section-number">3.2</span> Observers</h2>
<ul>
<li>Observers (<code>observe()</code>) are similar to reactives:
<ul>
<li>They also take an arbitrary R expression.</li>
<li>They also react to an input.</li>
</ul></li>
<li>But they also carry important differences:
<ul>
<li>They are <strong>not assigned</strong> to a name, thus they cannot be referred to from other reactive consumers and their return value is simply discarded. This also means they are terminal nodes (reactive consumers) in the reactive graphs – just like outputs.</li>
<li>They are evaluated <strong>eagerly</strong>, i.e.&nbsp;they run as soon as possible and do not wait for their dependencies.</li>
<li>They are <strong>forgetful</strong>, their previous output is not cached.</li>
</ul></li>
<li>Since they are terminal nodes but do not produce a visible output, they are something between a reactive and an output</li>
<li>Their uses are manifold, but here are some examples:
<ul>
<li>Logging to the R console</li>
<li>Updating inputs (see below)</li>
<li>Reactively changing the UI</li>
<li>Communicating with a remote storage (e.g.&nbsp;a database or a cloud)</li>
<li>Essentially everything that does not require assigning to a name</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conceptually, observers may be compared to the tidyverse function <a href="https://www.tidyverse.org/blog/2023/05/purrr-walk-this-way/"><code>purrr::walk</code></a>, which iterates over a list or a vector and performs “side-effects” like writing to files. Unlike <code>purrr::walk</code>, though, <code>observe</code> is probably much more common-place.</p>
</div>
</div>
<div class="cell" data-source-line-numbers="32-36">
<div class="sourceCode cell-code" id="cb4" data-source-line-numbers="32-36" data-code-line-numbers="32-36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># the reactive takes the inputs and produces a reactive value</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># which can be re-used in other reactive expressions</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb4-4"><a href="#cb4-4"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb4-5"><a href="#cb4-5"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb4-6"><a href="#cb4-6"></a>  range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb4-7"><a href="#cb4-7"></a>  </span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="co"># select country</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>countries)) {</span>
<span id="cb4-10"><a href="#cb4-10"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb4-11"><a href="#cb4-11"></a>  }</span>
<span id="cb4-12"><a href="#cb4-12"></a>  </span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="co"># select variable</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb4-15"><a href="#cb4-15"></a>})</span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co"># the plot output is a "reactive consumer" that takes</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co"># the reactive value and makes a plot out of it</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb4-20"><a href="#cb4-20"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb4-21"><a href="#cb4-21"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb4-22"><a href="#cb4-22"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb4-25"><a href="#cb4-25"></a>  </span>
<span id="cb4-26"><a href="#cb4-26"></a>  <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>    <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb4-30"><a href="#cb4-30"></a>})</span>
<span id="cb4-31"><a href="#cb4-31"></a></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co"># the observer also takes the reactive value and prints it to the console</span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co"># it is also a reactive consumer and does not return anything</span></span>
<span id="cb4-34"><a href="#cb4-34"></a><span class="fu">observe</span>({</span>
<span id="cb4-35"><a href="#cb4-35"></a>  <span class="fu">print</span>(<span class="fu">filtered</span>())</span>
<span id="cb4-36"><a href="#cb4-36"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-source-line-numbers="116-120">
<details class="code-fold">
<summary>Complete code</summary>
<div class="sourceCode cell-code" id="cb5" data-source-line-numbers="116-120" data-code-line-numbers="116-120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="fu">library</span>(shiny)</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">library</span>(plotly)</span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">library</span>(haven)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>ess <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust.rds"</span>)</span>
<span id="cb5-9"><a href="#cb5-9"></a>ess_geo <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust_geo.rds"</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co"># UI ----</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">titlePanel</span>(<span class="st">"European Social Survey - round 10"</span>),</span>
<span id="cb5-14"><a href="#cb5-14"></a>  </span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="do">## Sidebar ----</span></span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb5-18"><a href="#cb5-18"></a>      <span class="do">### select dependent variable</span></span>
<span id="cb5-19"><a href="#cb5-19"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb5-20"><a href="#cb5-20"></a>        <span class="st">"xvar"</span>,</span>
<span id="cb5-21"><a href="#cb5-21"></a>        <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb5-23"><a href="#cb5-23"></a>          <span class="st">"Trust in country's parliament"</span> <span class="ot">=</span> <span class="st">"trust_parliament"</span>,</span>
<span id="cb5-24"><a href="#cb5-24"></a>          <span class="st">"Trust in the legal system"</span> <span class="ot">=</span> <span class="st">"trust_legal"</span>,</span>
<span id="cb5-25"><a href="#cb5-25"></a>          <span class="st">"Trust in the police"</span> <span class="ot">=</span> <span class="st">"trust_police"</span>,</span>
<span id="cb5-26"><a href="#cb5-26"></a>          <span class="st">"Trust in politicians"</span> <span class="ot">=</span> <span class="st">"trust_politicians"</span>,</span>
<span id="cb5-27"><a href="#cb5-27"></a>          <span class="st">"Trust in political parties"</span> <span class="ot">=</span> <span class="st">"trust_parties"</span>,</span>
<span id="cb5-28"><a href="#cb5-28"></a>          <span class="st">"Trust in the European Parliament"</span> <span class="ot">=</span> <span class="st">"trust_eu"</span>,</span>
<span id="cb5-29"><a href="#cb5-29"></a>          <span class="st">"Trust in the United Nations"</span> <span class="ot">=</span> <span class="st">"trust_un"</span></span>
<span id="cb5-30"><a href="#cb5-30"></a>        )</span>
<span id="cb5-31"><a href="#cb5-31"></a>      ),</span>
<span id="cb5-32"><a href="#cb5-32"></a>      </span>
<span id="cb5-33"><a href="#cb5-33"></a>      <span class="do">### select a variable ----</span></span>
<span id="cb5-34"><a href="#cb5-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb5-35"><a href="#cb5-35"></a>        <span class="st">"yvar"</span>,</span>
<span id="cb5-36"><a href="#cb5-36"></a>        <span class="at">label =</span> <span class="st">"Select an independent variable"</span>,</span>
<span id="cb5-37"><a href="#cb5-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb5-38"><a href="#cb5-38"></a>          <span class="st">"Placement on the left-right scale"</span> <span class="ot">=</span> <span class="st">"left_right"</span>,</span>
<span id="cb5-39"><a href="#cb5-39"></a>          <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb5-40"><a href="#cb5-40"></a>          <span class="st">"Feeling about household's income"</span> <span class="ot">=</span> <span class="st">"income_feeling"</span>,</span>
<span id="cb5-41"><a href="#cb5-41"></a>          <span class="st">"How often do you use the internet?"</span> <span class="ot">=</span> <span class="st">"internet_use"</span>,</span>
<span id="cb5-42"><a href="#cb5-42"></a>          <span class="st">"How happy are you?"</span> <span class="ot">=</span> <span class="st">"happiness"</span></span>
<span id="cb5-43"><a href="#cb5-43"></a>        )</span>
<span id="cb5-44"><a href="#cb5-44"></a>      ),</span>
<span id="cb5-45"><a href="#cb5-45"></a>      </span>
<span id="cb5-46"><a href="#cb5-46"></a>      <span class="do">### select a country ----</span></span>
<span id="cb5-47"><a href="#cb5-47"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb5-48"><a href="#cb5-48"></a>        <span class="st">"countries"</span>,</span>
<span id="cb5-49"><a href="#cb5-49"></a>        <span class="at">label =</span> <span class="st">"Filter by country"</span>,</span>
<span id="cb5-50"><a href="#cb5-50"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ess<span class="sc">$</span>country),</span>
<span id="cb5-51"><a href="#cb5-51"></a>        <span class="at">selected =</span> <span class="st">"FR"</span>,</span>
<span id="cb5-52"><a href="#cb5-52"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb5-53"><a href="#cb5-53"></a>      )</span>
<span id="cb5-54"><a href="#cb5-54"></a>    ),</span>
<span id="cb5-55"><a href="#cb5-55"></a>    </span>
<span id="cb5-56"><a href="#cb5-56"></a>    <span class="do">## Main panel ----</span></span>
<span id="cb5-57"><a href="#cb5-57"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb5-58"><a href="#cb5-58"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb5-59"><a href="#cb5-59"></a>        <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb5-60"><a href="#cb5-60"></a>        </span>
<span id="cb5-61"><a href="#cb5-61"></a>        <span class="do">### Table tab ----</span></span>
<span id="cb5-62"><a href="#cb5-62"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-63"><a href="#cb5-63"></a>          <span class="at">title =</span> <span class="st">"Table"</span>,</span>
<span id="cb5-64"><a href="#cb5-64"></a>          <span class="fu">div</span>(</span>
<span id="cb5-65"><a href="#cb5-65"></a>            <span class="at">style =</span> <span class="st">"height: 600px; overflow-y: auto;"</span>,</span>
<span id="cb5-66"><a href="#cb5-66"></a>            <span class="fu">tableOutput</span>(<span class="st">"table"</span>)</span>
<span id="cb5-67"><a href="#cb5-67"></a>          )</span>
<span id="cb5-68"><a href="#cb5-68"></a>        ),</span>
<span id="cb5-69"><a href="#cb5-69"></a>        </span>
<span id="cb5-70"><a href="#cb5-70"></a>        <span class="do">### Plot tab ----</span></span>
<span id="cb5-71"><a href="#cb5-71"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb5-72"><a href="#cb5-72"></a>          <span class="at">title =</span> <span class="st">"Plot"</span>,</span>
<span id="cb5-73"><a href="#cb5-73"></a>          <span class="fu">plotOutput</span>(<span class="st">"plot"</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb5-74"><a href="#cb5-74"></a>        )</span>
<span id="cb5-75"><a href="#cb5-75"></a>      )</span>
<span id="cb5-76"><a href="#cb5-76"></a>    )</span>
<span id="cb5-77"><a href="#cb5-77"></a>  )</span>
<span id="cb5-78"><a href="#cb5-78"></a>)</span>
<span id="cb5-79"><a href="#cb5-79"></a></span>
<span id="cb5-80"><a href="#cb5-80"></a></span>
<span id="cb5-81"><a href="#cb5-81"></a><span class="co"># Server ----</span></span>
<span id="cb5-82"><a href="#cb5-82"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb5-83"><a href="#cb5-83"></a>  <span class="co"># filter data ----</span></span>
<span id="cb5-84"><a href="#cb5-84"></a>  filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-85"><a href="#cb5-85"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb5-86"><a href="#cb5-86"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb5-87"><a href="#cb5-87"></a>    range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb5-88"><a href="#cb5-88"></a>    </span>
<span id="cb5-89"><a href="#cb5-89"></a>    <span class="co"># select country</span></span>
<span id="cb5-90"><a href="#cb5-90"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb5-91"><a href="#cb5-91"></a>    </span>
<span id="cb5-92"><a href="#cb5-92"></a>    <span class="co"># select variable</span></span>
<span id="cb5-93"><a href="#cb5-93"></a>    ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb5-94"><a href="#cb5-94"></a>  })</span>
<span id="cb5-95"><a href="#cb5-95"></a>  </span>
<span id="cb5-96"><a href="#cb5-96"></a>  <span class="co"># render table ----</span></span>
<span id="cb5-97"><a href="#cb5-97"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb5-98"><a href="#cb5-98"></a>    <span class="fu">filtered</span>()</span>
<span id="cb5-99"><a href="#cb5-99"></a>  }, <span class="at">height =</span> <span class="dv">400</span>)</span>
<span id="cb5-100"><a href="#cb5-100"></a>  </span>
<span id="cb5-101"><a href="#cb5-101"></a>  <span class="co"># render plot ----</span></span>
<span id="cb5-102"><a href="#cb5-102"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb5-103"><a href="#cb5-103"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb5-104"><a href="#cb5-104"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb5-105"><a href="#cb5-105"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-106"><a href="#cb5-106"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-107"><a href="#cb5-107"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb5-108"><a href="#cb5-108"></a>    </span>
<span id="cb5-109"><a href="#cb5-109"></a>    <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb5-110"><a href="#cb5-110"></a>      <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb5-111"><a href="#cb5-111"></a>      <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-112"><a href="#cb5-112"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb5-113"><a href="#cb5-113"></a>  })</span>
<span id="cb5-114"><a href="#cb5-114"></a>  </span>
<span id="cb5-115"><a href="#cb5-115"></a>  <span class="co"># executes everytime `filtered()` is updated</span></span>
<span id="cb5-116"><a href="#cb5-116"></a>  <span class="co"># prints the filtered dataset to the console</span></span>
<span id="cb5-117"><a href="#cb5-117"></a>  <span class="fu">observe</span>({</span>
<span id="cb5-118"><a href="#cb5-118"></a>    <span class="fu">print</span>(<span class="fu">filtered</span>())</span>
<span id="cb5-119"><a href="#cb5-119"></a>  })</span>
<span id="cb5-120"><a href="#cb5-120"></a>}</span>
<span id="cb5-121"><a href="#cb5-121"></a></span>
<span id="cb5-122"><a href="#cb5-122"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="events" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Events</h1>
<ul>
<li>We talk about an <em>event</em> when a reactive expression is triggered by another reactive expression</li>
<li>For example:
<ul>
<li>A user clicks a button</li>
<li>The Shiny session initializes</li>
<li>An input is updated (see below)</li>
</ul></li>
<li>We are dealing with Shiny events all the time, but it is important to realize how to control them</li>
</ul>
<section id="bindevent" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="bindevent"><span class="header-section-number">4.1</span> <code>bindEvent</code></h2>
<ul>
<li>The <code>bindEvent</code> function binds a reactive expression to one or multiple events</li>
<li>The reactive expression is evaluated if <em>and only if</em> the event is triggered</li>
<li><code>bindEvent</code> <em>locks up</em> a reactive expression unless a specific event is triggered</li>
<li>You can use <code>bindEvent</code> on all sorts of reactive expressions: reactives, observers, and output renderers</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">reactive</span>({</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="co"># do something</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>button)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arguments-to-bindevent" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="arguments-to-bindevent"><span class="header-section-number">4.2</span> Arguments to <code>bindEvent</code></h2>
<ul>
<li><code>bindEvent</code> takes three arguments:
<ul>
<li><code>ignoreNULL</code>: By default, every event is an event, even if it is <code>NULL</code>. An unpressed button would then also count as an event. If you need your plot to render only before pressing that button, then ignoring <code>NULL</code> is the right choice.</li>
<li><code>ignoreInit</code>: By default, events are triggered when the reactive expressions are first initialized. This can be bad news for dynamically created UI elements (which are beyond this workshop).</li>
<li><code>once</code>: If used on an observer, this argument can be used to destroy that observer after its first use.</li>
</ul></li>
</ul>
</section>
<section id="example" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="example"><span class="header-section-number">4.3</span> Example</h2>
<ul>
<li>To exemplify we will add an action button, that serves the following role:
<ul>
<li>If the inputs are changed, nothing should happen to the plot</li>
<li>Only if the button is pressed, shall the plot data be recalculated</li>
</ul></li>
</ul>
<p>In the UI:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">actionButton</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="st">"button"</span>,</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="at">label =</span> <span class="st">"Update parameters"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the server function:</p>
<div class="cell" data-source-line-numbers="13-14,22-23">
<div class="sourceCode cell-code" id="cb8" data-source-line-numbers="13-14,22-23" data-code-line-numbers="13-14,22-23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-2"><a href="#cb8-2"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb8-3"><a href="#cb8-3"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb8-4"><a href="#cb8-4"></a>  range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb8-5"><a href="#cb8-5"></a>  </span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="co"># select country</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(input<span class="sc">$</span>countries)) {</span>
<span id="cb8-8"><a href="#cb8-8"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb8-9"><a href="#cb8-9"></a>  }</span>
<span id="cb8-10"><a href="#cb8-10"></a>  </span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="co"># select variable</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb8-13"><a href="#cb8-13"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>button, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-15"><a href="#cb8-15"></a></span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb8-18"><a href="#cb8-18"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb8-21"><a href="#cb8-21"></a>  </span>
<span id="cb8-22"><a href="#cb8-22"></a>  xvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">3</span>]]</span>
<span id="cb8-23"><a href="#cb8-23"></a>  yvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">4</span>]]</span>
<span id="cb8-24"><a href="#cb8-24"></a>  </span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>    <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>    <span class="fu">theme_classic</span>()</span>
<span id="cb8-29"><a href="#cb8-29"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-source-line-numbers="55-59,101-102,114-115,118">
<details class="code-fold">
<summary>Complete code (important lines are highlighted)</summary>
<div class="sourceCode cell-code" id="cb9" data-source-line-numbers="55-59,101-102,114-115,118" data-code-line-numbers="55-59,101-102,114-115,118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">library</span>(shiny)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">library</span>(plotly)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">library</span>(haven)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>ess <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust.rds"</span>)</span>
<span id="cb9-9"><a href="#cb9-9"></a>ess_geo <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust_geo.rds"</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co"># UI ----</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="fu">titlePanel</span>(<span class="st">"European Social Survey - round 10"</span>),</span>
<span id="cb9-14"><a href="#cb9-14"></a>  </span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="do">## Sidebar ----</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb9-17"><a href="#cb9-17"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb9-18"><a href="#cb9-18"></a>      <span class="do">### select dependent variable</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb9-20"><a href="#cb9-20"></a>        <span class="st">"xvar"</span>,</span>
<span id="cb9-21"><a href="#cb9-21"></a>        <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb9-22"><a href="#cb9-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb9-23"><a href="#cb9-23"></a>          <span class="st">"Trust in country's parliament"</span> <span class="ot">=</span> <span class="st">"trust_parliament"</span>,</span>
<span id="cb9-24"><a href="#cb9-24"></a>          <span class="st">"Trust in the legal system"</span> <span class="ot">=</span> <span class="st">"trust_legal"</span>,</span>
<span id="cb9-25"><a href="#cb9-25"></a>          <span class="st">"Trust in the police"</span> <span class="ot">=</span> <span class="st">"trust_police"</span>,</span>
<span id="cb9-26"><a href="#cb9-26"></a>          <span class="st">"Trust in politicians"</span> <span class="ot">=</span> <span class="st">"trust_politicians"</span>,</span>
<span id="cb9-27"><a href="#cb9-27"></a>          <span class="st">"Trust in political parties"</span> <span class="ot">=</span> <span class="st">"trust_parties"</span>,</span>
<span id="cb9-28"><a href="#cb9-28"></a>          <span class="st">"Trust in the European Parliament"</span> <span class="ot">=</span> <span class="st">"trust_eu"</span>,</span>
<span id="cb9-29"><a href="#cb9-29"></a>          <span class="st">"Trust in the United Nations"</span> <span class="ot">=</span> <span class="st">"trust_un"</span></span>
<span id="cb9-30"><a href="#cb9-30"></a>        )</span>
<span id="cb9-31"><a href="#cb9-31"></a>      ),</span>
<span id="cb9-32"><a href="#cb9-32"></a>      </span>
<span id="cb9-33"><a href="#cb9-33"></a>      <span class="do">### select a variable ----</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb9-35"><a href="#cb9-35"></a>        <span class="st">"yvar"</span>,</span>
<span id="cb9-36"><a href="#cb9-36"></a>        <span class="at">label =</span> <span class="st">"Select an independent variable"</span>,</span>
<span id="cb9-37"><a href="#cb9-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb9-38"><a href="#cb9-38"></a>          <span class="st">"Placement on the left-right scale"</span> <span class="ot">=</span> <span class="st">"left_right"</span>,</span>
<span id="cb9-39"><a href="#cb9-39"></a>          <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb9-40"><a href="#cb9-40"></a>          <span class="st">"Feeling about household's income"</span> <span class="ot">=</span> <span class="st">"income_feeling"</span>,</span>
<span id="cb9-41"><a href="#cb9-41"></a>          <span class="st">"How often do you use the internet?"</span> <span class="ot">=</span> <span class="st">"internet_use"</span>,</span>
<span id="cb9-42"><a href="#cb9-42"></a>          <span class="st">"How happy are you?"</span> <span class="ot">=</span> <span class="st">"happiness"</span></span>
<span id="cb9-43"><a href="#cb9-43"></a>        )</span>
<span id="cb9-44"><a href="#cb9-44"></a>      ),</span>
<span id="cb9-45"><a href="#cb9-45"></a>      </span>
<span id="cb9-46"><a href="#cb9-46"></a>      <span class="do">### select a country ----</span></span>
<span id="cb9-47"><a href="#cb9-47"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb9-48"><a href="#cb9-48"></a>        <span class="st">"countries"</span>,</span>
<span id="cb9-49"><a href="#cb9-49"></a>        <span class="at">label =</span> <span class="st">"Filter by country"</span>,</span>
<span id="cb9-50"><a href="#cb9-50"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ess<span class="sc">$</span>country),</span>
<span id="cb9-51"><a href="#cb9-51"></a>        <span class="at">selected =</span> <span class="st">"FR"</span>,</span>
<span id="cb9-52"><a href="#cb9-52"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb9-53"><a href="#cb9-53"></a>      ),</span>
<span id="cb9-54"><a href="#cb9-54"></a>      </span>
<span id="cb9-55"><a href="#cb9-55"></a>      <span class="fu">actionButton</span>(</span>
<span id="cb9-56"><a href="#cb9-56"></a>        <span class="st">"button"</span>,</span>
<span id="cb9-57"><a href="#cb9-57"></a>        <span class="at">label =</span> <span class="st">"Update parameters"</span>,</span>
<span id="cb9-58"><a href="#cb9-58"></a>        <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>)</span>
<span id="cb9-59"><a href="#cb9-59"></a>      )</span>
<span id="cb9-60"><a href="#cb9-60"></a>    ),</span>
<span id="cb9-61"><a href="#cb9-61"></a>    </span>
<span id="cb9-62"><a href="#cb9-62"></a>    <span class="do">## Main panel ----</span></span>
<span id="cb9-63"><a href="#cb9-63"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb9-64"><a href="#cb9-64"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb9-65"><a href="#cb9-65"></a>        <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb9-66"><a href="#cb9-66"></a>        </span>
<span id="cb9-67"><a href="#cb9-67"></a>        <span class="do">### Table tab ----</span></span>
<span id="cb9-68"><a href="#cb9-68"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb9-69"><a href="#cb9-69"></a>          <span class="at">title =</span> <span class="st">"Table"</span>,</span>
<span id="cb9-70"><a href="#cb9-70"></a>          <span class="fu">div</span>(</span>
<span id="cb9-71"><a href="#cb9-71"></a>            <span class="at">style =</span> <span class="st">"height: 600px; overflow-y: auto;"</span>,</span>
<span id="cb9-72"><a href="#cb9-72"></a>            <span class="fu">tableOutput</span>(<span class="st">"table"</span>)</span>
<span id="cb9-73"><a href="#cb9-73"></a>          )</span>
<span id="cb9-74"><a href="#cb9-74"></a>        ),</span>
<span id="cb9-75"><a href="#cb9-75"></a>        </span>
<span id="cb9-76"><a href="#cb9-76"></a>        <span class="do">### Plot tab ----</span></span>
<span id="cb9-77"><a href="#cb9-77"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb9-78"><a href="#cb9-78"></a>          <span class="at">title =</span> <span class="st">"Plot"</span>,</span>
<span id="cb9-79"><a href="#cb9-79"></a>          <span class="fu">plotOutput</span>(<span class="st">"plot"</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb9-80"><a href="#cb9-80"></a>        )</span>
<span id="cb9-81"><a href="#cb9-81"></a>      )</span>
<span id="cb9-82"><a href="#cb9-82"></a>    )</span>
<span id="cb9-83"><a href="#cb9-83"></a>  )</span>
<span id="cb9-84"><a href="#cb9-84"></a>)</span>
<span id="cb9-85"><a href="#cb9-85"></a></span>
<span id="cb9-86"><a href="#cb9-86"></a></span>
<span id="cb9-87"><a href="#cb9-87"></a><span class="co"># Server ----</span></span>
<span id="cb9-88"><a href="#cb9-88"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb9-89"><a href="#cb9-89"></a>  <span class="co"># filter data ----</span></span>
<span id="cb9-90"><a href="#cb9-90"></a>  filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-91"><a href="#cb9-91"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb9-92"><a href="#cb9-92"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb9-93"><a href="#cb9-93"></a>    range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb9-94"><a href="#cb9-94"></a>    </span>
<span id="cb9-95"><a href="#cb9-95"></a>    <span class="co"># select country</span></span>
<span id="cb9-96"><a href="#cb9-96"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb9-97"><a href="#cb9-97"></a>    </span>
<span id="cb9-98"><a href="#cb9-98"></a>    <span class="co"># select variable</span></span>
<span id="cb9-99"><a href="#cb9-99"></a>    ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb9-100"><a href="#cb9-100"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb9-101"><a href="#cb9-101"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>button, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-102"><a href="#cb9-102"></a>  </span>
<span id="cb9-103"><a href="#cb9-103"></a>  <span class="co"># render table ----</span></span>
<span id="cb9-104"><a href="#cb9-104"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb9-105"><a href="#cb9-105"></a>    <span class="fu">filtered</span>()</span>
<span id="cb9-106"><a href="#cb9-106"></a>  }, <span class="at">height =</span> <span class="dv">400</span>)</span>
<span id="cb9-107"><a href="#cb9-107"></a>  </span>
<span id="cb9-108"><a href="#cb9-108"></a>  <span class="co"># render plot ----</span></span>
<span id="cb9-109"><a href="#cb9-109"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb9-110"><a href="#cb9-110"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-111"><a href="#cb9-111"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-112"><a href="#cb9-112"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb9-113"><a href="#cb9-113"></a>    </span>
<span id="cb9-114"><a href="#cb9-114"></a>    xvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">3</span>]]</span>
<span id="cb9-115"><a href="#cb9-115"></a>    yvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">4</span>]]</span>
<span id="cb9-116"><a href="#cb9-116"></a>    </span>
<span id="cb9-117"><a href="#cb9-117"></a>    <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb9-118"><a href="#cb9-118"></a>      <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb9-119"><a href="#cb9-119"></a>      <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-120"><a href="#cb9-120"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb9-121"><a href="#cb9-121"></a>  })</span>
<span id="cb9-122"><a href="#cb9-122"></a>}</span>
<span id="cb9-123"><a href="#cb9-123"></a></span>
<span id="cb9-124"><a href="#cb9-124"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="updaters" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Updaters</h1>
<ul>
<li>Updaters are one of the more common uses of observers</li>
<li>They update the values and appearance of input widgets</li>
<li>There are update functions for most input widgets – and if there is not, updating becomes much more difficult</li>
<li>Some examples:
<ul>
<li><a href="https://shiny.posit.co/r/reference/shiny/0.14/updateselectinput"><code>updateSelectInput</code></a>: Updating an input selection can update a palette selection to match varying data types – continuous, categorical, divering.</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/0.11/updatetabsetpanel"><code>updateTabsetPanel</code></a>: Updating a tabset panel can automatically switch between tabs.</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/0.14/updateactionbutton"><code>updateActionButton</code></a>: Updating an action button can simulate a button click, without the user needing to physically click on the button.</li>
</ul></li>
</ul>
<section id="implementation" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="implementation"><span class="header-section-number">5.1</span> Implementation</h2>
<ul>
<li>Updaters are usually found in an <strong>observer</strong>.</li>
<li>Because they often do not depend on any input, they are best coupled with <code>bindEvent</code>.</li>
<li>It can also be useful to combine them with <code>freezeReactiveValue</code>
<ul>
<li>Updating a value triggers an event</li>
<li>Freezing can prevent the event from triggering twice: when changing the input and when updating.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-8-1"><a href="#annotated-cell-8-1"></a><span class="fu">observe</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="1">1</button><span id="annotated-cell-8-2" class="code-annotation-target"><a href="#annotated-cell-8-2"></a>  <span class="fu">freezeReactiveValue</span>(input, <span class="st">"id_of_input"</span>)</span>
<span id="annotated-cell-8-3"><a href="#annotated-cell-8-3"></a>  <span class="fu">updateSelectInput</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="2">2</button><span id="annotated-cell-8-4" class="code-annotation-target"><a href="#annotated-cell-8-4"></a>    <span class="at">session =</span> session,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="3">3</button><span id="annotated-cell-8-5" class="code-annotation-target"><a href="#annotated-cell-8-5"></a>    <span class="at">inputId =</span> <span class="st">"id_of_input"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="4">4</button><span id="annotated-cell-8-6" class="code-annotation-target"><a href="#annotated-cell-8-6"></a>    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>)</span>
<span id="annotated-cell-8-7"><a href="#annotated-cell-8-7"></a>    <span class="at">selected =</span> <span class="st">"b"</span></span>
<span id="annotated-cell-8-8"><a href="#annotated-cell-8-8"></a>  ) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-8" data-target-annotation="5">5</button><span id="annotated-cell-8-9" class="code-annotation-target"><a href="#annotated-cell-8-9"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>button)</span>
<span id="annotated-cell-8-10"><a href="#annotated-cell-8-10"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-8" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="2" data-code-annotation="1">Freeze <code>id_of_input</code> to prevent it from triggering an event twice, first when clicking on the button, and second when updating the input.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="4" data-code-annotation="2">The <code>session</code> object of the server function has to be passed to every update function. This has no deeper meaning.</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="5" data-code-annotation="3">The <code>inputId</code> argument takes the ID of the widget that is to be updated</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="6,7" data-code-annotation="4">Every update function has different arguments to alter different parts of the input widget</span>
</dd>
<dt data-target-cell="annotated-cell-8" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-8" data-code-lines="9" data-code-annotation="5">Bind the observer to an input that should trigger the input update</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="example-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="example-1"><span class="header-section-number">5.2</span> Example</h2>
<ul>
<li>To exemplify, we add a new slider to the app:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">sliderInput</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="st">"slider"</span>,</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="at">label =</span> <span class="st">"Select a range for the independent variable"</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="at">min =</span> <span class="fu">min</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="at">max =</span> <span class="fu">max</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="at">value =</span> <span class="fu">range</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="at">step =</span> <span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Note that min, max, and value are fixed</li>
<li>…, but the independent variable is not: we can select a different variable with a different range</li>
<li>We can thus implement an updater that dynamically updates the slider with new ranges:</li>
</ul>
<div class="cell" data-source-line-numbers="1-14,26-30">
<div class="sourceCode cell-code" id="annotated-cell-10" data-source-line-numbers="1-14,26-30" data-code-line-numbers="1-14,26-30"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-10-1"><a href="#annotated-cell-10-1"></a><span class="fu">observe</span>({</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a>  <span class="fu">freezeReactiveValue</span>(input, <span class="st">"slider"</span>)</span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>  <span class="fu">updateSliderInput</span>(</span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5"></a>    <span class="at">session =</span> session,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-6" class="code-annotation-target"><a href="#annotated-cell-10-6"></a>    <span class="at">inputId =</span> <span class="st">"slider"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-7" class="code-annotation-target"><a href="#annotated-cell-10-7"></a>    <span class="at">min =</span> <span class="fu">min</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a>    <span class="at">max =</span> <span class="fu">max</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-10-9"><a href="#annotated-cell-10-9"></a>    <span class="at">value =</span> <span class="fu">range</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-10-10"><a href="#annotated-cell-10-10"></a>  )</span>
<span id="annotated-cell-10-11"><a href="#annotated-cell-10-11"></a>}) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-12" class="code-annotation-target"><a href="#annotated-cell-10-12"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>yvar)</span>
<span id="annotated-cell-10-13"><a href="#annotated-cell-10-13"></a></span>
<span id="annotated-cell-10-14"><a href="#annotated-cell-10-14"></a>filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-10-15"><a href="#annotated-cell-10-15"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="annotated-cell-10-16"><a href="#annotated-cell-10-16"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="annotated-cell-10-17"><a href="#annotated-cell-10-17"></a>  </span>
<span id="annotated-cell-10-18"><a href="#annotated-cell-10-18"></a>  <span class="co"># select country</span></span>
<span id="annotated-cell-10-19"><a href="#annotated-cell-10-19"></a>  ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="annotated-cell-10-20"><a href="#annotated-cell-10-20"></a></span>
<span id="annotated-cell-10-21"><a href="#annotated-cell-10-21"></a>  <span class="co"># apply range</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4">4</button><span id="annotated-cell-10-22" class="code-annotation-target"><a href="#annotated-cell-10-22"></a>  ess <span class="ot">&lt;-</span> ess[</span>
<span id="annotated-cell-10-23"><a href="#annotated-cell-10-23"></a>    ess[[yvar]] <span class="sc">&gt;</span> input<span class="sc">$</span>slider[<span class="dv">1</span>] <span class="sc">&amp;</span></span>
<span id="annotated-cell-10-24"><a href="#annotated-cell-10-24"></a>    ess[[yvar]] <span class="sc">&lt;</span> input<span class="sc">$</span>slider[<span class="dv">2</span>],</span>
<span id="annotated-cell-10-25"><a href="#annotated-cell-10-25"></a>  ]</span>
<span id="annotated-cell-10-26"><a href="#annotated-cell-10-26"></a>  </span>
<span id="annotated-cell-10-27"><a href="#annotated-cell-10-27"></a>  <span class="co"># select variable</span></span>
<span id="annotated-cell-10-28"><a href="#annotated-cell-10-28"></a>  ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="annotated-cell-10-29"><a href="#annotated-cell-10-29"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="6" data-code-annotation="1">The updater references the ID of the input that needs to change</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="7,8,9" data-code-annotation="2">Min, max, and value are adapted to the select Y variable</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="12" data-code-annotation="3">The updater only triggers when a new Y variable is selected</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="22,23,24,25" data-code-annotation="4">The dataset is filtered according to the slider</span>
</dd>
</dl>
</div>
</div>
<div class="cell" data-source-line-numbers="55-62,96,101-105,131-142">
<details class="code-fold">
<summary>Complete code (important lines are highlighted)</summary>
<div class="sourceCode cell-code" id="cb11" data-source-line-numbers="55-62,96,101-105,131-142" data-code-line-numbers="55-62,96,101-105,131-142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">library</span>(shiny)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">library</span>(plotly)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="fu">library</span>(haven)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>ess <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust.rds"</span>)</span>
<span id="cb11-9"><a href="#cb11-9"></a>ess_geo <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust_geo.rds"</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co"># UI ----</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb11-13"><a href="#cb11-13"></a>  <span class="fu">titlePanel</span>(<span class="st">"European Social Survey - round 10"</span>),</span>
<span id="cb11-14"><a href="#cb11-14"></a>  </span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="do">## Sidebar ----</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb11-17"><a href="#cb11-17"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb11-18"><a href="#cb11-18"></a>      <span class="do">### select dependent variable</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb11-20"><a href="#cb11-20"></a>        <span class="st">"xvar"</span>,</span>
<span id="cb11-21"><a href="#cb11-21"></a>        <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb11-22"><a href="#cb11-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb11-23"><a href="#cb11-23"></a>          <span class="st">"Trust in country's parliament"</span> <span class="ot">=</span> <span class="st">"trust_parliament"</span>,</span>
<span id="cb11-24"><a href="#cb11-24"></a>          <span class="st">"Trust in the legal system"</span> <span class="ot">=</span> <span class="st">"trust_legal"</span>,</span>
<span id="cb11-25"><a href="#cb11-25"></a>          <span class="st">"Trust in the police"</span> <span class="ot">=</span> <span class="st">"trust_police"</span>,</span>
<span id="cb11-26"><a href="#cb11-26"></a>          <span class="st">"Trust in politicians"</span> <span class="ot">=</span> <span class="st">"trust_politicians"</span>,</span>
<span id="cb11-27"><a href="#cb11-27"></a>          <span class="st">"Trust in political parties"</span> <span class="ot">=</span> <span class="st">"trust_parties"</span>,</span>
<span id="cb11-28"><a href="#cb11-28"></a>          <span class="st">"Trust in the European Parliament"</span> <span class="ot">=</span> <span class="st">"trust_eu"</span>,</span>
<span id="cb11-29"><a href="#cb11-29"></a>          <span class="st">"Trust in the United Nations"</span> <span class="ot">=</span> <span class="st">"trust_un"</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>        )</span>
<span id="cb11-31"><a href="#cb11-31"></a>      ),</span>
<span id="cb11-32"><a href="#cb11-32"></a>      </span>
<span id="cb11-33"><a href="#cb11-33"></a>      <span class="do">### select a variable ----</span></span>
<span id="cb11-34"><a href="#cb11-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb11-35"><a href="#cb11-35"></a>        <span class="st">"yvar"</span>,</span>
<span id="cb11-36"><a href="#cb11-36"></a>        <span class="at">label =</span> <span class="st">"Select an independent variable"</span>,</span>
<span id="cb11-37"><a href="#cb11-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb11-38"><a href="#cb11-38"></a>          <span class="st">"Placement on the left-right scale"</span> <span class="ot">=</span> <span class="st">"left_right"</span>,</span>
<span id="cb11-39"><a href="#cb11-39"></a>          <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb11-40"><a href="#cb11-40"></a>          <span class="st">"Feeling about household's income"</span> <span class="ot">=</span> <span class="st">"income_feeling"</span>,</span>
<span id="cb11-41"><a href="#cb11-41"></a>          <span class="st">"How often do you use the internet?"</span> <span class="ot">=</span> <span class="st">"internet_use"</span>,</span>
<span id="cb11-42"><a href="#cb11-42"></a>          <span class="st">"How happy are you?"</span> <span class="ot">=</span> <span class="st">"happiness"</span></span>
<span id="cb11-43"><a href="#cb11-43"></a>        )</span>
<span id="cb11-44"><a href="#cb11-44"></a>      ),</span>
<span id="cb11-45"><a href="#cb11-45"></a>      </span>
<span id="cb11-46"><a href="#cb11-46"></a>      <span class="do">### select a country ----</span></span>
<span id="cb11-47"><a href="#cb11-47"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb11-48"><a href="#cb11-48"></a>        <span class="st">"countries"</span>,</span>
<span id="cb11-49"><a href="#cb11-49"></a>        <span class="at">label =</span> <span class="st">"Filter by country"</span>,</span>
<span id="cb11-50"><a href="#cb11-50"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ess<span class="sc">$</span>country),</span>
<span id="cb11-51"><a href="#cb11-51"></a>        <span class="at">selected =</span> <span class="st">"FR"</span>,</span>
<span id="cb11-52"><a href="#cb11-52"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb11-53"><a href="#cb11-53"></a>      ),</span>
<span id="cb11-54"><a href="#cb11-54"></a>      </span>
<span id="cb11-55"><a href="#cb11-55"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb11-56"><a href="#cb11-56"></a>        <span class="st">"slider"</span>,</span>
<span id="cb11-57"><a href="#cb11-57"></a>        <span class="at">label =</span> <span class="st">"Select a range for the independent variable"</span>,</span>
<span id="cb11-58"><a href="#cb11-58"></a>        <span class="at">min =</span> <span class="fu">min</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-59"><a href="#cb11-59"></a>        <span class="at">max =</span> <span class="fu">max</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-60"><a href="#cb11-60"></a>        <span class="at">value =</span> <span class="fu">range</span>(ess<span class="sc">$</span>left_right, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-61"><a href="#cb11-61"></a>        <span class="at">step =</span> <span class="dv">1</span></span>
<span id="cb11-62"><a href="#cb11-62"></a>      )</span>
<span id="cb11-63"><a href="#cb11-63"></a>    ),</span>
<span id="cb11-64"><a href="#cb11-64"></a>    </span>
<span id="cb11-65"><a href="#cb11-65"></a>    <span class="do">## Main panel ----</span></span>
<span id="cb11-66"><a href="#cb11-66"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb11-67"><a href="#cb11-67"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb11-68"><a href="#cb11-68"></a>        <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb11-69"><a href="#cb11-69"></a>        </span>
<span id="cb11-70"><a href="#cb11-70"></a>        <span class="do">### Table tab ----</span></span>
<span id="cb11-71"><a href="#cb11-71"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb11-72"><a href="#cb11-72"></a>          <span class="at">title =</span> <span class="st">"Table"</span>,</span>
<span id="cb11-73"><a href="#cb11-73"></a>          <span class="fu">div</span>(</span>
<span id="cb11-74"><a href="#cb11-74"></a>            <span class="at">style =</span> <span class="st">"height: 600px; overflow-y: auto;"</span>,</span>
<span id="cb11-75"><a href="#cb11-75"></a>            <span class="fu">tableOutput</span>(<span class="st">"table"</span>)</span>
<span id="cb11-76"><a href="#cb11-76"></a>          )</span>
<span id="cb11-77"><a href="#cb11-77"></a>        ),</span>
<span id="cb11-78"><a href="#cb11-78"></a>        </span>
<span id="cb11-79"><a href="#cb11-79"></a>        <span class="do">### Plot tab ----</span></span>
<span id="cb11-80"><a href="#cb11-80"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb11-81"><a href="#cb11-81"></a>          <span class="at">title =</span> <span class="st">"Plot"</span>,</span>
<span id="cb11-82"><a href="#cb11-82"></a>          <span class="fu">plotOutput</span>(<span class="st">"plot"</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb11-83"><a href="#cb11-83"></a>        )</span>
<span id="cb11-84"><a href="#cb11-84"></a>      )</span>
<span id="cb11-85"><a href="#cb11-85"></a>    )</span>
<span id="cb11-86"><a href="#cb11-86"></a>  )</span>
<span id="cb11-87"><a href="#cb11-87"></a>)</span>
<span id="cb11-88"><a href="#cb11-88"></a></span>
<span id="cb11-89"><a href="#cb11-89"></a></span>
<span id="cb11-90"><a href="#cb11-90"></a><span class="co"># Server ----</span></span>
<span id="cb11-91"><a href="#cb11-91"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb11-92"><a href="#cb11-92"></a>  <span class="co"># filter data ----</span></span>
<span id="cb11-93"><a href="#cb11-93"></a>  filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-94"><a href="#cb11-94"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb11-95"><a href="#cb11-95"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb11-96"><a href="#cb11-96"></a>    range <span class="ot">&lt;-</span> input<span class="sc">$</span>slider</span>
<span id="cb11-97"><a href="#cb11-97"></a>    </span>
<span id="cb11-98"><a href="#cb11-98"></a>    <span class="co"># select country</span></span>
<span id="cb11-99"><a href="#cb11-99"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb11-100"><a href="#cb11-100"></a></span>
<span id="cb11-101"><a href="#cb11-101"></a>    <span class="co"># apply range</span></span>
<span id="cb11-102"><a href="#cb11-102"></a>    ess <span class="ot">&lt;-</span> ess[</span>
<span id="cb11-103"><a href="#cb11-103"></a>      ess[[yvar]] <span class="sc">&gt;</span> range[<span class="dv">1</span>] <span class="sc">&amp;</span></span>
<span id="cb11-104"><a href="#cb11-104"></a>      ess[[yvar]] <span class="sc">&lt;</span> range[<span class="dv">2</span>], </span>
<span id="cb11-105"><a href="#cb11-105"></a>    ]</span>
<span id="cb11-106"><a href="#cb11-106"></a>    </span>
<span id="cb11-107"><a href="#cb11-107"></a>    <span class="co"># select variable</span></span>
<span id="cb11-108"><a href="#cb11-108"></a>    ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb11-109"><a href="#cb11-109"></a>  })</span>
<span id="cb11-110"><a href="#cb11-110"></a>  </span>
<span id="cb11-111"><a href="#cb11-111"></a>  <span class="co"># render table ----</span></span>
<span id="cb11-112"><a href="#cb11-112"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb11-113"><a href="#cb11-113"></a>    <span class="fu">filtered</span>()</span>
<span id="cb11-114"><a href="#cb11-114"></a>  }, <span class="at">height =</span> <span class="dv">400</span>)</span>
<span id="cb11-115"><a href="#cb11-115"></a>  </span>
<span id="cb11-116"><a href="#cb11-116"></a>  <span class="co"># render plot ----</span></span>
<span id="cb11-117"><a href="#cb11-117"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb11-118"><a href="#cb11-118"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-119"><a href="#cb11-119"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-120"><a href="#cb11-120"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb11-121"><a href="#cb11-121"></a>    </span>
<span id="cb11-122"><a href="#cb11-122"></a>    xvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">3</span>]]</span>
<span id="cb11-123"><a href="#cb11-123"></a>    yvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">4</span>]]</span>
<span id="cb11-124"><a href="#cb11-124"></a></span>
<span id="cb11-125"><a href="#cb11-125"></a>    <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb11-126"><a href="#cb11-126"></a>      <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb11-127"><a href="#cb11-127"></a>      <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-128"><a href="#cb11-128"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb11-129"><a href="#cb11-129"></a>  })</span>
<span id="cb11-130"><a href="#cb11-130"></a>  </span>
<span id="cb11-131"><a href="#cb11-131"></a>  <span class="fu">observe</span>({</span>
<span id="cb11-132"><a href="#cb11-132"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb11-133"><a href="#cb11-133"></a>    <span class="fu">freezeReactiveValue</span>(input, <span class="st">"slider"</span>)</span>
<span id="cb11-134"><a href="#cb11-134"></a>    <span class="fu">updateSliderInput</span>(</span>
<span id="cb11-135"><a href="#cb11-135"></a>      <span class="at">session =</span> session,</span>
<span id="cb11-136"><a href="#cb11-136"></a>      <span class="at">inputId =</span> <span class="st">"slider"</span>,</span>
<span id="cb11-137"><a href="#cb11-137"></a>      <span class="at">min =</span> <span class="fu">min</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-138"><a href="#cb11-138"></a>      <span class="at">max =</span> <span class="fu">max</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-139"><a href="#cb11-139"></a>      <span class="at">value =</span> <span class="fu">range</span>(ess[[yvar]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-140"><a href="#cb11-140"></a>    )</span>
<span id="cb11-141"><a href="#cb11-141"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb11-142"><a href="#cb11-142"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>yvar)</span>
<span id="cb11-143"><a href="#cb11-143"></a>}</span>
<span id="cb11-144"><a href="#cb11-144"></a></span>
<span id="cb11-145"><a href="#cb11-145"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="truthiness" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Truthiness</h1>
<ul>
<li>Truthiness is Shiny’s flavor of logical or boolean values.</li>
<li>Shiny interprets truthiness much more liberally than base R</li>
<li>Truthiness answers questions such as:
<ul>
<li>Is this value missing or available?</li>
<li>Has the user provided an answer?</li>
<li>Has the button been clicked?</li>
</ul></li>
<li>Concretely, a value is truthy <em>unless</em> it is:
<ul>
<li><code>FALSE</code></li>
<li><code>NULL</code></li>
<li>An empty character string (<code>""</code>)</li>
<li>An empty vector (e.g.&nbsp;<code>numeric(0)</code>)</li>
<li>A vector full of <code>NA</code> (e.g.&nbsp;<code>c(NA, NA, NA)</code>)</li>
<li>A vector full of <code>NA</code> or <code>FALSE</code> (e.g.&nbsp;<code>c(NA, FALSE, NA)</code>)</li>
<li>A try-error (e.g.&nbsp;<code>try(stop("an error"))</code>)</li>
<li>An unclicked action button</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">isTruthy</span>(<span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">isTruthy</span>(<span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">isTruthy</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] TRUE</code></pre>
</div>
</div>
<section id="required-values-req" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="required-values-req"><span class="header-section-number">6.1</span> Required values (<code>req</code>)</h2>
<ul>
<li>Truthiness is useful for Shiny’s <code>req</code> function</li>
<li><code>req</code> is equivalent to <code>if</code> statements in R with two exceptions:
<ul>
<li>They test for truthiness (instead of <code>TRUE</code>/<code>FALSE</code>)</li>
<li>They raise a “silent” exception, i.e.&nbsp;they cancel any ongoing computation without logging or displaying an error</li>
</ul></li>
<li><code>req</code> is useful to stop reactive behavior when certain conditions are not met</li>
</ul>
</section>
<section id="example-2" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="example-2"><span class="header-section-number">6.2</span> Example</h2>
<ul>
<li>In our Shiny app, we can use req to cancel plotting when no country is specified</li>
<li><code>selectizeInput</code>, which is used to select a country, returns <code>NULL</code> when no value is specified</li>
<li>Now, if we do not specify a country, the plot simply will not render</li>
</ul>
<div class="cell" data-source-line-numbers="2">
<div class="sourceCode cell-code" id="cb18" data-source-line-numbers="2" data-code-line-numbers="2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">req</span>(input<span class="sc">$</span>countries, <span class="at">cancelOutput =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a>  </span>
<span id="cb18-4"><a href="#cb18-4"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb18-5"><a href="#cb18-5"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb18-6"><a href="#cb18-6"></a>  range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb18-7"><a href="#cb18-7"></a>  </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="co"># select country</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb18-10"><a href="#cb18-10"></a>  </span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="co"># select variable</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb18-13"><a href="#cb18-13"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>button, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-source-line-numbers="90">
<details class="code-fold">
<summary>Complete code (important lines are highlighted)</summary>
<div class="sourceCode cell-code" id="cb19" data-source-line-numbers="90" data-code-line-numbers="90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="fu">library</span>(shiny)</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="fu">library</span>(plotly)</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="fu">library</span>(haven)</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a>ess <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust.rds"</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>ess_geo <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust_geo.rds"</span>)</span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co"># UI ----</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb19-13"><a href="#cb19-13"></a>  <span class="fu">titlePanel</span>(<span class="st">"European Social Survey - round 10"</span>),</span>
<span id="cb19-14"><a href="#cb19-14"></a>  </span>
<span id="cb19-15"><a href="#cb19-15"></a>  <span class="do">## Sidebar ----</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb19-18"><a href="#cb19-18"></a>      <span class="do">### select dependent variable</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb19-20"><a href="#cb19-20"></a>        <span class="st">"xvar"</span>,</span>
<span id="cb19-21"><a href="#cb19-21"></a>        <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb19-22"><a href="#cb19-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb19-23"><a href="#cb19-23"></a>          <span class="st">"Trust in country's parliament"</span> <span class="ot">=</span> <span class="st">"trust_parliament"</span>,</span>
<span id="cb19-24"><a href="#cb19-24"></a>          <span class="st">"Trust in the legal system"</span> <span class="ot">=</span> <span class="st">"trust_legal"</span>,</span>
<span id="cb19-25"><a href="#cb19-25"></a>          <span class="st">"Trust in the police"</span> <span class="ot">=</span> <span class="st">"trust_police"</span>,</span>
<span id="cb19-26"><a href="#cb19-26"></a>          <span class="st">"Trust in politicians"</span> <span class="ot">=</span> <span class="st">"trust_politicians"</span>,</span>
<span id="cb19-27"><a href="#cb19-27"></a>          <span class="st">"Trust in political parties"</span> <span class="ot">=</span> <span class="st">"trust_parties"</span>,</span>
<span id="cb19-28"><a href="#cb19-28"></a>          <span class="st">"Trust in the European Parliament"</span> <span class="ot">=</span> <span class="st">"trust_eu"</span>,</span>
<span id="cb19-29"><a href="#cb19-29"></a>          <span class="st">"Trust in the United Nations"</span> <span class="ot">=</span> <span class="st">"trust_un"</span></span>
<span id="cb19-30"><a href="#cb19-30"></a>        )</span>
<span id="cb19-31"><a href="#cb19-31"></a>      ),</span>
<span id="cb19-32"><a href="#cb19-32"></a>      </span>
<span id="cb19-33"><a href="#cb19-33"></a>      <span class="do">### select a variable ----</span></span>
<span id="cb19-34"><a href="#cb19-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb19-35"><a href="#cb19-35"></a>        <span class="st">"yvar"</span>,</span>
<span id="cb19-36"><a href="#cb19-36"></a>        <span class="at">label =</span> <span class="st">"Select an independent variable"</span>,</span>
<span id="cb19-37"><a href="#cb19-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb19-38"><a href="#cb19-38"></a>          <span class="st">"Placement on the left-right scale"</span> <span class="ot">=</span> <span class="st">"left_right"</span>,</span>
<span id="cb19-39"><a href="#cb19-39"></a>          <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb19-40"><a href="#cb19-40"></a>          <span class="st">"Feeling about household's income"</span> <span class="ot">=</span> <span class="st">"income_feeling"</span>,</span>
<span id="cb19-41"><a href="#cb19-41"></a>          <span class="st">"How often do you use the internet?"</span> <span class="ot">=</span> <span class="st">"internet_use"</span>,</span>
<span id="cb19-42"><a href="#cb19-42"></a>          <span class="st">"How happy are you?"</span> <span class="ot">=</span> <span class="st">"happiness"</span></span>
<span id="cb19-43"><a href="#cb19-43"></a>        )</span>
<span id="cb19-44"><a href="#cb19-44"></a>      ),</span>
<span id="cb19-45"><a href="#cb19-45"></a>      </span>
<span id="cb19-46"><a href="#cb19-46"></a>      <span class="do">### select a country ----</span></span>
<span id="cb19-47"><a href="#cb19-47"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb19-48"><a href="#cb19-48"></a>        <span class="st">"countries"</span>,</span>
<span id="cb19-49"><a href="#cb19-49"></a>        <span class="at">label =</span> <span class="st">"Filter by country"</span>,</span>
<span id="cb19-50"><a href="#cb19-50"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ess<span class="sc">$</span>country),</span>
<span id="cb19-51"><a href="#cb19-51"></a>        <span class="at">selected =</span> <span class="st">"FR"</span>,</span>
<span id="cb19-52"><a href="#cb19-52"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb19-53"><a href="#cb19-53"></a>      )</span>
<span id="cb19-54"><a href="#cb19-54"></a>    ),</span>
<span id="cb19-55"><a href="#cb19-55"></a>    </span>
<span id="cb19-56"><a href="#cb19-56"></a>    <span class="do">## Main panel ----</span></span>
<span id="cb19-57"><a href="#cb19-57"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb19-58"><a href="#cb19-58"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb19-59"><a href="#cb19-59"></a>        <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb19-60"><a href="#cb19-60"></a>        </span>
<span id="cb19-61"><a href="#cb19-61"></a>        <span class="do">### Table tab ----</span></span>
<span id="cb19-62"><a href="#cb19-62"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb19-63"><a href="#cb19-63"></a>          <span class="at">title =</span> <span class="st">"Table"</span>,</span>
<span id="cb19-64"><a href="#cb19-64"></a>          <span class="fu">div</span>(</span>
<span id="cb19-65"><a href="#cb19-65"></a>            <span class="at">style =</span> <span class="st">"height: 600px; overflow-y: auto;"</span>,</span>
<span id="cb19-66"><a href="#cb19-66"></a>            <span class="fu">tableOutput</span>(<span class="st">"table"</span>)</span>
<span id="cb19-67"><a href="#cb19-67"></a>          )</span>
<span id="cb19-68"><a href="#cb19-68"></a>        ),</span>
<span id="cb19-69"><a href="#cb19-69"></a>        </span>
<span id="cb19-70"><a href="#cb19-70"></a>        <span class="do">### Plot tab ----</span></span>
<span id="cb19-71"><a href="#cb19-71"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb19-72"><a href="#cb19-72"></a>          <span class="at">title =</span> <span class="st">"Plot"</span>,</span>
<span id="cb19-73"><a href="#cb19-73"></a>          <span class="fu">plotOutput</span>(<span class="st">"plot"</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb19-74"><a href="#cb19-74"></a>        )</span>
<span id="cb19-75"><a href="#cb19-75"></a>      )</span>
<span id="cb19-76"><a href="#cb19-76"></a>    )</span>
<span id="cb19-77"><a href="#cb19-77"></a>  )</span>
<span id="cb19-78"><a href="#cb19-78"></a>)</span>
<span id="cb19-79"><a href="#cb19-79"></a></span>
<span id="cb19-80"><a href="#cb19-80"></a></span>
<span id="cb19-81"><a href="#cb19-81"></a><span class="co"># Server ----</span></span>
<span id="cb19-82"><a href="#cb19-82"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb19-83"><a href="#cb19-83"></a>  <span class="co"># filter data ----</span></span>
<span id="cb19-84"><a href="#cb19-84"></a>  filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-85"><a href="#cb19-85"></a>    <span class="fu">req</span>(input<span class="sc">$</span>countries, <span class="at">cancelOutput =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-86"><a href="#cb19-86"></a>    </span>
<span id="cb19-87"><a href="#cb19-87"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb19-88"><a href="#cb19-88"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb19-89"><a href="#cb19-89"></a>    range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb19-90"><a href="#cb19-90"></a>    </span>
<span id="cb19-91"><a href="#cb19-91"></a>    <span class="co"># select country</span></span>
<span id="cb19-92"><a href="#cb19-92"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb19-93"><a href="#cb19-93"></a>    </span>
<span id="cb19-94"><a href="#cb19-94"></a>    <span class="co"># select variable</span></span>
<span id="cb19-95"><a href="#cb19-95"></a>    ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb19-96"><a href="#cb19-96"></a>  })</span>
<span id="cb19-97"><a href="#cb19-97"></a>  </span>
<span id="cb19-98"><a href="#cb19-98"></a>  <span class="co"># render table ----</span></span>
<span id="cb19-99"><a href="#cb19-99"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb19-100"><a href="#cb19-100"></a>    <span class="fu">filtered</span>()</span>
<span id="cb19-101"><a href="#cb19-101"></a>  }, <span class="at">height =</span> <span class="dv">400</span>)</span>
<span id="cb19-102"><a href="#cb19-102"></a>  </span>
<span id="cb19-103"><a href="#cb19-103"></a>  <span class="co"># render plot ----</span></span>
<span id="cb19-104"><a href="#cb19-104"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb19-105"><a href="#cb19-105"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-106"><a href="#cb19-106"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-107"><a href="#cb19-107"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb19-108"><a href="#cb19-108"></a>    </span>
<span id="cb19-109"><a href="#cb19-109"></a>    xvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">3</span>]]</span>
<span id="cb19-110"><a href="#cb19-110"></a>    yvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">4</span>]]</span>
<span id="cb19-111"><a href="#cb19-111"></a>    </span>
<span id="cb19-112"><a href="#cb19-112"></a>    <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb19-113"><a href="#cb19-113"></a>      <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb19-114"><a href="#cb19-114"></a>      <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-115"><a href="#cb19-115"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb19-116"><a href="#cb19-116"></a>  })</span>
<span id="cb19-117"><a href="#cb19-117"></a>}</span>
<span id="cb19-118"><a href="#cb19-118"></a></span>
<span id="cb19-119"><a href="#cb19-119"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="one-step-further-validation" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="one-step-further-validation"><span class="header-section-number">6.3</span> One step further: Validation</h2>
<ul>
<li><code>req()</code> is useful for simply controlling reactivity in general</li>
<li><code>validate()</code> is useful for also providing a user with feedback</li>
<li><code>validate()</code> is fed with <code>need()</code> conditions which take two arguments:
<ul>
<li>An expression that is tested for truthiness</li>
<li>A message that is shown to the user if the expression is not truthy</li>
</ul></li>
<li><code>validate()</code> is very bare-bones! For more sophisticated input validation, check out <a href="https://merlinoa.github.io/shinyFeedback/"><code>shinyFeedback</code></a></li>
</ul>
<div class="cell" data-source-line-numbers="2-4">
<div class="sourceCode cell-code" id="cb20" data-source-line-numbers="2-4" data-code-line-numbers="2-4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">validate</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>    <span class="fu">need</span>(input<span class="sc">$</span>countries, <span class="at">message =</span> <span class="st">"At least one country must be specified."</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a>  )</span>
<span id="cb20-5"><a href="#cb20-5"></a>  </span>
<span id="cb20-6"><a href="#cb20-6"></a>  xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb20-7"><a href="#cb20-7"></a>  yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb20-8"><a href="#cb20-8"></a>  range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb20-9"><a href="#cb20-9"></a>  </span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="co"># select country</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>  ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb20-12"><a href="#cb20-12"></a>  </span>
<span id="cb20-13"><a href="#cb20-13"></a>  <span class="co"># select variable</span></span>
<span id="cb20-14"><a href="#cb20-14"></a>  ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb20-15"><a href="#cb20-15"></a>}) <span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16"></a>  <span class="fu">bindEvent</span>(input<span class="sc">$</span>button, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-source-line-numbers="90-92">
<details class="code-fold">
<summary>Complete code (important lines are highlighted)</summary>
<div class="sourceCode cell-code" id="cb21" data-source-line-numbers="90-92" data-code-line-numbers="90-92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="fu">library</span>(shiny)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="fu">library</span>(plotly)</span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="fu">library</span>(haven)</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a>ess <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust.rds"</span>)</span>
<span id="cb21-9"><a href="#cb21-9"></a>ess_geo <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ess_trust_geo.rds"</span>)</span>
<span id="cb21-10"><a href="#cb21-10"></a></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co"># UI ----</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb21-13"><a href="#cb21-13"></a>  <span class="fu">titlePanel</span>(<span class="st">"European Social Survey - round 10"</span>),</span>
<span id="cb21-14"><a href="#cb21-14"></a>  </span>
<span id="cb21-15"><a href="#cb21-15"></a>  <span class="do">## Sidebar ----</span></span>
<span id="cb21-16"><a href="#cb21-16"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb21-17"><a href="#cb21-17"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb21-18"><a href="#cb21-18"></a>      <span class="do">### select dependent variable</span></span>
<span id="cb21-19"><a href="#cb21-19"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb21-20"><a href="#cb21-20"></a>        <span class="st">"xvar"</span>,</span>
<span id="cb21-21"><a href="#cb21-21"></a>        <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb21-22"><a href="#cb21-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb21-23"><a href="#cb21-23"></a>          <span class="st">"Trust in country's parliament"</span> <span class="ot">=</span> <span class="st">"trust_parliament"</span>,</span>
<span id="cb21-24"><a href="#cb21-24"></a>          <span class="st">"Trust in the legal system"</span> <span class="ot">=</span> <span class="st">"trust_legal"</span>,</span>
<span id="cb21-25"><a href="#cb21-25"></a>          <span class="st">"Trust in the police"</span> <span class="ot">=</span> <span class="st">"trust_police"</span>,</span>
<span id="cb21-26"><a href="#cb21-26"></a>          <span class="st">"Trust in politicians"</span> <span class="ot">=</span> <span class="st">"trust_politicians"</span>,</span>
<span id="cb21-27"><a href="#cb21-27"></a>          <span class="st">"Trust in political parties"</span> <span class="ot">=</span> <span class="st">"trust_parties"</span>,</span>
<span id="cb21-28"><a href="#cb21-28"></a>          <span class="st">"Trust in the European Parliament"</span> <span class="ot">=</span> <span class="st">"trust_eu"</span>,</span>
<span id="cb21-29"><a href="#cb21-29"></a>          <span class="st">"Trust in the United Nations"</span> <span class="ot">=</span> <span class="st">"trust_un"</span></span>
<span id="cb21-30"><a href="#cb21-30"></a>        )</span>
<span id="cb21-31"><a href="#cb21-31"></a>      ),</span>
<span id="cb21-32"><a href="#cb21-32"></a>      </span>
<span id="cb21-33"><a href="#cb21-33"></a>      <span class="do">### select a variable ----</span></span>
<span id="cb21-34"><a href="#cb21-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb21-35"><a href="#cb21-35"></a>        <span class="st">"yvar"</span>,</span>
<span id="cb21-36"><a href="#cb21-36"></a>        <span class="at">label =</span> <span class="st">"Select an independent variable"</span>,</span>
<span id="cb21-37"><a href="#cb21-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb21-38"><a href="#cb21-38"></a>          <span class="st">"Placement on the left-right scale"</span> <span class="ot">=</span> <span class="st">"left_right"</span>,</span>
<span id="cb21-39"><a href="#cb21-39"></a>          <span class="st">"Age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb21-40"><a href="#cb21-40"></a>          <span class="st">"Feeling about household's income"</span> <span class="ot">=</span> <span class="st">"income_feeling"</span>,</span>
<span id="cb21-41"><a href="#cb21-41"></a>          <span class="st">"How often do you use the internet?"</span> <span class="ot">=</span> <span class="st">"internet_use"</span>,</span>
<span id="cb21-42"><a href="#cb21-42"></a>          <span class="st">"How happy are you?"</span> <span class="ot">=</span> <span class="st">"happiness"</span></span>
<span id="cb21-43"><a href="#cb21-43"></a>        )</span>
<span id="cb21-44"><a href="#cb21-44"></a>      ),</span>
<span id="cb21-45"><a href="#cb21-45"></a>      </span>
<span id="cb21-46"><a href="#cb21-46"></a>      <span class="do">### select a country ----</span></span>
<span id="cb21-47"><a href="#cb21-47"></a>      <span class="fu">selectizeInput</span>(</span>
<span id="cb21-48"><a href="#cb21-48"></a>        <span class="st">"countries"</span>,</span>
<span id="cb21-49"><a href="#cb21-49"></a>        <span class="at">label =</span> <span class="st">"Filter by country"</span>,</span>
<span id="cb21-50"><a href="#cb21-50"></a>        <span class="at">choices =</span> <span class="fu">unique</span>(ess<span class="sc">$</span>country),</span>
<span id="cb21-51"><a href="#cb21-51"></a>        <span class="at">selected =</span> <span class="st">"FR"</span>,</span>
<span id="cb21-52"><a href="#cb21-52"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb21-53"><a href="#cb21-53"></a>      )</span>
<span id="cb21-54"><a href="#cb21-54"></a>    ),</span>
<span id="cb21-55"><a href="#cb21-55"></a>    </span>
<span id="cb21-56"><a href="#cb21-56"></a>    <span class="do">## Main panel ----</span></span>
<span id="cb21-57"><a href="#cb21-57"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb21-58"><a href="#cb21-58"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb21-59"><a href="#cb21-59"></a>        <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb21-60"><a href="#cb21-60"></a>        </span>
<span id="cb21-61"><a href="#cb21-61"></a>        <span class="do">### Table tab ----</span></span>
<span id="cb21-62"><a href="#cb21-62"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb21-63"><a href="#cb21-63"></a>          <span class="at">title =</span> <span class="st">"Table"</span>,</span>
<span id="cb21-64"><a href="#cb21-64"></a>          <span class="fu">div</span>(</span>
<span id="cb21-65"><a href="#cb21-65"></a>            <span class="at">style =</span> <span class="st">"height: 600px; overflow-y: auto;"</span>,</span>
<span id="cb21-66"><a href="#cb21-66"></a>            <span class="fu">tableOutput</span>(<span class="st">"table"</span>)</span>
<span id="cb21-67"><a href="#cb21-67"></a>          )</span>
<span id="cb21-68"><a href="#cb21-68"></a>        ),</span>
<span id="cb21-69"><a href="#cb21-69"></a>        </span>
<span id="cb21-70"><a href="#cb21-70"></a>        <span class="do">### Plot tab ----</span></span>
<span id="cb21-71"><a href="#cb21-71"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb21-72"><a href="#cb21-72"></a>          <span class="at">title =</span> <span class="st">"Plot"</span>,</span>
<span id="cb21-73"><a href="#cb21-73"></a>          <span class="fu">plotOutput</span>(<span class="st">"plot"</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb21-74"><a href="#cb21-74"></a>        )</span>
<span id="cb21-75"><a href="#cb21-75"></a>      )</span>
<span id="cb21-76"><a href="#cb21-76"></a>    )</span>
<span id="cb21-77"><a href="#cb21-77"></a>  )</span>
<span id="cb21-78"><a href="#cb21-78"></a>)</span>
<span id="cb21-79"><a href="#cb21-79"></a></span>
<span id="cb21-80"><a href="#cb21-80"></a></span>
<span id="cb21-81"><a href="#cb21-81"></a><span class="co"># Server ----</span></span>
<span id="cb21-82"><a href="#cb21-82"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb21-83"><a href="#cb21-83"></a>  <span class="co"># filter data ----</span></span>
<span id="cb21-84"><a href="#cb21-84"></a>  filtered <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb21-85"><a href="#cb21-85"></a>    <span class="fu">validate</span>(</span>
<span id="cb21-86"><a href="#cb21-86"></a>      <span class="fu">need</span>(input<span class="sc">$</span>countries, <span class="at">message =</span> <span class="st">"At least one country must be specified."</span>)</span>
<span id="cb21-87"><a href="#cb21-87"></a>    )</span>
<span id="cb21-88"><a href="#cb21-88"></a>    </span>
<span id="cb21-89"><a href="#cb21-89"></a>    xvar <span class="ot">&lt;-</span> input<span class="sc">$</span>xvar</span>
<span id="cb21-90"><a href="#cb21-90"></a>    yvar <span class="ot">&lt;-</span> input<span class="sc">$</span>yvar</span>
<span id="cb21-91"><a href="#cb21-91"></a>    range <span class="ot">&lt;-</span> input<span class="sc">$</span>range</span>
<span id="cb21-92"><a href="#cb21-92"></a>    </span>
<span id="cb21-93"><a href="#cb21-93"></a>    <span class="co"># select country</span></span>
<span id="cb21-94"><a href="#cb21-94"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>countries, ]</span>
<span id="cb21-95"><a href="#cb21-95"></a>    </span>
<span id="cb21-96"><a href="#cb21-96"></a>    <span class="co"># select variable</span></span>
<span id="cb21-97"><a href="#cb21-97"></a>    ess[<span class="fu">c</span>(<span class="st">"idno"</span>, <span class="st">"country"</span>, xvar, yvar)]</span>
<span id="cb21-98"><a href="#cb21-98"></a>  })</span>
<span id="cb21-99"><a href="#cb21-99"></a>  </span>
<span id="cb21-100"><a href="#cb21-100"></a>  <span class="co"># render table ----</span></span>
<span id="cb21-101"><a href="#cb21-101"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">renderTable</span>({</span>
<span id="cb21-102"><a href="#cb21-102"></a>    <span class="fu">filtered</span>()</span>
<span id="cb21-103"><a href="#cb21-103"></a>  }, <span class="at">height =</span> <span class="dv">400</span>)</span>
<span id="cb21-104"><a href="#cb21-104"></a>  </span>
<span id="cb21-105"><a href="#cb21-105"></a>  <span class="co"># render plot ----</span></span>
<span id="cb21-106"><a href="#cb21-106"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb21-107"><a href="#cb21-107"></a>    plot_data <span class="ot">&lt;-</span> <span class="fu">filtered</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-108"><a href="#cb21-108"></a>      <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-109"><a href="#cb21-109"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> as.ordered))</span>
<span id="cb21-110"><a href="#cb21-110"></a>    </span>
<span id="cb21-111"><a href="#cb21-111"></a>    xvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">3</span>]]</span>
<span id="cb21-112"><a href="#cb21-112"></a>    yvar <span class="ot">&lt;-</span> <span class="fu">names</span>(plot_data)[[<span class="dv">4</span>]]</span>
<span id="cb21-113"><a href="#cb21-113"></a>    </span>
<span id="cb21-114"><a href="#cb21-114"></a>    <span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb21-115"><a href="#cb21-115"></a>      <span class="fu">aes</span>(<span class="at">x =</span> .data[[xvar]], <span class="at">y =</span> .data[[yvar]], <span class="at">group =</span> .data[[xvar]]) <span class="sc">+</span></span>
<span id="cb21-116"><a href="#cb21-116"></a>      <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-117"><a href="#cb21-117"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb21-118"><a href="#cb21-118"></a>  })</span>
<span id="cb21-119"><a href="#cb21-119"></a>}</span>
<span id="cb21-120"><a href="#cb21-120"></a></span>
<span id="cb21-121"><a href="#cb21-121"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="other-important-concepts" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Other important concepts</h1>
<ul>
<li>Shiny’s reactivity is easy to learn and hard to master</li>
<li>We have started with basic concepts (inputs, outputs, reactive graphs)</li>
<li>… and ended with more advanced concepts (observers, events, updaters, truthiness)</li>
<li>Nonetheless, there is still much to be explored that reaches far beyond this workshop</li>
<li>Here we provide a non-exhaustive list of concepts, functions, and extensions that might serve useful when dealing with Shiny’s reactivity
<ul>
<li>A more exhaustive list was created by Shiny developer Nan Xiao: <a href="https://github.com/nanxstats/awesome-shiny-extensions">Awesome Shiny extensions</a></li>
</ul></li>
<li>Base Shiny:
<ul>
<li>Dynamic UI
<ul>
<li>Add, manipulate, and remove UI elements from the server function</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/insertui"><code>insertUI</code></a> and <a href="https://shiny.posit.co/r/reference/shiny/latest/insertui"><code>removeUI</code></a></li>
<li><a href="https://deanattali.com/shinyjs/"><code>shinyjs</code></a> package for advanced control</li>
<li>See also this <a href="https://shiny.posit.co/r/articles/build/dynamic-ui/">blog article</a> on dynamic UIs</li>
</ul></li>
<li>Isolation
<ul>
<li>Sever reactive values from the reactive graph</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/0.11/isolate.html"><code>isolate</code></a></li>
<li>See also this <a href="https://shiny.posit.co/r/articles/build/isolation/">blog article</a></li>
</ul></li>
<li>Freezing
<ul>
<li>Prevent an event from triggering until the next flush</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/1.4.0/freezereactivevalue"><code>freezeReactiveValue</code></a></li>
<li>We have introduced this briefly in the section about updaters</li>
</ul></li>
<li>Reactive values
<ul>
<li>Values or list-likes that are able to take dependencies in reactive expressions</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/reactiveval"><code>reactiveVal</code></a> and <a href="https://shiny.posit.co/r/reference/shiny/latest/reactivevalues"><code>reactiveValues</code></a></li>
<li>Reactive values are essentially a bare-bones version of <code>reactive()</code>, but for a short introduction, see <a href="https://mastering-shiny.org/reactivity-objects.html#reactive-values">chapter 15.1</a> of Mastering Shiny</li>
</ul></li>
<li>Flush events
<ul>
<li>Execute code after / before the reactive graphs finishes / starts</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/0.14/onflush"><code>onFlush</code></a></li>
<li>See also this <a href="https://shiny.posit.co/r/articles/build/execution-scheduling/">blog article</a> about execution scheduling</li>
</ul></li>
<li>Caching
<ul>
<li>Temporarily store computationally intensive results to improve performance</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/bindcache"><code>bindCache</code></a></li>
</ul></li>
<li>Data storage
<ul>
<li>Improve input/output of large data using local or remote databases (e.g.&nbsp;SQLite, Google Sheets, Dropbox, Amazon S3)</li>
<li>See this <a href="https://shiny.posit.co/r/articles/build/overview/">blog article</a></li>
</ul></li>
<li>Scheduled invalidation
<ul>
<li>Invalidate reactive expressions after some time has passed</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/invalidatelater"><code>invalidateLater</code></a></li>
</ul></li>
<li>Input validation
<ul>
<li>A more sophisticated alternative to <code>req</code> allowing multiple tests and more flexible conditions.</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/validate.html"><code>validate</code></a></li>
</ul></li>
<li>Safe execution
<ul>
<li>Notify the user when something gone wrong with useful error messages instead of plain R errors</li>
<li><a href="https://rdrr.io/r/base/conditions.html"><code>base::tryCatch</code></a> and <a href="https://rdrr.io/r/base/conditions.html"><code>base::withCallingHandlers</code></a> provide mechanisms to implement safe errors</li>
<li><a href="https://dreamrs.github.io/shinyWidgets/reference/execute_safely.html"><code>shinyWidgets::execute_safely</code></a> and <a href="https://rstudio.github.io/shinyvalidate/index.html"><code>shinyvalidate</code></a> are implementations found in the wild</li>
<li>See also <a href="https://engineering-shiny.org/ux-matters.html">chapter 6: UX Matters</a> of Colin Fay’s Engineering Production-Grade Shiny Apps</li>
</ul></li>
<li>Modularization
<ul>
<li>Package large Shiny apps into isolated modules to increase maintainability</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/1.7.0/moduleserver"><code>moduleServer</code></a></li>
<li>See also this <a href="https://shiny.posit.co/r/articles/improve/modules/">blog article</a></li>
</ul></li>
<li>Testing server logics
<ul>
<li>Set up a mocked Shiny server to use in unit tests</li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/testserver"><code>testServer</code></a></li>
<li>Particularly useful for making a robust Shiny package</li>
<li>Advanced approaches also exist, e.g.&nbsp;<a href="https://github.com/rstudio/shinytest2"><code>shinytest2</code></a> or <a href="https://github.com/yonicd/reactor"><code>reactor</code></a></li>
</ul></li>
<li>Javascript
<ul>
<li>Shiny apps can be built without ever seeing a single line of Javascript – but Javascript can still come in handy for that last mile of customization</li>
<li>See <a href="https://engineering-shiny.org/using-javascript.html">chapter 17</a> of Engineering Production-Grade Shiny Apps and <a href="https://unleash-shiny.rinterface.com/survival-kit-javascript">chapter 10</a> of Outstanding User Interfaces with Shiny for useful primers on Javascript in Shiny</li>
</ul></li>
</ul></li>
<li>Shiny extensions
<ul>
<li>Event-based reactivity
<ul>
<li><a href="https://cran.r-project.org/web/packages/gargoyle/"><code>gargoyle</code></a></li>
<li>Create and trigger custom events to control the reactivity flow</li>
</ul></li>
<li>Shiny event tracking
<ul>
<li><a href="https://cran.r-project.org/web/packages/shinylogs/index.html"><code>shinylogs</code></a> or <a href="https://github.com/Appsilon/shiny.telemetry"><code>shiny.telemetry</code></a></li>
<li>Track inputs, outputs, errors and session events and optionally use them for logging</li>
</ul></li>
<li>Parallelization and asynchronous programming
<ul>
<li><a href="https://appsilon.github.io/shiny.worker/"><code>shiny.worker</code></a></li>
<li>Delegate heavy computation tasks to seperate processes to keep Shiny app responsive</li>
</ul></li>
<li>URL routing
<ul>
<li>Route to specific parts of a Shiny app by modifying the URL path</li>
<li><a href="https://appsilon.github.io/shiny.router/"><code>shiny.router</code></a> and <a href="https://github.com/shinyworks/scenes?tab=readme-ov-file"><code>scenes</code></a></li>
<li><a href="https://shiny.posit.co/r/reference/shiny/latest/updatequerystring"><code>updateQueryString</code></a> and <a href="https://shiny.posit.co/r/reference/shiny/latest/getquerystring"><code>getQueryString</code></a> in base Shiny</li>
<li>Example: <code>https://shinyapp.com/plot</code> to access a plot</li>
</ul></li>
<li>Reactivity logging
<ul>
<li><a href="https://rstudio.github.io/reactlog/"><code>reactlog</code></a></li>
<li>Interactively supervise reactivity a posteriori</li>
</ul></li>
<li>Flame graphs
<ul>
<li><a href="https://rstudio.github.io/profvis/"><code>profvis</code></a></li>
<li>Interactively understand bottlenecks of a Shiny app</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="exercises" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Exercises</h1>
<section id="observers-and-reactives" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="observers-and-reactives"><span class="header-section-number">8.1</span> Observers and reactives</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Imagine you need to implement the following features in a Shiny app. In principle, would you rather use a reactive or an observer (or both) for these tasks?</p>
<ol type="1">
<li>Filtering a dataset as input for both <code>lm()</code> and <code>ggplot()</code>.</li>
<li>Reading from a database.</li>
<li>Writing to a database.</li>
<li>Update an input selection with new selection values.</li>
<li>Collect the results of a linear regression done in the Shiny app.</li>
<li>Display a password prompt and check if the credentials are correct.</li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 1.1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Filtering a dataset for two different operations is a good use case for <code>reactive()</code> as its output value can be cached.</li>
<li>Reading from a file or a database is generally a task for <code>reactive()</code> as the data read in R must be stored. This cannot be done using observers.</li>
<li>Writing to a database, however, should be done in an observer because the return value does not matter for writing.</li>
<li>Updating the UI is usually done in an observer due to their eager evaluation.</li>
<li>Results of a calculation in Shiny are often used for further operations down the line (e.g.&nbsp;visualization). They are thus best handled by a reactive.</li>
<li>Ideally, passwords should stay in the R session for as short as possible. Thus they should not be handled by a reactive because reactive values are cached until the next invalidation. Additionally, proper password checks are performed using external databases which calls for observers.</li>
</ol>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>The following code contains two observers. Both observers depend on the same input (<code>input$button</code>), so their execution order can only be determined by their position in the code. Thus, <code>"2nd observer"</code> is printed before <code>"1st observer"</code>. Study the documentation of <code>?observe</code> and fix the app such <code>"1st observer"</code> is always printed first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>()</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">observe</span>({</span>
<span id="cb22-5"><a href="#cb22-5"></a>    input<span class="sc">$</span>button</span>
<span id="cb22-6"><a href="#cb22-6"></a>    <span class="fu">print</span>(<span class="st">"2nd observer"</span>)</span>
<span id="cb22-7"><a href="#cb22-7"></a>  })</span>
<span id="cb22-8"><a href="#cb22-8"></a>  </span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">observe</span>({</span>
<span id="cb22-10"><a href="#cb22-10"></a>    input<span class="sc">$</span>button</span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="fu">print</span>(<span class="st">"1st observer"</span>)</span>
<span id="cb22-12"><a href="#cb22-12"></a>  })</span>
<span id="cb22-13"><a href="#cb22-13"></a>}</span>
<span id="cb22-14"><a href="#cb22-14"></a></span>
<span id="cb22-15"><a href="#cb22-15"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 1.2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>observe()</code> features an argument called <code>priority</code> which allows you to control the execution order. A higher value indicates a higher priority. Setting <code>priority = 1</code> makes the “1st observer” run before the “2nd observer” which has a default priority of 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>()</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">observe</span>({</span>
<span id="cb23-5"><a href="#cb23-5"></a>    <span class="fu">print</span>(<span class="st">"2nd observer"</span>)</span>
<span id="cb23-6"><a href="#cb23-6"></a>  })</span>
<span id="cb23-7"><a href="#cb23-7"></a>  </span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">observe</span>({</span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="fu">print</span>(<span class="st">"1st observer"</span>)</span>
<span id="cb23-10"><a href="#cb23-10"></a>  }, <span class="at">priority =</span> <span class="dv">1</span>)</span>
<span id="cb23-11"><a href="#cb23-11"></a>}</span>
<span id="cb23-12"><a href="#cb23-12"></a></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Taking the Shiny app below, gradually enter letters to the text input. Observe the printed messages in your R console. Why is the code in <code>reactive()</code> never run but the code in <code>observe()</code> is? Fix the example such that the code in <code>reactive()</code> is executed as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="fu">textInput</span>(<span class="st">"text"</span>, <span class="st">"enter a text"</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a>)</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, server) {</span>
<span id="cb24-6"><a href="#cb24-6"></a>  val <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="fu">print</span>(<span class="st">"reactive is executed"</span>)</span>
<span id="cb24-8"><a href="#cb24-8"></a>    input<span class="sc">$</span>text</span>
<span id="cb24-9"><a href="#cb24-9"></a>  })</span>
<span id="cb24-10"><a href="#cb24-10"></a>  </span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">observe</span>({</span>
<span id="cb24-12"><a href="#cb24-12"></a>    <span class="fu">print</span>(<span class="st">"observer is executed"</span>)</span>
<span id="cb24-13"><a href="#cb24-13"></a>    input<span class="sc">$</span>text</span>
<span id="cb24-14"><a href="#cb24-14"></a>  })</span>
<span id="cb24-15"><a href="#cb24-15"></a>}</span>
<span id="cb24-16"><a href="#cb24-16"></a></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Recall one of the main differences between <code>observe()</code> and <code>reactive()</code>: Reactives are lazy, observers are eager. Eagerly evaluated code triggers every time a dependency is invalidated, lazily evaluated triggers only when it is called from outside.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 1.3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The code in <code>observe()</code> is run because the code takes a dependency on <code>input$text</code>. Whenever the text input is changed, the observer is re-run. The code in <code>reactive()</code> also takes a dependency on <code>input$text</code>, but since reactives are evaluated lazily, <code>reactive()</code> does not changes in the input. It only executes when it is called by a reactive consumer such as <code>observe()</code> or a render function. To make the code in <code>reactive()</code> run, we can let the observer call it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">textInput</span>(<span class="st">"text"</span>, <span class="st">"enter a text"</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>)</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, server) {</span>
<span id="cb25-6"><a href="#cb25-6"></a>  val <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb25-7"><a href="#cb25-7"></a>    <span class="fu">print</span>(<span class="st">"reactive is executed"</span>)</span>
<span id="cb25-8"><a href="#cb25-8"></a>    input<span class="sc">$</span>text</span>
<span id="cb25-9"><a href="#cb25-9"></a>  })</span>
<span id="cb25-10"><a href="#cb25-10"></a>  </span>
<span id="cb25-11"><a href="#cb25-11"></a>  <span class="fu">observe</span>({</span>
<span id="cb25-12"><a href="#cb25-12"></a>    <span class="fu">print</span>(<span class="st">"observer is executed"</span>)</span>
<span id="cb25-13"><a href="#cb25-13"></a>    <span class="fu">val</span>()</span>
<span id="cb25-14"><a href="#cb25-14"></a>  })</span>
<span id="cb25-15"><a href="#cb25-15"></a>}</span>
<span id="cb25-16"><a href="#cb25-16"></a></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1.4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given the code below, which takes a variable and plots a histogram, print the summary of the selected variable each time a new variable is selected. How can this task be done without duplicating code?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">selectInput</span>(</span>
<span id="cb26-3"><a href="#cb26-3"></a>    <span class="st">"var"</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="st">"Select a variable"</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="fu">names</span>(ess)[<span class="fu">startsWith</span>(<span class="fu">names</span>(ess), <span class="st">"trust"</span>)]</span>
<span id="cb26-6"><a href="#cb26-6"></a>  ),</span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">selectInput</span>(</span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="st">"country"</span>,</span>
<span id="cb26-9"><a href="#cb26-9"></a>    <span class="st">"Select a country"</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="fu">unique</span>(ess<span class="sc">$</span>country)</span>
<span id="cb26-11"><a href="#cb26-11"></a>  ),</span>
<span id="cb26-12"><a href="#cb26-12"></a>  <span class="fu">plotOutput</span>(<span class="st">"plot"</span>)</span>
<span id="cb26-13"><a href="#cb26-13"></a>)</span>
<span id="cb26-14"><a href="#cb26-14"></a></span>
<span id="cb26-15"><a href="#cb26-15"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb26-16"><a href="#cb26-16"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb26-17"><a href="#cb26-17"></a>    ess <span class="ot">&lt;-</span> ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>country, ]</span>
<span id="cb26-18"><a href="#cb26-18"></a>    <span class="fu">ggplot</span>(ess) <span class="sc">+</span></span>
<span id="cb26-19"><a href="#cb26-19"></a>      <span class="fu">aes</span>(.data[[input<span class="sc">$</span>var]]) <span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20"></a>      <span class="fu">geom_histogram</span>()</span>
<span id="cb26-21"><a href="#cb26-21"></a>  })</span>
<span id="cb26-22"><a href="#cb26-22"></a>}</span>
<span id="cb26-23"><a href="#cb26-23"></a></span>
<span id="cb26-24"><a href="#cb26-24"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 1.4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To print the summary, implement an observer that prints the <code>summary()</code> of the selected variable. However, because the <code>ess</code> object is also filtered by the selected country, we would need to copy the filtering process to the observer as well, thus duplicating code. To avoid duplicating code, we can add a <code>reactive()</code> that performs the country filtering. The return value can then be forwarded to both <code>observe()</code> and <code>renderPlot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">selectInput</span>(</span>
<span id="cb27-3"><a href="#cb27-3"></a>    <span class="st">"var"</span>,</span>
<span id="cb27-4"><a href="#cb27-4"></a>    <span class="st">"Select a variable"</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>    <span class="fu">names</span>(ess)[<span class="fu">startsWith</span>(<span class="fu">names</span>(ess), <span class="st">"trust"</span>)]</span>
<span id="cb27-6"><a href="#cb27-6"></a>  ),</span>
<span id="cb27-7"><a href="#cb27-7"></a>  <span class="fu">selectInput</span>(</span>
<span id="cb27-8"><a href="#cb27-8"></a>    <span class="st">"country"</span>,</span>
<span id="cb27-9"><a href="#cb27-9"></a>    <span class="st">"Select a country"</span>,</span>
<span id="cb27-10"><a href="#cb27-10"></a>    <span class="fu">unique</span>(ess<span class="sc">$</span>country)</span>
<span id="cb27-11"><a href="#cb27-11"></a>  ),</span>
<span id="cb27-12"><a href="#cb27-12"></a>  <span class="fu">plotOutput</span>(<span class="st">"plot"</span>)</span>
<span id="cb27-13"><a href="#cb27-13"></a>)</span>
<span id="cb27-14"><a href="#cb27-14"></a></span>
<span id="cb27-15"><a href="#cb27-15"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb27-16"><a href="#cb27-16"></a>  ess_country <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb27-17"><a href="#cb27-17"></a>    ess[ess<span class="sc">$</span>country <span class="sc">%in%</span> input<span class="sc">$</span>country, ]</span>
<span id="cb27-18"><a href="#cb27-18"></a>  })</span>
<span id="cb27-19"><a href="#cb27-19"></a></span>
<span id="cb27-20"><a href="#cb27-20"></a>  <span class="fu">observe</span>({</span>
<span id="cb27-21"><a href="#cb27-21"></a>    <span class="fu">print</span>(<span class="fu">summary</span>(<span class="fu">ess_country</span>()[[input<span class="sc">$</span>var]]))</span>
<span id="cb27-22"><a href="#cb27-22"></a>  })</span>
<span id="cb27-23"><a href="#cb27-23"></a></span>
<span id="cb27-24"><a href="#cb27-24"></a>  output<span class="sc">$</span>plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb27-25"><a href="#cb27-25"></a>    <span class="fu">ggplot</span>(<span class="fu">ess_country</span>()) <span class="sc">+</span></span>
<span id="cb27-26"><a href="#cb27-26"></a>      <span class="fu">aes</span>(.data[[input<span class="sc">$</span>var]]) <span class="sc">+</span></span>
<span id="cb27-27"><a href="#cb27-27"></a>      <span class="fu">geom_histogram</span>()</span>
<span id="cb27-28"><a href="#cb27-28"></a>  })</span>
<span id="cb27-29"><a href="#cb27-29"></a>}</span>
<span id="cb27-30"><a href="#cb27-30"></a></span>
<span id="cb27-31"><a href="#cb27-31"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="updates-and-events" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="updates-and-events"><span class="header-section-number">8.2</span> Updates and events</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>The code below implements a UI that contains checkboxes with four European regions (Central, Eastern, Southern, Northern) and an input selection for the country. Change the app such that <code>selectizeInput()</code> only shows those countries belonging to a region selected in <code>checkboxGroupInput()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="at">Central =</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CH"</span>, <span class="st">"DE"</span>, <span class="st">"NL"</span>, <span class="st">"PL"</span>, <span class="st">"CZ"</span>),</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="at">Eastern =</span> <span class="fu">c</span>(<span class="st">"BG"</span>, <span class="st">"EE"</span>, <span class="st">"HR"</span>, <span class="st">"HU"</span>, <span class="st">"LT"</span>, <span class="st">"LV"</span>, <span class="st">"PL"</span>, <span class="st">"SI"</span>, <span class="st">"SK"</span>),</span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="at">Southern =</span> <span class="fu">c</span>(<span class="st">"ES"</span>, <span class="st">"IT"</span>, <span class="st">"PT"</span>, <span class="st">"RS"</span>, <span class="st">"ME"</span>),</span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="at">Northern =</span> <span class="fu">c</span>(<span class="st">"IS"</span>, <span class="st">"SE"</span>, <span class="st">"FI"</span>, <span class="st">"GB"</span>, <span class="st">"IE"</span>, <span class="st">"DK"</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a>)</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb28-9"><a href="#cb28-9"></a>  <span class="fu">checkboxGroupInput</span>(</span>
<span id="cb28-10"><a href="#cb28-10"></a>    <span class="st">"region"</span>,</span>
<span id="cb28-11"><a href="#cb28-11"></a>    <span class="at">label =</span> <span class="st">"Select a European region"</span>,</span>
<span id="cb28-12"><a href="#cb28-12"></a>    <span class="at">choices =</span> <span class="fu">names</span>(regions)</span>
<span id="cb28-13"><a href="#cb28-13"></a>  ),</span>
<span id="cb28-14"><a href="#cb28-14"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="st">"country"</span>,</span>
<span id="cb28-16"><a href="#cb28-16"></a>    <span class="at">label =</span> <span class="st">"Select a country"</span>,</span>
<span id="cb28-17"><a href="#cb28-17"></a>    <span class="at">choices =</span> regions</span>
<span id="cb28-18"><a href="#cb28-18"></a>  )</span>
<span id="cb28-19"><a href="#cb28-19"></a>)</span>
<span id="cb28-20"><a href="#cb28-20"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb28-22"><a href="#cb28-22"></a></span>
<span id="cb28-23"><a href="#cb28-23"></a>}</span>
<span id="cb28-24"><a href="#cb28-24"></a></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The function you need to update the input selection is called <code>updateSelectizeInput()</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 2.1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the solution, I add an observer with <code>updateSelectizeInput()</code> that updates <code>selectizeInput()</code>. The updated values correspond to the countries of the selected region in the <code>regions</code> list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="at">Central =</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CH"</span>, <span class="st">"DE"</span>, <span class="st">"NL"</span>, <span class="st">"PL"</span>, <span class="st">"CZ"</span>),</span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="at">Eastern =</span> <span class="fu">c</span>(<span class="st">"BG"</span>, <span class="st">"EE"</span>, <span class="st">"HR"</span>, <span class="st">"HU"</span>, <span class="st">"LT"</span>, <span class="st">"LV"</span>, <span class="st">"PL"</span>, <span class="st">"SI"</span>, <span class="st">"SK"</span>),</span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="at">Southern =</span> <span class="fu">c</span>(<span class="st">"ES"</span>, <span class="st">"IT"</span>, <span class="st">"PT"</span>, <span class="st">"RS"</span>, <span class="st">"ME"</span>),</span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="at">Northern =</span> <span class="fu">c</span>(<span class="st">"IS"</span>, <span class="st">"SE"</span>, <span class="st">"FI"</span>, <span class="st">"GB"</span>, <span class="st">"IE"</span>, <span class="st">"DK"</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a>)</span>
<span id="cb29-7"><a href="#cb29-7"></a></span>
<span id="cb29-8"><a href="#cb29-8"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb29-9"><a href="#cb29-9"></a>  <span class="fu">checkboxGroupInput</span>(</span>
<span id="cb29-10"><a href="#cb29-10"></a>    <span class="st">"region"</span>,</span>
<span id="cb29-11"><a href="#cb29-11"></a>    <span class="at">label =</span> <span class="st">"Select a European region"</span>,</span>
<span id="cb29-12"><a href="#cb29-12"></a>    <span class="at">choices =</span> <span class="fu">names</span>(regions)</span>
<span id="cb29-13"><a href="#cb29-13"></a>  ),</span>
<span id="cb29-14"><a href="#cb29-14"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb29-15"><a href="#cb29-15"></a>    <span class="st">"country"</span>,</span>
<span id="cb29-16"><a href="#cb29-16"></a>    <span class="at">label =</span> <span class="st">"Select a country"</span>,</span>
<span id="cb29-17"><a href="#cb29-17"></a>    <span class="at">choices =</span> regions</span>
<span id="cb29-18"><a href="#cb29-18"></a>  )</span>
<span id="cb29-19"><a href="#cb29-19"></a>)</span>
<span id="cb29-20"><a href="#cb29-20"></a></span>
<span id="cb29-21"><a href="#cb29-21"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb29-22"><a href="#cb29-22"></a>  <span class="fu">observe</span>({</span>
<span id="cb29-23"><a href="#cb29-23"></a>    <span class="fu">updateSelectizeInput</span>(</span>
<span id="cb29-24"><a href="#cb29-24"></a>      <span class="at">inputId =</span> <span class="st">"country"</span>,</span>
<span id="cb29-25"><a href="#cb29-25"></a>      <span class="at">choices =</span> regions[input<span class="sc">$</span>region]</span>
<span id="cb29-26"><a href="#cb29-26"></a>    )</span>
<span id="cb29-27"><a href="#cb29-27"></a>  })</span>
<span id="cb29-28"><a href="#cb29-28"></a>}</span>
<span id="cb29-29"><a href="#cb29-29"></a></span>
<span id="cb29-30"><a href="#cb29-30"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2.2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the app from exercise 2.1, <code>selectizeInput()</code> is updated every time a European region is selected. In this case, this is probably what we expect from the app. To get a little more control of the reactivity flow, implement an action button that needs to be pressed in order for <code>selectizeInput()</code> to be updated.</p>
<div class="cell">
<details class="code-fold">
<summary>Code from exercise 2.1</summary>
<div class="sourceCode cell-code" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="at">Central =</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CH"</span>, <span class="st">"DE"</span>, <span class="st">"NL"</span>, <span class="st">"PL"</span>, <span class="st">"CZ"</span>),</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="at">Eastern =</span> <span class="fu">c</span>(<span class="st">"BG"</span>, <span class="st">"EE"</span>, <span class="st">"HR"</span>, <span class="st">"HU"</span>, <span class="st">"LT"</span>, <span class="st">"LV"</span>, <span class="st">"PL"</span>, <span class="st">"SI"</span>, <span class="st">"SK"</span>),</span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="at">Southern =</span> <span class="fu">c</span>(<span class="st">"ES"</span>, <span class="st">"IT"</span>, <span class="st">"PT"</span>, <span class="st">"RS"</span>, <span class="st">"ME"</span>),</span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="at">Northern =</span> <span class="fu">c</span>(<span class="st">"IS"</span>, <span class="st">"SE"</span>, <span class="st">"FI"</span>, <span class="st">"GB"</span>, <span class="st">"IE"</span>, <span class="st">"DK"</span>)</span>
<span id="cb30-6"><a href="#cb30-6"></a>)</span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">checkboxGroupInput</span>(</span>
<span id="cb30-10"><a href="#cb30-10"></a>    <span class="st">"region"</span>,</span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="at">label =</span> <span class="st">"Select a European region"</span>,</span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="at">choices =</span> <span class="fu">names</span>(regions)</span>
<span id="cb30-13"><a href="#cb30-13"></a>  ),</span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb30-15"><a href="#cb30-15"></a>    <span class="st">"country"</span>,</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="at">label =</span> <span class="st">"Select a country"</span>,</span>
<span id="cb30-17"><a href="#cb30-17"></a>    <span class="at">choices =</span> regions</span>
<span id="cb30-18"><a href="#cb30-18"></a>  )</span>
<span id="cb30-19"><a href="#cb30-19"></a>)</span>
<span id="cb30-20"><a href="#cb30-20"></a></span>
<span id="cb30-21"><a href="#cb30-21"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb30-22"><a href="#cb30-22"></a>  <span class="fu">observe</span>({</span>
<span id="cb30-23"><a href="#cb30-23"></a>    <span class="fu">updateSelectizeInput</span>(</span>
<span id="cb30-24"><a href="#cb30-24"></a>      <span class="at">inputId =</span> <span class="st">"country"</span>,</span>
<span id="cb30-25"><a href="#cb30-25"></a>      <span class="at">choices =</span> regions[input<span class="sc">$</span>region]</span>
<span id="cb30-26"><a href="#cb30-26"></a>    )</span>
<span id="cb30-27"><a href="#cb30-27"></a>  })</span>
<span id="cb30-28"><a href="#cb30-28"></a>}</span>
<span id="cb30-29"><a href="#cb30-29"></a></span>
<span id="cb30-30"><a href="#cb30-30"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 2.2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the solution, I add an observer with <code>updateSelectizeInput()</code> that updates <code>selectizeInput()</code>. The updated values correspond to the countries of the selected region in the <code>regions</code> list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="at">Central =</span> <span class="fu">c</span>(<span class="st">"AT"</span>, <span class="st">"BE"</span>, <span class="st">"CH"</span>, <span class="st">"DE"</span>, <span class="st">"NL"</span>, <span class="st">"PL"</span>, <span class="st">"CZ"</span>),</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="at">Eastern =</span> <span class="fu">c</span>(<span class="st">"BG"</span>, <span class="st">"EE"</span>, <span class="st">"HR"</span>, <span class="st">"HU"</span>, <span class="st">"LT"</span>, <span class="st">"LV"</span>, <span class="st">"PL"</span>, <span class="st">"SI"</span>, <span class="st">"SK"</span>),</span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="at">Southern =</span> <span class="fu">c</span>(<span class="st">"ES"</span>, <span class="st">"IT"</span>, <span class="st">"PT"</span>, <span class="st">"RS"</span>, <span class="st">"ME"</span>),</span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="at">Northern =</span> <span class="fu">c</span>(<span class="st">"IS"</span>, <span class="st">"SE"</span>, <span class="st">"FI"</span>, <span class="st">"GB"</span>, <span class="st">"IE"</span>, <span class="st">"DK"</span>)</span>
<span id="cb31-6"><a href="#cb31-6"></a>)</span>
<span id="cb31-7"><a href="#cb31-7"></a></span>
<span id="cb31-8"><a href="#cb31-8"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="fu">checkboxGroupInput</span>(</span>
<span id="cb31-10"><a href="#cb31-10"></a>    <span class="st">"region"</span>,</span>
<span id="cb31-11"><a href="#cb31-11"></a>    <span class="at">label =</span> <span class="st">"Select a European region"</span>,</span>
<span id="cb31-12"><a href="#cb31-12"></a>    <span class="at">choices =</span> <span class="fu">names</span>(regions)</span>
<span id="cb31-13"><a href="#cb31-13"></a>  ),</span>
<span id="cb31-14"><a href="#cb31-14"></a>  <span class="fu">selectizeInput</span>(</span>
<span id="cb31-15"><a href="#cb31-15"></a>    <span class="st">"country"</span>,</span>
<span id="cb31-16"><a href="#cb31-16"></a>    <span class="at">label =</span> <span class="st">"Select a country"</span>,</span>
<span id="cb31-17"><a href="#cb31-17"></a>    <span class="at">choices =</span> regions</span>
<span id="cb31-18"><a href="#cb31-18"></a>  ),</span>
<span id="cb31-19"><a href="#cb31-19"></a>  <span class="fu">actionButton</span>(</span>
<span id="cb31-20"><a href="#cb31-20"></a>    <span class="st">"button"</span>,</span>
<span id="cb31-21"><a href="#cb31-21"></a>    <span class="at">label =</span> <span class="st">"Update"</span>,</span>
<span id="cb31-22"><a href="#cb31-22"></a>    <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>)</span>
<span id="cb31-23"><a href="#cb31-23"></a>  )</span>
<span id="cb31-24"><a href="#cb31-24"></a>)</span>
<span id="cb31-25"><a href="#cb31-25"></a></span>
<span id="cb31-26"><a href="#cb31-26"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb31-27"><a href="#cb31-27"></a>  <span class="fu">observe</span>({</span>
<span id="cb31-28"><a href="#cb31-28"></a>    <span class="fu">updateSelectizeInput</span>(</span>
<span id="cb31-29"><a href="#cb31-29"></a>      <span class="at">inputId =</span> <span class="st">"country"</span>,</span>
<span id="cb31-30"><a href="#cb31-30"></a>      <span class="at">choices =</span> regions[input<span class="sc">$</span>region]</span>
<span id="cb31-31"><a href="#cb31-31"></a>    )</span>
<span id="cb31-32"><a href="#cb31-32"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>button)</span>
<span id="cb31-34"><a href="#cb31-34"></a>}</span>
<span id="cb31-35"><a href="#cb31-35"></a></span>
<span id="cb31-36"><a href="#cb31-36"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2.3
</div>
</div>
<div class="callout-body-container callout-body">
<p>The (admittedly quite useless) Shiny app below implements two buttons, each of which adds 1 to either tab A or tab B. Right now, to see the result in either tab, you would need to manually click on the tabs. Change the app such that changing button A or B automatically opens the corresponding tab.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="at">id =</span> <span class="st">"tabset_panel"</span>,</span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb32-5"><a href="#cb32-5"></a>      <span class="fu">actionButton</span>(<span class="st">"button_a"</span>, <span class="st">"Add to A"</span>),</span>
<span id="cb32-6"><a href="#cb32-6"></a>      <span class="fu">br</span>(),</span>
<span id="cb32-7"><a href="#cb32-7"></a>      <span class="fu">actionButton</span>(<span class="st">"button_b"</span>, <span class="st">"Add to B"</span>)</span>
<span id="cb32-8"><a href="#cb32-8"></a>    ),</span>
<span id="cb32-9"><a href="#cb32-9"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb32-10"><a href="#cb32-10"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb32-11"><a href="#cb32-11"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb32-12"><a href="#cb32-12"></a>          <span class="at">title =</span> <span class="st">"Tab A"</span>,</span>
<span id="cb32-13"><a href="#cb32-13"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_a"</span>)</span>
<span id="cb32-14"><a href="#cb32-14"></a>        ),</span>
<span id="cb32-15"><a href="#cb32-15"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb32-16"><a href="#cb32-16"></a>          <span class="at">title =</span> <span class="st">"Tab B"</span>,</span>
<span id="cb32-17"><a href="#cb32-17"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_b"</span>)</span>
<span id="cb32-18"><a href="#cb32-18"></a>        )</span>
<span id="cb32-19"><a href="#cb32-19"></a>      )</span>
<span id="cb32-20"><a href="#cb32-20"></a>    )</span>
<span id="cb32-21"><a href="#cb32-21"></a>  )</span>
<span id="cb32-22"><a href="#cb32-22"></a>)</span>
<span id="cb32-23"><a href="#cb32-23"></a></span>
<span id="cb32-24"><a href="#cb32-24"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb32-25"><a href="#cb32-25"></a>  output<span class="sc">$</span>tab_a <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_a))</span>
<span id="cb32-26"><a href="#cb32-26"></a>  output<span class="sc">$</span>tab_b <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_b))</span>
<span id="cb32-27"><a href="#cb32-27"></a>}</span>
<span id="cb32-28"><a href="#cb32-28"></a></span>
<span id="cb32-29"><a href="#cb32-29"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The function that you need to update a tabset panel is called <code>updateTabsetPanel()</code>. It requires the ID assigned to <code>tabsetPanel()</code>.</p>
<p>While there are technically many ways to solve this task, the most obvious one at this point requires two observers. If you want to implement the solution using only a single observer, consider using super assignment (see <code>?"&lt;&lt;-"</code> or <a href="https://adv-r.hadley.nz/environments.html#super-assignment--">here</a>).</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 2.3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the server function, I add two observers. The first only triggers when <code>tab_a</code> is pressed, the second one when <code>tab_b</code> is pressed. Within each observer, the tabset panel is updated using <code>updateTabsetPanel()</code>. <code>inputId</code> takes <code>"tabset_panel"</code>, the ID assigned to <code>tabsetPanel()</code> in the UI. <code>selected</code> takes the label of the tab that should be selected.</p>
<p>It is also possible to implement a solution with only a single observer, but this is much trickier. The code chunk below implements such a solution using the super assignment operator <code>&lt;&lt;-</code>. Since reactive expressions are technically functions, you can use <code>&lt;&lt;-</code> to conveniently store non-reactive values in the session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb33-3"><a href="#cb33-3"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb33-4"><a href="#cb33-4"></a>      <span class="fu">actionButton</span>(<span class="st">"button_a"</span>, <span class="st">"Add to A"</span>),</span>
<span id="cb33-5"><a href="#cb33-5"></a>      <span class="fu">br</span>(),</span>
<span id="cb33-6"><a href="#cb33-6"></a>      <span class="fu">actionButton</span>(<span class="st">"button_b"</span>, <span class="st">"Add to B"</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>    ),</span>
<span id="cb33-8"><a href="#cb33-8"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb33-9"><a href="#cb33-9"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb33-10"><a href="#cb33-10"></a>        <span class="at">id =</span> <span class="st">"tabset_panel"</span>,</span>
<span id="cb33-11"><a href="#cb33-11"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb33-12"><a href="#cb33-12"></a>          <span class="at">title =</span> <span class="st">"Tab A"</span>,</span>
<span id="cb33-13"><a href="#cb33-13"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_a"</span>)</span>
<span id="cb33-14"><a href="#cb33-14"></a>        ),</span>
<span id="cb33-15"><a href="#cb33-15"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb33-16"><a href="#cb33-16"></a>          <span class="at">title =</span> <span class="st">"Tab B"</span>,</span>
<span id="cb33-17"><a href="#cb33-17"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_b"</span>)</span>
<span id="cb33-18"><a href="#cb33-18"></a>        )</span>
<span id="cb33-19"><a href="#cb33-19"></a>      )</span>
<span id="cb33-20"><a href="#cb33-20"></a>    )</span>
<span id="cb33-21"><a href="#cb33-21"></a>  )</span>
<span id="cb33-22"><a href="#cb33-22"></a>)</span>
<span id="cb33-23"><a href="#cb33-23"></a></span>
<span id="cb33-24"><a href="#cb33-24"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb33-25"><a href="#cb33-25"></a>  output<span class="sc">$</span>tab_a <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_a))</span>
<span id="cb33-26"><a href="#cb33-26"></a>  output<span class="sc">$</span>tab_b <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_b))</span>
<span id="cb33-27"><a href="#cb33-27"></a>  </span>
<span id="cb33-28"><a href="#cb33-28"></a>  <span class="fu">observe</span>({</span>
<span id="cb33-29"><a href="#cb33-29"></a>    <span class="fu">updateTabsetPanel</span>(<span class="at">inputId =</span> <span class="st">"tabset_panel"</span>, <span class="at">selected =</span> <span class="st">"Tab A"</span>)</span>
<span id="cb33-30"><a href="#cb33-30"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb33-31"><a href="#cb33-31"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>button_a)</span>
<span id="cb33-32"><a href="#cb33-32"></a>  </span>
<span id="cb33-33"><a href="#cb33-33"></a>  <span class="fu">observe</span>({</span>
<span id="cb33-34"><a href="#cb33-34"></a>    <span class="fu">updateTabsetPanel</span>(<span class="at">inputId =</span> <span class="st">"tabset_panel"</span>, <span class="at">selected =</span> <span class="st">"Tab B"</span>)</span>
<span id="cb33-35"><a href="#cb33-35"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb33-36"><a href="#cb33-36"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>button_b)</span>
<span id="cb33-37"><a href="#cb33-37"></a>}</span>
<span id="cb33-38"><a href="#cb33-38"></a></span>
<span id="cb33-39"><a href="#cb33-39"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Alternative solution</summary>
<div class="sourceCode cell-code" id="cb34" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb34-2"><a href="#cb34-2"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb34-3"><a href="#cb34-3"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb34-4"><a href="#cb34-4"></a>      <span class="fu">actionButton</span>(<span class="st">"button_a"</span>, <span class="st">"Add to A"</span>),</span>
<span id="cb34-5"><a href="#cb34-5"></a>      <span class="fu">br</span>(),</span>
<span id="cb34-6"><a href="#cb34-6"></a>      <span class="fu">actionButton</span>(<span class="st">"button_b"</span>, <span class="st">"Add to B"</span>)</span>
<span id="cb34-7"><a href="#cb34-7"></a>    ),</span>
<span id="cb34-8"><a href="#cb34-8"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb34-9"><a href="#cb34-9"></a>      <span class="fu">tabsetPanel</span>(</span>
<span id="cb34-10"><a href="#cb34-10"></a>        <span class="at">id =</span> <span class="st">"tabset_panel"</span>,</span>
<span id="cb34-11"><a href="#cb34-11"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb34-12"><a href="#cb34-12"></a>          <span class="at">title =</span> <span class="st">"Tab A"</span>,</span>
<span id="cb34-13"><a href="#cb34-13"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_a"</span>)</span>
<span id="cb34-14"><a href="#cb34-14"></a>        ),</span>
<span id="cb34-15"><a href="#cb34-15"></a>        <span class="fu">tabPanel</span>(</span>
<span id="cb34-16"><a href="#cb34-16"></a>          <span class="at">title =</span> <span class="st">"Tab B"</span>,</span>
<span id="cb34-17"><a href="#cb34-17"></a>          <span class="fu">verbatimTextOutput</span>(<span class="st">"tab_b"</span>)</span>
<span id="cb34-18"><a href="#cb34-18"></a>        )</span>
<span id="cb34-19"><a href="#cb34-19"></a>      )</span>
<span id="cb34-20"><a href="#cb34-20"></a>    )</span>
<span id="cb34-21"><a href="#cb34-21"></a>  )</span>
<span id="cb34-22"><a href="#cb34-22"></a>)</span>
<span id="cb34-23"><a href="#cb34-23"></a></span>
<span id="cb34-24"><a href="#cb34-24"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb34-25"><a href="#cb34-25"></a>  output<span class="sc">$</span>tab_a <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_a))</span>
<span id="cb34-26"><a href="#cb34-26"></a>  output<span class="sc">$</span>tab_b <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>(<span class="fu">as.vector</span>(input<span class="sc">$</span>button_b))</span>
<span id="cb34-27"><a href="#cb34-27"></a>  </span>
<span id="cb34-28"><a href="#cb34-28"></a>  last_a <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-29"><a href="#cb34-29"></a>  last_b <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-30"><a href="#cb34-30"></a>  <span class="fu">observe</span>({</span>
<span id="cb34-31"><a href="#cb34-31"></a>    button_a <span class="ot">&lt;-</span> input<span class="sc">$</span>button_a</span>
<span id="cb34-32"><a href="#cb34-32"></a>    button_b <span class="ot">&lt;-</span> input<span class="sc">$</span>button_b</span>
<span id="cb34-33"><a href="#cb34-33"></a>    <span class="cf">if</span> (button_a <span class="sc">!=</span> last_a) {</span>
<span id="cb34-34"><a href="#cb34-34"></a>      last_a <span class="ot">&lt;&lt;-</span> button_a</span>
<span id="cb34-35"><a href="#cb34-35"></a>      sel <span class="ot">&lt;-</span> <span class="st">"Tab A"</span></span>
<span id="cb34-36"><a href="#cb34-36"></a>    } <span class="cf">else</span> <span class="cf">if</span> (button_b <span class="sc">!=</span> last_b) {</span>
<span id="cb34-37"><a href="#cb34-37"></a>      last_b <span class="ot">&lt;&lt;-</span> button_b</span>
<span id="cb34-38"><a href="#cb34-38"></a>      sel <span class="ot">&lt;-</span> <span class="st">"Tab B"</span></span>
<span id="cb34-39"><a href="#cb34-39"></a>    } <span class="cf">else</span> {</span>
<span id="cb34-40"><a href="#cb34-40"></a>      <span class="fu">return</span>()</span>
<span id="cb34-41"><a href="#cb34-41"></a>    }</span>
<span id="cb34-42"><a href="#cb34-42"></a>    </span>
<span id="cb34-43"><a href="#cb34-43"></a>    <span class="fu">updateTabsetPanel</span>(<span class="at">inputId =</span> <span class="st">"tabset_panel"</span>, <span class="at">selected =</span> sel)</span>
<span id="cb34-44"><a href="#cb34-44"></a>  })</span>
<span id="cb34-45"><a href="#cb34-45"></a>}</span>
<span id="cb34-46"><a href="#cb34-46"></a></span>
<span id="cb34-47"><a href="#cb34-47"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="truthiness-and-validation" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="truthiness-and-validation"><span class="header-section-number">8.3</span> Truthiness and validation</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 3.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Shiny app below implements three features: - A numeric input that lets you select a number to compute the natural logarithm of - A file input that lets you read and print an R object from a file - An input selection that shows you an emoji depending on the selected value</p>
<p>At its current state, the app does not go out of its way to check the input for correctness. What problems could this cause in the usage of the app? How can these problems be prevented? Implement an input validation that catches potential problems before they occur and gives appropriate feedback to the user.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="fu">column</span>(</span>
<span id="cb35-4"><a href="#cb35-4"></a>      <span class="dv">4</span>,</span>
<span id="cb35-5"><a href="#cb35-5"></a>      <span class="fu">numericInput</span>(</span>
<span id="cb35-6"><a href="#cb35-6"></a>        <span class="st">"number"</span>,</span>
<span id="cb35-7"><a href="#cb35-7"></a>        <span class="at">label =</span> <span class="st">"Select a number to compute the natural log of"</span>,</span>
<span id="cb35-8"><a href="#cb35-8"></a>        <span class="at">value =</span> <span class="dv">3</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>      )</span>
<span id="cb35-10"><a href="#cb35-10"></a>    ),</span>
<span id="cb35-11"><a href="#cb35-11"></a>    <span class="fu">column</span>(</span>
<span id="cb35-12"><a href="#cb35-12"></a>      <span class="dv">4</span>,</span>
<span id="cb35-13"><a href="#cb35-13"></a>      <span class="fu">verbatimTextOutput</span>(<span class="st">"number_result"</span>)</span>
<span id="cb35-14"><a href="#cb35-14"></a>    )</span>
<span id="cb35-15"><a href="#cb35-15"></a>  ),</span>
<span id="cb35-16"><a href="#cb35-16"></a>  </span>
<span id="cb35-17"><a href="#cb35-17"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb35-18"><a href="#cb35-18"></a>    <span class="fu">column</span>(</span>
<span id="cb35-19"><a href="#cb35-19"></a>      <span class="dv">4</span>,</span>
<span id="cb35-20"><a href="#cb35-20"></a>      <span class="fu">fileInput</span>(</span>
<span id="cb35-21"><a href="#cb35-21"></a>        <span class="st">"file"</span>,</span>
<span id="cb35-22"><a href="#cb35-22"></a>        <span class="at">label =</span> <span class="st">"Select an RDS file"</span></span>
<span id="cb35-23"><a href="#cb35-23"></a>      )</span>
<span id="cb35-24"><a href="#cb35-24"></a>    ),</span>
<span id="cb35-25"><a href="#cb35-25"></a>    <span class="fu">column</span>(</span>
<span id="cb35-26"><a href="#cb35-26"></a>      <span class="dv">4</span>,</span>
<span id="cb35-27"><a href="#cb35-27"></a>      <span class="fu">verbatimTextOutput</span>(<span class="st">"file_result"</span>)</span>
<span id="cb35-28"><a href="#cb35-28"></a>    )</span>
<span id="cb35-29"><a href="#cb35-29"></a>  ),</span>
<span id="cb35-30"><a href="#cb35-30"></a>  </span>
<span id="cb35-31"><a href="#cb35-31"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb35-32"><a href="#cb35-32"></a>    <span class="fu">column</span>(</span>
<span id="cb35-33"><a href="#cb35-33"></a>      <span class="dv">4</span>,</span>
<span id="cb35-34"><a href="#cb35-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb35-35"><a href="#cb35-35"></a>        <span class="st">"animal"</span>,</span>
<span id="cb35-36"><a href="#cb35-36"></a>        <span class="at">label =</span> <span class="st">"Select an animal"</span>,</span>
<span id="cb35-37"><a href="#cb35-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"dog"</span>, <span class="st">"cat"</span>, <span class="st">"mouse"</span>),</span>
<span id="cb35-38"><a href="#cb35-38"></a>        <span class="at">selected =</span> <span class="st">"mouse"</span>,</span>
<span id="cb35-39"><a href="#cb35-39"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb35-40"><a href="#cb35-40"></a>      )</span>
<span id="cb35-41"><a href="#cb35-41"></a>    ),</span>
<span id="cb35-42"><a href="#cb35-42"></a>    <span class="fu">column</span>(</span>
<span id="cb35-43"><a href="#cb35-43"></a>      <span class="dv">4</span>,</span>
<span id="cb35-44"><a href="#cb35-44"></a>      <span class="fu">htmlOutput</span>(<span class="st">"animal_result"</span>)</span>
<span id="cb35-45"><a href="#cb35-45"></a>    )</span>
<span id="cb35-46"><a href="#cb35-46"></a>  )</span>
<span id="cb35-47"><a href="#cb35-47"></a>)</span>
<span id="cb35-48"><a href="#cb35-48"></a></span>
<span id="cb35-49"><a href="#cb35-49"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb35-50"><a href="#cb35-50"></a>  output<span class="sc">$</span>number_result <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb35-51"><a href="#cb35-51"></a>    lg <span class="ot">&lt;-</span> <span class="fu">log</span>(input<span class="sc">$</span>number)</span>
<span id="cb35-52"><a href="#cb35-52"></a>    <span class="fu">paste0</span>(<span class="st">"Natural logarithm:</span><span class="sc">\n</span><span class="st">"</span>, lg)</span>
<span id="cb35-53"><a href="#cb35-53"></a>  })</span>
<span id="cb35-54"><a href="#cb35-54"></a>  </span>
<span id="cb35-55"><a href="#cb35-55"></a>  output<span class="sc">$</span>file_result <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb35-56"><a href="#cb35-56"></a>    <span class="fu">readRDS</span>(input<span class="sc">$</span>file)</span>
<span id="cb35-57"><a href="#cb35-57"></a>  })</span>
<span id="cb35-58"><a href="#cb35-58"></a>  </span>
<span id="cb35-59"><a href="#cb35-59"></a>  output<span class="sc">$</span>animal_result <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb35-60"><a href="#cb35-60"></a>    url <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb35-61"><a href="#cb35-61"></a>      input<span class="sc">$</span>animal,</span>
<span id="cb35-62"><a href="#cb35-62"></a>      <span class="at">dog =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f415.svg"</span>,</span>
<span id="cb35-63"><a href="#cb35-63"></a>      <span class="at">cat =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f408.svg"</span>,</span>
<span id="cb35-64"><a href="#cb35-64"></a>      <span class="at">mouse =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f401.svg"</span></span>
<span id="cb35-65"><a href="#cb35-65"></a>    )</span>
<span id="cb35-66"><a href="#cb35-66"></a>    <span class="fu">img</span>(<span class="at">src =</span> url, <span class="at">width =</span> <span class="st">"30%"</span>)</span>
<span id="cb35-67"><a href="#cb35-67"></a>  })</span>
<span id="cb35-68"><a href="#cb35-68"></a>}</span>
<span id="cb35-69"><a href="#cb35-69"></a></span>
<span id="cb35-70"><a href="#cb35-70"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Experiment with the app to find out ways the app could fail or produce an undesirable result. An undesirable result can be an error, but it can also be an unexpected value like <code>NA</code>.</p>
<p>The <code>validate()</code> function can take an arbitrary amount of <code>need()</code>s to check for multiple conditions.</p>
<p>If one condition needs to be checked before the other conditions, you can wrap it in a separate call to <code>validate()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="fu">validate</span>(<span class="fu">need</span>(<span class="cn">TRUE</span>, <span class="st">"Necessary first condition"</span>))</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="fu">validate</span>(</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">need</span>(<span class="cn">TRUE</span>, <span class="st">"all"</span>),</span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="fu">need</span>(<span class="cn">TRUE</span>, <span class="st">"the"</span>),</span>
<span id="cb36-6"><a href="#cb36-6"></a>  <span class="fu">need</span>(<span class="cn">TRUE</span>, <span class="st">"other"</span>),</span>
<span id="cb36-7"><a href="#cb36-7"></a>  <span class="fu">need</span>(<span class="cn">TRUE</span>, <span class="st">"conditions"</span>)</span>
<span id="cb36-8"><a href="#cb36-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution 2.3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One problem with the app can be observed directly upon starting the app: The default value of <code>input$file</code> (which is <code>NULL</code>) cannot be read by <code>readRDS()</code>: Shiny issues an error. Similar behavior can be seen when selecting a non-natural number of when selecting multiple animals.</p>
<p>A possible solution to this problem is to use <code>validate()</code> to check the input before processing it. The following code chunk implements several checks: - For <code>numericInput()</code>, it checks whether the selected number is larger than 0. - For <code>fileInput()</code>, it first checks whether the file is <code>NULL</code>. If not, it proceeds to check if the file exists and if it ends on <code>.rds</code>. - For <code>selectInput()</code>, it checks whether at least one, but not two or more animals are selected.</p>
<div class="cell" data-source-line-numbers="52-54,61-65,72-75">
<details class="code-fold">
<summary>Alternative solution</summary>
<div class="sourceCode cell-code" id="cb37" data-source-line-numbers="52-54,61-65,72-75" data-code-line-numbers="52-54,61-65,72-75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="fu">column</span>(</span>
<span id="cb37-4"><a href="#cb37-4"></a>      <span class="dv">4</span>,</span>
<span id="cb37-5"><a href="#cb37-5"></a>      <span class="fu">numericInput</span>(</span>
<span id="cb37-6"><a href="#cb37-6"></a>        <span class="st">"number"</span>,</span>
<span id="cb37-7"><a href="#cb37-7"></a>        <span class="at">label =</span> <span class="st">"Select a number to compute the natural log of"</span>,</span>
<span id="cb37-8"><a href="#cb37-8"></a>        <span class="at">value =</span> <span class="dv">3</span></span>
<span id="cb37-9"><a href="#cb37-9"></a>      )</span>
<span id="cb37-10"><a href="#cb37-10"></a>    ),</span>
<span id="cb37-11"><a href="#cb37-11"></a>    <span class="fu">column</span>(</span>
<span id="cb37-12"><a href="#cb37-12"></a>      <span class="dv">4</span>,</span>
<span id="cb37-13"><a href="#cb37-13"></a>      <span class="fu">verbatimTextOutput</span>(<span class="st">"number_result"</span>)</span>
<span id="cb37-14"><a href="#cb37-14"></a>    )</span>
<span id="cb37-15"><a href="#cb37-15"></a>  ),</span>
<span id="cb37-16"><a href="#cb37-16"></a>  </span>
<span id="cb37-17"><a href="#cb37-17"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb37-18"><a href="#cb37-18"></a>    <span class="fu">column</span>(</span>
<span id="cb37-19"><a href="#cb37-19"></a>      <span class="dv">4</span>,</span>
<span id="cb37-20"><a href="#cb37-20"></a>      <span class="fu">fileInput</span>(</span>
<span id="cb37-21"><a href="#cb37-21"></a>        <span class="st">"file"</span>,</span>
<span id="cb37-22"><a href="#cb37-22"></a>        <span class="at">label =</span> <span class="st">"Select an RDS file"</span></span>
<span id="cb37-23"><a href="#cb37-23"></a>      )</span>
<span id="cb37-24"><a href="#cb37-24"></a>    ),</span>
<span id="cb37-25"><a href="#cb37-25"></a>    <span class="fu">column</span>(</span>
<span id="cb37-26"><a href="#cb37-26"></a>      <span class="dv">4</span>,</span>
<span id="cb37-27"><a href="#cb37-27"></a>      <span class="fu">verbatimTextOutput</span>(<span class="st">"file_result"</span>)</span>
<span id="cb37-28"><a href="#cb37-28"></a>    )</span>
<span id="cb37-29"><a href="#cb37-29"></a>  ),</span>
<span id="cb37-30"><a href="#cb37-30"></a>  </span>
<span id="cb37-31"><a href="#cb37-31"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb37-32"><a href="#cb37-32"></a>    <span class="fu">column</span>(</span>
<span id="cb37-33"><a href="#cb37-33"></a>      <span class="dv">4</span>,</span>
<span id="cb37-34"><a href="#cb37-34"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb37-35"><a href="#cb37-35"></a>        <span class="st">"animal"</span>,</span>
<span id="cb37-36"><a href="#cb37-36"></a>        <span class="at">label =</span> <span class="st">"Select an animal"</span>,</span>
<span id="cb37-37"><a href="#cb37-37"></a>        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"dog"</span>, <span class="st">"cat"</span>, <span class="st">"mouse"</span>),</span>
<span id="cb37-38"><a href="#cb37-38"></a>        <span class="at">selected =</span> <span class="st">"mouse"</span>,</span>
<span id="cb37-39"><a href="#cb37-39"></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb37-40"><a href="#cb37-40"></a>      )</span>
<span id="cb37-41"><a href="#cb37-41"></a>    ),</span>
<span id="cb37-42"><a href="#cb37-42"></a>    <span class="fu">column</span>(</span>
<span id="cb37-43"><a href="#cb37-43"></a>      <span class="dv">4</span>,</span>
<span id="cb37-44"><a href="#cb37-44"></a>      <span class="fu">htmlOutput</span>(<span class="st">"animal_result"</span>)</span>
<span id="cb37-45"><a href="#cb37-45"></a>    )</span>
<span id="cb37-46"><a href="#cb37-46"></a>  )</span>
<span id="cb37-47"><a href="#cb37-47"></a>)</span>
<span id="cb37-48"><a href="#cb37-48"></a></span>
<span id="cb37-49"><a href="#cb37-49"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb37-50"><a href="#cb37-50"></a>  output<span class="sc">$</span>number_result <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb37-51"><a href="#cb37-51"></a>    number <span class="ot">&lt;-</span> input<span class="sc">$</span>number</span>
<span id="cb37-52"><a href="#cb37-52"></a>    <span class="fu">validate</span>(</span>
<span id="cb37-53"><a href="#cb37-53"></a>      <span class="fu">need</span>(number <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Input must be a natural number."</span>)</span>
<span id="cb37-54"><a href="#cb37-54"></a>    )</span>
<span id="cb37-55"><a href="#cb37-55"></a>    </span>
<span id="cb37-56"><a href="#cb37-56"></a>    <span class="fu">log</span>(number)</span>
<span id="cb37-57"><a href="#cb37-57"></a>  })</span>
<span id="cb37-58"><a href="#cb37-58"></a>  </span>
<span id="cb37-59"><a href="#cb37-59"></a>  output<span class="sc">$</span>file_result <span class="ot">&lt;-</span> <span class="fu">renderPrint</span>({</span>
<span id="cb37-60"><a href="#cb37-60"></a>    file <span class="ot">&lt;-</span> input<span class="sc">$</span>file<span class="sc">$</span>datapath</span>
<span id="cb37-61"><a href="#cb37-61"></a>    <span class="fu">validate</span>(<span class="fu">need</span>(<span class="sc">!</span><span class="fu">is.null</span>(file), <span class="st">"Please select an RDS file"</span>))</span>
<span id="cb37-62"><a href="#cb37-62"></a>    <span class="fu">validate</span>(</span>
<span id="cb37-63"><a href="#cb37-63"></a>      <span class="fu">need</span>(<span class="fu">file.exists</span>(file), <span class="st">"Input file must exist"</span>),</span>
<span id="cb37-64"><a href="#cb37-64"></a>      <span class="fu">need</span>(<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.rds$"</span>, file), <span class="st">"Input file must be .rds"</span>)</span>
<span id="cb37-65"><a href="#cb37-65"></a>    )</span>
<span id="cb37-66"><a href="#cb37-66"></a>    </span>
<span id="cb37-67"><a href="#cb37-67"></a>    <span class="fu">readRDS</span>(file)</span>
<span id="cb37-68"><a href="#cb37-68"></a>  })</span>
<span id="cb37-69"><a href="#cb37-69"></a>  </span>
<span id="cb37-70"><a href="#cb37-70"></a>  output<span class="sc">$</span>animal_result <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb37-71"><a href="#cb37-71"></a>    animal <span class="ot">&lt;-</span> input<span class="sc">$</span>animal</span>
<span id="cb37-72"><a href="#cb37-72"></a>    <span class="fu">validate</span>(</span>
<span id="cb37-73"><a href="#cb37-73"></a>      <span class="fu">need</span>(<span class="fu">length</span>(animal) <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Please select an animal."</span>),</span>
<span id="cb37-74"><a href="#cb37-74"></a>      <span class="fu">need</span>(<span class="fu">length</span>(animal) <span class="sc">&lt;</span> <span class="dv">2</span>, <span class="st">"Please select a maximum of one animal."</span>)</span>
<span id="cb37-75"><a href="#cb37-75"></a>    )</span>
<span id="cb37-76"><a href="#cb37-76"></a>    </span>
<span id="cb37-77"><a href="#cb37-77"></a>    url <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb37-78"><a href="#cb37-78"></a>      animal,</span>
<span id="cb37-79"><a href="#cb37-79"></a>      <span class="at">dog =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f415.svg"</span>,</span>
<span id="cb37-80"><a href="#cb37-80"></a>      <span class="at">cat =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f408.svg"</span>,</span>
<span id="cb37-81"><a href="#cb37-81"></a>      <span class="at">mouse =</span> <span class="st">"https://images.emojiterra.com/google/noto-emoji/unicode-15.1/color/svg/1f401.svg"</span></span>
<span id="cb37-82"><a href="#cb37-82"></a>    )</span>
<span id="cb37-83"><a href="#cb37-83"></a>    <span class="fu">img</span>(<span class="at">src =</span> url, <span class="at">width =</span> <span class="st">"30%"</span>)</span>
<span id="cb37-84"><a href="#cb37-84"></a>  })</span>
<span id="cb37-85"><a href="#cb37-85"></a>}</span>
<span id="cb37-86"><a href="#cb37-86"></a></span>
<span id="cb37-87"><a href="#cb37-87"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/bookdown\.org\/paul\/shiny_workshop\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/paulcbauer/shiny_workshop/edit/main/05-server-reactive-programming-ii.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/paulcbauer/shiny_workshop/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>