<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Workshop: Interactive Data Analysis with Shiny - Mapping data &amp; advanced visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BVZNWTMFX1"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BVZNWTMFX1', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="Workshop: Interactive Data Analysis with Shiny - Mapping data &amp; advanced visualization">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-mapping.html">Mapping data &amp; advanced visualization</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Interactive Data Analysis with Shiny</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://training.gesis.org/?site=pDetails&amp;child=full&amp;pID=0x0D17F8F738B14E0991504DBF8823A002" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-cursor-fill"></i></a>
    <a href="https://github.com/paulcbauer/shiny_workshop" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://github.com/paulcbauer/shiny_workshop/issues" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bug-fill"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-workshop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-user-interface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">User Interface (UI): Designing the front end</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-server-reactive-programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Server: Reactive programming</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelling and visualizing data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-mapping.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Mapping data &amp; advanced visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-theming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Theming &amp; styling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-deployment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Strengthen &amp; Deploy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-guerry-app-all-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guerry app: All the code</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#interactive-maps" id="toc-interactive-maps" class="nav-link active" data-scroll-target="#interactive-maps"><span class="header-section-number">1</span> Interactive maps</a>
  <ul class="collapse">
  <li><a href="#current-app-state" id="toc-current-app-state" class="nav-link" data-scroll-target="#current-app-state"><span class="header-section-number">1.1</span> Current app state</a></li>
  <li><a href="#further-resources" id="toc-further-resources" class="nav-link" data-scroll-target="#further-resources"><span class="header-section-number">1.2</span> Further resources</a></li>
  </ul></li>
  <li><a href="#basics-of-spatial-data" id="toc-basics-of-spatial-data" class="nav-link" data-scroll-target="#basics-of-spatial-data"><span class="header-section-number">2</span> Basics of spatial data</a>
  <ul class="collapse">
  <li><a href="#types-of-spatial-data" id="toc-types-of-spatial-data" class="nav-link" data-scroll-target="#types-of-spatial-data"><span class="header-section-number">2.1</span> Types of spatial data</a></li>
  <li><a href="#spatial-data-in-r" id="toc-spatial-data-in-r" class="nav-link" data-scroll-target="#spatial-data-in-r"><span class="header-section-number">2.2</span> Spatial data in R</a></li>
  <li><a href="#coordinate-reference-systems" id="toc-coordinate-reference-systems" class="nav-link" data-scroll-target="#coordinate-reference-systems"><span class="header-section-number">2.3</span> Coordinate reference systems</a></li>
  <li><a href="#epsg-codes" id="toc-epsg-codes" class="nav-link" data-scroll-target="#epsg-codes"><span class="header-section-number">2.4</span> EPSG codes</a></li>
  <li><a href="#crs-in-r" id="toc-crs-in-r" class="nav-link" data-scroll-target="#crs-in-r"><span class="header-section-number">2.5</span> CRS in R</a></li>
  <li><a href="#handling-the-guerry-dataset" id="toc-handling-the-guerry-dataset" class="nav-link" data-scroll-target="#handling-the-guerry-dataset"><span class="header-section-number">2.6</span> Handling the Guerry dataset</a></li>
  <li><a href="#spatial-operations" id="toc-spatial-operations" class="nav-link" data-scroll-target="#spatial-operations"><span class="header-section-number">2.7</span> Spatial operations</a></li>
  <li><a href="#guerry-as-spatial-data" id="toc-guerry-as-spatial-data" class="nav-link" data-scroll-target="#guerry-as-spatial-data"><span class="header-section-number">2.8</span> Guerry as spatial data</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.9</span> Exercises</a></li>
  </ul></li>
  <li><a href="#interactive-maps-using-leaflet" id="toc-interactive-maps-using-leaflet" class="nav-link" data-scroll-target="#interactive-maps-using-leaflet"><span class="header-section-number">3</span> Interactive maps using Leaflet</a>
  <ul class="collapse">
  <li><a href="#integrate-leaflet-in-shiny" id="toc-integrate-leaflet-in-shiny" class="nav-link" data-scroll-target="#integrate-leaflet-in-shiny"><span class="header-section-number">3.1</span> Integrate Leaflet in Shiny</a></li>
  <li><a href="#leaflet-workhorse" id="toc-leaflet-workhorse" class="nav-link" data-scroll-target="#leaflet-workhorse"><span class="header-section-number">3.2</span> Leaflet workhorse</a></li>
  <li><a href="#full-code" id="toc-full-code" class="nav-link" data-scroll-target="#full-code"><span class="header-section-number">3.3</span> Full code</a></li>
  </ul></li>
  <li><a href="#add-data" id="toc-add-data" class="nav-link" data-scroll-target="#add-data"><span class="header-section-number">4</span> Add data</a>
  <ul class="collapse">
  <li><a href="#specifics-of-leaflet-mapping" id="toc-specifics-of-leaflet-mapping" class="nav-link" data-scroll-target="#specifics-of-leaflet-mapping"><span class="header-section-number">4.1</span> Specifics of Leaflet mapping</a></li>
  <li><a href="#full-code-1" id="toc-full-code-1" class="nav-link" data-scroll-target="#full-code-1"><span class="header-section-number">4.2</span> Full code</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">4.3</span> Exercises</a></li>
  </ul></li>
  <li><a href="#add-reactivity" id="toc-add-reactivity" class="nav-link" data-scroll-target="#add-reactivity"><span class="header-section-number">5</span> Add reactivity</a>
  <ul class="collapse">
  <li><a href="#reactive-ui" id="toc-reactive-ui" class="nav-link" data-scroll-target="#reactive-ui"><span class="header-section-number">5.1</span> Reactive UI</a></li>
  <li><a href="#server-side" id="toc-server-side" class="nav-link" data-scroll-target="#server-side"><span class="header-section-number">5.2</span> Server side</a></li>
  <li><a href="#full-code-2" id="toc-full-code-2" class="nav-link" data-scroll-target="#full-code-2"><span class="header-section-number">5.3</span> Full code</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2"><span class="header-section-number">5.4</span> Exercises</a></li>
  </ul></li>
  <li><a href="#appendix-add-context" id="toc-appendix-add-context" class="nav-link" data-scroll-target="#appendix-add-context"><span class="header-section-number">6</span> Appendix: Add context</a>
  <ul class="collapse">
  <li><a href="#prepare-context-info" id="toc-prepare-context-info" class="nav-link" data-scroll-target="#prepare-context-info"><span class="header-section-number">6.1</span> Prepare context info</a></li>
  <li><a href="#add-variable-descriptions" id="toc-add-variable-descriptions" class="nav-link" data-scroll-target="#add-variable-descriptions"><span class="header-section-number">6.2</span> Add variable descriptions</a></li>
  <li><a href="#render-context" id="toc-render-context" class="nav-link" data-scroll-target="#render-context"><span class="header-section-number">6.3</span> Render context</a></li>
  <li><a href="#full-code-3" id="toc-full-code-3" class="nav-link" data-scroll-target="#full-code-3"><span class="header-section-number">6.4</span> Full code</a></li>
  </ul></li>
  <li><a href="#appendix-add-hover-labels" id="toc-appendix-add-hover-labels" class="nav-link" data-scroll-target="#appendix-add-hover-labels"><span class="header-section-number">7</span> Appendix: Add hover labels</a>
  <ul class="collapse">
  <li><a href="#how-to-add-labels" id="toc-how-to-add-labels" class="nav-link" data-scroll-target="#how-to-add-labels"><span class="header-section-number">7.1</span> How to add labels</a></li>
  <li><a href="#advanced-label-layout-using-html" id="toc-advanced-label-layout-using-html" class="nav-link" data-scroll-target="#advanced-label-layout-using-html"><span class="header-section-number">7.2</span> Advanced label layout using HTML</a></li>
  <li><a href="#full-code-4" id="toc-full-code-4" class="nav-link" data-scroll-target="#full-code-4"><span class="header-section-number">7.3</span> Full code</a></li>
  </ul></li>
  <li><a href="#appendix-add-proxies" id="toc-appendix-add-proxies" class="nav-link" data-scroll-target="#appendix-add-proxies"><span class="header-section-number">8</span> Appendix: Add proxies</a>
  <ul class="collapse">
  <li><a href="#what-are-proxies" id="toc-what-are-proxies" class="nav-link" data-scroll-target="#what-are-proxies"><span class="header-section-number">8.1</span> What are proxies?</a></li>
  <li><a href="#proxies-in-shiny-extensions" id="toc-proxies-in-shiny-extensions" class="nav-link" data-scroll-target="#proxies-in-shiny-extensions"><span class="header-section-number">8.2</span> Proxies in Shiny extensions</a></li>
  <li><a href="#proxy-workflow" id="toc-proxy-workflow" class="nav-link" data-scroll-target="#proxy-workflow"><span class="header-section-number">8.3</span> Proxy workflow</a></li>
  <li><a href="#isolate-reactive-objects" id="toc-isolate-reactive-objects" class="nav-link" data-scroll-target="#isolate-reactive-objects"><span class="header-section-number">8.4</span> Isolate reactive objects</a></li>
  <li><a href="#implement-proxies" id="toc-implement-proxies" class="nav-link" data-scroll-target="#implement-proxies"><span class="header-section-number">8.5</span> Implement proxies</a></li>
  <li><a href="#what-changed" id="toc-what-changed" class="nav-link" data-scroll-target="#what-changed"><span class="header-section-number">8.6</span> What changed?</a></li>
  <li><a href="#full-code-5" id="toc-full-code-5" class="nav-link" data-scroll-target="#full-code-5"><span class="header-section-number">8.7</span> Full code</a></li>
  </ul></li>
  <li><a href="#appendix-access-shiny-events-on-maps" id="toc-appendix-access-shiny-events-on-maps" class="nav-link" data-scroll-target="#appendix-access-shiny-events-on-maps"><span class="header-section-number">9</span> Appendix: Access Shiny events on maps</a>
  <ul class="collapse">
  <li><a href="#leaflet-events" id="toc-leaflet-events" class="nav-link" data-scroll-target="#leaflet-events"><span class="header-section-number">9.1</span> Leaflet events</a></li>
  <li><a href="#leaflet-object-types" id="toc-leaflet-object-types" class="nav-link" data-scroll-target="#leaflet-object-types"><span class="header-section-number">9.2</span> Leaflet object types</a></li>
  <li><a href="#leaflet-event-types" id="toc-leaflet-event-types" class="nav-link" data-scroll-target="#leaflet-event-types"><span class="header-section-number">9.3</span> Leaflet event types</a></li>
  <li><a href="#other-events" id="toc-other-events" class="nav-link" data-scroll-target="#other-events"><span class="header-section-number">9.4</span> Other events</a></li>
  <li><a href="#events-in-practice" id="toc-events-in-practice" class="nav-link" data-scroll-target="#events-in-practice"><span class="header-section-number">9.5</span> Events in practice</a></li>
  <li><a href="#clear-objects" id="toc-clear-objects" class="nav-link" data-scroll-target="#clear-objects"><span class="header-section-number">9.6</span> Clear objects</a></li>
  <li><a href="#full-code-6" id="toc-full-code-6" class="nav-link" data-scroll-target="#full-code-6"><span class="header-section-number">9.7</span> Full code</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3"><span class="header-section-number">9.8</span> Exercises</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/paulcbauer/shiny_workshop/edit/main/06-mapping.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/paulcbauer/shiny_workshop/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mapping data &amp; advanced visualization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>You will learn how to:</p>
<ul>
<li>Work with spatial data</li>
<li>Create interactive maps in Shiny using Leaflet</li>
<li>Use Shiny events and proxies</li>
</ul>
<section id="interactive-maps" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Interactive maps</h1>
<ul>
<li>Mapping is a type of data visualization based on <em>spatial data</em></li>
<li>Classic cartography relies on generalization and interpretation</li>
<li>Interactive cartography removes many limitations such as generalization and map boundaries</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/generalization.gif" class="img-fluid figure-img"></p>
<figcaption>Generalization in OpenStreetMap at different scales</figcaption>
</figure>
</div>
<section id="current-app-state" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="current-app-state"><span class="header-section-number">1.1</span> Current app state</h2>
<ul>
<li>Quick recap:
<ul>
<li>In section 3, we added an introduction tab that contains background info on the app</li>
<li>In section 4, we added a table tab using the <code>DT</code> package</li>
<li>In section 5, we added a modelling tab using all sorts of visualizations</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Full code for the current app state</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-26"><a href="#cb1-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb1-28"><a href="#cb1-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb1-30"><a href="#cb1-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb1-31"><a href="#cb1-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb1-34"><a href="#cb1-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb1-35"><a href="#cb1-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb1-36"><a href="#cb1-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb1-37"><a href="#cb1-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb1-38"><a href="#cb1-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb1-40"><a href="#cb1-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb1-41"><a href="#cb1-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>)</span>
<span id="cb1-46"><a href="#cb1-46"></a></span>
<span id="cb1-47"><a href="#cb1-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-48"><a href="#cb1-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb1-50"><a href="#cb1-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb1-51"><a href="#cb1-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-53"><a href="#cb1-53"></a>  ),</span>
<span id="cb1-54"><a href="#cb1-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb1-55"><a href="#cb1-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb1-56"><a href="#cb1-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb1-57"><a href="#cb1-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb1-58"><a href="#cb1-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-59"><a href="#cb1-59"></a>  ),</span>
<span id="cb1-60"><a href="#cb1-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb1-61"><a href="#cb1-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb1-62"><a href="#cb1-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb1-63"><a href="#cb1-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb1-64"><a href="#cb1-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb1-65"><a href="#cb1-65"></a>  ),</span>
<span id="cb1-66"><a href="#cb1-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb1-67"><a href="#cb1-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb1-68"><a href="#cb1-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb1-69"><a href="#cb1-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb1-70"><a href="#cb1-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-71"><a href="#cb1-71"></a>  ),</span>
<span id="cb1-72"><a href="#cb1-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb1-73"><a href="#cb1-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb1-74"><a href="#cb1-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb1-75"><a href="#cb1-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb1-76"><a href="#cb1-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-77"><a href="#cb1-77"></a>  ),</span>
<span id="cb1-78"><a href="#cb1-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb1-79"><a href="#cb1-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb1-80"><a href="#cb1-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb1-81"><a href="#cb1-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb1-82"><a href="#cb1-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-83"><a href="#cb1-83"></a>  ),</span>
<span id="cb1-84"><a href="#cb1-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb1-85"><a href="#cb1-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb1-86"><a href="#cb1-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb1-87"><a href="#cb1-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb1-88"><a href="#cb1-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-89"><a href="#cb1-89"></a>  ),</span>
<span id="cb1-90"><a href="#cb1-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb1-91"><a href="#cb1-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb1-92"><a href="#cb1-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb1-93"><a href="#cb1-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb1-94"><a href="#cb1-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-95"><a href="#cb1-95"></a>  ),</span>
<span id="cb1-96"><a href="#cb1-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb1-97"><a href="#cb1-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb1-98"><a href="#cb1-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb1-99"><a href="#cb1-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb1-100"><a href="#cb1-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-101"><a href="#cb1-101"></a>  ),</span>
<span id="cb1-102"><a href="#cb1-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb1-103"><a href="#cb1-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb1-104"><a href="#cb1-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb1-105"><a href="#cb1-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb1-106"><a href="#cb1-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb1-107"><a href="#cb1-107"></a>  ),</span>
<span id="cb1-108"><a href="#cb1-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb1-109"><a href="#cb1-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb1-110"><a href="#cb1-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb1-111"><a href="#cb1-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb1-112"><a href="#cb1-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-113"><a href="#cb1-113"></a>  ),</span>
<span id="cb1-114"><a href="#cb1-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb1-115"><a href="#cb1-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb1-116"><a href="#cb1-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb1-117"><a href="#cb1-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb1-118"><a href="#cb1-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-119"><a href="#cb1-119"></a>  ),</span>
<span id="cb1-120"><a href="#cb1-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb1-121"><a href="#cb1-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb1-122"><a href="#cb1-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb1-123"><a href="#cb1-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb1-124"><a href="#cb1-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-125"><a href="#cb1-125"></a>  ),</span>
<span id="cb1-126"><a href="#cb1-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb1-127"><a href="#cb1-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb1-128"><a href="#cb1-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb1-129"><a href="#cb1-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb1-130"><a href="#cb1-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-131"><a href="#cb1-131"></a>  ),</span>
<span id="cb1-132"><a href="#cb1-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb1-133"><a href="#cb1-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb1-134"><a href="#cb1-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb1-135"><a href="#cb1-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb1-136"><a href="#cb1-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-137"><a href="#cb1-137"></a>  ),</span>
<span id="cb1-138"><a href="#cb1-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb1-139"><a href="#cb1-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb1-140"><a href="#cb1-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb1-141"><a href="#cb1-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb1-142"><a href="#cb1-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-143"><a href="#cb1-143"></a>  ),</span>
<span id="cb1-144"><a href="#cb1-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb1-145"><a href="#cb1-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb1-146"><a href="#cb1-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb1-147"><a href="#cb1-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb1-148"><a href="#cb1-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb1-149"><a href="#cb1-149"></a>  ),</span>
<span id="cb1-150"><a href="#cb1-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb1-151"><a href="#cb1-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb1-152"><a href="#cb1-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb1-153"><a href="#cb1-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb1-154"><a href="#cb1-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb1-155"><a href="#cb1-155"></a>  ),</span>
<span id="cb1-156"><a href="#cb1-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb1-157"><a href="#cb1-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb1-158"><a href="#cb1-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb1-159"><a href="#cb1-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb1-160"><a href="#cb1-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb1-161"><a href="#cb1-161"></a>  )</span>
<span id="cb1-162"><a href="#cb1-162"></a>)</span>
<span id="cb1-163"><a href="#cb1-163"></a></span>
<span id="cb1-164"><a href="#cb1-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb1-165"><a href="#cb1-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-166"><a href="#cb1-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-167"><a href="#cb1-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-168"><a href="#cb1-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb1-169"><a href="#cb1-169"></a>    Region,</span>
<span id="cb1-170"><a href="#cb1-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb1-171"><a href="#cb1-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb1-172"><a href="#cb1-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb1-173"><a href="#cb1-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb1-174"><a href="#cb1-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb1-175"><a href="#cb1-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb1-176"><a href="#cb1-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-177"><a href="#cb1-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb1-178"><a href="#cb1-178"></a></span>
<span id="cb1-179"><a href="#cb1-179"></a></span>
<span id="cb1-180"><a href="#cb1-180"></a></span>
<span id="cb1-181"><a href="#cb1-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb1-182"><a href="#cb1-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb1-183"><a href="#cb1-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-184"><a href="#cb1-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb1-185"><a href="#cb1-185"></a></span>
<span id="cb1-186"><a href="#cb1-186"></a></span>
<span id="cb1-187"><a href="#cb1-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb1-188"><a href="#cb1-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb1-189"><a href="#cb1-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb1-190"><a href="#cb1-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb1-191"><a href="#cb1-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb1-192"><a href="#cb1-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb1-193"><a href="#cb1-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb1-194"><a href="#cb1-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb1-195"><a href="#cb1-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-196"><a href="#cb1-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb1-197"><a href="#cb1-197"></a>      }</span>
<span id="cb1-198"><a href="#cb1-198"></a>    }</span>
<span id="cb1-199"><a href="#cb1-199"></a>  ))</span>
<span id="cb1-200"><a href="#cb1-200"></a></span>
<span id="cb1-201"><a href="#cb1-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb1-202"><a href="#cb1-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb1-203"><a href="#cb1-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-204"><a href="#cb1-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb1-205"><a href="#cb1-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-206"><a href="#cb1-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb1-207"><a href="#cb1-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb1-208"><a href="#cb1-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb1-209"><a href="#cb1-209"></a>)</span>
<span id="cb1-210"><a href="#cb1-210"></a></span>
<span id="cb1-211"><a href="#cb1-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb1-212"><a href="#cb1-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb1-213"><a href="#cb1-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-214"><a href="#cb1-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb1-215"><a href="#cb1-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb1-216"><a href="#cb1-216"></a>)</span>
<span id="cb1-217"><a href="#cb1-217"></a></span>
<span id="cb1-218"><a href="#cb1-218"></a></span>
<span id="cb1-219"><a href="#cb1-219"></a></span>
<span id="cb1-220"><a href="#cb1-220"></a></span>
<span id="cb1-221"><a href="#cb1-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb1-222"><a href="#cb1-222"></a></span>
<span id="cb1-223"><a href="#cb1-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb1-224"><a href="#cb1-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb1-225"><a href="#cb1-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb1-226"><a href="#cb1-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb1-227"><a href="#cb1-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb1-228"><a href="#cb1-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb1-229"><a href="#cb1-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb1-230"><a href="#cb1-230"></a>    )</span>
<span id="cb1-231"><a href="#cb1-231"></a>  ),</span>
<span id="cb1-232"><a href="#cb1-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb1-233"><a href="#cb1-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb1-234"><a href="#cb1-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb1-235"><a href="#cb1-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb1-236"><a href="#cb1-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb1-237"><a href="#cb1-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb1-238"><a href="#cb1-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb1-239"><a href="#cb1-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb1-240"><a href="#cb1-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb1-241"><a href="#cb1-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb1-242"><a href="#cb1-242"></a>    ),</span>
<span id="cb1-243"><a href="#cb1-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-244"><a href="#cb1-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-245"><a href="#cb1-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-246"><a href="#cb1-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb1-247"><a href="#cb1-247"></a>  ),</span>
<span id="cb1-248"><a href="#cb1-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb1-249"><a href="#cb1-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb1-250"><a href="#cb1-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb1-251"><a href="#cb1-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb1-252"><a href="#cb1-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb1-253"><a href="#cb1-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb1-254"><a href="#cb1-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb1-255"><a href="#cb1-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb1-256"><a href="#cb1-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb1-257"><a href="#cb1-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb1-258"><a href="#cb1-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb1-259"><a href="#cb1-259"></a>        ),</span>
<span id="cb1-260"><a href="#cb1-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb1-261"><a href="#cb1-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb1-262"><a href="#cb1-262"></a>          <span class="fu">column</span>(</span>
<span id="cb1-263"><a href="#cb1-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb1-264"><a href="#cb1-264"></a>            <span class="fu">box</span>(</span>
<span id="cb1-265"><a href="#cb1-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb1-266"><a href="#cb1-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-267"><a href="#cb1-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-268"><a href="#cb1-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb1-269"><a href="#cb1-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb1-270"><a href="#cb1-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb1-271"><a href="#cb1-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb1-272"><a href="#cb1-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb1-273"><a href="#cb1-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb1-274"><a href="#cb1-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb1-275"><a href="#cb1-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb1-276"><a href="#cb1-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb1-277"><a href="#cb1-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb1-278"><a href="#cb1-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb1-279"><a href="#cb1-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb1-280"><a href="#cb1-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb1-281"><a href="#cb1-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb1-282"><a href="#cb1-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb1-283"><a href="#cb1-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb1-284"><a href="#cb1-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb1-285"><a href="#cb1-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb1-286"><a href="#cb1-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb1-287"><a href="#cb1-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb1-288"><a href="#cb1-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb1-289"><a href="#cb1-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb1-290"><a href="#cb1-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb1-291"><a href="#cb1-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb1-292"><a href="#cb1-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb1-293"><a href="#cb1-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-294"><a href="#cb1-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-295"><a href="#cb1-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb1-296"><a href="#cb1-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb1-297"><a href="#cb1-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb1-298"><a href="#cb1-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb1-299"><a href="#cb1-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb1-300"><a href="#cb1-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb1-301"><a href="#cb1-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb1-302"><a href="#cb1-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb1-303"><a href="#cb1-303"></a>                  )</span>
<span id="cb1-304"><a href="#cb1-304"></a>                ),</span>
<span id="cb1-305"><a href="#cb1-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb1-306"><a href="#cb1-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb1-307"><a href="#cb1-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-308"><a href="#cb1-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-309"><a href="#cb1-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb1-310"><a href="#cb1-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb1-311"><a href="#cb1-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb1-312"><a href="#cb1-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb1-313"><a href="#cb1-313"></a>                )</span>
<span id="cb1-314"><a href="#cb1-314"></a>              )</span>
<span id="cb1-315"><a href="#cb1-315"></a>            )</span>
<span id="cb1-316"><a href="#cb1-316"></a>          ),</span>
<span id="cb1-317"><a href="#cb1-317"></a>          <span class="fu">column</span>(</span>
<span id="cb1-318"><a href="#cb1-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb1-319"><a href="#cb1-319"></a>            <span class="fu">box</span>(</span>
<span id="cb1-320"><a href="#cb1-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb1-321"><a href="#cb1-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-322"><a href="#cb1-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-323"><a href="#cb1-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb1-324"><a href="#cb1-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb1-325"><a href="#cb1-325"></a>            )</span>
<span id="cb1-326"><a href="#cb1-326"></a>          )</span>
<span id="cb1-327"><a href="#cb1-327"></a>        )</span>
<span id="cb1-328"><a href="#cb1-328"></a>      ),</span>
<span id="cb1-329"><a href="#cb1-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb1-330"><a href="#cb1-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb1-331"><a href="#cb1-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb1-332"><a href="#cb1-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb1-333"><a href="#cb1-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb1-334"><a href="#cb1-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb1-335"><a href="#cb1-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb1-336"><a href="#cb1-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb1-337"><a href="#cb1-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb1-338"><a href="#cb1-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb1-339"><a href="#cb1-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-340"><a href="#cb1-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1-341"><a href="#cb1-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-342"><a href="#cb1-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb1-343"><a href="#cb1-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb1-344"><a href="#cb1-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb1-345"><a href="#cb1-345"></a>            ),</span>
<span id="cb1-346"><a href="#cb1-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-347"><a href="#cb1-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb1-348"><a href="#cb1-348"></a>          )</span>
<span id="cb1-349"><a href="#cb1-349"></a>        ),</span>
<span id="cb1-350"><a href="#cb1-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb1-351"><a href="#cb1-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb1-352"><a href="#cb1-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb1-353"><a href="#cb1-353"></a>      ),</span>
<span id="cb1-354"><a href="#cb1-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb1-355"><a href="#cb1-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb1-356"><a href="#cb1-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb1-357"><a href="#cb1-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb1-358"><a href="#cb1-358"></a>          <span class="fu">column</span>(</span>
<span id="cb1-359"><a href="#cb1-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb1-360"><a href="#cb1-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb1-361"><a href="#cb1-361"></a>            <span class="fu">box</span>(</span>
<span id="cb1-362"><a href="#cb1-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-363"><a href="#cb1-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb1-364"><a href="#cb1-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-365"><a href="#cb1-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb1-366"><a href="#cb1-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb1-367"><a href="#cb1-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb1-368"><a href="#cb1-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb1-369"><a href="#cb1-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-370"><a href="#cb1-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb1-371"><a href="#cb1-371"></a>              ),</span>
<span id="cb1-372"><a href="#cb1-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb1-373"><a href="#cb1-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb1-374"><a href="#cb1-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb1-375"><a href="#cb1-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb1-376"><a href="#cb1-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb1-377"><a href="#cb1-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-378"><a href="#cb1-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-379"><a href="#cb1-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb1-380"><a href="#cb1-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb1-381"><a href="#cb1-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb1-382"><a href="#cb1-382"></a>                ),</span>
<span id="cb1-383"><a href="#cb1-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-384"><a href="#cb1-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb1-385"><a href="#cb1-385"></a>              ),</span>
<span id="cb1-386"><a href="#cb1-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb1-387"><a href="#cb1-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb1-388"><a href="#cb1-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb1-389"><a href="#cb1-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-390"><a href="#cb1-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-391"><a href="#cb1-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb1-392"><a href="#cb1-392"></a>              ),</span>
<span id="cb1-393"><a href="#cb1-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb1-394"><a href="#cb1-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb1-395"><a href="#cb1-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb1-396"><a href="#cb1-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb1-397"><a href="#cb1-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb1-398"><a href="#cb1-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb1-399"><a href="#cb1-399"></a>              )</span>
<span id="cb1-400"><a href="#cb1-400"></a>            ),</span>
<span id="cb1-401"><a href="#cb1-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb1-402"><a href="#cb1-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb1-403"><a href="#cb1-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-404"><a href="#cb1-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb1-405"><a href="#cb1-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb1-406"><a href="#cb1-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb1-407"><a href="#cb1-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-408"><a href="#cb1-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb1-409"><a href="#cb1-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-410"><a href="#cb1-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb1-411"><a href="#cb1-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb1-412"><a href="#cb1-412"></a>              ),</span>
<span id="cb1-413"><a href="#cb1-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb1-414"><a href="#cb1-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-415"><a href="#cb1-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb1-416"><a href="#cb1-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb1-417"><a href="#cb1-417"></a>              ),</span>
<span id="cb1-418"><a href="#cb1-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb1-419"><a href="#cb1-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-420"><a href="#cb1-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb1-421"><a href="#cb1-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb1-422"><a href="#cb1-422"></a>              )</span>
<span id="cb1-423"><a href="#cb1-423"></a>            )</span>
<span id="cb1-424"><a href="#cb1-424"></a>          ),</span>
<span id="cb1-425"><a href="#cb1-425"></a>          <span class="fu">column</span>(</span>
<span id="cb1-426"><a href="#cb1-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb1-427"><a href="#cb1-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb1-428"><a href="#cb1-428"></a>            <span class="fu">box</span>(</span>
<span id="cb1-429"><a href="#cb1-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-430"><a href="#cb1-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb1-431"><a href="#cb1-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-432"><a href="#cb1-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb1-433"><a href="#cb1-433"></a>            ),</span>
<span id="cb1-434"><a href="#cb1-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb1-435"><a href="#cb1-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb1-436"><a href="#cb1-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-437"><a href="#cb1-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb1-438"><a href="#cb1-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb1-439"><a href="#cb1-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-440"><a href="#cb1-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb1-441"><a href="#cb1-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-442"><a href="#cb1-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb1-443"><a href="#cb1-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb1-444"><a href="#cb1-444"></a>              ),</span>
<span id="cb1-445"><a href="#cb1-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-446"><a href="#cb1-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb1-447"><a href="#cb1-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb1-448"><a href="#cb1-448"></a>              ),</span>
<span id="cb1-449"><a href="#cb1-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb1-450"><a href="#cb1-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb1-451"><a href="#cb1-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb1-452"><a href="#cb1-452"></a>              )</span>
<span id="cb1-453"><a href="#cb1-453"></a>            )</span>
<span id="cb1-454"><a href="#cb1-454"></a>          )</span>
<span id="cb1-455"><a href="#cb1-455"></a>        )</span>
<span id="cb1-456"><a href="#cb1-456"></a>      ),</span>
<span id="cb1-457"><a href="#cb1-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb1-458"><a href="#cb1-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb1-459"><a href="#cb1-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb1-460"><a href="#cb1-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb1-461"><a href="#cb1-461"></a>          <span class="fu">column</span>(</span>
<span id="cb1-462"><a href="#cb1-462"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb1-463"><a href="#cb1-463"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb1-464"><a href="#cb1-464"></a>            <span class="fu">box</span>(</span>
<span id="cb1-465"><a href="#cb1-465"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb1-466"><a href="#cb1-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb1-467"><a href="#cb1-467"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-468"><a href="#cb1-468"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-469"><a href="#cb1-469"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb1-470"><a href="#cb1-470"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb1-471"><a href="#cb1-471"></a>            ) <span class="co"># end box</span></span>
<span id="cb1-472"><a href="#cb1-472"></a>          ) <span class="co"># end column</span></span>
<span id="cb1-473"><a href="#cb1-473"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb1-474"><a href="#cb1-474"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb1-475"><a href="#cb1-475"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb1-476"><a href="#cb1-476"></a>  ),</span>
<span id="cb1-477"><a href="#cb1-477"></a>  </span>
<span id="cb1-478"><a href="#cb1-478"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb1-479"><a href="#cb1-479"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb1-480"><a href="#cb1-480"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb1-481"><a href="#cb1-481"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb1-482"><a href="#cb1-482"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb1-483"><a href="#cb1-483"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb1-484"><a href="#cb1-484"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb1-485"><a href="#cb1-485"></a>    )</span>
<span id="cb1-486"><a href="#cb1-486"></a>  ),</span>
<span id="cb1-487"><a href="#cb1-487"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb1-488"><a href="#cb1-488"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb1-489"><a href="#cb1-489"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb1-490"><a href="#cb1-490"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb1-491"><a href="#cb1-491"></a>  )  </span>
<span id="cb1-492"><a href="#cb1-492"></a>)</span>
<span id="cb1-493"><a href="#cb1-493"></a></span>
<span id="cb1-494"><a href="#cb1-494"></a></span>
<span id="cb1-495"><a href="#cb1-495"></a></span>
<span id="cb1-496"><a href="#cb1-496"></a><span class="co"># 4 Server ----</span></span>
<span id="cb1-497"><a href="#cb1-497"></a></span>
<span id="cb1-498"><a href="#cb1-498"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb1-499"><a href="#cb1-499"></a>  </span>
<span id="cb1-500"><a href="#cb1-500"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb1-501"><a href="#cb1-501"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb1-502"><a href="#cb1-502"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb1-503"><a href="#cb1-503"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb1-504"><a href="#cb1-504"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb1-505"><a href="#cb1-505"></a>    </span>
<span id="cb1-506"><a href="#cb1-506"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb1-507"><a href="#cb1-507"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb1-508"><a href="#cb1-508"></a>    }</span>
<span id="cb1-509"><a href="#cb1-509"></a>    </span>
<span id="cb1-510"><a href="#cb1-510"></a>    data_table</span>
<span id="cb1-511"><a href="#cb1-511"></a>  })</span>
<span id="cb1-512"><a href="#cb1-512"></a>  </span>
<span id="cb1-513"><a href="#cb1-513"></a>  </span>
<span id="cb1-514"><a href="#cb1-514"></a>  <span class="do">### Create table----</span></span>
<span id="cb1-515"><a href="#cb1-515"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb1-516"><a href="#cb1-516"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb1-517"><a href="#cb1-517"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb1-518"><a href="#cb1-518"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb1-519"><a href="#cb1-519"></a>      tab,</span>
<span id="cb1-520"><a href="#cb1-520"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb1-521"><a href="#cb1-521"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb1-522"><a href="#cb1-522"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb1-523"><a href="#cb1-523"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-524"><a href="#cb1-524"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb1-525"><a href="#cb1-525"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-526"><a href="#cb1-526"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb1-527"><a href="#cb1-527"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb1-528"><a href="#cb1-528"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-529"><a href="#cb1-529"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-530"><a href="#cb1-530"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb1-531"><a href="#cb1-531"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb1-532"><a href="#cb1-532"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb1-533"><a href="#cb1-533"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb1-534"><a href="#cb1-534"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb1-535"><a href="#cb1-535"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb1-536"><a href="#cb1-536"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb1-537"><a href="#cb1-537"></a><span class="st">  </span></span>
<span id="cb1-538"><a href="#cb1-538"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb1-539"><a href="#cb1-539"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb1-540"><a href="#cb1-540"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb1-541"><a href="#cb1-541"></a><span class="st">            );</span></span>
<span id="cb1-542"><a href="#cb1-542"></a><span class="st">          }</span></span>
<span id="cb1-543"><a href="#cb1-543"></a><span class="st">        "</span>))</span>
<span id="cb1-544"><a href="#cb1-544"></a>        )</span>
<span id="cb1-545"><a href="#cb1-545"></a>      )</span>
<span id="cb1-546"><a href="#cb1-546"></a>    )</span>
<span id="cb1-547"><a href="#cb1-547"></a>  })</span>
<span id="cb1-548"><a href="#cb1-548"></a>  </span>
<span id="cb1-549"><a href="#cb1-549"></a>  <span class="do">### Render table----</span></span>
<span id="cb1-550"><a href="#cb1-550"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-551"><a href="#cb1-551"></a>  </span>
<span id="cb1-552"><a href="#cb1-552"></a>  </span>
<span id="cb1-553"><a href="#cb1-553"></a>  </span>
<span id="cb1-554"><a href="#cb1-554"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb1-555"><a href="#cb1-555"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb1-556"><a href="#cb1-556"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb1-557"><a href="#cb1-557"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb1-558"><a href="#cb1-558"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb1-559"><a href="#cb1-559"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb1-560"><a href="#cb1-560"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb1-561"><a href="#cb1-561"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb1-562"><a href="#cb1-562"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb1-563"><a href="#cb1-563"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb1-564"><a href="#cb1-564"></a>    </span>
<span id="cb1-565"><a href="#cb1-565"></a>    <span class="fu">list</span>(</span>
<span id="cb1-566"><a href="#cb1-566"></a>      <span class="at">x =</span> x,</span>
<span id="cb1-567"><a href="#cb1-567"></a>      <span class="at">y =</span> y,</span>
<span id="cb1-568"><a href="#cb1-568"></a>      <span class="at">data =</span> dt,</span>
<span id="cb1-569"><a href="#cb1-569"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb1-570"><a href="#cb1-570"></a>      <span class="at">model =</span> mod</span>
<span id="cb1-571"><a href="#cb1-571"></a>    )</span>
<span id="cb1-572"><a href="#cb1-572"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb1-573"><a href="#cb1-573"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-574"><a href="#cb1-574"></a>  </span>
<span id="cb1-575"><a href="#cb1-575"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb1-576"><a href="#cb1-576"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb1-577"><a href="#cb1-577"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-578"><a href="#cb1-578"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb1-579"><a href="#cb1-579"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb1-580"><a href="#cb1-580"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb1-581"><a href="#cb1-581"></a>      params<span class="sc">$</span>data,</span>
<span id="cb1-582"><a href="#cb1-582"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb1-583"><a href="#cb1-583"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb1-584"><a href="#cb1-584"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb1-585"><a href="#cb1-585"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb1-586"><a href="#cb1-586"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb1-587"><a href="#cb1-587"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb1-588"><a href="#cb1-588"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb1-589"><a href="#cb1-589"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb1-590"><a href="#cb1-590"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb1-591"><a href="#cb1-591"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb1-592"><a href="#cb1-592"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb1-593"><a href="#cb1-593"></a>            ))</span>
<span id="cb1-594"><a href="#cb1-594"></a>        }</span>
<span id="cb1-595"><a href="#cb1-595"></a>      )</span>
<span id="cb1-596"><a href="#cb1-596"></a>    )</span>
<span id="cb1-597"><a href="#cb1-597"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-598"><a href="#cb1-598"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-599"><a href="#cb1-599"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-600"><a href="#cb1-600"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-601"><a href="#cb1-601"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-602"><a href="#cb1-602"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-603"><a href="#cb1-603"></a>  })</span>
<span id="cb1-604"><a href="#cb1-604"></a>  </span>
<span id="cb1-605"><a href="#cb1-605"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb1-606"><a href="#cb1-606"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb1-607"><a href="#cb1-607"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-608"><a href="#cb1-608"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb1-609"><a href="#cb1-609"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb1-610"><a href="#cb1-610"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb1-611"><a href="#cb1-611"></a>    </span>
<span id="cb1-612"><a href="#cb1-612"></a>    </span>
<span id="cb1-613"><a href="#cb1-613"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb1-614"><a href="#cb1-614"></a>    </span>
<span id="cb1-615"><a href="#cb1-615"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-616"><a href="#cb1-616"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb1-617"><a href="#cb1-617"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-618"><a href="#cb1-618"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-619"><a href="#cb1-619"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-620"><a href="#cb1-620"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-621"><a href="#cb1-621"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-622"><a href="#cb1-622"></a>  })</span>
<span id="cb1-623"><a href="#cb1-623"></a>  </span>
<span id="cb1-624"><a href="#cb1-624"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb1-625"><a href="#cb1-625"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb1-626"><a href="#cb1-626"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-627"><a href="#cb1-627"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb1-628"><a href="#cb1-628"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb1-629"><a href="#cb1-629"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb1-630"><a href="#cb1-630"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb1-631"><a href="#cb1-631"></a>    </span>
<span id="cb1-632"><a href="#cb1-632"></a>    </span>
<span id="cb1-633"><a href="#cb1-633"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb1-634"><a href="#cb1-634"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb1-635"><a href="#cb1-635"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb1-636"><a href="#cb1-636"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb1-637"><a href="#cb1-637"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb1-638"><a href="#cb1-638"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb1-639"><a href="#cb1-639"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb1-640"><a href="#cb1-640"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb1-641"><a href="#cb1-641"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-642"><a href="#cb1-642"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb1-643"><a href="#cb1-643"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb1-644"><a href="#cb1-644"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb1-645"><a href="#cb1-645"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-646"><a href="#cb1-646"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-647"><a href="#cb1-647"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb1-648"><a href="#cb1-648"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb1-649"><a href="#cb1-649"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb1-650"><a href="#cb1-650"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb1-651"><a href="#cb1-651"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb1-652"><a href="#cb1-652"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb1-653"><a href="#cb1-653"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb1-654"><a href="#cb1-654"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb1-655"><a href="#cb1-655"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb1-656"><a href="#cb1-656"></a>      </span>
<span id="cb1-657"><a href="#cb1-657"></a>    }</span>
<span id="cb1-658"><a href="#cb1-658"></a>    </span>
<span id="cb1-659"><a href="#cb1-659"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-660"><a href="#cb1-660"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb1-661"><a href="#cb1-661"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-662"><a href="#cb1-662"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-663"><a href="#cb1-663"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-664"><a href="#cb1-664"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-665"><a href="#cb1-665"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-666"><a href="#cb1-666"></a>  })</span>
<span id="cb1-667"><a href="#cb1-667"></a>  </span>
<span id="cb1-668"><a href="#cb1-668"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb1-669"><a href="#cb1-669"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb1-670"><a href="#cb1-670"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-671"><a href="#cb1-671"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb1-672"><a href="#cb1-672"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb1-673"><a href="#cb1-673"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb1-674"><a href="#cb1-674"></a>    ))</span>
<span id="cb1-675"><a href="#cb1-675"></a>  })</span>
<span id="cb1-676"><a href="#cb1-676"></a>  </span>
<span id="cb1-677"><a href="#cb1-677"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb1-678"><a href="#cb1-678"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb1-679"><a href="#cb1-679"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-680"><a href="#cb1-680"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb1-681"><a href="#cb1-681"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-682"><a href="#cb1-682"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-683"><a href="#cb1-683"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-684"><a href="#cb1-684"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-685"><a href="#cb1-685"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-686"><a href="#cb1-686"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-687"><a href="#cb1-687"></a>  })</span>
<span id="cb1-688"><a href="#cb1-688"></a>  </span>
<span id="cb1-689"><a href="#cb1-689"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb1-690"><a href="#cb1-690"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb1-691"><a href="#cb1-691"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-692"><a href="#cb1-692"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-693"><a href="#cb1-693"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-694"><a href="#cb1-694"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-695"><a href="#cb1-695"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-696"><a href="#cb1-696"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb1-697"><a href="#cb1-697"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-698"><a href="#cb1-698"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-699"><a href="#cb1-699"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-700"><a href="#cb1-700"></a>  })</span>
<span id="cb1-701"><a href="#cb1-701"></a>  </span>
<span id="cb1-702"><a href="#cb1-702"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb1-703"><a href="#cb1-703"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb1-704"><a href="#cb1-704"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb1-705"><a href="#cb1-705"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb1-706"><a href="#cb1-706"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb1-707"><a href="#cb1-707"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb1-708"><a href="#cb1-708"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb1-709"><a href="#cb1-709"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb1-710"><a href="#cb1-710"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb1-711"><a href="#cb1-711"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb1-712"><a href="#cb1-712"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-713"><a href="#cb1-713"></a>  })</span>
<span id="cb1-714"><a href="#cb1-714"></a>  </span>
<span id="cb1-715"><a href="#cb1-715"></a>  </span>
<span id="cb1-716"><a href="#cb1-716"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb1-717"><a href="#cb1-717"></a>  </span>
<span id="cb1-718"><a href="#cb1-718"></a>  <span class="co"># New code goes here :)</span></span>
<span id="cb1-719"><a href="#cb1-719"></a>}</span>
<span id="cb1-720"><a href="#cb1-720"></a></span>
<span id="cb1-721"><a href="#cb1-721"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="further-resources" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="further-resources"><span class="header-section-number">1.2</span> Further resources</h2>
<ul>
<li><a href="https://r.geocompx.org/adv-map.html">Chapter 9</a> of Robin Lovelace’s “Geocomputation with R”</li>
<li>The documentation of <a href="https://rstudio.github.io/leaflet/">Leaflet for R</a></li>
</ul>
</section>
</section>
<section id="basics-of-spatial-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Basics of spatial data</h1>
<ul>
<li>Spatial data is the foundation of mapping, but what is it?</li>
<li>Spatial data is all data that can be explicitly linked to a spatial reference (longitude/latitude)</li>
</ul>
<table class="caption-top table">
<caption>A very basic form of spatial data</caption>
<thead>
<tr class="header">
<th>val</th>
<th>lon</th>
<th>lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5.234</td>
<td>52.5646345</td>
<td>7.4326654</td>
</tr>
<tr class="even">
<td>72.360</td>
<td>51.3453453</td>
<td>7.3242334</td>
</tr>
<tr class="odd">
<td>12.543</td>
<td>52.4564561</td>
<td>7.2323423</td>
</tr>
</tbody>
</table>
<section id="types-of-spatial-data" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="types-of-spatial-data"><span class="header-section-number">2.1</span> Types of spatial data</h2>
<ul>
<li>Geography can describe the world in two ways:
<ul>
<li>As spatially continuous processes (or as <em>raster data</em>)</li>
<li>As an ensemble of individual elements (or as <em>vector data</em>)</li>
</ul></li>
<li>Vector data is also called spatial geometries and can be divided into
<ul>
<li>Points (e.g., individual events or places)</li>
<li>Lines (e.g., streets, rivers)</li>
<li>Polygons (e.g., buildings, districts)</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://saylordotorg.github.io/text_essentials-of-geographic-information-systems/section_11/ca6ce94cdd2e09a1da8aa6ec22336835.jpg" class="img-fluid figure-img" width="440"></p>
<figcaption>The real world described by layers of raster and vector data (<a href="https://saylordotorg.github.io/text_essentials-of-geographic-information-systems/s11-02-multiple-layer-analysis.html#campbell_1.0-ch07_s02_f01">Source</a>)</figcaption>
</figure>
</div>
</section>
<section id="spatial-data-in-r" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="spatial-data-in-r"><span class="header-section-number">2.2</span> Spatial data in R</h2>
<ul>
<li>In R, spatial data can be handled using various packages:
<ul>
<li><code>sp</code> (vector data) and <code>raster</code> (raster data) used to be the common packages for spatial analysis</li>
<li><code>sf</code> (vector data) and <code>terra</code> (raster data) are their more timely successors</li>
</ul></li>
<li>By default, <code>data_guerry</code> is an sp object, but we converted it to an sf dataframe</li>
<li><code>sf</code> dataframes consist of a geometry column (class <code>sfc</code>) and multiple features (i.e.&nbsp;non-spatial columns)</li>
<li><code>sfc</code> geometries are list-like objects that consist of individual geometries (class <code>sfg</code>) and spatial metadata (e.g.&nbsp;type or dimension)</li>
<li><code>sfg</code> objects are matrices consisting purely of coordinates</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1">1</button><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1"></a><span class="fu">st_sf</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2">2</button><span id="annotated-cell-2-2" class="code-annotation-target"><a href="#annotated-cell-2-2"></a>    <span class="at">feature =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3">3</button><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3"></a>    <span class="at">geometry =</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4">4</button><span id="annotated-cell-2-4" class="code-annotation-target"><a href="#annotated-cell-2-4"></a>        <span class="fu">st_sfc</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5">5</button><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a>            <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="annotated-cell-2-6"><a href="#annotated-cell-2-6"></a>            <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="annotated-cell-2-7"><a href="#annotated-cell-2-7"></a>          <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="annotated-cell-2-8"><a href="#annotated-cell-2-8"></a>            <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="annotated-cell-2-9"><a href="#annotated-cell-2-9"></a>        )</span>
<span id="annotated-cell-2-10"><a href="#annotated-cell-2-10"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">Create an sf dataframe</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="2">Create a feature column – essentially a regular non-spatial column</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="3">Create a geometry column containing an <code>sfc</code> object</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="4" data-code-annotation="4"><code>sfc</code> = geometry + spatial metadata</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5,6,7,8,9" data-code-annotation="5"><code>sfg</code> = raw geometries</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 4 features and 1 field
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 1 ymin: 1 xmax: 2 ymax: 2
CRS:           NA
  feature    geometry
1       1 POINT (1 1)
2       2 POINT (1 2)
3       1 POINT (2 2)
4       2 POINT (2 1)</code></pre>
</div>
</div>
</section>
<section id="coordinate-reference-systems" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="coordinate-reference-systems"><span class="header-section-number">2.3</span> Coordinate reference systems</h2>
<ul>
<li>All spatial data need to have a <strong>coordinate reference system</strong> (CRS) that locates the coordinates on the planet</li>
<li>The geodetic specifics are mostly not necessary, but it’s always good to know a basic distinction
<ul>
<li><strong>Geodetic CRS</strong>
<ul>
<li>Uses angular units (degrees) because they are based on a spheroid</li>
<li>Usually good for global or national scale visualizations</li>
<li>Example: WGS84 (World Geodetic System)</li>
</ul></li>
<li><strong>Projected CRS</strong>
<ul>
<li>Uses metric units (meters) because they are based on a projected model of the earth</li>
<li>Usually good for local or regional high-precision spatial analysis and visualization</li>
<li>Example: UTM (Universal Transversal Mercator)</li>
</ul></li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Utm-zones.jpg" class="img-fluid figure-img"></p>
<figcaption>UTM (Universal Transversal Mercator) - a projected coordinate system. Each zone is a CRS.</figcaption>
</figure>
</div>
</section>
<section id="epsg-codes" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="epsg-codes"><span class="header-section-number">2.4</span> EPSG codes</h2>
<ul>
<li>CRS can be referenced using numeric identifiers called EPSG codes
<ul>
<li>EPSG database: <a href="https://epsg.io/" class="uri">https://epsg.io/</a>, e.g.&nbsp;EPSG code 4326: <a href="https://epsg.io/4326" class="uri">https://epsg.io/4326</a></li>
</ul></li>
</ul>
<table class="caption-top table">
<caption>Some common CRS</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>EPSG code</th>
<th>Area</th>
<th>Geodetic?</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System 1984 (WGS84)</a></td>
<td>4326</td>
<td>World</td>
<td>Yes</td>
<td>Basic geographic coordinates, common usage in GPS systems</td>
</tr>
<tr class="even">
<td><a href="https://en.wikipedia.org/wiki/Web_Mercator_projection">WGS 84 / Pseudo-Mercator</a></td>
<td>3857</td>
<td>World</td>
<td>No</td>
<td>Google Maps, OpenStreetMap, general web mapping</td>
</tr>
<tr class="odd">
<td><a href="https://de.wikipedia.org/wiki/UTM-Koordinatensystem">UTM zone 32N</a></td>
<td>25832</td>
<td>Central Europe</td>
<td>No</td>
<td>Spatial analysis and measuring in Central Europe</td>
</tr>
<tr class="even">
<td><a href="https://en.wikipedia.org/wiki/European_grid">LAEA Europe</a></td>
<td>3035</td>
<td>Europe</td>
<td>No</td>
<td>Multi-purpose CRS developed by the EU</td>
</tr>
</tbody>
</table>
</section>
<section id="crs-in-r" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="crs-in-r"><span class="header-section-number">2.5</span> CRS in R</h2>
<ul>
<li>How do we work with CRS in R?
<ul>
<li>Convert to an sf dataframe: <a href="https://r-spatial.github.io/sf/reference/st_as_sf.html"><code>st_as_sf</code></a><code>(..., crs = 4326)</code></li>
<li>Assign a CRS to an existing sf dataframe: <a href="https://r-spatial.github.io/sf/reference/st_crs.html"><code>st_crs</code></a><code>(...) &lt;- 4326</code> or <code>st_set_crs(…, 4326)</code></li>
<li>Transform an existing CRS to a new CRS: <a href="https://r-spatial.github.io/sf/reference/st_transform.html"><code>st_transform</code></a><code>(..., 4326)</code></li>
</ul></li>
</ul>
<!-- -->
</section>
<section id="handling-the-guerry-dataset" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="handling-the-guerry-dataset"><span class="header-section-number">2.6</span> Handling the Guerry dataset</h2>
<ul>
<li>Let us take a look back at <code>data_guerry</code> and how to handle it as a spatial dataframe</li>
<li><code>Guerry::gfrance85</code> comes as an <code>sp</code> dataframe, that’s a bit old so we have to convert it</li>
<li>The dataset also comes with an invalid CRS, so we need to fix it</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1">1</button><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2">2</button><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3">3</button><span id="annotated-cell-3-3" class="code-annotation-target"><a href="#annotated-cell-3-3"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4">4</button><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="5">5</button><span id="annotated-cell-3-5" class="code-annotation-target"><a href="#annotated-cell-3-5"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6"></a>    Region,</span>
<span id="annotated-cell-3-7"><a href="#annotated-cell-3-7"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="annotated-cell-3-9"><a href="#annotated-cell-3-9"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="annotated-cell-3-11"><a href="#annotated-cell-3-11"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="annotated-cell-3-12"><a href="#annotated-cell-3-12"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-3-13"><a href="#annotated-cell-3-13"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span> <span class="co"># drop columns</span></span>
<span id="annotated-cell-3-14"><a href="#annotated-cell-3-14"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names))) <span class="co"># select columns</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1"><code>Guerry::gfrance85</code> comes as an sp object and it has no CRS information</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="2">…, so we convert it to an sf dataframe</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="3" data-code-annotation="3">Also convert it to a tibble to make it look nicer</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="4">Finally, convert it back to sf and set the CRS to 25572 (which is the native CRS of the Guerry data)</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="5,6,7,8,9,10,11,12" data-code-annotation="5">Here, we change the region coding that can be used for spatial aggregation</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="spatial-operations" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="spatial-operations"><span class="header-section-number">2.7</span> Spatial operations</h2>
<ul>
<li>For mapping the Guerry data, a nice addition is to perform spatial aggregation to compare the data across geographical levels</li>
<li>Spatial operations like spatial aggregations are one of the main advantages of spatial over regular data</li>
<li>In Guerry, we have two levels: Departments (smaller) and regions (larger)</li>
<li>In the following chunk we perform spatial aggregation <em>outside</em> of the server function</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2"></a>    <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4"></a>        <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5"></a>        <span class="cf">function</span>(x) {</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6"></a>            <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7"></a>                <span class="fu">sum</span>(x)</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8"></a>            } <span class="cf">else</span> {</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9"></a>                <span class="fu">mean</span>(x)</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10"></a>            }</span>
<span id="annotated-cell-4-11"><a href="#annotated-cell-4-11"></a>        }</span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12"></a>    ))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="1">Define a group variable (Region)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3,4,5,6,7,8,9,10,11,12" data-code-annotation="2">Aggregate Guerry variables and geometries by their grouping variable <code>Region</code>. Features are summed or averaged while geometries are merged.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="guerry-as-spatial-data" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="guerry-as-spatial-data"><span class="header-section-number">2.8</span> Guerry as spatial data</h2>
<ul>
<li><strong>Question:</strong> What can we say about the Guerry dataset in terms of spatial information?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>data_guerry[<span class="st">"Literacy"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 85 features and 1 field
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441
Projected CRS: NTF (Paris) / Lambert zone II
# A tibble: 85 × 2
   Literacy                                                             geometry
      &lt;int&gt;                                                   &lt;MULTIPOLYGON [m]&gt;
 1       37 (((801150 2092615, 800669 2093190, 800688 2095430, 800780 2095795, …
 2       51 (((729326 2521619, 729320 2521230, 729280 2518544, 728751 2517520, …
 3       13 (((710830 2137350, 711746 2136617, 712430 2135212, 712070 2134132, …
 4       46 (((882701 1920024, 882408 1920733, 881778 1921200, 881526 1922332, …
 5       69 (((886504 1922890, 885733 1922978, 885479 1923276, 883061 1925266, …
 6       27 (((747008 1925789, 746630 1925762, 745723 1925138, 744216 1925236, …
 7       67 (((818893 2514767, 818614 2514515, 817900 2514467, 817327 2514945, …
 8       18 (((509103 1747787, 508820 1747513, 508154 1747093, 505861 1746627, …
 9       59 (((775400 2345600, 775068 2345397, 773587 2345177, 772940 2344780, …
10       34 (((626230 1810121, 626269 1810496, 627494 1811321, 627681 1812424, …
# ℹ 75 more rows</code></pre>
</div>
</div>
</section>
<section id="exercises" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.9</span> Exercises</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Extract the <code>sfc</code> object from the <code>Guerry</code> dataset. What is the difference between <code>sf</code> and <code>sfc</code>?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Consult the documentation of <code>st_geometry()</code></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">st_geometry</span>(data_guerry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>sf</code> objects are dataframes containing of one or more non-spatial feature columns and a geometry column containing an <code>sfc</code> object</p>
<p><code>sfc</code> objects are representations of geospatial geometries. They contain all relevant spatial metadata but no contextual feature data</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Extract the fifth <code>sfg</code> object of the <code>sfc</code> object from exercise 1. What is the difference between the two?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Objects of class <code>sfc</code> behave like lists and can be subset in the same fashion</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>geom <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(data_guerry)</span>
<span id="cb6-2"><a href="#cb6-2"></a>geom[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>sfg</code> objects contain raw geometries consisting only of coordinates and a geometric topology (i.e.&nbsp;how to connect coordinates to make a polygon)</p>
<p><code>sfc</code> objects have spatial metadata including the CRS which makes it possible to where the coordinates are located on the planet</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 3
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>data_guerry</code> currently consists of multi polygons. How can we convert these polygons to point geometries? Explore the <a href="https://r-spatial.github.io/sf/reference/index.html">function reference</a> of the sf package and find functions (multiple answers possible) that can convert polygons to points in some way.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A search for “point” can give you the most obvious functions to fulfill the task, but there’s more!</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>st_point_on_surface(data_guerry)</code> returns a point that is guaranteed to be on the polygon</p>
<p><code>st_centroid(data_guerry)</code> returns the geometrical center of the polygon</p>
<p><code>st_cast(data_guerry, "POINT")</code> or <code>st_cast(data_guerry, "MULTIPOINT")</code></p>
<p>All of them return a warning! <a href="https://r-spatial.github.io/sf/articles/sf1.html#how-attributes-relate-to-geometries">Why might that be?</a></p>
<p><code>st_sample(data_guerry, size = rep(1, nrow(data_guerry)))</code></p>
<p>Doesn’t return a warning, but is random and drops all features</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Currently, the <code>Guerry</code> dataframe has the CRS “NTF (Paris) / Lambert zone II”, which is already a good choice. What other CRS could be a good choice for accurate mapping in France?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Remember the UTM coordinate system! Scroll back up to see the UTM zones.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>While there are many CRS that might be a good choice, one solution that we addressed in this workshop are UTM zones! Taking a look at the figure of UTM zones we can see that UTM zone 31N almost entirely covers the area of France.</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/6/61/Modified_UTM_Zones.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 5
</div>
</div>
<div class="callout-body-container callout-body">
<p>Transform the <code>Guerry</code> dataframe to your new CRS from exercise 4.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Remember you can visit <a href="https://epsg.io/" class="uri">https://epsg.io/</a> to look up EPSG codes.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the search function on <a href="https://epsg.io/?q=utm+zone+31n">epsg.io</a> we can determine that the EPSG code to transform the Guerry dataset from Lambert zone II to UTM zone 31N is one of 23031, 25831 or 32631.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>  <span class="fu">st_transform</span>(data_guerry, <span class="dv">23031</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="interactive-maps-using-leaflet" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Interactive maps using Leaflet</h1>
<ul>
<li><p>R offers many solutions to mapping, some more advanced than others</p>
<ul>
<li><a href="https://cloud.r-project.org/web/packages/ggplot2/"><code>ggplot2</code></a> supports spatial data with functions like <a href="https://ggplot2.tidyverse.org/reference/ggsf.html"><code>geom_sf</code></a>, <a href="https://ggplot2.tidyverse.org/reference/ggsf.html"><code>coord_sf</code></a> and custom ones like <a href="https://r-spatial.github.io/stars/reference/geom_stars.html"><code>stars::geom_stars</code></a></li>
<li><a href="https://cran.r-project.org/web/packages/tmap/"><code>tmap</code></a> is a comprehensive framework for high-quality thematic mapping</li>
<li><a href="https://cran.r-project.org/web/packages/cartography/index.html"><code>cartography</code></a> and <a href="https://cran.r-project.org/web/packages/mapsf/index.html"><code>mapsf</code></a> incorporate cartography principles to move R closer to dedicated mapping software</li>
<li><a href="https://cran.r-project.org/web/packages/leaflet/"><code>leaflet</code></a> interfaces the Leaflet JavaScript library to create interactive map visualizations</li>
</ul></li>
</ul>
<section id="integrate-leaflet-in-shiny" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="integrate-leaflet-in-shiny"><span class="header-section-number">3.1</span> Integrate Leaflet in Shiny</h2>
<ul>
<li>Leaflet in Shiny works just like any other type of visualization, we need:
<ul>
<li>A UI output: <a href="https://rdrr.io/cran/leaflet/man/map-shiny.html"><code>leaflet::leafletOutput()</code></a></li>
<li>A rendering function: <a href="https://rdrr.io/cran/leaflet/man/map-shiny.html"><code>leaflet::renderLeaflet()</code></a></li>
</ul></li>
<li>In our app, we add a geographic explorer of the Guerry dataset</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-6"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="1">1</button><span id="annotated-cell-6-1" class="code-annotation-target"><a href="#annotated-cell-6-1"></a><span class="fu">tabItem</span>(</span>
<span id="annotated-cell-6-2"><a href="#annotated-cell-6-2"></a>  <span class="at">tabName =</span> <span class="st">"tab_map"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="2">2</button><span id="annotated-cell-6-3" class="code-annotation-target"><a href="#annotated-cell-6-3"></a>  <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-6-4"><a href="#annotated-cell-6-4"></a>    <span class="fu">column</span>(</span>
<span id="annotated-cell-6-5"><a href="#annotated-cell-6-5"></a>      <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-6-6"><a href="#annotated-cell-6-6"></a>      <span class="fu">box</span>(</span>
<span id="annotated-cell-6-7"><a href="#annotated-cell-6-7"></a>        <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="annotated-cell-6-8"><a href="#annotated-cell-6-8"></a>        <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-6-9"><a href="#annotated-cell-6-9"></a>        <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-6-10"><a href="#annotated-cell-6-10"></a>        <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-6-11"><a href="#annotated-cell-6-11"></a>        <span class="at">width =</span> <span class="dv">12</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-6" data-target-annotation="3">3</button><span id="annotated-cell-6-12" class="code-annotation-target"><a href="#annotated-cell-6-12"></a>        leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="annotated-cell-6-13"><a href="#annotated-cell-6-13"></a>      ) <span class="co"># end box</span></span>
<span id="annotated-cell-6-14"><a href="#annotated-cell-6-14"></a>    ) <span class="co"># end column</span></span>
<span id="annotated-cell-6-15"><a href="#annotated-cell-6-15"></a>  ) <span class="co"># end fluidRow</span></span>
<span id="annotated-cell-6-16"><a href="#annotated-cell-6-16"></a>) <span class="co"># end tabItem</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-6" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="1,2" data-code-annotation="1">Create a new tab called <code>tab_map</code></span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="3,4,5,6,7,8,9,10,11" data-code-annotation="2">Add a fluid row containing a column and a box covering the entire page</span>
</dd>
<dt data-target-cell="annotated-cell-6" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-6" data-code-lines="12" data-code-annotation="3">Add a UI output that will hold the leaflet map. It covers the entire width and 800 pixels in height.</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="leaflet-workhorse" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="leaflet-workhorse"><span class="header-section-number">3.2</span> Leaflet workhorse</h2>
<ul>
<li>The leaflet package is centered around the workhorse <a href="https://rdrr.io/cran/leaflet/man/leaflet.html"><code>leaflet()</code></a> which creates an empty map canvas</li>
<li>Each additional function can be piped into and adds an additional mapping component (similar to <code>ggplot2</code>)
<ul>
<li><a href="https://rdrr.io/cran/leaflet/man/addProviderTiles.html"><code>addProviderTiles()</code></a> adds a base map, in this case we use four base maps that can be chosen from</li>
<li><a href="https://rdrr.io/cran/leaflet/man/addLayersControl.html"><code>addLayersControl()</code></a> adds a button that lets you switch between map layers</li>
<li><a href="https://rdrr.io/cran/leaflet/man/map-methods.html"><code>setView()</code></a> sets the center and zoom level of the initial map view</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1"></a>output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2"></a>        <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-7-4"><a href="#annotated-cell-7-4"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4">4</button><span id="annotated-cell-7-7" class="code-annotation-target"><a href="#annotated-cell-7-7"></a>            <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a>                                                                            <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5">5</button><span id="annotated-cell-7-9" class="code-annotation-target"><a href="#annotated-cell-7-9"></a>            <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>)</span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">Fill the output <code>tab_map_map</code> with a leaflet map using <code>renderLeaflet</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="2">Add an empty map using the power horse <code>leaflet()</code></span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3,4,5,6" data-code-annotation="3">Add multiple basemaps: OpenStreetMap, OpenTopoMap, Stamen and ortho photos from the French geo portal</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="7,8" data-code-annotation="4">Add a button to control which of the basemaps to show</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="9" data-code-annotation="5">Set the initial center of the map and the zoom level</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_01.gif" class="img-fluid"></p>
</section>
<section id="full-code" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="full-code"><span class="header-section-number">3.3</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including an empty map</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb8-21"><a href="#cb8-21"></a></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb8-29"><a href="#cb8-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb8-32"><a href="#cb8-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb8-33"><a href="#cb8-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb8-34"><a href="#cb8-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb8-35"><a href="#cb8-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb8-37"><a href="#cb8-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb8-38"><a href="#cb8-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb8-39"><a href="#cb8-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb8-40"><a href="#cb8-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb8-41"><a href="#cb8-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb8-42"><a href="#cb8-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb8-43"><a href="#cb8-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb8-44"><a href="#cb8-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb8-45"><a href="#cb8-45"></a>)</span>
<span id="cb8-46"><a href="#cb8-46"></a></span>
<span id="cb8-47"><a href="#cb8-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-48"><a href="#cb8-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb8-49"><a href="#cb8-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb8-50"><a href="#cb8-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb8-51"><a href="#cb8-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb8-52"><a href="#cb8-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-53"><a href="#cb8-53"></a>  ),</span>
<span id="cb8-54"><a href="#cb8-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb8-55"><a href="#cb8-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb8-56"><a href="#cb8-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb8-57"><a href="#cb8-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb8-58"><a href="#cb8-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-59"><a href="#cb8-59"></a>  ),</span>
<span id="cb8-60"><a href="#cb8-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb8-61"><a href="#cb8-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb8-62"><a href="#cb8-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb8-63"><a href="#cb8-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb8-64"><a href="#cb8-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb8-65"><a href="#cb8-65"></a>  ),</span>
<span id="cb8-66"><a href="#cb8-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb8-67"><a href="#cb8-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb8-68"><a href="#cb8-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb8-69"><a href="#cb8-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb8-70"><a href="#cb8-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-71"><a href="#cb8-71"></a>  ),</span>
<span id="cb8-72"><a href="#cb8-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb8-73"><a href="#cb8-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb8-74"><a href="#cb8-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb8-75"><a href="#cb8-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb8-76"><a href="#cb8-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-77"><a href="#cb8-77"></a>  ),</span>
<span id="cb8-78"><a href="#cb8-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb8-79"><a href="#cb8-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb8-80"><a href="#cb8-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb8-81"><a href="#cb8-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb8-82"><a href="#cb8-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-83"><a href="#cb8-83"></a>  ),</span>
<span id="cb8-84"><a href="#cb8-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb8-85"><a href="#cb8-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb8-86"><a href="#cb8-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb8-87"><a href="#cb8-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb8-88"><a href="#cb8-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-89"><a href="#cb8-89"></a>  ),</span>
<span id="cb8-90"><a href="#cb8-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb8-91"><a href="#cb8-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb8-92"><a href="#cb8-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb8-93"><a href="#cb8-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb8-94"><a href="#cb8-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-95"><a href="#cb8-95"></a>  ),</span>
<span id="cb8-96"><a href="#cb8-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb8-97"><a href="#cb8-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb8-98"><a href="#cb8-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb8-99"><a href="#cb8-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb8-100"><a href="#cb8-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-101"><a href="#cb8-101"></a>  ),</span>
<span id="cb8-102"><a href="#cb8-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb8-103"><a href="#cb8-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb8-104"><a href="#cb8-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb8-105"><a href="#cb8-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb8-106"><a href="#cb8-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb8-107"><a href="#cb8-107"></a>  ),</span>
<span id="cb8-108"><a href="#cb8-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb8-109"><a href="#cb8-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb8-110"><a href="#cb8-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb8-111"><a href="#cb8-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb8-112"><a href="#cb8-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-113"><a href="#cb8-113"></a>  ),</span>
<span id="cb8-114"><a href="#cb8-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb8-115"><a href="#cb8-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb8-116"><a href="#cb8-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb8-117"><a href="#cb8-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb8-118"><a href="#cb8-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-119"><a href="#cb8-119"></a>  ),</span>
<span id="cb8-120"><a href="#cb8-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb8-121"><a href="#cb8-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb8-122"><a href="#cb8-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb8-123"><a href="#cb8-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb8-124"><a href="#cb8-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-125"><a href="#cb8-125"></a>  ),</span>
<span id="cb8-126"><a href="#cb8-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb8-127"><a href="#cb8-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb8-128"><a href="#cb8-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb8-129"><a href="#cb8-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb8-130"><a href="#cb8-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-131"><a href="#cb8-131"></a>  ),</span>
<span id="cb8-132"><a href="#cb8-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb8-133"><a href="#cb8-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb8-134"><a href="#cb8-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb8-135"><a href="#cb8-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb8-136"><a href="#cb8-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-137"><a href="#cb8-137"></a>  ),</span>
<span id="cb8-138"><a href="#cb8-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb8-139"><a href="#cb8-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb8-140"><a href="#cb8-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb8-141"><a href="#cb8-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb8-142"><a href="#cb8-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-143"><a href="#cb8-143"></a>  ),</span>
<span id="cb8-144"><a href="#cb8-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb8-145"><a href="#cb8-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb8-146"><a href="#cb8-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb8-147"><a href="#cb8-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb8-148"><a href="#cb8-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb8-149"><a href="#cb8-149"></a>  ),</span>
<span id="cb8-150"><a href="#cb8-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb8-151"><a href="#cb8-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb8-152"><a href="#cb8-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb8-153"><a href="#cb8-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb8-154"><a href="#cb8-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb8-155"><a href="#cb8-155"></a>  ),</span>
<span id="cb8-156"><a href="#cb8-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb8-157"><a href="#cb8-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb8-158"><a href="#cb8-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb8-159"><a href="#cb8-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb8-160"><a href="#cb8-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb8-161"><a href="#cb8-161"></a>  )</span>
<span id="cb8-162"><a href="#cb8-162"></a>)</span>
<span id="cb8-163"><a href="#cb8-163"></a></span>
<span id="cb8-164"><a href="#cb8-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb8-165"><a href="#cb8-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-166"><a href="#cb8-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-167"><a href="#cb8-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-168"><a href="#cb8-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb8-169"><a href="#cb8-169"></a>    Region,</span>
<span id="cb8-170"><a href="#cb8-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb8-171"><a href="#cb8-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb8-172"><a href="#cb8-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb8-173"><a href="#cb8-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb8-174"><a href="#cb8-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb8-175"><a href="#cb8-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb8-176"><a href="#cb8-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-177"><a href="#cb8-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb8-178"><a href="#cb8-178"></a></span>
<span id="cb8-179"><a href="#cb8-179"></a></span>
<span id="cb8-180"><a href="#cb8-180"></a></span>
<span id="cb8-181"><a href="#cb8-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb8-182"><a href="#cb8-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb8-183"><a href="#cb8-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-184"><a href="#cb8-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb8-185"><a href="#cb8-185"></a></span>
<span id="cb8-186"><a href="#cb8-186"></a></span>
<span id="cb8-187"><a href="#cb8-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb8-188"><a href="#cb8-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb8-189"><a href="#cb8-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb8-190"><a href="#cb8-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb8-191"><a href="#cb8-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb8-192"><a href="#cb8-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb8-193"><a href="#cb8-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb8-194"><a href="#cb8-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb8-195"><a href="#cb8-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb8-196"><a href="#cb8-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb8-197"><a href="#cb8-197"></a>      }</span>
<span id="cb8-198"><a href="#cb8-198"></a>    }</span>
<span id="cb8-199"><a href="#cb8-199"></a>  ))</span>
<span id="cb8-200"><a href="#cb8-200"></a></span>
<span id="cb8-201"><a href="#cb8-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb8-202"><a href="#cb8-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb8-203"><a href="#cb8-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-204"><a href="#cb8-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb8-205"><a href="#cb8-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-206"><a href="#cb8-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb8-207"><a href="#cb8-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb8-208"><a href="#cb8-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb8-209"><a href="#cb8-209"></a>)</span>
<span id="cb8-210"><a href="#cb8-210"></a></span>
<span id="cb8-211"><a href="#cb8-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb8-212"><a href="#cb8-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb8-213"><a href="#cb8-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-214"><a href="#cb8-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb8-215"><a href="#cb8-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb8-216"><a href="#cb8-216"></a>)</span>
<span id="cb8-217"><a href="#cb8-217"></a></span>
<span id="cb8-218"><a href="#cb8-218"></a></span>
<span id="cb8-219"><a href="#cb8-219"></a></span>
<span id="cb8-220"><a href="#cb8-220"></a></span>
<span id="cb8-221"><a href="#cb8-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb8-222"><a href="#cb8-222"></a></span>
<span id="cb8-223"><a href="#cb8-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb8-224"><a href="#cb8-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb8-225"><a href="#cb8-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb8-226"><a href="#cb8-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb8-227"><a href="#cb8-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb8-228"><a href="#cb8-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb8-229"><a href="#cb8-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb8-230"><a href="#cb8-230"></a>    )</span>
<span id="cb8-231"><a href="#cb8-231"></a>  ),</span>
<span id="cb8-232"><a href="#cb8-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb8-233"><a href="#cb8-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb8-234"><a href="#cb8-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb8-235"><a href="#cb8-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb8-236"><a href="#cb8-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb8-237"><a href="#cb8-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb8-238"><a href="#cb8-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb8-239"><a href="#cb8-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb8-240"><a href="#cb8-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb8-241"><a href="#cb8-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb8-242"><a href="#cb8-242"></a>    ),</span>
<span id="cb8-243"><a href="#cb8-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-244"><a href="#cb8-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-245"><a href="#cb8-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-246"><a href="#cb8-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb8-247"><a href="#cb8-247"></a>  ),</span>
<span id="cb8-248"><a href="#cb8-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb8-249"><a href="#cb8-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb8-250"><a href="#cb8-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb8-251"><a href="#cb8-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb8-252"><a href="#cb8-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb8-253"><a href="#cb8-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb8-254"><a href="#cb8-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb8-255"><a href="#cb8-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb8-256"><a href="#cb8-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb8-257"><a href="#cb8-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb8-258"><a href="#cb8-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb8-259"><a href="#cb8-259"></a>        ),</span>
<span id="cb8-260"><a href="#cb8-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb8-261"><a href="#cb8-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb8-262"><a href="#cb8-262"></a>          <span class="fu">column</span>(</span>
<span id="cb8-263"><a href="#cb8-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb8-264"><a href="#cb8-264"></a>            <span class="fu">box</span>(</span>
<span id="cb8-265"><a href="#cb8-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb8-266"><a href="#cb8-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-267"><a href="#cb8-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-268"><a href="#cb8-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb8-269"><a href="#cb8-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb8-270"><a href="#cb8-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb8-271"><a href="#cb8-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb8-272"><a href="#cb8-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb8-273"><a href="#cb8-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb8-274"><a href="#cb8-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb8-275"><a href="#cb8-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb8-276"><a href="#cb8-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb8-277"><a href="#cb8-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb8-278"><a href="#cb8-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb8-279"><a href="#cb8-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb8-280"><a href="#cb8-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb8-281"><a href="#cb8-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb8-282"><a href="#cb8-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb8-283"><a href="#cb8-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb8-284"><a href="#cb8-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb8-285"><a href="#cb8-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb8-286"><a href="#cb8-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb8-287"><a href="#cb8-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb8-288"><a href="#cb8-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb8-289"><a href="#cb8-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb8-290"><a href="#cb8-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb8-291"><a href="#cb8-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb8-292"><a href="#cb8-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb8-293"><a href="#cb8-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-294"><a href="#cb8-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-295"><a href="#cb8-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb8-296"><a href="#cb8-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb8-297"><a href="#cb8-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb8-298"><a href="#cb8-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb8-299"><a href="#cb8-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb8-300"><a href="#cb8-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb8-301"><a href="#cb8-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb8-302"><a href="#cb8-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb8-303"><a href="#cb8-303"></a>                  )</span>
<span id="cb8-304"><a href="#cb8-304"></a>                ),</span>
<span id="cb8-305"><a href="#cb8-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb8-306"><a href="#cb8-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb8-307"><a href="#cb8-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-308"><a href="#cb8-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-309"><a href="#cb8-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb8-310"><a href="#cb8-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb8-311"><a href="#cb8-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb8-312"><a href="#cb8-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb8-313"><a href="#cb8-313"></a>                )</span>
<span id="cb8-314"><a href="#cb8-314"></a>              )</span>
<span id="cb8-315"><a href="#cb8-315"></a>            )</span>
<span id="cb8-316"><a href="#cb8-316"></a>          ),</span>
<span id="cb8-317"><a href="#cb8-317"></a>          <span class="fu">column</span>(</span>
<span id="cb8-318"><a href="#cb8-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb8-319"><a href="#cb8-319"></a>            <span class="fu">box</span>(</span>
<span id="cb8-320"><a href="#cb8-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb8-321"><a href="#cb8-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-322"><a href="#cb8-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-323"><a href="#cb8-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb8-324"><a href="#cb8-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb8-325"><a href="#cb8-325"></a>            )</span>
<span id="cb8-326"><a href="#cb8-326"></a>          )</span>
<span id="cb8-327"><a href="#cb8-327"></a>        )</span>
<span id="cb8-328"><a href="#cb8-328"></a>      ),</span>
<span id="cb8-329"><a href="#cb8-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb8-330"><a href="#cb8-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb8-331"><a href="#cb8-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb8-332"><a href="#cb8-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb8-333"><a href="#cb8-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb8-334"><a href="#cb8-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb8-335"><a href="#cb8-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb8-336"><a href="#cb8-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb8-337"><a href="#cb8-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb8-338"><a href="#cb8-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb8-339"><a href="#cb8-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-340"><a href="#cb8-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb8-341"><a href="#cb8-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-342"><a href="#cb8-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb8-343"><a href="#cb8-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb8-344"><a href="#cb8-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb8-345"><a href="#cb8-345"></a>            ),</span>
<span id="cb8-346"><a href="#cb8-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-347"><a href="#cb8-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb8-348"><a href="#cb8-348"></a>          )</span>
<span id="cb8-349"><a href="#cb8-349"></a>        ),</span>
<span id="cb8-350"><a href="#cb8-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb8-351"><a href="#cb8-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb8-352"><a href="#cb8-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb8-353"><a href="#cb8-353"></a>      ),</span>
<span id="cb8-354"><a href="#cb8-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb8-355"><a href="#cb8-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb8-356"><a href="#cb8-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb8-357"><a href="#cb8-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb8-358"><a href="#cb8-358"></a>          <span class="fu">column</span>(</span>
<span id="cb8-359"><a href="#cb8-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb8-360"><a href="#cb8-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb8-361"><a href="#cb8-361"></a>            <span class="fu">box</span>(</span>
<span id="cb8-362"><a href="#cb8-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-363"><a href="#cb8-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb8-364"><a href="#cb8-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-365"><a href="#cb8-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb8-366"><a href="#cb8-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb8-367"><a href="#cb8-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb8-368"><a href="#cb8-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb8-369"><a href="#cb8-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-370"><a href="#cb8-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb8-371"><a href="#cb8-371"></a>              ),</span>
<span id="cb8-372"><a href="#cb8-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb8-373"><a href="#cb8-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb8-374"><a href="#cb8-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb8-375"><a href="#cb8-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb8-376"><a href="#cb8-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb8-377"><a href="#cb8-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-378"><a href="#cb8-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-379"><a href="#cb8-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb8-380"><a href="#cb8-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb8-381"><a href="#cb8-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb8-382"><a href="#cb8-382"></a>                ),</span>
<span id="cb8-383"><a href="#cb8-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-384"><a href="#cb8-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb8-385"><a href="#cb8-385"></a>              ),</span>
<span id="cb8-386"><a href="#cb8-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb8-387"><a href="#cb8-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb8-388"><a href="#cb8-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb8-389"><a href="#cb8-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-390"><a href="#cb8-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-391"><a href="#cb8-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb8-392"><a href="#cb8-392"></a>              ),</span>
<span id="cb8-393"><a href="#cb8-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb8-394"><a href="#cb8-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb8-395"><a href="#cb8-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb8-396"><a href="#cb8-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb8-397"><a href="#cb8-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb8-398"><a href="#cb8-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb8-399"><a href="#cb8-399"></a>              )</span>
<span id="cb8-400"><a href="#cb8-400"></a>            ),</span>
<span id="cb8-401"><a href="#cb8-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb8-402"><a href="#cb8-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb8-403"><a href="#cb8-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-404"><a href="#cb8-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb8-405"><a href="#cb8-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb8-406"><a href="#cb8-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb8-407"><a href="#cb8-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-408"><a href="#cb8-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb8-409"><a href="#cb8-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-410"><a href="#cb8-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb8-411"><a href="#cb8-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb8-412"><a href="#cb8-412"></a>              ),</span>
<span id="cb8-413"><a href="#cb8-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb8-414"><a href="#cb8-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-415"><a href="#cb8-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb8-416"><a href="#cb8-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb8-417"><a href="#cb8-417"></a>              ),</span>
<span id="cb8-418"><a href="#cb8-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb8-419"><a href="#cb8-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-420"><a href="#cb8-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb8-421"><a href="#cb8-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb8-422"><a href="#cb8-422"></a>              )</span>
<span id="cb8-423"><a href="#cb8-423"></a>            )</span>
<span id="cb8-424"><a href="#cb8-424"></a>          ),</span>
<span id="cb8-425"><a href="#cb8-425"></a>          <span class="fu">column</span>(</span>
<span id="cb8-426"><a href="#cb8-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb8-427"><a href="#cb8-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb8-428"><a href="#cb8-428"></a>            <span class="fu">box</span>(</span>
<span id="cb8-429"><a href="#cb8-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-430"><a href="#cb8-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb8-431"><a href="#cb8-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-432"><a href="#cb8-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb8-433"><a href="#cb8-433"></a>            ),</span>
<span id="cb8-434"><a href="#cb8-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb8-435"><a href="#cb8-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb8-436"><a href="#cb8-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-437"><a href="#cb8-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb8-438"><a href="#cb8-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb8-439"><a href="#cb8-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-440"><a href="#cb8-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb8-441"><a href="#cb8-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-442"><a href="#cb8-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb8-443"><a href="#cb8-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb8-444"><a href="#cb8-444"></a>              ),</span>
<span id="cb8-445"><a href="#cb8-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-446"><a href="#cb8-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb8-447"><a href="#cb8-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb8-448"><a href="#cb8-448"></a>              ),</span>
<span id="cb8-449"><a href="#cb8-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb8-450"><a href="#cb8-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb8-451"><a href="#cb8-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb8-452"><a href="#cb8-452"></a>              )</span>
<span id="cb8-453"><a href="#cb8-453"></a>            )</span>
<span id="cb8-454"><a href="#cb8-454"></a>          )</span>
<span id="cb8-455"><a href="#cb8-455"></a>        )</span>
<span id="cb8-456"><a href="#cb8-456"></a>      ),</span>
<span id="cb8-457"><a href="#cb8-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb8-458"><a href="#cb8-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb8-459"><a href="#cb8-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb8-460"><a href="#cb8-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb8-461"><a href="#cb8-461"></a>          <span class="fu">column</span>(</span>
<span id="cb8-462"><a href="#cb8-462"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb8-463"><a href="#cb8-463"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb8-464"><a href="#cb8-464"></a>            <span class="fu">box</span>(</span>
<span id="cb8-465"><a href="#cb8-465"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb8-466"><a href="#cb8-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb8-467"><a href="#cb8-467"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-468"><a href="#cb8-468"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-469"><a href="#cb8-469"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb8-470"><a href="#cb8-470"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb8-471"><a href="#cb8-471"></a>            ) <span class="co"># end box</span></span>
<span id="cb8-472"><a href="#cb8-472"></a>          ) <span class="co"># end column</span></span>
<span id="cb8-473"><a href="#cb8-473"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb8-474"><a href="#cb8-474"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb8-475"><a href="#cb8-475"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb8-476"><a href="#cb8-476"></a>  ),</span>
<span id="cb8-477"><a href="#cb8-477"></a>  </span>
<span id="cb8-478"><a href="#cb8-478"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb8-479"><a href="#cb8-479"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb8-480"><a href="#cb8-480"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb8-481"><a href="#cb8-481"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb8-482"><a href="#cb8-482"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb8-483"><a href="#cb8-483"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb8-484"><a href="#cb8-484"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb8-485"><a href="#cb8-485"></a>    )</span>
<span id="cb8-486"><a href="#cb8-486"></a>  ),</span>
<span id="cb8-487"><a href="#cb8-487"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb8-488"><a href="#cb8-488"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb8-489"><a href="#cb8-489"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb8-490"><a href="#cb8-490"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb8-491"><a href="#cb8-491"></a>  )  </span>
<span id="cb8-492"><a href="#cb8-492"></a>)</span>
<span id="cb8-493"><a href="#cb8-493"></a></span>
<span id="cb8-494"><a href="#cb8-494"></a></span>
<span id="cb8-495"><a href="#cb8-495"></a></span>
<span id="cb8-496"><a href="#cb8-496"></a><span class="co"># 4 Server ----</span></span>
<span id="cb8-497"><a href="#cb8-497"></a></span>
<span id="cb8-498"><a href="#cb8-498"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb8-499"><a href="#cb8-499"></a>  </span>
<span id="cb8-500"><a href="#cb8-500"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb8-501"><a href="#cb8-501"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb8-502"><a href="#cb8-502"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-503"><a href="#cb8-503"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb8-504"><a href="#cb8-504"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb8-505"><a href="#cb8-505"></a>    </span>
<span id="cb8-506"><a href="#cb8-506"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb8-507"><a href="#cb8-507"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb8-508"><a href="#cb8-508"></a>    }</span>
<span id="cb8-509"><a href="#cb8-509"></a>    </span>
<span id="cb8-510"><a href="#cb8-510"></a>    data_table</span>
<span id="cb8-511"><a href="#cb8-511"></a>  })</span>
<span id="cb8-512"><a href="#cb8-512"></a>  </span>
<span id="cb8-513"><a href="#cb8-513"></a>  </span>
<span id="cb8-514"><a href="#cb8-514"></a>  <span class="do">### Create table----</span></span>
<span id="cb8-515"><a href="#cb8-515"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-516"><a href="#cb8-516"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb8-517"><a href="#cb8-517"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb8-518"><a href="#cb8-518"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb8-519"><a href="#cb8-519"></a>      tab,</span>
<span id="cb8-520"><a href="#cb8-520"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb8-521"><a href="#cb8-521"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb8-522"><a href="#cb8-522"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb8-523"><a href="#cb8-523"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb8-524"><a href="#cb8-524"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb8-525"><a href="#cb8-525"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-526"><a href="#cb8-526"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb8-527"><a href="#cb8-527"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb8-528"><a href="#cb8-528"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-529"><a href="#cb8-529"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-530"><a href="#cb8-530"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb8-531"><a href="#cb8-531"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb8-532"><a href="#cb8-532"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb8-533"><a href="#cb8-533"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb8-534"><a href="#cb8-534"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb8-535"><a href="#cb8-535"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb8-536"><a href="#cb8-536"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb8-537"><a href="#cb8-537"></a><span class="st">  </span></span>
<span id="cb8-538"><a href="#cb8-538"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb8-539"><a href="#cb8-539"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb8-540"><a href="#cb8-540"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb8-541"><a href="#cb8-541"></a><span class="st">            );</span></span>
<span id="cb8-542"><a href="#cb8-542"></a><span class="st">          }</span></span>
<span id="cb8-543"><a href="#cb8-543"></a><span class="st">        "</span>))</span>
<span id="cb8-544"><a href="#cb8-544"></a>        )</span>
<span id="cb8-545"><a href="#cb8-545"></a>      )</span>
<span id="cb8-546"><a href="#cb8-546"></a>    )</span>
<span id="cb8-547"><a href="#cb8-547"></a>  })</span>
<span id="cb8-548"><a href="#cb8-548"></a>  </span>
<span id="cb8-549"><a href="#cb8-549"></a>  <span class="do">### Render table----</span></span>
<span id="cb8-550"><a href="#cb8-550"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-551"><a href="#cb8-551"></a>  </span>
<span id="cb8-552"><a href="#cb8-552"></a>  </span>
<span id="cb8-553"><a href="#cb8-553"></a>  </span>
<span id="cb8-554"><a href="#cb8-554"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb8-555"><a href="#cb8-555"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb8-556"><a href="#cb8-556"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-557"><a href="#cb8-557"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb8-558"><a href="#cb8-558"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb8-559"><a href="#cb8-559"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb8-560"><a href="#cb8-560"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb8-561"><a href="#cb8-561"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb8-562"><a href="#cb8-562"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb8-563"><a href="#cb8-563"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb8-564"><a href="#cb8-564"></a>    </span>
<span id="cb8-565"><a href="#cb8-565"></a>    <span class="fu">list</span>(</span>
<span id="cb8-566"><a href="#cb8-566"></a>      <span class="at">x =</span> x,</span>
<span id="cb8-567"><a href="#cb8-567"></a>      <span class="at">y =</span> y,</span>
<span id="cb8-568"><a href="#cb8-568"></a>      <span class="at">data =</span> dt,</span>
<span id="cb8-569"><a href="#cb8-569"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb8-570"><a href="#cb8-570"></a>      <span class="at">model =</span> mod</span>
<span id="cb8-571"><a href="#cb8-571"></a>    )</span>
<span id="cb8-572"><a href="#cb8-572"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb8-573"><a href="#cb8-573"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-574"><a href="#cb8-574"></a>  </span>
<span id="cb8-575"><a href="#cb8-575"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb8-576"><a href="#cb8-576"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb8-577"><a href="#cb8-577"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-578"><a href="#cb8-578"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb8-579"><a href="#cb8-579"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb8-580"><a href="#cb8-580"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb8-581"><a href="#cb8-581"></a>      params<span class="sc">$</span>data,</span>
<span id="cb8-582"><a href="#cb8-582"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb8-583"><a href="#cb8-583"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb8-584"><a href="#cb8-584"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb8-585"><a href="#cb8-585"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb8-586"><a href="#cb8-586"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb8-587"><a href="#cb8-587"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb8-588"><a href="#cb8-588"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb8-589"><a href="#cb8-589"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb8-590"><a href="#cb8-590"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb8-591"><a href="#cb8-591"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb8-592"><a href="#cb8-592"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb8-593"><a href="#cb8-593"></a>            ))</span>
<span id="cb8-594"><a href="#cb8-594"></a>        }</span>
<span id="cb8-595"><a href="#cb8-595"></a>      )</span>
<span id="cb8-596"><a href="#cb8-596"></a>    )</span>
<span id="cb8-597"><a href="#cb8-597"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-598"><a href="#cb8-598"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-599"><a href="#cb8-599"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-600"><a href="#cb8-600"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-601"><a href="#cb8-601"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-602"><a href="#cb8-602"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-603"><a href="#cb8-603"></a>  })</span>
<span id="cb8-604"><a href="#cb8-604"></a>  </span>
<span id="cb8-605"><a href="#cb8-605"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb8-606"><a href="#cb8-606"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb8-607"><a href="#cb8-607"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-608"><a href="#cb8-608"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb8-609"><a href="#cb8-609"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb8-610"><a href="#cb8-610"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb8-611"><a href="#cb8-611"></a>    </span>
<span id="cb8-612"><a href="#cb8-612"></a>    </span>
<span id="cb8-613"><a href="#cb8-613"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb8-614"><a href="#cb8-614"></a>    </span>
<span id="cb8-615"><a href="#cb8-615"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-616"><a href="#cb8-616"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb8-617"><a href="#cb8-617"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-618"><a href="#cb8-618"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-619"><a href="#cb8-619"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-620"><a href="#cb8-620"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-621"><a href="#cb8-621"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-622"><a href="#cb8-622"></a>  })</span>
<span id="cb8-623"><a href="#cb8-623"></a>  </span>
<span id="cb8-624"><a href="#cb8-624"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb8-625"><a href="#cb8-625"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb8-626"><a href="#cb8-626"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-627"><a href="#cb8-627"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb8-628"><a href="#cb8-628"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb8-629"><a href="#cb8-629"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb8-630"><a href="#cb8-630"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb8-631"><a href="#cb8-631"></a>    </span>
<span id="cb8-632"><a href="#cb8-632"></a>    </span>
<span id="cb8-633"><a href="#cb8-633"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb8-634"><a href="#cb8-634"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb8-635"><a href="#cb8-635"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb8-636"><a href="#cb8-636"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb8-637"><a href="#cb8-637"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb8-638"><a href="#cb8-638"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb8-639"><a href="#cb8-639"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb8-640"><a href="#cb8-640"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb8-641"><a href="#cb8-641"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb8-642"><a href="#cb8-642"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb8-643"><a href="#cb8-643"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb8-644"><a href="#cb8-644"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb8-645"><a href="#cb8-645"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-646"><a href="#cb8-646"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-647"><a href="#cb8-647"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb8-648"><a href="#cb8-648"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb8-649"><a href="#cb8-649"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb8-650"><a href="#cb8-650"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb8-651"><a href="#cb8-651"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb8-652"><a href="#cb8-652"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb8-653"><a href="#cb8-653"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb8-654"><a href="#cb8-654"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-655"><a href="#cb8-655"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-656"><a href="#cb8-656"></a>      </span>
<span id="cb8-657"><a href="#cb8-657"></a>    }</span>
<span id="cb8-658"><a href="#cb8-658"></a>    </span>
<span id="cb8-659"><a href="#cb8-659"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-660"><a href="#cb8-660"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb8-661"><a href="#cb8-661"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-662"><a href="#cb8-662"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-663"><a href="#cb8-663"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-664"><a href="#cb8-664"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-665"><a href="#cb8-665"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-666"><a href="#cb8-666"></a>  })</span>
<span id="cb8-667"><a href="#cb8-667"></a>  </span>
<span id="cb8-668"><a href="#cb8-668"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb8-669"><a href="#cb8-669"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb8-670"><a href="#cb8-670"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-671"><a href="#cb8-671"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb8-672"><a href="#cb8-672"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb8-673"><a href="#cb8-673"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb8-674"><a href="#cb8-674"></a>    ))</span>
<span id="cb8-675"><a href="#cb8-675"></a>  })</span>
<span id="cb8-676"><a href="#cb8-676"></a>  </span>
<span id="cb8-677"><a href="#cb8-677"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb8-678"><a href="#cb8-678"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb8-679"><a href="#cb8-679"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-680"><a href="#cb8-680"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb8-681"><a href="#cb8-681"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-682"><a href="#cb8-682"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-683"><a href="#cb8-683"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-684"><a href="#cb8-684"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-685"><a href="#cb8-685"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-686"><a href="#cb8-686"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-687"><a href="#cb8-687"></a>  })</span>
<span id="cb8-688"><a href="#cb8-688"></a>  </span>
<span id="cb8-689"><a href="#cb8-689"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb8-690"><a href="#cb8-690"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb8-691"><a href="#cb8-691"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-692"><a href="#cb8-692"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-693"><a href="#cb8-693"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-694"><a href="#cb8-694"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-695"><a href="#cb8-695"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-696"><a href="#cb8-696"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb8-697"><a href="#cb8-697"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-698"><a href="#cb8-698"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-699"><a href="#cb8-699"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-700"><a href="#cb8-700"></a>  })</span>
<span id="cb8-701"><a href="#cb8-701"></a>  </span>
<span id="cb8-702"><a href="#cb8-702"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb8-703"><a href="#cb8-703"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb8-704"><a href="#cb8-704"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb8-705"><a href="#cb8-705"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb8-706"><a href="#cb8-706"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb8-707"><a href="#cb8-707"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb8-708"><a href="#cb8-708"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb8-709"><a href="#cb8-709"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb8-710"><a href="#cb8-710"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb8-711"><a href="#cb8-711"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb8-712"><a href="#cb8-712"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-713"><a href="#cb8-713"></a>  })</span>
<span id="cb8-714"><a href="#cb8-714"></a>  </span>
<span id="cb8-715"><a href="#cb8-715"></a>  </span>
<span id="cb8-716"><a href="#cb8-716"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb8-717"><a href="#cb8-717"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb8-718"><a href="#cb8-718"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-719"><a href="#cb8-719"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-720"><a href="#cb8-720"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-721"><a href="#cb8-721"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-722"><a href="#cb8-722"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-723"><a href="#cb8-723"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="cb8-724"><a href="#cb8-724"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-725"><a href="#cb8-725"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>)</span>
<span id="cb8-726"><a href="#cb8-726"></a>  })</span>
<span id="cb8-727"><a href="#cb8-727"></a>}</span>
<span id="cb8-728"><a href="#cb8-728"></a></span>
<span id="cb8-729"><a href="#cb8-729"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="add-data" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Add data</h1>
<ul>
<li>Currently, we only show a background, but do not map the Guerry data</li>
<li>Adding data works using layer functions, for example:
<ul>
<li><a href="https://rdrr.io/cran/leaflet/man/map-layers.html"><code>addMarkers()</code></a> adds point data</li>
<li><a href="https://rdrr.io/cran/leaflet/man/map-layers.html"><code>addPolylines()</code></a> adds line data</li>
<li><a href="https://rdrr.io/cran/leaflet/man/map-layers.html"><code>addPolygons()</code></a> adds polygon data</li>
<li><a href="https://rdrr.io/cran/leaflet/man/addRasterImage.html"><code>addRasterImage()</code></a> adds raster data</li>
<li><a href="https://rdrr.io/cran/leaflet/man/addLegend.html"><code>addLegend()</code></a> adds a legend</li>
</ul></li>
</ul>
<section id="specifics-of-leaflet-mapping" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="specifics-of-leaflet-mapping"><span class="header-section-number">4.1</span> Specifics of Leaflet mapping</h2>
<ul>
<li>Variables are passed using formulas (i.e.&nbsp;instead of <code>data_guerry$Literacy</code>, we write <code>~Literacy</code>)</li>
<li>Leaflet by default only supports WGS84 (EPSG:4326) as CRS</li>
<li>Palettes are applied using custom functions that are generated in function factories:
<ul>
<li><code>colorNumeric()</code> maps continuous values</li>
<li><code>colorBin()</code> bins continuous values evenly</li>
<li><code>colorQuantile()</code> bins continuous values based on their quantiles</li>
<li><code>colorFactor()</code> maps categorical values</li>
</ul></li>
<li><code>highlightOptions()</code> adds a nice highlight effect when hovering over a polygon</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-9"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-9-1"><a href="#annotated-cell-9-1"></a>output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="1">1</button><span id="annotated-cell-9-2" class="code-annotation-target"><a href="#annotated-cell-9-2"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="annotated-cell-9-3"><a href="#annotated-cell-9-3"></a>    </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="2">2</button><span id="annotated-cell-9-4" class="code-annotation-target"><a href="#annotated-cell-9-4"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> <span class="fu">st_transform</span>(data_guerry, <span class="dv">4326</span>)) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="3">3</button><span id="annotated-cell-9-5" class="code-annotation-target"><a href="#annotated-cell-9-5"></a>        <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="4">4</button><span id="annotated-cell-9-6" class="code-annotation-target"><a href="#annotated-cell-9-6"></a>        <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="5">5</button><span id="annotated-cell-9-7" class="code-annotation-target"><a href="#annotated-cell-9-7"></a>        <span class="fu">addPolygons</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="6">6</button><span id="annotated-cell-9-8" class="code-annotation-target"><a href="#annotated-cell-9-8"></a>            <span class="at">fillColor =</span> <span class="sc">~</span>params<span class="sc">$</span><span class="fu">pal</span>(Literacy),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="7">7</button><span id="annotated-cell-9-9" class="code-annotation-target"><a href="#annotated-cell-9-9"></a>            <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-9-10"><a href="#annotated-cell-9-10"></a>            <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-9-11"><a href="#annotated-cell-9-11"></a>            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-9-12"><a href="#annotated-cell-9-12"></a>            <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="8">8</button><span id="annotated-cell-9-13" class="code-annotation-target"><a href="#annotated-cell-9-13"></a>            <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-9-14"><a href="#annotated-cell-9-14"></a>                <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-9-15"><a href="#annotated-cell-9-15"></a>                <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-9-16"><a href="#annotated-cell-9-16"></a>                <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-9-17"><a href="#annotated-cell-9-17"></a>                <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-9-18"><a href="#annotated-cell-9-18"></a>                <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-9-19"><a href="#annotated-cell-9-19"></a>                <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-9-20"><a href="#annotated-cell-9-20"></a>            )</span>
<span id="annotated-cell-9-21"><a href="#annotated-cell-9-21"></a>        ) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="9">9</button><span id="annotated-cell-9-22" class="code-annotation-target"><a href="#annotated-cell-9-22"></a>        <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-9-23"><a href="#annotated-cell-9-23"></a>            <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="10">10</button><span id="annotated-cell-9-24" class="code-annotation-target"><a href="#annotated-cell-9-24"></a>            <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-9-25"><a href="#annotated-cell-9-25"></a>            <span class="at">values =</span> <span class="sc">~</span>Literacy,</span>
<span id="annotated-cell-9-26"><a href="#annotated-cell-9-26"></a>            <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-9-27"><a href="#annotated-cell-9-27"></a>            <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-9" data-target-annotation="11">11</button><span id="annotated-cell-9-28" class="code-annotation-target"><a href="#annotated-cell-9-28"></a>            <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> <span class="st">" %"</span>)</span>
<span id="annotated-cell-9-29"><a href="#annotated-cell-9-29"></a>        )</span>
<span id="annotated-cell-9-30"><a href="#annotated-cell-9-30"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-9" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="2" data-code-annotation="1">Determine the color palette for mapping. Here, we want to map continious values in red. The output is a function called <code>pal()</code> which we can use later on.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="4" data-code-annotation="2">Create an empty map. Add spatial data. Note that leaflet by default only accepts spatial data with EPSG:4326. For anything else, consult <a href="https://rstudio.github.io/leaflet/projections.html"><code>leaflet::leafletCRS()</code></a>, but don’t expect to understand much of what’s going on.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="5" data-code-annotation="3">Add a basemap of OpenStreetMap France</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="6" data-code-annotation="4">Set the center and zoom level of the initial view</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="7" data-code-annotation="5">The <code>addPolygons()</code> function adds polygons to the leaflet map</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="8" data-code-annotation="6"><code>fillColor</code> determines how the polygons should be colored. We pass a formula that contains a call to our generated function <code>pal()</code> (see point 2) that maps colors to the Literacy variable.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="9,10,11,12" data-code-annotation="7">We can add additional parameters that control the appearance of the map, e.g.&nbsp;opacity, color or line thickness (weight).</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="13,14,15,16,17,18,19,20,21" data-code-annotation="8"><code>highlightOptions()</code> allows you to add a nice highlight effect when hovering over the polygons</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="22,23" data-code-annotation="9">Using <code>addLegend()</code> we add a legend to the bottom right of the Leaflet map</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="10">10</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="24,25" data-code-annotation="10"><code>addLegend()</code> accepts values in the same way as <code>addPolygons()</code>: <code>pal</code> accepts the generated palette function and <code>values</code> accepts a formula containing the column name in the input dataset.</span>
</dd>
<dt data-target-cell="annotated-cell-9" data-target-annotation="11">11</dt>
<dd>
<span data-code-cell="annotated-cell-9" data-code-lines="28" data-code-annotation="11">Finally, <code>labelFormat()</code> allows you to change the formatting of the legend label, e.g.&nbsp;if you need to specify whether a number is a percentage, meters or something else</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_02.gif" class="img-fluid"></p>
</section>
<section id="full-code-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="full-code-1"><span class="header-section-number">4.2</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including a simple Leaflet map</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb9-21"><a href="#cb9-21"></a></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb9-23"><a href="#cb9-23"></a></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-26"><a href="#cb9-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb9-29"><a href="#cb9-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb9-31"><a href="#cb9-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb9-32"><a href="#cb9-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb9-33"><a href="#cb9-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb9-34"><a href="#cb9-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb9-35"><a href="#cb9-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb9-36"><a href="#cb9-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb9-37"><a href="#cb9-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb9-38"><a href="#cb9-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb9-39"><a href="#cb9-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb9-40"><a href="#cb9-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb9-41"><a href="#cb9-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb9-42"><a href="#cb9-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb9-43"><a href="#cb9-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb9-44"><a href="#cb9-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb9-45"><a href="#cb9-45"></a>)</span>
<span id="cb9-46"><a href="#cb9-46"></a></span>
<span id="cb9-47"><a href="#cb9-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-48"><a href="#cb9-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb9-49"><a href="#cb9-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb9-50"><a href="#cb9-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb9-51"><a href="#cb9-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb9-52"><a href="#cb9-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-53"><a href="#cb9-53"></a>  ),</span>
<span id="cb9-54"><a href="#cb9-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb9-55"><a href="#cb9-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb9-56"><a href="#cb9-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb9-57"><a href="#cb9-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb9-58"><a href="#cb9-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-59"><a href="#cb9-59"></a>  ),</span>
<span id="cb9-60"><a href="#cb9-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb9-61"><a href="#cb9-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb9-62"><a href="#cb9-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb9-63"><a href="#cb9-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb9-64"><a href="#cb9-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb9-65"><a href="#cb9-65"></a>  ),</span>
<span id="cb9-66"><a href="#cb9-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb9-67"><a href="#cb9-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb9-68"><a href="#cb9-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb9-69"><a href="#cb9-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb9-70"><a href="#cb9-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-71"><a href="#cb9-71"></a>  ),</span>
<span id="cb9-72"><a href="#cb9-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb9-73"><a href="#cb9-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb9-74"><a href="#cb9-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb9-75"><a href="#cb9-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb9-76"><a href="#cb9-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-77"><a href="#cb9-77"></a>  ),</span>
<span id="cb9-78"><a href="#cb9-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb9-79"><a href="#cb9-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb9-80"><a href="#cb9-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb9-81"><a href="#cb9-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb9-82"><a href="#cb9-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-83"><a href="#cb9-83"></a>  ),</span>
<span id="cb9-84"><a href="#cb9-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb9-85"><a href="#cb9-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb9-86"><a href="#cb9-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb9-87"><a href="#cb9-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb9-88"><a href="#cb9-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-89"><a href="#cb9-89"></a>  ),</span>
<span id="cb9-90"><a href="#cb9-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb9-91"><a href="#cb9-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb9-92"><a href="#cb9-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb9-93"><a href="#cb9-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb9-94"><a href="#cb9-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-95"><a href="#cb9-95"></a>  ),</span>
<span id="cb9-96"><a href="#cb9-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb9-97"><a href="#cb9-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb9-98"><a href="#cb9-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb9-99"><a href="#cb9-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb9-100"><a href="#cb9-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-101"><a href="#cb9-101"></a>  ),</span>
<span id="cb9-102"><a href="#cb9-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb9-103"><a href="#cb9-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb9-104"><a href="#cb9-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb9-105"><a href="#cb9-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb9-106"><a href="#cb9-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb9-107"><a href="#cb9-107"></a>  ),</span>
<span id="cb9-108"><a href="#cb9-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb9-109"><a href="#cb9-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb9-110"><a href="#cb9-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb9-111"><a href="#cb9-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb9-112"><a href="#cb9-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-113"><a href="#cb9-113"></a>  ),</span>
<span id="cb9-114"><a href="#cb9-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb9-115"><a href="#cb9-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb9-116"><a href="#cb9-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb9-117"><a href="#cb9-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb9-118"><a href="#cb9-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-119"><a href="#cb9-119"></a>  ),</span>
<span id="cb9-120"><a href="#cb9-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb9-121"><a href="#cb9-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb9-122"><a href="#cb9-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb9-123"><a href="#cb9-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb9-124"><a href="#cb9-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-125"><a href="#cb9-125"></a>  ),</span>
<span id="cb9-126"><a href="#cb9-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb9-127"><a href="#cb9-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb9-128"><a href="#cb9-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb9-129"><a href="#cb9-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb9-130"><a href="#cb9-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-131"><a href="#cb9-131"></a>  ),</span>
<span id="cb9-132"><a href="#cb9-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb9-133"><a href="#cb9-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb9-134"><a href="#cb9-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb9-135"><a href="#cb9-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb9-136"><a href="#cb9-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-137"><a href="#cb9-137"></a>  ),</span>
<span id="cb9-138"><a href="#cb9-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb9-139"><a href="#cb9-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb9-140"><a href="#cb9-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb9-141"><a href="#cb9-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb9-142"><a href="#cb9-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-143"><a href="#cb9-143"></a>  ),</span>
<span id="cb9-144"><a href="#cb9-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb9-145"><a href="#cb9-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb9-146"><a href="#cb9-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb9-147"><a href="#cb9-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb9-148"><a href="#cb9-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb9-149"><a href="#cb9-149"></a>  ),</span>
<span id="cb9-150"><a href="#cb9-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb9-151"><a href="#cb9-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb9-152"><a href="#cb9-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb9-153"><a href="#cb9-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb9-154"><a href="#cb9-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb9-155"><a href="#cb9-155"></a>  ),</span>
<span id="cb9-156"><a href="#cb9-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb9-157"><a href="#cb9-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb9-158"><a href="#cb9-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb9-159"><a href="#cb9-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb9-160"><a href="#cb9-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb9-161"><a href="#cb9-161"></a>  )</span>
<span id="cb9-162"><a href="#cb9-162"></a>)</span>
<span id="cb9-163"><a href="#cb9-163"></a></span>
<span id="cb9-164"><a href="#cb9-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb9-165"><a href="#cb9-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-166"><a href="#cb9-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-167"><a href="#cb9-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-168"><a href="#cb9-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb9-169"><a href="#cb9-169"></a>    Region,</span>
<span id="cb9-170"><a href="#cb9-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb9-171"><a href="#cb9-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb9-172"><a href="#cb9-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb9-173"><a href="#cb9-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb9-174"><a href="#cb9-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb9-175"><a href="#cb9-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb9-176"><a href="#cb9-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-177"><a href="#cb9-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb9-178"><a href="#cb9-178"></a></span>
<span id="cb9-179"><a href="#cb9-179"></a></span>
<span id="cb9-180"><a href="#cb9-180"></a></span>
<span id="cb9-181"><a href="#cb9-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb9-182"><a href="#cb9-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb9-183"><a href="#cb9-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-184"><a href="#cb9-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb9-185"><a href="#cb9-185"></a></span>
<span id="cb9-186"><a href="#cb9-186"></a></span>
<span id="cb9-187"><a href="#cb9-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb9-188"><a href="#cb9-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb9-189"><a href="#cb9-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb9-190"><a href="#cb9-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb9-191"><a href="#cb9-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb9-192"><a href="#cb9-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb9-193"><a href="#cb9-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb9-194"><a href="#cb9-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb9-195"><a href="#cb9-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb9-196"><a href="#cb9-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb9-197"><a href="#cb9-197"></a>      }</span>
<span id="cb9-198"><a href="#cb9-198"></a>    }</span>
<span id="cb9-199"><a href="#cb9-199"></a>  ))</span>
<span id="cb9-200"><a href="#cb9-200"></a></span>
<span id="cb9-201"><a href="#cb9-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb9-202"><a href="#cb9-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb9-203"><a href="#cb9-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-204"><a href="#cb9-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb9-205"><a href="#cb9-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-206"><a href="#cb9-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb9-207"><a href="#cb9-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb9-208"><a href="#cb9-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb9-209"><a href="#cb9-209"></a>)</span>
<span id="cb9-210"><a href="#cb9-210"></a></span>
<span id="cb9-211"><a href="#cb9-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb9-212"><a href="#cb9-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb9-213"><a href="#cb9-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-214"><a href="#cb9-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb9-215"><a href="#cb9-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb9-216"><a href="#cb9-216"></a>)</span>
<span id="cb9-217"><a href="#cb9-217"></a></span>
<span id="cb9-218"><a href="#cb9-218"></a></span>
<span id="cb9-219"><a href="#cb9-219"></a></span>
<span id="cb9-220"><a href="#cb9-220"></a></span>
<span id="cb9-221"><a href="#cb9-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb9-222"><a href="#cb9-222"></a></span>
<span id="cb9-223"><a href="#cb9-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb9-224"><a href="#cb9-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb9-225"><a href="#cb9-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb9-226"><a href="#cb9-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb9-227"><a href="#cb9-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb9-228"><a href="#cb9-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb9-229"><a href="#cb9-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb9-230"><a href="#cb9-230"></a>    )</span>
<span id="cb9-231"><a href="#cb9-231"></a>  ),</span>
<span id="cb9-232"><a href="#cb9-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb9-233"><a href="#cb9-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb9-234"><a href="#cb9-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb9-235"><a href="#cb9-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb9-236"><a href="#cb9-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb9-237"><a href="#cb9-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb9-238"><a href="#cb9-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb9-239"><a href="#cb9-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb9-240"><a href="#cb9-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb9-241"><a href="#cb9-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb9-242"><a href="#cb9-242"></a>    ),</span>
<span id="cb9-243"><a href="#cb9-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-244"><a href="#cb9-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-245"><a href="#cb9-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-246"><a href="#cb9-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb9-247"><a href="#cb9-247"></a>  ),</span>
<span id="cb9-248"><a href="#cb9-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb9-249"><a href="#cb9-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb9-250"><a href="#cb9-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb9-251"><a href="#cb9-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb9-252"><a href="#cb9-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb9-253"><a href="#cb9-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb9-254"><a href="#cb9-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb9-255"><a href="#cb9-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb9-256"><a href="#cb9-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb9-257"><a href="#cb9-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb9-258"><a href="#cb9-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb9-259"><a href="#cb9-259"></a>        ),</span>
<span id="cb9-260"><a href="#cb9-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb9-261"><a href="#cb9-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb9-262"><a href="#cb9-262"></a>          <span class="fu">column</span>(</span>
<span id="cb9-263"><a href="#cb9-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb9-264"><a href="#cb9-264"></a>            <span class="fu">box</span>(</span>
<span id="cb9-265"><a href="#cb9-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb9-266"><a href="#cb9-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-267"><a href="#cb9-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-268"><a href="#cb9-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb9-269"><a href="#cb9-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb9-270"><a href="#cb9-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb9-271"><a href="#cb9-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb9-272"><a href="#cb9-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb9-273"><a href="#cb9-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb9-274"><a href="#cb9-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb9-275"><a href="#cb9-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb9-276"><a href="#cb9-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb9-277"><a href="#cb9-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb9-278"><a href="#cb9-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb9-279"><a href="#cb9-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb9-280"><a href="#cb9-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb9-281"><a href="#cb9-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb9-282"><a href="#cb9-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb9-283"><a href="#cb9-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb9-284"><a href="#cb9-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb9-285"><a href="#cb9-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb9-286"><a href="#cb9-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb9-287"><a href="#cb9-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb9-288"><a href="#cb9-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb9-289"><a href="#cb9-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb9-290"><a href="#cb9-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb9-291"><a href="#cb9-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb9-292"><a href="#cb9-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb9-293"><a href="#cb9-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-294"><a href="#cb9-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-295"><a href="#cb9-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb9-296"><a href="#cb9-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb9-297"><a href="#cb9-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb9-298"><a href="#cb9-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb9-299"><a href="#cb9-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb9-300"><a href="#cb9-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb9-301"><a href="#cb9-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb9-302"><a href="#cb9-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb9-303"><a href="#cb9-303"></a>                  )</span>
<span id="cb9-304"><a href="#cb9-304"></a>                ),</span>
<span id="cb9-305"><a href="#cb9-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb9-306"><a href="#cb9-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb9-307"><a href="#cb9-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-308"><a href="#cb9-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-309"><a href="#cb9-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb9-310"><a href="#cb9-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb9-311"><a href="#cb9-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb9-312"><a href="#cb9-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb9-313"><a href="#cb9-313"></a>                )</span>
<span id="cb9-314"><a href="#cb9-314"></a>              )</span>
<span id="cb9-315"><a href="#cb9-315"></a>            )</span>
<span id="cb9-316"><a href="#cb9-316"></a>          ),</span>
<span id="cb9-317"><a href="#cb9-317"></a>          <span class="fu">column</span>(</span>
<span id="cb9-318"><a href="#cb9-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb9-319"><a href="#cb9-319"></a>            <span class="fu">box</span>(</span>
<span id="cb9-320"><a href="#cb9-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb9-321"><a href="#cb9-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-322"><a href="#cb9-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-323"><a href="#cb9-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb9-324"><a href="#cb9-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb9-325"><a href="#cb9-325"></a>            )</span>
<span id="cb9-326"><a href="#cb9-326"></a>          )</span>
<span id="cb9-327"><a href="#cb9-327"></a>        )</span>
<span id="cb9-328"><a href="#cb9-328"></a>      ),</span>
<span id="cb9-329"><a href="#cb9-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb9-330"><a href="#cb9-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb9-331"><a href="#cb9-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb9-332"><a href="#cb9-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb9-333"><a href="#cb9-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb9-334"><a href="#cb9-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb9-335"><a href="#cb9-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb9-336"><a href="#cb9-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb9-337"><a href="#cb9-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb9-338"><a href="#cb9-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb9-339"><a href="#cb9-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-340"><a href="#cb9-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb9-341"><a href="#cb9-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-342"><a href="#cb9-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb9-343"><a href="#cb9-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb9-344"><a href="#cb9-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb9-345"><a href="#cb9-345"></a>            ),</span>
<span id="cb9-346"><a href="#cb9-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-347"><a href="#cb9-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb9-348"><a href="#cb9-348"></a>          )</span>
<span id="cb9-349"><a href="#cb9-349"></a>        ),</span>
<span id="cb9-350"><a href="#cb9-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb9-351"><a href="#cb9-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb9-352"><a href="#cb9-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb9-353"><a href="#cb9-353"></a>      ),</span>
<span id="cb9-354"><a href="#cb9-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb9-355"><a href="#cb9-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb9-356"><a href="#cb9-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb9-357"><a href="#cb9-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb9-358"><a href="#cb9-358"></a>          <span class="fu">column</span>(</span>
<span id="cb9-359"><a href="#cb9-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb9-360"><a href="#cb9-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb9-361"><a href="#cb9-361"></a>            <span class="fu">box</span>(</span>
<span id="cb9-362"><a href="#cb9-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-363"><a href="#cb9-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb9-364"><a href="#cb9-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-365"><a href="#cb9-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb9-366"><a href="#cb9-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb9-367"><a href="#cb9-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb9-368"><a href="#cb9-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb9-369"><a href="#cb9-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb9-370"><a href="#cb9-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb9-371"><a href="#cb9-371"></a>              ),</span>
<span id="cb9-372"><a href="#cb9-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb9-373"><a href="#cb9-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb9-374"><a href="#cb9-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb9-375"><a href="#cb9-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb9-376"><a href="#cb9-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb9-377"><a href="#cb9-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-378"><a href="#cb9-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-379"><a href="#cb9-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb9-380"><a href="#cb9-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb9-381"><a href="#cb9-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb9-382"><a href="#cb9-382"></a>                ),</span>
<span id="cb9-383"><a href="#cb9-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-384"><a href="#cb9-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb9-385"><a href="#cb9-385"></a>              ),</span>
<span id="cb9-386"><a href="#cb9-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb9-387"><a href="#cb9-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb9-388"><a href="#cb9-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb9-389"><a href="#cb9-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-390"><a href="#cb9-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-391"><a href="#cb9-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb9-392"><a href="#cb9-392"></a>              ),</span>
<span id="cb9-393"><a href="#cb9-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb9-394"><a href="#cb9-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb9-395"><a href="#cb9-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb9-396"><a href="#cb9-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb9-397"><a href="#cb9-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb9-398"><a href="#cb9-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb9-399"><a href="#cb9-399"></a>              )</span>
<span id="cb9-400"><a href="#cb9-400"></a>            ),</span>
<span id="cb9-401"><a href="#cb9-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb9-402"><a href="#cb9-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb9-403"><a href="#cb9-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-404"><a href="#cb9-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb9-405"><a href="#cb9-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb9-406"><a href="#cb9-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb9-407"><a href="#cb9-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-408"><a href="#cb9-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb9-409"><a href="#cb9-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-410"><a href="#cb9-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb9-411"><a href="#cb9-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb9-412"><a href="#cb9-412"></a>              ),</span>
<span id="cb9-413"><a href="#cb9-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb9-414"><a href="#cb9-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-415"><a href="#cb9-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb9-416"><a href="#cb9-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb9-417"><a href="#cb9-417"></a>              ),</span>
<span id="cb9-418"><a href="#cb9-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb9-419"><a href="#cb9-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-420"><a href="#cb9-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb9-421"><a href="#cb9-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb9-422"><a href="#cb9-422"></a>              )</span>
<span id="cb9-423"><a href="#cb9-423"></a>            )</span>
<span id="cb9-424"><a href="#cb9-424"></a>          ),</span>
<span id="cb9-425"><a href="#cb9-425"></a>          <span class="fu">column</span>(</span>
<span id="cb9-426"><a href="#cb9-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb9-427"><a href="#cb9-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb9-428"><a href="#cb9-428"></a>            <span class="fu">box</span>(</span>
<span id="cb9-429"><a href="#cb9-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-430"><a href="#cb9-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb9-431"><a href="#cb9-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-432"><a href="#cb9-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb9-433"><a href="#cb9-433"></a>            ),</span>
<span id="cb9-434"><a href="#cb9-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb9-435"><a href="#cb9-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb9-436"><a href="#cb9-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-437"><a href="#cb9-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb9-438"><a href="#cb9-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb9-439"><a href="#cb9-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-440"><a href="#cb9-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb9-441"><a href="#cb9-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-442"><a href="#cb9-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb9-443"><a href="#cb9-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb9-444"><a href="#cb9-444"></a>              ),</span>
<span id="cb9-445"><a href="#cb9-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-446"><a href="#cb9-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb9-447"><a href="#cb9-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb9-448"><a href="#cb9-448"></a>              ),</span>
<span id="cb9-449"><a href="#cb9-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb9-450"><a href="#cb9-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb9-451"><a href="#cb9-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb9-452"><a href="#cb9-452"></a>              )</span>
<span id="cb9-453"><a href="#cb9-453"></a>            )</span>
<span id="cb9-454"><a href="#cb9-454"></a>          )</span>
<span id="cb9-455"><a href="#cb9-455"></a>        )</span>
<span id="cb9-456"><a href="#cb9-456"></a>      ),</span>
<span id="cb9-457"><a href="#cb9-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb9-458"><a href="#cb9-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb9-459"><a href="#cb9-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb9-460"><a href="#cb9-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb9-461"><a href="#cb9-461"></a>          <span class="fu">column</span>(</span>
<span id="cb9-462"><a href="#cb9-462"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb9-463"><a href="#cb9-463"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb9-464"><a href="#cb9-464"></a>            <span class="fu">box</span>(</span>
<span id="cb9-465"><a href="#cb9-465"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb9-466"><a href="#cb9-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-467"><a href="#cb9-467"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-468"><a href="#cb9-468"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-469"><a href="#cb9-469"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb9-470"><a href="#cb9-470"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb9-471"><a href="#cb9-471"></a>            ) <span class="co"># end box</span></span>
<span id="cb9-472"><a href="#cb9-472"></a>          ) <span class="co"># end column</span></span>
<span id="cb9-473"><a href="#cb9-473"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb9-474"><a href="#cb9-474"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb9-475"><a href="#cb9-475"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb9-476"><a href="#cb9-476"></a>  ),</span>
<span id="cb9-477"><a href="#cb9-477"></a>  </span>
<span id="cb9-478"><a href="#cb9-478"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb9-479"><a href="#cb9-479"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb9-480"><a href="#cb9-480"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb9-481"><a href="#cb9-481"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb9-482"><a href="#cb9-482"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb9-483"><a href="#cb9-483"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb9-484"><a href="#cb9-484"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb9-485"><a href="#cb9-485"></a>    )</span>
<span id="cb9-486"><a href="#cb9-486"></a>  ),</span>
<span id="cb9-487"><a href="#cb9-487"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb9-488"><a href="#cb9-488"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb9-489"><a href="#cb9-489"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb9-490"><a href="#cb9-490"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb9-491"><a href="#cb9-491"></a>  )  </span>
<span id="cb9-492"><a href="#cb9-492"></a>)</span>
<span id="cb9-493"><a href="#cb9-493"></a></span>
<span id="cb9-494"><a href="#cb9-494"></a></span>
<span id="cb9-495"><a href="#cb9-495"></a></span>
<span id="cb9-496"><a href="#cb9-496"></a><span class="co"># 4 Server ----</span></span>
<span id="cb9-497"><a href="#cb9-497"></a></span>
<span id="cb9-498"><a href="#cb9-498"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb9-499"><a href="#cb9-499"></a>  </span>
<span id="cb9-500"><a href="#cb9-500"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb9-501"><a href="#cb9-501"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb9-502"><a href="#cb9-502"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-503"><a href="#cb9-503"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb9-504"><a href="#cb9-504"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb9-505"><a href="#cb9-505"></a>    </span>
<span id="cb9-506"><a href="#cb9-506"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb9-507"><a href="#cb9-507"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb9-508"><a href="#cb9-508"></a>    }</span>
<span id="cb9-509"><a href="#cb9-509"></a>    </span>
<span id="cb9-510"><a href="#cb9-510"></a>    data_table</span>
<span id="cb9-511"><a href="#cb9-511"></a>  })</span>
<span id="cb9-512"><a href="#cb9-512"></a>  </span>
<span id="cb9-513"><a href="#cb9-513"></a>  </span>
<span id="cb9-514"><a href="#cb9-514"></a>  <span class="do">### Create table----</span></span>
<span id="cb9-515"><a href="#cb9-515"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-516"><a href="#cb9-516"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb9-517"><a href="#cb9-517"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb9-518"><a href="#cb9-518"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb9-519"><a href="#cb9-519"></a>      tab,</span>
<span id="cb9-520"><a href="#cb9-520"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb9-521"><a href="#cb9-521"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb9-522"><a href="#cb9-522"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb9-523"><a href="#cb9-523"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb9-524"><a href="#cb9-524"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb9-525"><a href="#cb9-525"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-526"><a href="#cb9-526"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb9-527"><a href="#cb9-527"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb9-528"><a href="#cb9-528"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-529"><a href="#cb9-529"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-530"><a href="#cb9-530"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb9-531"><a href="#cb9-531"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb9-532"><a href="#cb9-532"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb9-533"><a href="#cb9-533"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb9-534"><a href="#cb9-534"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb9-535"><a href="#cb9-535"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb9-536"><a href="#cb9-536"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb9-537"><a href="#cb9-537"></a><span class="st">  </span></span>
<span id="cb9-538"><a href="#cb9-538"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb9-539"><a href="#cb9-539"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb9-540"><a href="#cb9-540"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb9-541"><a href="#cb9-541"></a><span class="st">            );</span></span>
<span id="cb9-542"><a href="#cb9-542"></a><span class="st">          }</span></span>
<span id="cb9-543"><a href="#cb9-543"></a><span class="st">        "</span>))</span>
<span id="cb9-544"><a href="#cb9-544"></a>        )</span>
<span id="cb9-545"><a href="#cb9-545"></a>      )</span>
<span id="cb9-546"><a href="#cb9-546"></a>    )</span>
<span id="cb9-547"><a href="#cb9-547"></a>  })</span>
<span id="cb9-548"><a href="#cb9-548"></a>  </span>
<span id="cb9-549"><a href="#cb9-549"></a>  <span class="do">### Render table----</span></span>
<span id="cb9-550"><a href="#cb9-550"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-551"><a href="#cb9-551"></a>  </span>
<span id="cb9-552"><a href="#cb9-552"></a>  </span>
<span id="cb9-553"><a href="#cb9-553"></a>  </span>
<span id="cb9-554"><a href="#cb9-554"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb9-555"><a href="#cb9-555"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb9-556"><a href="#cb9-556"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-557"><a href="#cb9-557"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb9-558"><a href="#cb9-558"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb9-559"><a href="#cb9-559"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb9-560"><a href="#cb9-560"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb9-561"><a href="#cb9-561"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb9-562"><a href="#cb9-562"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb9-563"><a href="#cb9-563"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb9-564"><a href="#cb9-564"></a>    </span>
<span id="cb9-565"><a href="#cb9-565"></a>    <span class="fu">list</span>(</span>
<span id="cb9-566"><a href="#cb9-566"></a>      <span class="at">x =</span> x,</span>
<span id="cb9-567"><a href="#cb9-567"></a>      <span class="at">y =</span> y,</span>
<span id="cb9-568"><a href="#cb9-568"></a>      <span class="at">data =</span> dt,</span>
<span id="cb9-569"><a href="#cb9-569"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb9-570"><a href="#cb9-570"></a>      <span class="at">model =</span> mod</span>
<span id="cb9-571"><a href="#cb9-571"></a>    )</span>
<span id="cb9-572"><a href="#cb9-572"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb9-573"><a href="#cb9-573"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-574"><a href="#cb9-574"></a>  </span>
<span id="cb9-575"><a href="#cb9-575"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb9-576"><a href="#cb9-576"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb9-577"><a href="#cb9-577"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-578"><a href="#cb9-578"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb9-579"><a href="#cb9-579"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb9-580"><a href="#cb9-580"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb9-581"><a href="#cb9-581"></a>      params<span class="sc">$</span>data,</span>
<span id="cb9-582"><a href="#cb9-582"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb9-583"><a href="#cb9-583"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb9-584"><a href="#cb9-584"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb9-585"><a href="#cb9-585"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb9-586"><a href="#cb9-586"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb9-587"><a href="#cb9-587"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb9-588"><a href="#cb9-588"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb9-589"><a href="#cb9-589"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb9-590"><a href="#cb9-590"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb9-591"><a href="#cb9-591"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb9-592"><a href="#cb9-592"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb9-593"><a href="#cb9-593"></a>            ))</span>
<span id="cb9-594"><a href="#cb9-594"></a>        }</span>
<span id="cb9-595"><a href="#cb9-595"></a>      )</span>
<span id="cb9-596"><a href="#cb9-596"></a>    )</span>
<span id="cb9-597"><a href="#cb9-597"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-598"><a href="#cb9-598"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-599"><a href="#cb9-599"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-600"><a href="#cb9-600"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-601"><a href="#cb9-601"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-602"><a href="#cb9-602"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-603"><a href="#cb9-603"></a>  })</span>
<span id="cb9-604"><a href="#cb9-604"></a>  </span>
<span id="cb9-605"><a href="#cb9-605"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb9-606"><a href="#cb9-606"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb9-607"><a href="#cb9-607"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-608"><a href="#cb9-608"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb9-609"><a href="#cb9-609"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb9-610"><a href="#cb9-610"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb9-611"><a href="#cb9-611"></a>    </span>
<span id="cb9-612"><a href="#cb9-612"></a>    </span>
<span id="cb9-613"><a href="#cb9-613"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb9-614"><a href="#cb9-614"></a>    </span>
<span id="cb9-615"><a href="#cb9-615"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-616"><a href="#cb9-616"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb9-617"><a href="#cb9-617"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-618"><a href="#cb9-618"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-619"><a href="#cb9-619"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-620"><a href="#cb9-620"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-621"><a href="#cb9-621"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-622"><a href="#cb9-622"></a>  })</span>
<span id="cb9-623"><a href="#cb9-623"></a>  </span>
<span id="cb9-624"><a href="#cb9-624"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb9-625"><a href="#cb9-625"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb9-626"><a href="#cb9-626"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-627"><a href="#cb9-627"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb9-628"><a href="#cb9-628"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb9-629"><a href="#cb9-629"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb9-630"><a href="#cb9-630"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb9-631"><a href="#cb9-631"></a>    </span>
<span id="cb9-632"><a href="#cb9-632"></a>    </span>
<span id="cb9-633"><a href="#cb9-633"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb9-634"><a href="#cb9-634"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb9-635"><a href="#cb9-635"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb9-636"><a href="#cb9-636"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb9-637"><a href="#cb9-637"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb9-638"><a href="#cb9-638"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb9-639"><a href="#cb9-639"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb9-640"><a href="#cb9-640"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb9-641"><a href="#cb9-641"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb9-642"><a href="#cb9-642"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb9-643"><a href="#cb9-643"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb9-644"><a href="#cb9-644"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb9-645"><a href="#cb9-645"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-646"><a href="#cb9-646"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-647"><a href="#cb9-647"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-648"><a href="#cb9-648"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb9-649"><a href="#cb9-649"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb9-650"><a href="#cb9-650"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb9-651"><a href="#cb9-651"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb9-652"><a href="#cb9-652"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb9-653"><a href="#cb9-653"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-654"><a href="#cb9-654"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb9-655"><a href="#cb9-655"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb9-656"><a href="#cb9-656"></a>      </span>
<span id="cb9-657"><a href="#cb9-657"></a>    }</span>
<span id="cb9-658"><a href="#cb9-658"></a>    </span>
<span id="cb9-659"><a href="#cb9-659"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-660"><a href="#cb9-660"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb9-661"><a href="#cb9-661"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-662"><a href="#cb9-662"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-663"><a href="#cb9-663"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-664"><a href="#cb9-664"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-665"><a href="#cb9-665"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-666"><a href="#cb9-666"></a>  })</span>
<span id="cb9-667"><a href="#cb9-667"></a>  </span>
<span id="cb9-668"><a href="#cb9-668"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb9-669"><a href="#cb9-669"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb9-670"><a href="#cb9-670"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-671"><a href="#cb9-671"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb9-672"><a href="#cb9-672"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb9-673"><a href="#cb9-673"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb9-674"><a href="#cb9-674"></a>    ))</span>
<span id="cb9-675"><a href="#cb9-675"></a>  })</span>
<span id="cb9-676"><a href="#cb9-676"></a>  </span>
<span id="cb9-677"><a href="#cb9-677"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb9-678"><a href="#cb9-678"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb9-679"><a href="#cb9-679"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-680"><a href="#cb9-680"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb9-681"><a href="#cb9-681"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-682"><a href="#cb9-682"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-683"><a href="#cb9-683"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-684"><a href="#cb9-684"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-685"><a href="#cb9-685"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-686"><a href="#cb9-686"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-687"><a href="#cb9-687"></a>  })</span>
<span id="cb9-688"><a href="#cb9-688"></a>  </span>
<span id="cb9-689"><a href="#cb9-689"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb9-690"><a href="#cb9-690"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb9-691"><a href="#cb9-691"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-692"><a href="#cb9-692"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-693"><a href="#cb9-693"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-694"><a href="#cb9-694"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-695"><a href="#cb9-695"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-696"><a href="#cb9-696"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb9-697"><a href="#cb9-697"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-698"><a href="#cb9-698"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-699"><a href="#cb9-699"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-700"><a href="#cb9-700"></a>  })</span>
<span id="cb9-701"><a href="#cb9-701"></a>  </span>
<span id="cb9-702"><a href="#cb9-702"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb9-703"><a href="#cb9-703"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb9-704"><a href="#cb9-704"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb9-705"><a href="#cb9-705"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb9-706"><a href="#cb9-706"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb9-707"><a href="#cb9-707"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb9-708"><a href="#cb9-708"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb9-709"><a href="#cb9-709"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb9-710"><a href="#cb9-710"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb9-711"><a href="#cb9-711"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb9-712"><a href="#cb9-712"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-713"><a href="#cb9-713"></a>  })</span>
<span id="cb9-714"><a href="#cb9-714"></a>  </span>
<span id="cb9-715"><a href="#cb9-715"></a>  </span>
<span id="cb9-716"><a href="#cb9-716"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb9-717"><a href="#cb9-717"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="cb9-718"><a href="#cb9-718"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb9-719"><a href="#cb9-719"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-720"><a href="#cb9-720"></a>    </span>
<span id="cb9-721"><a href="#cb9-721"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> <span class="fu">st_transform</span>(data_guerry, <span class="dv">4326</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-722"><a href="#cb9-722"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-723"><a href="#cb9-723"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-724"><a href="#cb9-724"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-725"><a href="#cb9-725"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-726"><a href="#cb9-726"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>, <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-727"><a href="#cb9-727"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-728"><a href="#cb9-728"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb9-729"><a href="#cb9-729"></a>        <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">pal</span>(Literacy),</span>
<span id="cb9-730"><a href="#cb9-730"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb9-731"><a href="#cb9-731"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb9-732"><a href="#cb9-732"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-733"><a href="#cb9-733"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-734"><a href="#cb9-734"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb9-735"><a href="#cb9-735"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb9-736"><a href="#cb9-736"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb9-737"><a href="#cb9-737"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb9-738"><a href="#cb9-738"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb9-739"><a href="#cb9-739"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-740"><a href="#cb9-740"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb9-741"><a href="#cb9-741"></a>        )</span>
<span id="cb9-742"><a href="#cb9-742"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb9-743"><a href="#cb9-743"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb9-744"><a href="#cb9-744"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb9-745"><a href="#cb9-745"></a>        <span class="at">pal =</span> pal,</span>
<span id="cb9-746"><a href="#cb9-746"></a>        <span class="at">values =</span> <span class="sc">~</span>Literacy,</span>
<span id="cb9-747"><a href="#cb9-747"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb9-748"><a href="#cb9-748"></a>        <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb9-749"><a href="#cb9-749"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> <span class="st">" %"</span>)</span>
<span id="cb9-750"><a href="#cb9-750"></a>      )</span>
<span id="cb9-751"><a href="#cb9-751"></a>  })</span>
<span id="cb9-752"><a href="#cb9-752"></a>}</span>
<span id="cb9-753"><a href="#cb9-753"></a></span>
<span id="cb9-754"><a href="#cb9-754"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercises-1" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="exercises-1"><span class="header-section-number">4.3</span> Exercises</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Classify the mapped values into deciles (i.e., ten equally sized bins).</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Consult the documentation of <code>?colorNumeric()</code>. Particularly watch out for the other three <code>color*</code> functions.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Legend values can be binned using either the <code>colorBin()</code> or the <code>colorQuantile()</code> function. Since we want to map deciles, we need to use the <code>colorQuantile()</code> function and increase the number of bins to 10.</p>
<p>Instead of using <code>colorNumeric()</code> to create the palette function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">domain =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>… we can exchange it with <code>colorQuantile()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorQuantile</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">domain =</span> <span class="cn">NULL</span>, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let the opacity of the polygons scale with the values of the <code>Commerce</code> variable in the Guerry dataset. Also add a label that shows the values of Literacy in the following form: “value: &lt;literacy value here&gt;”.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Remember that data columns can be specified using the <code>~</code> symbol! This also applies to entire function calls.</p>
<p>If you are not sure about how to control opacity and labels, consult <code>?addPolygons()</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the Leaflet formulas, we can scale many arguments to the <code>add*</code> functions in any way we want. To scale the fill opacity using the Commerce variable, we can add <code>fillOpacity = ~Commerce / 100</code>. We divide by 100 to adjust the Commerce variable to the scale of opacity values (usually 0-1).</p>
<p>In the same way, we can provide hover labels</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-37"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-37-1"><a href="#annotated-cell-37-1"></a>  <span class="fu">leaflet</span>(<span class="at">data =</span> <span class="fu">st_transform</span>(data_guerry, <span class="dv">4326</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-2"><a href="#annotated-cell-37-2"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-3"><a href="#annotated-cell-37-3"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-4"><a href="#annotated-cell-37-4"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-5"><a href="#annotated-cell-37-5"></a>    <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-6"><a href="#annotated-cell-37-6"></a>    <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>, <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-7"><a href="#annotated-cell-37-7"></a>    <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-8"><a href="#annotated-cell-37-8"></a>    <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-37-9"><a href="#annotated-cell-37-9"></a>      <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">pal</span>(Literacy),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="1">1</button><span id="annotated-cell-37-10" class="code-annotation-target"><a href="#annotated-cell-37-10"></a>      <span class="at">fillOpacity =</span> <span class="sc">~</span>Commerce <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="annotated-cell-37-11"><a href="#annotated-cell-37-11"></a>      <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-37-12"><a href="#annotated-cell-37-12"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-37-13"><a href="#annotated-cell-37-13"></a>      <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-37" data-target-annotation="2">2</button><span id="annotated-cell-37-14" class="code-annotation-target"><a href="#annotated-cell-37-14"></a>      <span class="at">label =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"value: "</span>, Literacy),</span>
<span id="annotated-cell-37-15"><a href="#annotated-cell-37-15"></a>      <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-37-16"><a href="#annotated-cell-37-16"></a>        <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-37-17"><a href="#annotated-cell-37-17"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-37-18"><a href="#annotated-cell-37-18"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-37-19"><a href="#annotated-cell-37-19"></a>        <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-37-20"><a href="#annotated-cell-37-20"></a>        <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-37-21"><a href="#annotated-cell-37-21"></a>        <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-37-22"><a href="#annotated-cell-37-22"></a>      )</span>
<span id="annotated-cell-37-23"><a href="#annotated-cell-37-23"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-37-24"><a href="#annotated-cell-37-24"></a>    <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-37-25"><a href="#annotated-cell-37-25"></a>      <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-37-26"><a href="#annotated-cell-37-26"></a>      <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-37-27"><a href="#annotated-cell-37-27"></a>      <span class="at">values =</span> <span class="sc">~</span>Literacy,</span>
<span id="annotated-cell-37-28"><a href="#annotated-cell-37-28"></a>      <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-37-29"><a href="#annotated-cell-37-29"></a>      <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="annotated-cell-37-30"><a href="#annotated-cell-37-30"></a>      <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> <span class="st">" %"</span>)</span>
<span id="annotated-cell-37-31"><a href="#annotated-cell-37-31"></a>    )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-37" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="10" data-code-annotation="1">Scale the fill opacity using the Commerce variable. Since opacity is measured using percentages and Commerce is scaled somewhere around values of 1-100, we need to rescale Commerce by dividing it with 100.</span>
</dd>
<dt data-target-cell="annotated-cell-37" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-37" data-code-lines="14" data-code-annotation="2">Within a formula expression, we can put any R expression. Thus, to combine values and text, we can just use <code>paste0()</code> on them.</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>How could we go about adding a second line to the hover label that also shows the value for the <code>Commerce</code> variable? In other words, how can we add a hover label of the following form:</p>
<p>Literacy: &lt;literacy value here&gt;</p>
<p>Commerce: &lt;commerce value here&gt;</p>
<p>The solution does not have to be code, ideas are also welcome!</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Regular R line breaks (<code>\n</code>) don’t work in Shiny. Why is that? What can we use instead (remember section 3 about HTML tags)?</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Regular R line breaks don’t work, because Shiny apps are HTML documents. In section 3, we talked about HTML tags including the <code>br()</code> function producing the <code>&lt;br/&gt;</code> HTML tag. The code for a label with two lines could look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">addPolygons</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    ..., <span class="co"># rest of the arguments</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="at">label =</span> <span class="sc">~</span><span class="fu">lapply</span>(<span class="fu">paste0</span>(<span class="st">"Literacy: "</span>, Literacy, <span class="fu">br</span>(), <span class="st">"Commerce: "</span>, Commerce), HTML),</span>
<span id="cb12-5"><a href="#cb12-5"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note: If we are dealing with character vectors containing HTML, we need to wrap them in a call to <code>HTML()</code> so R knows it’s dealing with HTML!</p>
</div>
</div>
</div>
</section>
</section>
<section id="add-reactivity" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Add reactivity</h1>
<ul>
<li>Similar to chapter 5 on visualization, reactivity is the key to making maps in Shiny</li>
<li>Similar to chapter 5, reactivity is arguably the most complex part of app development!</li>
</ul>
<section id="reactive-ui" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="reactive-ui"><span class="header-section-number">5.1</span> Reactive UI</h2>
<ul>
<li>In our app, we add three reactive components:
<ul>
<li><code>selectInput()</code> to select a variable to map</li>
<li><code>radioButtons()</code> to select an aggregation level, departments or regions</li>
<li><code>selectInput()</code> to select a color palette</li>
</ul></li>
<li>Additionally, one new UI output (<code>tab_map_desc</code>) is added that describes the selected variable</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Define selectable palettes: All sequential palettes + viridis</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb13-8"><a href="#cb13-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-12-1"><a href="#annotated-cell-12-1"></a><span class="fu">tabItem</span>(</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2"></a>    <span class="at">tabName =</span> <span class="st">"tab_map"</span>,</span>
<span id="annotated-cell-12-3"><a href="#annotated-cell-12-3"></a>    <span class="fu">fluidRow</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-4" class="code-annotation-target"><a href="#annotated-cell-12-4"></a>        <span class="fu">column</span>(</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7"></a>                <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="annotated-cell-12-8"><a href="#annotated-cell-12-8"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9"></a>                <span class="at">width =</span> <span class="dv">12</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2">2</button><span id="annotated-cell-12-10" class="code-annotation-target"><a href="#annotated-cell-12-10"></a>                <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11"></a>                    <span class="st">"tab_map_select"</span>,</span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12"></a>                    <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13"></a>                    <span class="at">choices =</span> <span class="fu">setNames</span>(variable_names, <span class="fu">names</span>(variable_names))</span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14"></a>                )</span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15"></a>            ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3">3</button><span id="annotated-cell-12-16" class="code-annotation-target"><a href="#annotated-cell-12-16"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-12-17"><a href="#annotated-cell-12-17"></a>                <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="annotated-cell-12-18"><a href="#annotated-cell-12-18"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-12-19"><a href="#annotated-cell-12-19"></a>                <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-12-20"><a href="#annotated-cell-12-20"></a>                <span class="fu">radioButtons</span>(</span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21"></a>                    <span class="st">"tab_map_aggr"</span>,</span>
<span id="annotated-cell-12-22"><a href="#annotated-cell-12-22"></a>                    <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="annotated-cell-12-23"><a href="#annotated-cell-12-23"></a>                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24"></a>                    <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="annotated-cell-12-25"><a href="#annotated-cell-12-25"></a>                ),</span>
<span id="annotated-cell-12-26"><a href="#annotated-cell-12-26"></a>                <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27"></a>                    <span class="st">"tab_map_pal"</span>,</span>
<span id="annotated-cell-12-28"><a href="#annotated-cell-12-28"></a>                    <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="annotated-cell-12-29"><a href="#annotated-cell-12-29"></a>                    <span class="at">choices =</span> pals,</span>
<span id="annotated-cell-12-30"><a href="#annotated-cell-12-30"></a>                    <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="annotated-cell-12-31"><a href="#annotated-cell-12-31"></a>                ) <span class="co"># end input</span></span>
<span id="annotated-cell-12-32"><a href="#annotated-cell-12-32"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-12-33"><a href="#annotated-cell-12-33"></a>        ), <span class="co"># end column</span></span>
<span id="annotated-cell-12-34"><a href="#annotated-cell-12-34"></a>        <span class="fu">column</span>(</span>
<span id="annotated-cell-12-35"><a href="#annotated-cell-12-35"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="annotated-cell-12-36"><a href="#annotated-cell-12-36"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-12-37"><a href="#annotated-cell-12-37"></a>                <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="annotated-cell-12-38"><a href="#annotated-cell-12-38"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-12-39"><a href="#annotated-cell-12-39"></a>                <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-12-40"><a href="#annotated-cell-12-40"></a>                <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-12-41"><a href="#annotated-cell-12-41"></a>                <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-12-42"><a href="#annotated-cell-12-42"></a>                leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="annotated-cell-12-43"><a href="#annotated-cell-12-43"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-12-44"><a href="#annotated-cell-12-44"></a>        ) <span class="co"># end column</span></span>
<span id="annotated-cell-12-45"><a href="#annotated-cell-12-45"></a>    ) <span class="co"># end fluidRow</span></span>
<span id="annotated-cell-12-46"><a href="#annotated-cell-12-46"></a>) <span class="co"># end tabItem</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="4,5,6,7,8,9" data-code-annotation="1">Previously, the map tab only consisted of one column with a box. Now we add another column that occupies 1/3 of the page where we add our UI inputs</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="10,11,12,13,14" data-code-annotation="2">Add a dropdown menu that selects a variable to map</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="16,17,18,19" data-code-annotation="3">Add a second box. Since both boxes have a width of 12</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="server-side" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="server-side"><span class="header-section-number">5.2</span> Server side</h2>
<ul>
<li>In the server function, we have a lot to do:
<ul>
<li>Apply the selected aggregation level</li>
<li>Apply the selected palette</li>
<li>Change hard code to adaptive code</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-13"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-13-1"><a href="#annotated-cell-13-1"></a>    <span class="co"># Select polygon based on aggregation level</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="1">1</button><span id="annotated-cell-13-2" class="code-annotation-target"><a href="#annotated-cell-13-2"></a>    poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-13-3"><a href="#annotated-cell-13-3"></a>        <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="annotated-cell-13-4"><a href="#annotated-cell-13-4"></a>            data_guerry_region</span>
<span id="annotated-cell-13-5"><a href="#annotated-cell-13-5"></a>        } <span class="cf">else</span> {</span>
<span id="annotated-cell-13-6"><a href="#annotated-cell-13-6"></a>            data_guerry</span>
<span id="annotated-cell-13-7"><a href="#annotated-cell-13-7"></a>        }</span>
<span id="annotated-cell-13-8"><a href="#annotated-cell-13-8"></a>    })</span>
<span id="annotated-cell-13-9"><a href="#annotated-cell-13-9"></a>    </span>
<span id="annotated-cell-13-10"><a href="#annotated-cell-13-10"></a>    <span class="co"># Select palette based on input</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="2">2</button><span id="annotated-cell-13-11" class="code-annotation-target"><a href="#annotated-cell-13-11"></a>    palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-13-12"><a href="#annotated-cell-13-12"></a>        pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="annotated-cell-13-13"><a href="#annotated-cell-13-13"></a>        <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="annotated-cell-13-14"><a href="#annotated-cell-13-14"></a>            pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="annotated-cell-13-15"><a href="#annotated-cell-13-15"></a>        }</span>
<span id="annotated-cell-13-16"><a href="#annotated-cell-13-16"></a>        pal</span>
<span id="annotated-cell-13-17"><a href="#annotated-cell-13-17"></a>    })</span>
<span id="annotated-cell-13-18"><a href="#annotated-cell-13-18"></a>    </span>
<span id="annotated-cell-13-19"><a href="#annotated-cell-13-19"></a>    <span class="co"># Compile parameters for leaflet rendering</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="3">3</button><span id="annotated-cell-13-20" class="code-annotation-target"><a href="#annotated-cell-13-20"></a>    params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-13-21"><a href="#annotated-cell-13-21"></a>        poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="annotated-cell-13-22"><a href="#annotated-cell-13-22"></a>        pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="annotated-cell-13-23"><a href="#annotated-cell-13-23"></a>        var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="annotated-cell-13-24"><a href="#annotated-cell-13-24"></a></span>
<span id="annotated-cell-13-25"><a href="#annotated-cell-13-25"></a>        values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="annotated-cell-13-26"><a href="#annotated-cell-13-26"></a>        pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="annotated-cell-13-27"><a href="#annotated-cell-13-27"></a></span>
<span id="annotated-cell-13-28"><a href="#annotated-cell-13-28"></a>        <span class="fu">list</span>(</span>
<span id="annotated-cell-13-29"><a href="#annotated-cell-13-29"></a>            <span class="at">poly =</span> poly,</span>
<span id="annotated-cell-13-30"><a href="#annotated-cell-13-30"></a>            <span class="at">var =</span> var,</span>
<span id="annotated-cell-13-31"><a href="#annotated-cell-13-31"></a>            <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-13-32"><a href="#annotated-cell-13-32"></a>            <span class="at">values =</span> values</span>
<span id="annotated-cell-13-33"><a href="#annotated-cell-13-33"></a>        )</span>
<span id="annotated-cell-13-34"><a href="#annotated-cell-13-34"></a>    })</span>
<span id="annotated-cell-13-35"><a href="#annotated-cell-13-35"></a>    </span>
<span id="annotated-cell-13-36"><a href="#annotated-cell-13-36"></a>    <span class="co"># Render leaflet for the first time</span></span>
<span id="annotated-cell-13-37"><a href="#annotated-cell-13-37"></a>    output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="annotated-cell-13-38"><a href="#annotated-cell-13-38"></a>        <span class="co"># Isolate call to params() to prevent render function to be executed</span></span>
<span id="annotated-cell-13-39"><a href="#annotated-cell-13-39"></a>        <span class="co"># every time params() is invalidated. No dependency is made.</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-13" data-target-annotation="4">4</button><span id="annotated-cell-13-40" class="code-annotation-target"><a href="#annotated-cell-13-40"></a>        params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="annotated-cell-13-41"><a href="#annotated-cell-13-41"></a>        <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-42"><a href="#annotated-cell-13-42"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-43"><a href="#annotated-cell-13-43"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-44"><a href="#annotated-cell-13-44"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-45"><a href="#annotated-cell-13-45"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-46"><a href="#annotated-cell-13-46"></a>            <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-13-47"><a href="#annotated-cell-13-47"></a>                                                                            <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-48"><a href="#annotated-cell-13-48"></a>            <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-49"><a href="#annotated-cell-13-49"></a>            <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-13-50"><a href="#annotated-cell-13-50"></a>                <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-13-51"><a href="#annotated-cell-13-51"></a>                <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-13-52"><a href="#annotated-cell-13-52"></a>                <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-13-53"><a href="#annotated-cell-13-53"></a>                <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-13-54"><a href="#annotated-cell-13-54"></a>                <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-13-55"><a href="#annotated-cell-13-55"></a>                <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-13-56"><a href="#annotated-cell-13-56"></a>                    <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-13-57"><a href="#annotated-cell-13-57"></a>                    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-13-58"><a href="#annotated-cell-13-58"></a>                    <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-13-59"><a href="#annotated-cell-13-59"></a>                    <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-13-60"><a href="#annotated-cell-13-60"></a>                    <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-13-61"><a href="#annotated-cell-13-61"></a>                    <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-13-62"><a href="#annotated-cell-13-62"></a>                )</span>
<span id="annotated-cell-13-63"><a href="#annotated-cell-13-63"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-13-64"><a href="#annotated-cell-13-64"></a>            <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-13-65"><a href="#annotated-cell-13-65"></a>                <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-13-66"><a href="#annotated-cell-13-66"></a>                <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-13-67"><a href="#annotated-cell-13-67"></a>                <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-13-68"><a href="#annotated-cell-13-68"></a>                <span class="at">opacity =</span> <span class="fl">0.9</span></span>
<span id="annotated-cell-13-69"><a href="#annotated-cell-13-69"></a>            )</span>
<span id="annotated-cell-13-70"><a href="#annotated-cell-13-70"></a>    })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="2,3,4,5,6,7,8" data-code-annotation="1">In a reactive expression called <code>poly()</code> we catch the selected aggregation level and decide whether to use the original <code>data_guerry</code> or the aggregated variant <code>data_guerry_region</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="11,12,13,14,15,16,17" data-code-annotation="2">In a reactive expression called <code>palette()</code> we catch the selected palette and match it with the available palette names.</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="20,21,22,23,24,25,26,27,28,29,30,31,32,33,34" data-code-annotation="3">We combine all inputs in a reactive expression called <code>params()</code> where we do the remaining data wrangling before the input data goes into leaflet mapping</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="40,41,50,66,67" data-code-annotation="4">Finally, we do the mapping and replace all previously hard-coded information with our new reactive data. This includes the input dataframe which is now simply <code>params$poly</code>, the fill color which is now a formula that is pasted together from the palette function and the selected variable and finally the palette and values required for the legend.</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_03.gif" class="img-fluid"></p>
</section>
<section id="full-code-2" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="full-code-2"><span class="header-section-number">5.3</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including a reactive Leaflet map</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb14-23"><a href="#cb14-23"></a></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb14-27"><a href="#cb14-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb14-28"><a href="#cb14-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb14-29"><a href="#cb14-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb14-30"><a href="#cb14-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb14-31"><a href="#cb14-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb14-32"><a href="#cb14-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb14-33"><a href="#cb14-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb14-34"><a href="#cb14-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb14-35"><a href="#cb14-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb14-36"><a href="#cb14-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb14-37"><a href="#cb14-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb14-38"><a href="#cb14-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb14-39"><a href="#cb14-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb14-40"><a href="#cb14-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb14-41"><a href="#cb14-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb14-42"><a href="#cb14-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb14-43"><a href="#cb14-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb14-44"><a href="#cb14-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb14-45"><a href="#cb14-45"></a>)</span>
<span id="cb14-46"><a href="#cb14-46"></a></span>
<span id="cb14-47"><a href="#cb14-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-48"><a href="#cb14-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb14-49"><a href="#cb14-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb14-50"><a href="#cb14-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb14-51"><a href="#cb14-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb14-52"><a href="#cb14-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-53"><a href="#cb14-53"></a>  ),</span>
<span id="cb14-54"><a href="#cb14-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb14-55"><a href="#cb14-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb14-56"><a href="#cb14-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb14-57"><a href="#cb14-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb14-58"><a href="#cb14-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-59"><a href="#cb14-59"></a>  ),</span>
<span id="cb14-60"><a href="#cb14-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb14-61"><a href="#cb14-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb14-62"><a href="#cb14-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb14-63"><a href="#cb14-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb14-64"><a href="#cb14-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb14-65"><a href="#cb14-65"></a>  ),</span>
<span id="cb14-66"><a href="#cb14-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb14-67"><a href="#cb14-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb14-68"><a href="#cb14-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb14-69"><a href="#cb14-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb14-70"><a href="#cb14-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-71"><a href="#cb14-71"></a>  ),</span>
<span id="cb14-72"><a href="#cb14-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb14-73"><a href="#cb14-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb14-74"><a href="#cb14-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb14-75"><a href="#cb14-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb14-76"><a href="#cb14-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-77"><a href="#cb14-77"></a>  ),</span>
<span id="cb14-78"><a href="#cb14-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb14-79"><a href="#cb14-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb14-80"><a href="#cb14-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb14-81"><a href="#cb14-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb14-82"><a href="#cb14-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-83"><a href="#cb14-83"></a>  ),</span>
<span id="cb14-84"><a href="#cb14-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb14-85"><a href="#cb14-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb14-86"><a href="#cb14-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb14-87"><a href="#cb14-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb14-88"><a href="#cb14-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-89"><a href="#cb14-89"></a>  ),</span>
<span id="cb14-90"><a href="#cb14-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb14-91"><a href="#cb14-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb14-92"><a href="#cb14-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb14-93"><a href="#cb14-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb14-94"><a href="#cb14-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-95"><a href="#cb14-95"></a>  ),</span>
<span id="cb14-96"><a href="#cb14-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb14-97"><a href="#cb14-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb14-98"><a href="#cb14-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb14-99"><a href="#cb14-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb14-100"><a href="#cb14-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-101"><a href="#cb14-101"></a>  ),</span>
<span id="cb14-102"><a href="#cb14-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb14-103"><a href="#cb14-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb14-104"><a href="#cb14-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb14-105"><a href="#cb14-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb14-106"><a href="#cb14-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb14-107"><a href="#cb14-107"></a>  ),</span>
<span id="cb14-108"><a href="#cb14-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb14-109"><a href="#cb14-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb14-110"><a href="#cb14-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb14-111"><a href="#cb14-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb14-112"><a href="#cb14-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-113"><a href="#cb14-113"></a>  ),</span>
<span id="cb14-114"><a href="#cb14-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb14-115"><a href="#cb14-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb14-116"><a href="#cb14-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb14-117"><a href="#cb14-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb14-118"><a href="#cb14-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-119"><a href="#cb14-119"></a>  ),</span>
<span id="cb14-120"><a href="#cb14-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb14-121"><a href="#cb14-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb14-122"><a href="#cb14-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb14-123"><a href="#cb14-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb14-124"><a href="#cb14-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-125"><a href="#cb14-125"></a>  ),</span>
<span id="cb14-126"><a href="#cb14-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb14-127"><a href="#cb14-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb14-128"><a href="#cb14-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb14-129"><a href="#cb14-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb14-130"><a href="#cb14-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-131"><a href="#cb14-131"></a>  ),</span>
<span id="cb14-132"><a href="#cb14-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb14-133"><a href="#cb14-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb14-134"><a href="#cb14-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb14-135"><a href="#cb14-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb14-136"><a href="#cb14-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-137"><a href="#cb14-137"></a>  ),</span>
<span id="cb14-138"><a href="#cb14-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb14-139"><a href="#cb14-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb14-140"><a href="#cb14-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb14-141"><a href="#cb14-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb14-142"><a href="#cb14-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-143"><a href="#cb14-143"></a>  ),</span>
<span id="cb14-144"><a href="#cb14-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb14-145"><a href="#cb14-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb14-146"><a href="#cb14-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb14-147"><a href="#cb14-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb14-148"><a href="#cb14-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb14-149"><a href="#cb14-149"></a>  ),</span>
<span id="cb14-150"><a href="#cb14-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb14-151"><a href="#cb14-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb14-152"><a href="#cb14-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb14-153"><a href="#cb14-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb14-154"><a href="#cb14-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb14-155"><a href="#cb14-155"></a>  ),</span>
<span id="cb14-156"><a href="#cb14-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb14-157"><a href="#cb14-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb14-158"><a href="#cb14-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb14-159"><a href="#cb14-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb14-160"><a href="#cb14-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb14-161"><a href="#cb14-161"></a>  )</span>
<span id="cb14-162"><a href="#cb14-162"></a>)</span>
<span id="cb14-163"><a href="#cb14-163"></a></span>
<span id="cb14-164"><a href="#cb14-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb14-165"><a href="#cb14-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-166"><a href="#cb14-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-167"><a href="#cb14-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-168"><a href="#cb14-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb14-169"><a href="#cb14-169"></a>    Region,</span>
<span id="cb14-170"><a href="#cb14-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb14-171"><a href="#cb14-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb14-172"><a href="#cb14-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb14-173"><a href="#cb14-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb14-174"><a href="#cb14-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb14-175"><a href="#cb14-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb14-176"><a href="#cb14-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-177"><a href="#cb14-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb14-178"><a href="#cb14-178"></a></span>
<span id="cb14-179"><a href="#cb14-179"></a></span>
<span id="cb14-180"><a href="#cb14-180"></a></span>
<span id="cb14-181"><a href="#cb14-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb14-182"><a href="#cb14-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb14-183"><a href="#cb14-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-184"><a href="#cb14-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb14-185"><a href="#cb14-185"></a></span>
<span id="cb14-186"><a href="#cb14-186"></a></span>
<span id="cb14-187"><a href="#cb14-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb14-188"><a href="#cb14-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb14-189"><a href="#cb14-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb14-190"><a href="#cb14-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb14-191"><a href="#cb14-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb14-192"><a href="#cb14-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb14-193"><a href="#cb14-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb14-194"><a href="#cb14-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb14-195"><a href="#cb14-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb14-196"><a href="#cb14-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb14-197"><a href="#cb14-197"></a>      }</span>
<span id="cb14-198"><a href="#cb14-198"></a>    }</span>
<span id="cb14-199"><a href="#cb14-199"></a>  ))</span>
<span id="cb14-200"><a href="#cb14-200"></a></span>
<span id="cb14-201"><a href="#cb14-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb14-202"><a href="#cb14-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb14-203"><a href="#cb14-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-204"><a href="#cb14-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb14-205"><a href="#cb14-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-206"><a href="#cb14-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb14-207"><a href="#cb14-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb14-208"><a href="#cb14-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb14-209"><a href="#cb14-209"></a>)</span>
<span id="cb14-210"><a href="#cb14-210"></a></span>
<span id="cb14-211"><a href="#cb14-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb14-212"><a href="#cb14-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb14-213"><a href="#cb14-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb14-214"><a href="#cb14-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb14-215"><a href="#cb14-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb14-216"><a href="#cb14-216"></a>)</span>
<span id="cb14-217"><a href="#cb14-217"></a></span>
<span id="cb14-218"><a href="#cb14-218"></a></span>
<span id="cb14-219"><a href="#cb14-219"></a></span>
<span id="cb14-220"><a href="#cb14-220"></a></span>
<span id="cb14-221"><a href="#cb14-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb14-222"><a href="#cb14-222"></a></span>
<span id="cb14-223"><a href="#cb14-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb14-224"><a href="#cb14-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb14-225"><a href="#cb14-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb14-226"><a href="#cb14-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb14-227"><a href="#cb14-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb14-228"><a href="#cb14-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb14-229"><a href="#cb14-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb14-230"><a href="#cb14-230"></a>    )</span>
<span id="cb14-231"><a href="#cb14-231"></a>  ),</span>
<span id="cb14-232"><a href="#cb14-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb14-233"><a href="#cb14-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb14-234"><a href="#cb14-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb14-235"><a href="#cb14-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb14-236"><a href="#cb14-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb14-237"><a href="#cb14-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb14-238"><a href="#cb14-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb14-239"><a href="#cb14-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb14-240"><a href="#cb14-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb14-241"><a href="#cb14-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb14-242"><a href="#cb14-242"></a>    ),</span>
<span id="cb14-243"><a href="#cb14-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-244"><a href="#cb14-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-245"><a href="#cb14-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-246"><a href="#cb14-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb14-247"><a href="#cb14-247"></a>  ),</span>
<span id="cb14-248"><a href="#cb14-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb14-249"><a href="#cb14-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb14-250"><a href="#cb14-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb14-251"><a href="#cb14-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb14-252"><a href="#cb14-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb14-253"><a href="#cb14-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb14-254"><a href="#cb14-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb14-255"><a href="#cb14-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb14-256"><a href="#cb14-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb14-257"><a href="#cb14-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb14-258"><a href="#cb14-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb14-259"><a href="#cb14-259"></a>        ),</span>
<span id="cb14-260"><a href="#cb14-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb14-261"><a href="#cb14-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb14-262"><a href="#cb14-262"></a>          <span class="fu">column</span>(</span>
<span id="cb14-263"><a href="#cb14-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb14-264"><a href="#cb14-264"></a>            <span class="fu">box</span>(</span>
<span id="cb14-265"><a href="#cb14-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb14-266"><a href="#cb14-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-267"><a href="#cb14-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-268"><a href="#cb14-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb14-269"><a href="#cb14-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb14-270"><a href="#cb14-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb14-271"><a href="#cb14-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb14-272"><a href="#cb14-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb14-273"><a href="#cb14-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb14-274"><a href="#cb14-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb14-275"><a href="#cb14-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb14-276"><a href="#cb14-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb14-277"><a href="#cb14-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb14-278"><a href="#cb14-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb14-279"><a href="#cb14-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb14-280"><a href="#cb14-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb14-281"><a href="#cb14-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb14-282"><a href="#cb14-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb14-283"><a href="#cb14-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb14-284"><a href="#cb14-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb14-285"><a href="#cb14-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb14-286"><a href="#cb14-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb14-287"><a href="#cb14-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb14-288"><a href="#cb14-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb14-289"><a href="#cb14-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb14-290"><a href="#cb14-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb14-291"><a href="#cb14-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb14-292"><a href="#cb14-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb14-293"><a href="#cb14-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-294"><a href="#cb14-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-295"><a href="#cb14-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb14-296"><a href="#cb14-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb14-297"><a href="#cb14-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb14-298"><a href="#cb14-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb14-299"><a href="#cb14-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb14-300"><a href="#cb14-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb14-301"><a href="#cb14-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb14-302"><a href="#cb14-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb14-303"><a href="#cb14-303"></a>                  )</span>
<span id="cb14-304"><a href="#cb14-304"></a>                ),</span>
<span id="cb14-305"><a href="#cb14-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb14-306"><a href="#cb14-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb14-307"><a href="#cb14-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-308"><a href="#cb14-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-309"><a href="#cb14-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb14-310"><a href="#cb14-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb14-311"><a href="#cb14-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb14-312"><a href="#cb14-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb14-313"><a href="#cb14-313"></a>                )</span>
<span id="cb14-314"><a href="#cb14-314"></a>              )</span>
<span id="cb14-315"><a href="#cb14-315"></a>            )</span>
<span id="cb14-316"><a href="#cb14-316"></a>          ),</span>
<span id="cb14-317"><a href="#cb14-317"></a>          <span class="fu">column</span>(</span>
<span id="cb14-318"><a href="#cb14-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb14-319"><a href="#cb14-319"></a>            <span class="fu">box</span>(</span>
<span id="cb14-320"><a href="#cb14-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb14-321"><a href="#cb14-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-322"><a href="#cb14-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-323"><a href="#cb14-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb14-324"><a href="#cb14-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb14-325"><a href="#cb14-325"></a>            )</span>
<span id="cb14-326"><a href="#cb14-326"></a>          )</span>
<span id="cb14-327"><a href="#cb14-327"></a>        )</span>
<span id="cb14-328"><a href="#cb14-328"></a>      ),</span>
<span id="cb14-329"><a href="#cb14-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb14-330"><a href="#cb14-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb14-331"><a href="#cb14-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb14-332"><a href="#cb14-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb14-333"><a href="#cb14-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb14-334"><a href="#cb14-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb14-335"><a href="#cb14-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb14-336"><a href="#cb14-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb14-337"><a href="#cb14-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb14-338"><a href="#cb14-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb14-339"><a href="#cb14-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-340"><a href="#cb14-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb14-341"><a href="#cb14-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-342"><a href="#cb14-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb14-343"><a href="#cb14-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb14-344"><a href="#cb14-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb14-345"><a href="#cb14-345"></a>            ),</span>
<span id="cb14-346"><a href="#cb14-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-347"><a href="#cb14-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb14-348"><a href="#cb14-348"></a>          )</span>
<span id="cb14-349"><a href="#cb14-349"></a>        ),</span>
<span id="cb14-350"><a href="#cb14-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb14-351"><a href="#cb14-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb14-352"><a href="#cb14-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb14-353"><a href="#cb14-353"></a>      ),</span>
<span id="cb14-354"><a href="#cb14-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb14-355"><a href="#cb14-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb14-356"><a href="#cb14-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb14-357"><a href="#cb14-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb14-358"><a href="#cb14-358"></a>          <span class="fu">column</span>(</span>
<span id="cb14-359"><a href="#cb14-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb14-360"><a href="#cb14-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb14-361"><a href="#cb14-361"></a>            <span class="fu">box</span>(</span>
<span id="cb14-362"><a href="#cb14-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-363"><a href="#cb14-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb14-364"><a href="#cb14-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-365"><a href="#cb14-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb14-366"><a href="#cb14-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb14-367"><a href="#cb14-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb14-368"><a href="#cb14-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb14-369"><a href="#cb14-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-370"><a href="#cb14-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb14-371"><a href="#cb14-371"></a>              ),</span>
<span id="cb14-372"><a href="#cb14-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb14-373"><a href="#cb14-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb14-374"><a href="#cb14-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb14-375"><a href="#cb14-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb14-376"><a href="#cb14-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb14-377"><a href="#cb14-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-378"><a href="#cb14-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-379"><a href="#cb14-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb14-380"><a href="#cb14-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb14-381"><a href="#cb14-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb14-382"><a href="#cb14-382"></a>                ),</span>
<span id="cb14-383"><a href="#cb14-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-384"><a href="#cb14-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb14-385"><a href="#cb14-385"></a>              ),</span>
<span id="cb14-386"><a href="#cb14-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb14-387"><a href="#cb14-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb14-388"><a href="#cb14-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb14-389"><a href="#cb14-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-390"><a href="#cb14-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-391"><a href="#cb14-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb14-392"><a href="#cb14-392"></a>              ),</span>
<span id="cb14-393"><a href="#cb14-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb14-394"><a href="#cb14-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb14-395"><a href="#cb14-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb14-396"><a href="#cb14-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb14-397"><a href="#cb14-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb14-398"><a href="#cb14-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb14-399"><a href="#cb14-399"></a>              )</span>
<span id="cb14-400"><a href="#cb14-400"></a>            ),</span>
<span id="cb14-401"><a href="#cb14-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb14-402"><a href="#cb14-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb14-403"><a href="#cb14-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-404"><a href="#cb14-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb14-405"><a href="#cb14-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb14-406"><a href="#cb14-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb14-407"><a href="#cb14-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-408"><a href="#cb14-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb14-409"><a href="#cb14-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-410"><a href="#cb14-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb14-411"><a href="#cb14-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb14-412"><a href="#cb14-412"></a>              ),</span>
<span id="cb14-413"><a href="#cb14-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb14-414"><a href="#cb14-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-415"><a href="#cb14-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb14-416"><a href="#cb14-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb14-417"><a href="#cb14-417"></a>              ),</span>
<span id="cb14-418"><a href="#cb14-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb14-419"><a href="#cb14-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-420"><a href="#cb14-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb14-421"><a href="#cb14-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb14-422"><a href="#cb14-422"></a>              )</span>
<span id="cb14-423"><a href="#cb14-423"></a>            )</span>
<span id="cb14-424"><a href="#cb14-424"></a>          ),</span>
<span id="cb14-425"><a href="#cb14-425"></a>          <span class="fu">column</span>(</span>
<span id="cb14-426"><a href="#cb14-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb14-427"><a href="#cb14-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb14-428"><a href="#cb14-428"></a>            <span class="fu">box</span>(</span>
<span id="cb14-429"><a href="#cb14-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-430"><a href="#cb14-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb14-431"><a href="#cb14-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-432"><a href="#cb14-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb14-433"><a href="#cb14-433"></a>            ),</span>
<span id="cb14-434"><a href="#cb14-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb14-435"><a href="#cb14-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb14-436"><a href="#cb14-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-437"><a href="#cb14-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb14-438"><a href="#cb14-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb14-439"><a href="#cb14-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-440"><a href="#cb14-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb14-441"><a href="#cb14-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-442"><a href="#cb14-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb14-443"><a href="#cb14-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb14-444"><a href="#cb14-444"></a>              ),</span>
<span id="cb14-445"><a href="#cb14-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-446"><a href="#cb14-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb14-447"><a href="#cb14-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb14-448"><a href="#cb14-448"></a>              ),</span>
<span id="cb14-449"><a href="#cb14-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb14-450"><a href="#cb14-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb14-451"><a href="#cb14-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb14-452"><a href="#cb14-452"></a>              )</span>
<span id="cb14-453"><a href="#cb14-453"></a>            )</span>
<span id="cb14-454"><a href="#cb14-454"></a>          )</span>
<span id="cb14-455"><a href="#cb14-455"></a>        )</span>
<span id="cb14-456"><a href="#cb14-456"></a>      ),</span>
<span id="cb14-457"><a href="#cb14-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb14-458"><a href="#cb14-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb14-459"><a href="#cb14-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb14-460"><a href="#cb14-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb14-461"><a href="#cb14-461"></a>          <span class="fu">column</span>(</span>
<span id="cb14-462"><a href="#cb14-462"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb14-463"><a href="#cb14-463"></a>            <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="cb14-464"><a href="#cb14-464"></a>            <span class="fu">box</span>(</span>
<span id="cb14-465"><a href="#cb14-465"></a>              <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="cb14-466"><a href="#cb14-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-467"><a href="#cb14-467"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-468"><a href="#cb14-468"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb14-469"><a href="#cb14-469"></a>                <span class="st">"tab_map_select"</span>,</span>
<span id="cb14-470"><a href="#cb14-470"></a>                <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="cb14-471"><a href="#cb14-471"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="cb14-472"><a href="#cb14-472"></a>              )</span>
<span id="cb14-473"><a href="#cb14-473"></a>            ),</span>
<span id="cb14-474"><a href="#cb14-474"></a>            <span class="fu">box</span>(</span>
<span id="cb14-475"><a href="#cb14-475"></a>              <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="cb14-476"><a href="#cb14-476"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-477"><a href="#cb14-477"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-478"><a href="#cb14-478"></a>              <span class="fu">radioButtons</span>(</span>
<span id="cb14-479"><a href="#cb14-479"></a>                <span class="st">"tab_map_aggr"</span>,</span>
<span id="cb14-480"><a href="#cb14-480"></a>                <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="cb14-481"><a href="#cb14-481"></a>                <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="cb14-482"><a href="#cb14-482"></a>                <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="cb14-483"><a href="#cb14-483"></a>              ),</span>
<span id="cb14-484"><a href="#cb14-484"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb14-485"><a href="#cb14-485"></a>                <span class="st">"tab_map_pal"</span>,</span>
<span id="cb14-486"><a href="#cb14-486"></a>                <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="cb14-487"><a href="#cb14-487"></a>                <span class="at">choices =</span> pals,</span>
<span id="cb14-488"><a href="#cb14-488"></a>                <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="cb14-489"><a href="#cb14-489"></a>              ) <span class="co"># end input</span></span>
<span id="cb14-490"><a href="#cb14-490"></a>            ) <span class="co"># end box</span></span>
<span id="cb14-491"><a href="#cb14-491"></a>          ), <span class="co"># end column</span></span>
<span id="cb14-492"><a href="#cb14-492"></a>          <span class="fu">column</span>(</span>
<span id="cb14-493"><a href="#cb14-493"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb14-494"><a href="#cb14-494"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb14-495"><a href="#cb14-495"></a>            <span class="fu">box</span>(</span>
<span id="cb14-496"><a href="#cb14-496"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb14-497"><a href="#cb14-497"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb14-498"><a href="#cb14-498"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-499"><a href="#cb14-499"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-500"><a href="#cb14-500"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb14-501"><a href="#cb14-501"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb14-502"><a href="#cb14-502"></a>            ) <span class="co"># end box</span></span>
<span id="cb14-503"><a href="#cb14-503"></a>          ) <span class="co"># end column</span></span>
<span id="cb14-504"><a href="#cb14-504"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb14-505"><a href="#cb14-505"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb14-506"><a href="#cb14-506"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb14-507"><a href="#cb14-507"></a>  ),</span>
<span id="cb14-508"><a href="#cb14-508"></a>  </span>
<span id="cb14-509"><a href="#cb14-509"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb14-510"><a href="#cb14-510"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb14-511"><a href="#cb14-511"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb14-512"><a href="#cb14-512"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb14-513"><a href="#cb14-513"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb14-514"><a href="#cb14-514"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb14-515"><a href="#cb14-515"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb14-516"><a href="#cb14-516"></a>    )</span>
<span id="cb14-517"><a href="#cb14-517"></a>  ),</span>
<span id="cb14-518"><a href="#cb14-518"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb14-519"><a href="#cb14-519"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb14-520"><a href="#cb14-520"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb14-521"><a href="#cb14-521"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb14-522"><a href="#cb14-522"></a>  )  </span>
<span id="cb14-523"><a href="#cb14-523"></a>)</span>
<span id="cb14-524"><a href="#cb14-524"></a></span>
<span id="cb14-525"><a href="#cb14-525"></a></span>
<span id="cb14-526"><a href="#cb14-526"></a></span>
<span id="cb14-527"><a href="#cb14-527"></a><span class="co"># 4 Server ----</span></span>
<span id="cb14-528"><a href="#cb14-528"></a></span>
<span id="cb14-529"><a href="#cb14-529"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb14-530"><a href="#cb14-530"></a>  </span>
<span id="cb14-531"><a href="#cb14-531"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb14-532"><a href="#cb14-532"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb14-533"><a href="#cb14-533"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-534"><a href="#cb14-534"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb14-535"><a href="#cb14-535"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb14-536"><a href="#cb14-536"></a>    </span>
<span id="cb14-537"><a href="#cb14-537"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb14-538"><a href="#cb14-538"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb14-539"><a href="#cb14-539"></a>    }</span>
<span id="cb14-540"><a href="#cb14-540"></a>    </span>
<span id="cb14-541"><a href="#cb14-541"></a>    data_table</span>
<span id="cb14-542"><a href="#cb14-542"></a>  })</span>
<span id="cb14-543"><a href="#cb14-543"></a>  </span>
<span id="cb14-544"><a href="#cb14-544"></a>  </span>
<span id="cb14-545"><a href="#cb14-545"></a>  <span class="do">### Create table----</span></span>
<span id="cb14-546"><a href="#cb14-546"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-547"><a href="#cb14-547"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb14-548"><a href="#cb14-548"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb14-549"><a href="#cb14-549"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb14-550"><a href="#cb14-550"></a>      tab,</span>
<span id="cb14-551"><a href="#cb14-551"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb14-552"><a href="#cb14-552"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb14-553"><a href="#cb14-553"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb14-554"><a href="#cb14-554"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb14-555"><a href="#cb14-555"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb14-556"><a href="#cb14-556"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-557"><a href="#cb14-557"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb14-558"><a href="#cb14-558"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb14-559"><a href="#cb14-559"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-560"><a href="#cb14-560"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-561"><a href="#cb14-561"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb14-562"><a href="#cb14-562"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb14-563"><a href="#cb14-563"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb14-564"><a href="#cb14-564"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb14-565"><a href="#cb14-565"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb14-566"><a href="#cb14-566"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb14-567"><a href="#cb14-567"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb14-568"><a href="#cb14-568"></a><span class="st">  </span></span>
<span id="cb14-569"><a href="#cb14-569"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb14-570"><a href="#cb14-570"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb14-571"><a href="#cb14-571"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb14-572"><a href="#cb14-572"></a><span class="st">            );</span></span>
<span id="cb14-573"><a href="#cb14-573"></a><span class="st">          }</span></span>
<span id="cb14-574"><a href="#cb14-574"></a><span class="st">        "</span>))</span>
<span id="cb14-575"><a href="#cb14-575"></a>        )</span>
<span id="cb14-576"><a href="#cb14-576"></a>      )</span>
<span id="cb14-577"><a href="#cb14-577"></a>    )</span>
<span id="cb14-578"><a href="#cb14-578"></a>  })</span>
<span id="cb14-579"><a href="#cb14-579"></a>  </span>
<span id="cb14-580"><a href="#cb14-580"></a>  <span class="do">### Render table----</span></span>
<span id="cb14-581"><a href="#cb14-581"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-582"><a href="#cb14-582"></a>  </span>
<span id="cb14-583"><a href="#cb14-583"></a>  </span>
<span id="cb14-584"><a href="#cb14-584"></a>  </span>
<span id="cb14-585"><a href="#cb14-585"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb14-586"><a href="#cb14-586"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb14-587"><a href="#cb14-587"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-588"><a href="#cb14-588"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb14-589"><a href="#cb14-589"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb14-590"><a href="#cb14-590"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb14-591"><a href="#cb14-591"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb14-592"><a href="#cb14-592"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb14-593"><a href="#cb14-593"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb14-594"><a href="#cb14-594"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb14-595"><a href="#cb14-595"></a>    </span>
<span id="cb14-596"><a href="#cb14-596"></a>    <span class="fu">list</span>(</span>
<span id="cb14-597"><a href="#cb14-597"></a>      <span class="at">x =</span> x,</span>
<span id="cb14-598"><a href="#cb14-598"></a>      <span class="at">y =</span> y,</span>
<span id="cb14-599"><a href="#cb14-599"></a>      <span class="at">data =</span> dt,</span>
<span id="cb14-600"><a href="#cb14-600"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb14-601"><a href="#cb14-601"></a>      <span class="at">model =</span> mod</span>
<span id="cb14-602"><a href="#cb14-602"></a>    )</span>
<span id="cb14-603"><a href="#cb14-603"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb14-604"><a href="#cb14-604"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-605"><a href="#cb14-605"></a>  </span>
<span id="cb14-606"><a href="#cb14-606"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb14-607"><a href="#cb14-607"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb14-608"><a href="#cb14-608"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-609"><a href="#cb14-609"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb14-610"><a href="#cb14-610"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb14-611"><a href="#cb14-611"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb14-612"><a href="#cb14-612"></a>      params<span class="sc">$</span>data,</span>
<span id="cb14-613"><a href="#cb14-613"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb14-614"><a href="#cb14-614"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb14-615"><a href="#cb14-615"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb14-616"><a href="#cb14-616"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb14-617"><a href="#cb14-617"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb14-618"><a href="#cb14-618"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb14-619"><a href="#cb14-619"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb14-620"><a href="#cb14-620"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb14-621"><a href="#cb14-621"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb14-622"><a href="#cb14-622"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb14-623"><a href="#cb14-623"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb14-624"><a href="#cb14-624"></a>            ))</span>
<span id="cb14-625"><a href="#cb14-625"></a>        }</span>
<span id="cb14-626"><a href="#cb14-626"></a>      )</span>
<span id="cb14-627"><a href="#cb14-627"></a>    )</span>
<span id="cb14-628"><a href="#cb14-628"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-629"><a href="#cb14-629"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-630"><a href="#cb14-630"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-631"><a href="#cb14-631"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-632"><a href="#cb14-632"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-633"><a href="#cb14-633"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-634"><a href="#cb14-634"></a>  })</span>
<span id="cb14-635"><a href="#cb14-635"></a>  </span>
<span id="cb14-636"><a href="#cb14-636"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb14-637"><a href="#cb14-637"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-638"><a href="#cb14-638"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-639"><a href="#cb14-639"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb14-640"><a href="#cb14-640"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb14-641"><a href="#cb14-641"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb14-642"><a href="#cb14-642"></a>    </span>
<span id="cb14-643"><a href="#cb14-643"></a>    </span>
<span id="cb14-644"><a href="#cb14-644"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb14-645"><a href="#cb14-645"></a>    </span>
<span id="cb14-646"><a href="#cb14-646"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-647"><a href="#cb14-647"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb14-648"><a href="#cb14-648"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-649"><a href="#cb14-649"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-650"><a href="#cb14-650"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-651"><a href="#cb14-651"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-652"><a href="#cb14-652"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-653"><a href="#cb14-653"></a>  })</span>
<span id="cb14-654"><a href="#cb14-654"></a>  </span>
<span id="cb14-655"><a href="#cb14-655"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb14-656"><a href="#cb14-656"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-657"><a href="#cb14-657"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-658"><a href="#cb14-658"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb14-659"><a href="#cb14-659"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb14-660"><a href="#cb14-660"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb14-661"><a href="#cb14-661"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb14-662"><a href="#cb14-662"></a>    </span>
<span id="cb14-663"><a href="#cb14-663"></a>    </span>
<span id="cb14-664"><a href="#cb14-664"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb14-665"><a href="#cb14-665"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb14-666"><a href="#cb14-666"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb14-667"><a href="#cb14-667"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb14-668"><a href="#cb14-668"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb14-669"><a href="#cb14-669"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb14-670"><a href="#cb14-670"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb14-671"><a href="#cb14-671"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb14-672"><a href="#cb14-672"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb14-673"><a href="#cb14-673"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb14-674"><a href="#cb14-674"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb14-675"><a href="#cb14-675"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb14-676"><a href="#cb14-676"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-677"><a href="#cb14-677"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-678"><a href="#cb14-678"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb14-679"><a href="#cb14-679"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb14-680"><a href="#cb14-680"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb14-681"><a href="#cb14-681"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb14-682"><a href="#cb14-682"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb14-683"><a href="#cb14-683"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb14-684"><a href="#cb14-684"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-685"><a href="#cb14-685"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb14-686"><a href="#cb14-686"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb14-687"><a href="#cb14-687"></a>      </span>
<span id="cb14-688"><a href="#cb14-688"></a>    }</span>
<span id="cb14-689"><a href="#cb14-689"></a>    </span>
<span id="cb14-690"><a href="#cb14-690"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-691"><a href="#cb14-691"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb14-692"><a href="#cb14-692"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-693"><a href="#cb14-693"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-694"><a href="#cb14-694"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-695"><a href="#cb14-695"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-696"><a href="#cb14-696"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-697"><a href="#cb14-697"></a>  })</span>
<span id="cb14-698"><a href="#cb14-698"></a>  </span>
<span id="cb14-699"><a href="#cb14-699"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb14-700"><a href="#cb14-700"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb14-701"><a href="#cb14-701"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-702"><a href="#cb14-702"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb14-703"><a href="#cb14-703"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb14-704"><a href="#cb14-704"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb14-705"><a href="#cb14-705"></a>    ))</span>
<span id="cb14-706"><a href="#cb14-706"></a>  })</span>
<span id="cb14-707"><a href="#cb14-707"></a>  </span>
<span id="cb14-708"><a href="#cb14-708"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb14-709"><a href="#cb14-709"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-710"><a href="#cb14-710"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-711"><a href="#cb14-711"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb14-712"><a href="#cb14-712"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-713"><a href="#cb14-713"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-714"><a href="#cb14-714"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-715"><a href="#cb14-715"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-716"><a href="#cb14-716"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-717"><a href="#cb14-717"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-718"><a href="#cb14-718"></a>  })</span>
<span id="cb14-719"><a href="#cb14-719"></a>  </span>
<span id="cb14-720"><a href="#cb14-720"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb14-721"><a href="#cb14-721"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-722"><a href="#cb14-722"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-723"><a href="#cb14-723"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-724"><a href="#cb14-724"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-725"><a href="#cb14-725"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-726"><a href="#cb14-726"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-727"><a href="#cb14-727"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb14-728"><a href="#cb14-728"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-729"><a href="#cb14-729"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-730"><a href="#cb14-730"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-731"><a href="#cb14-731"></a>  })</span>
<span id="cb14-732"><a href="#cb14-732"></a>  </span>
<span id="cb14-733"><a href="#cb14-733"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb14-734"><a href="#cb14-734"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb14-735"><a href="#cb14-735"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb14-736"><a href="#cb14-736"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb14-737"><a href="#cb14-737"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb14-738"><a href="#cb14-738"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb14-739"><a href="#cb14-739"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb14-740"><a href="#cb14-740"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb14-741"><a href="#cb14-741"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb14-742"><a href="#cb14-742"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb14-743"><a href="#cb14-743"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-744"><a href="#cb14-744"></a>  })</span>
<span id="cb14-745"><a href="#cb14-745"></a>  </span>
<span id="cb14-746"><a href="#cb14-746"></a>  </span>
<span id="cb14-747"><a href="#cb14-747"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb14-748"><a href="#cb14-748"></a>  <span class="co"># Select polygon based on aggregation level</span></span>
<span id="cb14-749"><a href="#cb14-749"></a>  poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-750"><a href="#cb14-750"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="cb14-751"><a href="#cb14-751"></a>      data_guerry_region</span>
<span id="cb14-752"><a href="#cb14-752"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-753"><a href="#cb14-753"></a>      data_guerry</span>
<span id="cb14-754"><a href="#cb14-754"></a>    }</span>
<span id="cb14-755"><a href="#cb14-755"></a>  })</span>
<span id="cb14-756"><a href="#cb14-756"></a>  </span>
<span id="cb14-757"><a href="#cb14-757"></a>  <span class="co"># Select palette based on input</span></span>
<span id="cb14-758"><a href="#cb14-758"></a>  palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-759"><a href="#cb14-759"></a>    pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="cb14-760"><a href="#cb14-760"></a>    <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="cb14-761"><a href="#cb14-761"></a>      pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="cb14-762"><a href="#cb14-762"></a>    }</span>
<span id="cb14-763"><a href="#cb14-763"></a>    pal</span>
<span id="cb14-764"><a href="#cb14-764"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb14-765"><a href="#cb14-765"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>tab_map_pal)</span>
<span id="cb14-766"><a href="#cb14-766"></a>  </span>
<span id="cb14-767"><a href="#cb14-767"></a>  <span class="co"># Compile parameters for leaflet rendering</span></span>
<span id="cb14-768"><a href="#cb14-768"></a>  params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb14-769"><a href="#cb14-769"></a>    poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="cb14-770"><a href="#cb14-770"></a>    pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb14-771"><a href="#cb14-771"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="cb14-772"><a href="#cb14-772"></a>    </span>
<span id="cb14-773"><a href="#cb14-773"></a>    values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="cb14-774"><a href="#cb14-774"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="cb14-775"><a href="#cb14-775"></a></span>
<span id="cb14-776"><a href="#cb14-776"></a>    <span class="fu">list</span>(</span>
<span id="cb14-777"><a href="#cb14-777"></a>      <span class="at">poly =</span> poly,</span>
<span id="cb14-778"><a href="#cb14-778"></a>      <span class="at">var =</span> var,</span>
<span id="cb14-779"><a href="#cb14-779"></a>      <span class="at">pal =</span> pal,</span>
<span id="cb14-780"><a href="#cb14-780"></a>      <span class="at">values =</span> values</span>
<span id="cb14-781"><a href="#cb14-781"></a>    )</span>
<span id="cb14-782"><a href="#cb14-782"></a>  })</span>
<span id="cb14-783"><a href="#cb14-783"></a>  </span>
<span id="cb14-784"><a href="#cb14-784"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="cb14-785"><a href="#cb14-785"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb14-786"><a href="#cb14-786"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="cb14-787"><a href="#cb14-787"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="cb14-788"><a href="#cb14-788"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-789"><a href="#cb14-789"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-790"><a href="#cb14-790"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-791"><a href="#cb14-791"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-792"><a href="#cb14-792"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="cb14-793"><a href="#cb14-793"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-794"><a href="#cb14-794"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-795"><a href="#cb14-795"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb14-796"><a href="#cb14-796"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="cb14-797"><a href="#cb14-797"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb14-798"><a href="#cb14-798"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb14-799"><a href="#cb14-799"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb14-800"><a href="#cb14-800"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-801"><a href="#cb14-801"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb14-802"><a href="#cb14-802"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb14-803"><a href="#cb14-803"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb14-804"><a href="#cb14-804"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb14-805"><a href="#cb14-805"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb14-806"><a href="#cb14-806"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-807"><a href="#cb14-807"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb14-808"><a href="#cb14-808"></a>        )</span>
<span id="cb14-809"><a href="#cb14-809"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb14-810"><a href="#cb14-810"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb14-811"><a href="#cb14-811"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb14-812"><a href="#cb14-812"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="cb14-813"><a href="#cb14-813"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="cb14-814"><a href="#cb14-814"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span></span>
<span id="cb14-815"><a href="#cb14-815"></a>      )</span>
<span id="cb14-816"><a href="#cb14-816"></a>  })</span>
<span id="cb14-817"><a href="#cb14-817"></a>}</span>
<span id="cb14-818"><a href="#cb14-818"></a></span>
<span id="cb14-819"><a href="#cb14-819"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercises-2" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="exercises-2"><span class="header-section-number">5.4</span> Exercises</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add a slider to the map configuration box that changes the opacity of the mapped polygons.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can create a slider input using <code>shiny::sliderInput()</code></p>
<p>Remember the workflow that we used before to implement new UI inputs:</p>
<ul>
<li>Create a UI widget and assign an input ID</li>
<li>Use the input ID to access selected values on the server side</li>
<li>Use the input value in R computations on the server side, e.g.&nbsp;as arguments for function calls</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-27-contents" aria-controls="callout-27" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-27" class="callout-27-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>On the UI side, we add a <code>sliderInput()</code>. The slider input has the id <code>tab_map_slider</code> and the label “Opacity”. It is restricted to values between 0 and 1 to correspond to the allowed opacity values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-39"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-39-1"><a href="#annotated-cell-39-1"></a><span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-39-2"><a href="#annotated-cell-39-2"></a>  <span class="fu">column</span>(</span>
<span id="annotated-cell-39-3"><a href="#annotated-cell-39-3"></a>    <span class="do">#### Inputs(s) ----</span></span>
<span id="annotated-cell-39-4"><a href="#annotated-cell-39-4"></a>    <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="annotated-cell-39-5"><a href="#annotated-cell-39-5"></a>    <span class="fu">box</span>(</span>
<span id="annotated-cell-39-6"><a href="#annotated-cell-39-6"></a>      <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="annotated-cell-39-7"><a href="#annotated-cell-39-7"></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-39-8"><a href="#annotated-cell-39-8"></a>      <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-39-9"><a href="#annotated-cell-39-9"></a>      <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-39-10"><a href="#annotated-cell-39-10"></a>        <span class="st">"tab_map_select"</span>,</span>
<span id="annotated-cell-39-11"><a href="#annotated-cell-39-11"></a>        <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="annotated-cell-39-12"><a href="#annotated-cell-39-12"></a>        <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="annotated-cell-39-13"><a href="#annotated-cell-39-13"></a>      )</span>
<span id="annotated-cell-39-14"><a href="#annotated-cell-39-14"></a>    ),</span>
<span id="annotated-cell-39-15"><a href="#annotated-cell-39-15"></a>    <span class="fu">box</span>(</span>
<span id="annotated-cell-39-16"><a href="#annotated-cell-39-16"></a>      <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="annotated-cell-39-17"><a href="#annotated-cell-39-17"></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-39-18"><a href="#annotated-cell-39-18"></a>      <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-39-19"><a href="#annotated-cell-39-19"></a>      <span class="fu">radioButtons</span>(</span>
<span id="annotated-cell-39-20"><a href="#annotated-cell-39-20"></a>        <span class="st">"tab_map_aggr"</span>,</span>
<span id="annotated-cell-39-21"><a href="#annotated-cell-39-21"></a>        <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="annotated-cell-39-22"><a href="#annotated-cell-39-22"></a>        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="annotated-cell-39-23"><a href="#annotated-cell-39-23"></a>        <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="annotated-cell-39-24"><a href="#annotated-cell-39-24"></a>      ),</span>
<span id="annotated-cell-39-25"><a href="#annotated-cell-39-25"></a>      <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-39-26"><a href="#annotated-cell-39-26"></a>        <span class="st">"tab_map_pal"</span>,</span>
<span id="annotated-cell-39-27"><a href="#annotated-cell-39-27"></a>        <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="annotated-cell-39-28"><a href="#annotated-cell-39-28"></a>        <span class="at">choices =</span> pals,</span>
<span id="annotated-cell-39-29"><a href="#annotated-cell-39-29"></a>        <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="annotated-cell-39-30"><a href="#annotated-cell-39-30"></a>      ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-39" data-target-annotation="1">1</button><span id="annotated-cell-39-31" class="code-annotation-target"><a href="#annotated-cell-39-31"></a>      <span class="fu">sliderInput</span>(</span>
<span id="annotated-cell-39-32"><a href="#annotated-cell-39-32"></a>        <span class="st">"tab_map_slider"</span>,</span>
<span id="annotated-cell-39-33"><a href="#annotated-cell-39-33"></a>        <span class="at">label =</span> <span class="st">"Opacity"</span>,</span>
<span id="annotated-cell-39-34"><a href="#annotated-cell-39-34"></a>        <span class="at">min =</span> <span class="dv">0</span>,</span>
<span id="annotated-cell-39-35"><a href="#annotated-cell-39-35"></a>        <span class="at">max =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-39-36"><a href="#annotated-cell-39-36"></a>        <span class="at">value =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-39-37"><a href="#annotated-cell-39-37"></a>        <span class="at">step =</span> <span class="fl">0.05</span></span>
<span id="annotated-cell-39-38"><a href="#annotated-cell-39-38"></a>      )</span>
<span id="annotated-cell-39-39"><a href="#annotated-cell-39-39"></a>    ) <span class="co"># end box</span></span>
<span id="annotated-cell-39-40"><a href="#annotated-cell-39-40"></a>  ), <span class="co"># end column</span></span>
<span id="annotated-cell-39-41"><a href="#annotated-cell-39-41"></a>  <span class="fu">column</span>(</span>
<span id="annotated-cell-39-42"><a href="#annotated-cell-39-42"></a>    <span class="do">#### Output(s) ----</span></span>
<span id="annotated-cell-39-43"><a href="#annotated-cell-39-43"></a>    <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="annotated-cell-39-44"><a href="#annotated-cell-39-44"></a>    <span class="fu">box</span>(</span>
<span id="annotated-cell-39-45"><a href="#annotated-cell-39-45"></a>      <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="annotated-cell-39-46"><a href="#annotated-cell-39-46"></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-39-47"><a href="#annotated-cell-39-47"></a>      <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-39-48"><a href="#annotated-cell-39-48"></a>      <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-39-49"><a href="#annotated-cell-39-49"></a>      <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-39-50"><a href="#annotated-cell-39-50"></a>      leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="annotated-cell-39-51"><a href="#annotated-cell-39-51"></a>    ) <span class="co"># end box</span></span>
<span id="annotated-cell-39-52"><a href="#annotated-cell-39-52"></a>  ) <span class="co"># end column</span></span>
<span id="annotated-cell-39-53"><a href="#annotated-cell-39-53"></a>) <span class="co"># end fluidRow</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-39" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-39" data-code-lines="31,32,33,34,35,36,37,38" data-code-annotation="1">New slider input!</span>
</dd>
</dl>
</div>
</div>
<p>On the server side, we then simply add the new input as an argument value for <code>fillOpacity</code> in <code>addPolygons()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-40"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-40-1"><a href="#annotated-cell-40-1"></a><span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-2"><a href="#annotated-cell-40-2"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-3"><a href="#annotated-cell-40-3"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-4"><a href="#annotated-cell-40-4"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-5"><a href="#annotated-cell-40-5"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-6"><a href="#annotated-cell-40-6"></a>  <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-40-7"><a href="#annotated-cell-40-7"></a>                                  <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-8"><a href="#annotated-cell-40-8"></a>  <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-9"><a href="#annotated-cell-40-9"></a>  <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-40-10"><a href="#annotated-cell-40-10"></a>    <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-40" data-target-annotation="1">1</button><span id="annotated-cell-40-11" class="code-annotation-target"><a href="#annotated-cell-40-11"></a>    <span class="at">fillOpacity =</span> input<span class="sc">$</span>tab_map_slider,</span>
<span id="annotated-cell-40-12"><a href="#annotated-cell-40-12"></a>    <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-40-13"><a href="#annotated-cell-40-13"></a>    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-40-14"><a href="#annotated-cell-40-14"></a>    <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-40-15"><a href="#annotated-cell-40-15"></a>    <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-40-16"><a href="#annotated-cell-40-16"></a>      <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-40-17"><a href="#annotated-cell-40-17"></a>      <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-40-18"><a href="#annotated-cell-40-18"></a>      <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-40-19"><a href="#annotated-cell-40-19"></a>      <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-40-20"><a href="#annotated-cell-40-20"></a>      <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-40-21"><a href="#annotated-cell-40-21"></a>      <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-40-22"><a href="#annotated-cell-40-22"></a>    )</span>
<span id="annotated-cell-40-23"><a href="#annotated-cell-40-23"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-40-24"><a href="#annotated-cell-40-24"></a>  <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-40-25"><a href="#annotated-cell-40-25"></a>    <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-40-26"><a href="#annotated-cell-40-26"></a>    <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-40-27"><a href="#annotated-cell-40-27"></a>    <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-40-28"><a href="#annotated-cell-40-28"></a>    <span class="at">opacity =</span> <span class="fl">0.9</span></span>
<span id="annotated-cell-40-29"><a href="#annotated-cell-40-29"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-40" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-40" data-code-lines="11" data-code-annotation="1">The new input is used as an argument to specify the fill opacity!</span>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="appendix-add-context" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Appendix: Add context</h1>
<ul>
<li>In the current state of the app, it’s hard to know what exactly the variables represent</li>
<li>Variables have informative titles, but this is not always enough</li>
<li>In this subsection, we add additional context information to understand better what we’re looking at</li>
</ul>
<section id="prepare-context-info" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="prepare-context-info"><span class="header-section-number">6.1</span> Prepare context info</h2>
<ul>
<li>As with many things, it’s useful to prepare data before we use it</li>
<li>Instead of relying on large <code>switch()</code> expressions, we create a list before running the server</li>
<li>The list contains information on title, description, legend and unit</li>
<li>Each list element can be accessed using the variable name so we can access them reactively</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For such large data objects, it can be a good idea to place them outside the main code file to increase readability.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Create a list with context information</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">list</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  ),</span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb15-11"><a href="#cb15-11"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>  ),</span>
<span id="cb15-14"><a href="#cb15-14"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb15-17"><a href="#cb15-17"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb15-18"><a href="#cb15-18"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb15-19"><a href="#cb15-19"></a>  ),</span>
<span id="cb15-20"><a href="#cb15-20"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb15-21"><a href="#cb15-21"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb15-22"><a href="#cb15-22"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb15-23"><a href="#cb15-23"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb15-24"><a href="#cb15-24"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-25"><a href="#cb15-25"></a>  ),</span>
<span id="cb15-26"><a href="#cb15-26"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb15-27"><a href="#cb15-27"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb15-28"><a href="#cb15-28"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb15-29"><a href="#cb15-29"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb15-30"><a href="#cb15-30"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-31"><a href="#cb15-31"></a>  ),</span>
<span id="cb15-32"><a href="#cb15-32"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb15-33"><a href="#cb15-33"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb15-34"><a href="#cb15-34"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb15-35"><a href="#cb15-35"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb15-36"><a href="#cb15-36"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-37"><a href="#cb15-37"></a>  ),</span>
<span id="cb15-38"><a href="#cb15-38"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb15-39"><a href="#cb15-39"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb15-40"><a href="#cb15-40"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb15-41"><a href="#cb15-41"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb15-42"><a href="#cb15-42"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-43"><a href="#cb15-43"></a>  ),</span>
<span id="cb15-44"><a href="#cb15-44"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb15-45"><a href="#cb15-45"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb15-46"><a href="#cb15-46"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb15-47"><a href="#cb15-47"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb15-48"><a href="#cb15-48"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-49"><a href="#cb15-49"></a>  ),</span>
<span id="cb15-50"><a href="#cb15-50"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb15-51"><a href="#cb15-51"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb15-52"><a href="#cb15-52"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb15-53"><a href="#cb15-53"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb15-54"><a href="#cb15-54"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-55"><a href="#cb15-55"></a>  ),</span>
<span id="cb15-56"><a href="#cb15-56"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb15-57"><a href="#cb15-57"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb15-58"><a href="#cb15-58"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb15-59"><a href="#cb15-59"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb15-60"><a href="#cb15-60"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb15-61"><a href="#cb15-61"></a>  ),</span>
<span id="cb15-62"><a href="#cb15-62"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb15-63"><a href="#cb15-63"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb15-64"><a href="#cb15-64"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb15-65"><a href="#cb15-65"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb15-66"><a href="#cb15-66"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-67"><a href="#cb15-67"></a>  ),</span>
<span id="cb15-68"><a href="#cb15-68"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb15-69"><a href="#cb15-69"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb15-70"><a href="#cb15-70"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb15-71"><a href="#cb15-71"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb15-72"><a href="#cb15-72"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-73"><a href="#cb15-73"></a>  ),</span>
<span id="cb15-74"><a href="#cb15-74"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb15-75"><a href="#cb15-75"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb15-76"><a href="#cb15-76"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb15-77"><a href="#cb15-77"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb15-78"><a href="#cb15-78"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-79"><a href="#cb15-79"></a>  ),</span>
<span id="cb15-80"><a href="#cb15-80"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb15-81"><a href="#cb15-81"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb15-82"><a href="#cb15-82"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb15-83"><a href="#cb15-83"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb15-84"><a href="#cb15-84"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-85"><a href="#cb15-85"></a>  ),</span>
<span id="cb15-86"><a href="#cb15-86"></a>  <span class="at">Insturction =</span> <span class="fu">list</span>(</span>
<span id="cb15-87"><a href="#cb15-87"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb15-88"><a href="#cb15-88"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb15-89"><a href="#cb15-89"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb15-90"><a href="#cb15-90"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-91"><a href="#cb15-91"></a>  ),</span>
<span id="cb15-92"><a href="#cb15-92"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb15-93"><a href="#cb15-93"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb15-94"><a href="#cb15-94"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836),De la prostitution en Paris"</span>))),</span>
<span id="cb15-95"><a href="#cb15-95"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb15-96"><a href="#cb15-96"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-97"><a href="#cb15-97"></a>  ),</span>
<span id="cb15-98"><a href="#cb15-98"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb15-99"><a href="#cb15-99"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb15-100"><a href="#cb15-100"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb15-101"><a href="#cb15-101"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb15-102"><a href="#cb15-102"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb15-103"><a href="#cb15-103"></a>  ),</span>
<span id="cb15-104"><a href="#cb15-104"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb15-105"><a href="#cb15-105"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb15-106"><a href="#cb15-106"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km^2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb15-107"><a href="#cb15-107"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb15-108"><a href="#cb15-108"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb15-109"><a href="#cb15-109"></a>  ),</span>
<span id="cb15-110"><a href="#cb15-110"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb15-111"><a href="#cb15-111"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb15-112"><a href="#cb15-112"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb15-113"><a href="#cb15-113"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb15-114"><a href="#cb15-114"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb15-115"><a href="#cb15-115"></a>  )</span>
<span id="cb15-116"><a href="#cb15-116"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="add-variable-descriptions" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="add-variable-descriptions"><span class="header-section-number">6.2</span> Add variable descriptions</h2>
<ul>
<li>To give a short description of the selected variable and their source, we add a new UI output</li>
<li>The UI output is called <code>tab_map_desc</code> and can hold formatted HTML output</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-16"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-16-1"><a href="#annotated-cell-16-1"></a><span class="fu">tabItem</span>(</span>
<span id="annotated-cell-16-2"><a href="#annotated-cell-16-2"></a>    <span class="at">tabName =</span> <span class="st">"tab_map"</span>,</span>
<span id="annotated-cell-16-3"><a href="#annotated-cell-16-3"></a>    <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-16-4"><a href="#annotated-cell-16-4"></a>        <span class="fu">column</span>(                                     </span>
<span id="annotated-cell-16-5"><a href="#annotated-cell-16-5"></a>            <span class="at">width =</span> <span class="dv">4</span>,                                </span>
<span id="annotated-cell-16-6"><a href="#annotated-cell-16-6"></a>            <span class="fu">box</span>(                                      </span>
<span id="annotated-cell-16-7"><a href="#annotated-cell-16-7"></a>                <span class="at">title =</span> <span class="st">"Data selection"</span>,               </span>
<span id="annotated-cell-16-8"><a href="#annotated-cell-16-8"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,                     </span>
<span id="annotated-cell-16-9"><a href="#annotated-cell-16-9"></a>                <span class="at">width =</span> <span class="dv">12</span>,                             </span>
<span id="annotated-cell-16-10"><a href="#annotated-cell-16-10"></a>                <span class="fu">selectInput</span>(                            </span>
<span id="annotated-cell-16-11"><a href="#annotated-cell-16-11"></a>                    <span class="st">"tab_map_select"</span>,                         </span>
<span id="annotated-cell-16-12"><a href="#annotated-cell-16-12"></a>                    <span class="at">label =</span> <span class="st">"Select a variable"</span>,          </span>
<span id="annotated-cell-16-13"><a href="#annotated-cell-16-13"></a>                    <span class="at">choices =</span> <span class="fu">setNames</span>(variable_names, <span class="fu">names</span>(variable_names))</span>
<span id="annotated-cell-16-14"><a href="#annotated-cell-16-14"></a>                ),                                      </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-16" data-target-annotation="1">1</button><span id="annotated-cell-16-15" class="code-annotation-target"><a href="#annotated-cell-16-15"></a>                <span class="fu">uiOutput</span>(<span class="st">"tab_map_desc"</span>)</span>
<span id="annotated-cell-16-16"><a href="#annotated-cell-16-16"></a>            ),</span>
<span id="annotated-cell-16-17"><a href="#annotated-cell-16-17"></a>            <span class="fu">box</span>(                                      </span>
<span id="annotated-cell-16-18"><a href="#annotated-cell-16-18"></a>                <span class="at">title =</span> <span class="st">"Map configuration"</span>,            </span>
<span id="annotated-cell-16-19"><a href="#annotated-cell-16-19"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,                     </span>
<span id="annotated-cell-16-20"><a href="#annotated-cell-16-20"></a>                <span class="at">width =</span> <span class="dv">12</span>,                             </span>
<span id="annotated-cell-16-21"><a href="#annotated-cell-16-21"></a>                <span class="fu">radioButtons</span>(                           </span>
<span id="annotated-cell-16-22"><a href="#annotated-cell-16-22"></a>                    <span class="st">"tab_map_aggr"</span>,                           </span>
<span id="annotated-cell-16-23"><a href="#annotated-cell-16-23"></a>                    <span class="at">label =</span> <span class="st">"Aggregation level"</span>,          </span>
<span id="annotated-cell-16-24"><a href="#annotated-cell-16-24"></a>                    <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="annotated-cell-16-25"><a href="#annotated-cell-16-25"></a>                    <span class="at">selected =</span> <span class="st">"Departments"</span>              </span>
<span id="annotated-cell-16-26"><a href="#annotated-cell-16-26"></a>                ),                                      </span>
<span id="annotated-cell-16-27"><a href="#annotated-cell-16-27"></a>                <span class="fu">selectInput</span>(                            </span>
<span id="annotated-cell-16-28"><a href="#annotated-cell-16-28"></a>                    <span class="st">"tab_map_pal"</span>,                            </span>
<span id="annotated-cell-16-29"><a href="#annotated-cell-16-29"></a>                    <span class="at">label =</span> <span class="st">"Color palette"</span>,              </span>
<span id="annotated-cell-16-30"><a href="#annotated-cell-16-30"></a>                    <span class="at">choices =</span> pals,                       </span>
<span id="annotated-cell-16-31"><a href="#annotated-cell-16-31"></a>                    <span class="at">selected =</span> <span class="st">"Reds"</span>                     </span>
<span id="annotated-cell-16-32"><a href="#annotated-cell-16-32"></a>                ) <span class="co"># end input</span></span>
<span id="annotated-cell-16-33"><a href="#annotated-cell-16-33"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-16-34"><a href="#annotated-cell-16-34"></a>        ), <span class="co"># end column</span></span>
<span id="annotated-cell-16-35"><a href="#annotated-cell-16-35"></a>        <span class="fu">column</span>(</span>
<span id="annotated-cell-16-36"><a href="#annotated-cell-16-36"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="annotated-cell-16-37"><a href="#annotated-cell-16-37"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-16-38"><a href="#annotated-cell-16-38"></a>                <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="annotated-cell-16-39"><a href="#annotated-cell-16-39"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-16-40"><a href="#annotated-cell-16-40"></a>                <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-16-41"><a href="#annotated-cell-16-41"></a>                <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-16-42"><a href="#annotated-cell-16-42"></a>                <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-16-43"><a href="#annotated-cell-16-43"></a>                leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="annotated-cell-16-44"><a href="#annotated-cell-16-44"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-16-45"><a href="#annotated-cell-16-45"></a>        ) <span class="co"># end column</span></span>
<span id="annotated-cell-16-46"><a href="#annotated-cell-16-46"></a>    ) <span class="co"># end fluidRow</span></span>
<span id="annotated-cell-16-47"><a href="#annotated-cell-16-47"></a>) <span class="co"># end tabItem</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="15" data-code-annotation="1">Add a UI output with the id <code>tab_map_desc</code>. This is where the variable description will go!</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="render-context" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="render-context"><span class="header-section-number">6.3</span> Render context</h2>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1"></a>  <span class="co"># Add a variable description</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1">1</button><span id="annotated-cell-17-2" class="code-annotation-target"><a href="#annotated-cell-17-2"></a>  output<span class="sc">$</span>tab_map_desc <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="annotated-cell-17-3"><a href="#annotated-cell-17-3"></a>    <span class="fu">HTML</span>(txts[[input<span class="sc">$</span>tab_map_select]]<span class="sc">$</span>desc)</span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4"></a>  })</span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5"></a></span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6"></a>    <span class="co"># Select polygon based on aggregation level (B)</span></span>
<span id="annotated-cell-17-7"><a href="#annotated-cell-17-7"></a>    poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-17-8"><a href="#annotated-cell-17-8"></a>        <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="annotated-cell-17-9"><a href="#annotated-cell-17-9"></a>            data_guerry_region</span>
<span id="annotated-cell-17-10"><a href="#annotated-cell-17-10"></a>        } <span class="cf">else</span> {</span>
<span id="annotated-cell-17-11"><a href="#annotated-cell-17-11"></a>            data_guerry</span>
<span id="annotated-cell-17-12"><a href="#annotated-cell-17-12"></a>        }</span>
<span id="annotated-cell-17-13"><a href="#annotated-cell-17-13"></a>    })</span>
<span id="annotated-cell-17-14"><a href="#annotated-cell-17-14"></a>    </span>
<span id="annotated-cell-17-15"><a href="#annotated-cell-17-15"></a>    <span class="co"># Select palette based on input (C)</span></span>
<span id="annotated-cell-17-16"><a href="#annotated-cell-17-16"></a>    palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-17-17"><a href="#annotated-cell-17-17"></a>        pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="annotated-cell-17-18"><a href="#annotated-cell-17-18"></a>        <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="annotated-cell-17-19"><a href="#annotated-cell-17-19"></a>            pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="annotated-cell-17-20"><a href="#annotated-cell-17-20"></a>        }</span>
<span id="annotated-cell-17-21"><a href="#annotated-cell-17-21"></a>        pal</span>
<span id="annotated-cell-17-22"><a href="#annotated-cell-17-22"></a>    })</span>
<span id="annotated-cell-17-23"><a href="#annotated-cell-17-23"></a>    </span>
<span id="annotated-cell-17-24"><a href="#annotated-cell-17-24"></a>    <span class="co"># Compile parameters for leaflet rendering (D)</span></span>
<span id="annotated-cell-17-25"><a href="#annotated-cell-17-25"></a>    params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-17-26"><a href="#annotated-cell-17-26"></a>        poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="annotated-cell-17-27"><a href="#annotated-cell-17-27"></a>        pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="annotated-cell-17-28"><a href="#annotated-cell-17-28"></a>        var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="annotated-cell-17-29"><a href="#annotated-cell-17-29"></a>        </span>
<span id="annotated-cell-17-30"><a href="#annotated-cell-17-30"></a>        values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="annotated-cell-17-31"><a href="#annotated-cell-17-31"></a>        pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="annotated-cell-17-32"><a href="#annotated-cell-17-32"></a>        </span>
<span id="annotated-cell-17-33"><a href="#annotated-cell-17-33"></a>        <span class="fu">list</span>(</span>
<span id="annotated-cell-17-34"><a href="#annotated-cell-17-34"></a>            <span class="at">poly =</span> poly,</span>
<span id="annotated-cell-17-35"><a href="#annotated-cell-17-35"></a>            <span class="at">var =</span> var,</span>
<span id="annotated-cell-17-36"><a href="#annotated-cell-17-36"></a>            <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-17-37"><a href="#annotated-cell-17-37"></a>            <span class="at">values =</span> values,</span>
<span id="annotated-cell-17-38"><a href="#annotated-cell-17-38"></a>            <span class="at">labels =</span> labels</span>
<span id="annotated-cell-17-39"><a href="#annotated-cell-17-39"></a>        )</span>
<span id="annotated-cell-17-40"><a href="#annotated-cell-17-40"></a>    })</span>
<span id="annotated-cell-17-41"><a href="#annotated-cell-17-41"></a>    </span>
<span id="annotated-cell-17-42"><a href="#annotated-cell-17-42"></a>    <span class="co"># Render leaflet for the first time</span></span>
<span id="annotated-cell-17-43"><a href="#annotated-cell-17-43"></a>    output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="annotated-cell-17-44"><a href="#annotated-cell-17-44"></a>        <span class="co"># Isolate call to params() to prevent render function to be executed</span></span>
<span id="annotated-cell-17-45"><a href="#annotated-cell-17-45"></a>        <span class="co"># every time params() is invalidated. No dependency is made.</span></span>
<span id="annotated-cell-17-46"><a href="#annotated-cell-17-46"></a>        params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="annotated-cell-17-47"><a href="#annotated-cell-17-47"></a>        <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-48"><a href="#annotated-cell-17-48"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-49"><a href="#annotated-cell-17-49"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-50"><a href="#annotated-cell-17-50"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-51"><a href="#annotated-cell-17-51"></a>            <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-52"><a href="#annotated-cell-17-52"></a>            <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-17-53"><a href="#annotated-cell-17-53"></a>                                                                            <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-54"><a href="#annotated-cell-17-54"></a>            <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-55"><a href="#annotated-cell-17-55"></a>            <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-17-56"><a href="#annotated-cell-17-56"></a>                <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-17-57"><a href="#annotated-cell-17-57"></a>                <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-17-58"><a href="#annotated-cell-17-58"></a>                <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-17-59"><a href="#annotated-cell-17-59"></a>                <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-17-60"><a href="#annotated-cell-17-60"></a>                <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-17-61"><a href="#annotated-cell-17-61"></a>                <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-17-62"><a href="#annotated-cell-17-62"></a>                    <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-17-63"><a href="#annotated-cell-17-63"></a>                    <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-17-64"><a href="#annotated-cell-17-64"></a>                    <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-17-65"><a href="#annotated-cell-17-65"></a>                    <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-17-66"><a href="#annotated-cell-17-66"></a>                    <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-17-67"><a href="#annotated-cell-17-67"></a>                    <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-17-68"><a href="#annotated-cell-17-68"></a>                )</span>
<span id="annotated-cell-17-69"><a href="#annotated-cell-17-69"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-17-70"><a href="#annotated-cell-17-70"></a>            <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-17-71"><a href="#annotated-cell-17-71"></a>                <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-17-72"><a href="#annotated-cell-17-72"></a>                <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-17-73"><a href="#annotated-cell-17-73"></a>                <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-17-74"><a href="#annotated-cell-17-74"></a>                <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2">2</button><span id="annotated-cell-17-75" class="code-annotation-target"><a href="#annotated-cell-17-75"></a>                <span class="at">title =</span> txts[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-17-76"><a href="#annotated-cell-17-76"></a>                <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> txts[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-17-77"><a href="#annotated-cell-17-77"></a>            )</span>
<span id="annotated-cell-17-78"><a href="#annotated-cell-17-78"></a>    })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="2,3,4" data-code-annotation="1">To render the UI, we call the <code>renderUI()</code> function. Here, we can just access the list we created before to access the description based on the selected variable.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="75,76" data-code-annotation="2">In the same way, we can add a title and a unit to the legend using the <code>title</code> and <code>labFormat</code> arguments in <code>addLegend()</code></span>
</dd>
</dl>
</div>
</div>
<ul>
<li>The result is arguably nicer to look at, but certainly provides more information to understand the map we created</li>
</ul>
</section>
<section id="full-code-3" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="full-code-3"><span class="header-section-number">6.4</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including a reactive Leaflet map with context descriptions</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb16-21"><a href="#cb16-21"></a></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb16-23"><a href="#cb16-23"></a></span>
<span id="cb16-24"><a href="#cb16-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb16-25"><a href="#cb16-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-26"><a href="#cb16-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb16-27"><a href="#cb16-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb16-28"><a href="#cb16-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb16-29"><a href="#cb16-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb16-30"><a href="#cb16-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb16-31"><a href="#cb16-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb16-32"><a href="#cb16-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb16-33"><a href="#cb16-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb16-34"><a href="#cb16-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb16-35"><a href="#cb16-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb16-36"><a href="#cb16-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb16-37"><a href="#cb16-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb16-38"><a href="#cb16-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb16-39"><a href="#cb16-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb16-40"><a href="#cb16-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb16-41"><a href="#cb16-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb16-42"><a href="#cb16-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb16-43"><a href="#cb16-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb16-44"><a href="#cb16-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb16-45"><a href="#cb16-45"></a>)</span>
<span id="cb16-46"><a href="#cb16-46"></a></span>
<span id="cb16-47"><a href="#cb16-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-48"><a href="#cb16-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb16-49"><a href="#cb16-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb16-50"><a href="#cb16-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb16-51"><a href="#cb16-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb16-52"><a href="#cb16-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-53"><a href="#cb16-53"></a>  ),</span>
<span id="cb16-54"><a href="#cb16-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb16-55"><a href="#cb16-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb16-56"><a href="#cb16-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb16-57"><a href="#cb16-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb16-58"><a href="#cb16-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-59"><a href="#cb16-59"></a>  ),</span>
<span id="cb16-60"><a href="#cb16-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb16-61"><a href="#cb16-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb16-62"><a href="#cb16-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb16-63"><a href="#cb16-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb16-64"><a href="#cb16-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb16-65"><a href="#cb16-65"></a>  ),</span>
<span id="cb16-66"><a href="#cb16-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb16-67"><a href="#cb16-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb16-68"><a href="#cb16-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb16-69"><a href="#cb16-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb16-70"><a href="#cb16-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-71"><a href="#cb16-71"></a>  ),</span>
<span id="cb16-72"><a href="#cb16-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb16-73"><a href="#cb16-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb16-74"><a href="#cb16-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb16-75"><a href="#cb16-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb16-76"><a href="#cb16-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-77"><a href="#cb16-77"></a>  ),</span>
<span id="cb16-78"><a href="#cb16-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb16-79"><a href="#cb16-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb16-80"><a href="#cb16-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb16-81"><a href="#cb16-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb16-82"><a href="#cb16-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-83"><a href="#cb16-83"></a>  ),</span>
<span id="cb16-84"><a href="#cb16-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb16-85"><a href="#cb16-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb16-86"><a href="#cb16-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb16-87"><a href="#cb16-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb16-88"><a href="#cb16-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-89"><a href="#cb16-89"></a>  ),</span>
<span id="cb16-90"><a href="#cb16-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb16-91"><a href="#cb16-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb16-92"><a href="#cb16-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb16-93"><a href="#cb16-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb16-94"><a href="#cb16-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-95"><a href="#cb16-95"></a>  ),</span>
<span id="cb16-96"><a href="#cb16-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb16-97"><a href="#cb16-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb16-98"><a href="#cb16-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb16-99"><a href="#cb16-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb16-100"><a href="#cb16-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-101"><a href="#cb16-101"></a>  ),</span>
<span id="cb16-102"><a href="#cb16-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb16-103"><a href="#cb16-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb16-104"><a href="#cb16-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb16-105"><a href="#cb16-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb16-106"><a href="#cb16-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb16-107"><a href="#cb16-107"></a>  ),</span>
<span id="cb16-108"><a href="#cb16-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb16-109"><a href="#cb16-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb16-110"><a href="#cb16-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb16-111"><a href="#cb16-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb16-112"><a href="#cb16-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-113"><a href="#cb16-113"></a>  ),</span>
<span id="cb16-114"><a href="#cb16-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb16-115"><a href="#cb16-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb16-116"><a href="#cb16-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb16-117"><a href="#cb16-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb16-118"><a href="#cb16-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-119"><a href="#cb16-119"></a>  ),</span>
<span id="cb16-120"><a href="#cb16-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb16-121"><a href="#cb16-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb16-122"><a href="#cb16-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb16-123"><a href="#cb16-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb16-124"><a href="#cb16-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-125"><a href="#cb16-125"></a>  ),</span>
<span id="cb16-126"><a href="#cb16-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb16-127"><a href="#cb16-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb16-128"><a href="#cb16-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb16-129"><a href="#cb16-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb16-130"><a href="#cb16-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-131"><a href="#cb16-131"></a>  ),</span>
<span id="cb16-132"><a href="#cb16-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb16-133"><a href="#cb16-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb16-134"><a href="#cb16-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb16-135"><a href="#cb16-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb16-136"><a href="#cb16-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-137"><a href="#cb16-137"></a>  ),</span>
<span id="cb16-138"><a href="#cb16-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb16-139"><a href="#cb16-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb16-140"><a href="#cb16-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb16-141"><a href="#cb16-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb16-142"><a href="#cb16-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-143"><a href="#cb16-143"></a>  ),</span>
<span id="cb16-144"><a href="#cb16-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb16-145"><a href="#cb16-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb16-146"><a href="#cb16-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb16-147"><a href="#cb16-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb16-148"><a href="#cb16-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb16-149"><a href="#cb16-149"></a>  ),</span>
<span id="cb16-150"><a href="#cb16-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb16-151"><a href="#cb16-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb16-152"><a href="#cb16-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb16-153"><a href="#cb16-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb16-154"><a href="#cb16-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb16-155"><a href="#cb16-155"></a>  ),</span>
<span id="cb16-156"><a href="#cb16-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb16-157"><a href="#cb16-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb16-158"><a href="#cb16-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb16-159"><a href="#cb16-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb16-160"><a href="#cb16-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb16-161"><a href="#cb16-161"></a>  )</span>
<span id="cb16-162"><a href="#cb16-162"></a>)</span>
<span id="cb16-163"><a href="#cb16-163"></a></span>
<span id="cb16-164"><a href="#cb16-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb16-165"><a href="#cb16-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-166"><a href="#cb16-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-167"><a href="#cb16-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-168"><a href="#cb16-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb16-169"><a href="#cb16-169"></a>    Region,</span>
<span id="cb16-170"><a href="#cb16-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb16-171"><a href="#cb16-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb16-172"><a href="#cb16-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb16-173"><a href="#cb16-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb16-174"><a href="#cb16-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb16-175"><a href="#cb16-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb16-176"><a href="#cb16-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-177"><a href="#cb16-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb16-178"><a href="#cb16-178"></a></span>
<span id="cb16-179"><a href="#cb16-179"></a></span>
<span id="cb16-180"><a href="#cb16-180"></a></span>
<span id="cb16-181"><a href="#cb16-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb16-182"><a href="#cb16-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb16-183"><a href="#cb16-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-184"><a href="#cb16-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb16-185"><a href="#cb16-185"></a></span>
<span id="cb16-186"><a href="#cb16-186"></a></span>
<span id="cb16-187"><a href="#cb16-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb16-188"><a href="#cb16-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb16-189"><a href="#cb16-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb16-190"><a href="#cb16-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb16-191"><a href="#cb16-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb16-192"><a href="#cb16-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb16-193"><a href="#cb16-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb16-194"><a href="#cb16-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb16-195"><a href="#cb16-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb16-196"><a href="#cb16-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb16-197"><a href="#cb16-197"></a>      }</span>
<span id="cb16-198"><a href="#cb16-198"></a>    }</span>
<span id="cb16-199"><a href="#cb16-199"></a>  ))</span>
<span id="cb16-200"><a href="#cb16-200"></a></span>
<span id="cb16-201"><a href="#cb16-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb16-202"><a href="#cb16-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb16-203"><a href="#cb16-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-204"><a href="#cb16-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb16-205"><a href="#cb16-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-206"><a href="#cb16-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb16-207"><a href="#cb16-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb16-208"><a href="#cb16-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb16-209"><a href="#cb16-209"></a>)</span>
<span id="cb16-210"><a href="#cb16-210"></a></span>
<span id="cb16-211"><a href="#cb16-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb16-212"><a href="#cb16-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb16-213"><a href="#cb16-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-214"><a href="#cb16-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb16-215"><a href="#cb16-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb16-216"><a href="#cb16-216"></a>)</span>
<span id="cb16-217"><a href="#cb16-217"></a></span>
<span id="cb16-218"><a href="#cb16-218"></a></span>
<span id="cb16-219"><a href="#cb16-219"></a></span>
<span id="cb16-220"><a href="#cb16-220"></a></span>
<span id="cb16-221"><a href="#cb16-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb16-222"><a href="#cb16-222"></a></span>
<span id="cb16-223"><a href="#cb16-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb16-224"><a href="#cb16-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb16-225"><a href="#cb16-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb16-226"><a href="#cb16-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb16-227"><a href="#cb16-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb16-228"><a href="#cb16-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb16-229"><a href="#cb16-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb16-230"><a href="#cb16-230"></a>    )</span>
<span id="cb16-231"><a href="#cb16-231"></a>  ),</span>
<span id="cb16-232"><a href="#cb16-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb16-233"><a href="#cb16-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb16-234"><a href="#cb16-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb16-235"><a href="#cb16-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb16-236"><a href="#cb16-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb16-237"><a href="#cb16-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb16-238"><a href="#cb16-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb16-239"><a href="#cb16-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb16-240"><a href="#cb16-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb16-241"><a href="#cb16-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb16-242"><a href="#cb16-242"></a>    ),</span>
<span id="cb16-243"><a href="#cb16-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-244"><a href="#cb16-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-245"><a href="#cb16-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-246"><a href="#cb16-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb16-247"><a href="#cb16-247"></a>  ),</span>
<span id="cb16-248"><a href="#cb16-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb16-249"><a href="#cb16-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb16-250"><a href="#cb16-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb16-251"><a href="#cb16-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb16-252"><a href="#cb16-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb16-253"><a href="#cb16-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb16-254"><a href="#cb16-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb16-255"><a href="#cb16-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb16-256"><a href="#cb16-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb16-257"><a href="#cb16-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb16-258"><a href="#cb16-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb16-259"><a href="#cb16-259"></a>        ),</span>
<span id="cb16-260"><a href="#cb16-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb16-261"><a href="#cb16-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb16-262"><a href="#cb16-262"></a>          <span class="fu">column</span>(</span>
<span id="cb16-263"><a href="#cb16-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb16-264"><a href="#cb16-264"></a>            <span class="fu">box</span>(</span>
<span id="cb16-265"><a href="#cb16-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb16-266"><a href="#cb16-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-267"><a href="#cb16-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-268"><a href="#cb16-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb16-269"><a href="#cb16-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb16-270"><a href="#cb16-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb16-271"><a href="#cb16-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb16-272"><a href="#cb16-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb16-273"><a href="#cb16-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb16-274"><a href="#cb16-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb16-275"><a href="#cb16-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb16-276"><a href="#cb16-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb16-277"><a href="#cb16-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb16-278"><a href="#cb16-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb16-279"><a href="#cb16-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb16-280"><a href="#cb16-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb16-281"><a href="#cb16-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb16-282"><a href="#cb16-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb16-283"><a href="#cb16-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb16-284"><a href="#cb16-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb16-285"><a href="#cb16-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb16-286"><a href="#cb16-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb16-287"><a href="#cb16-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb16-288"><a href="#cb16-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb16-289"><a href="#cb16-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb16-290"><a href="#cb16-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb16-291"><a href="#cb16-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb16-292"><a href="#cb16-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb16-293"><a href="#cb16-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-294"><a href="#cb16-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-295"><a href="#cb16-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb16-296"><a href="#cb16-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb16-297"><a href="#cb16-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb16-298"><a href="#cb16-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb16-299"><a href="#cb16-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb16-300"><a href="#cb16-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb16-301"><a href="#cb16-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb16-302"><a href="#cb16-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb16-303"><a href="#cb16-303"></a>                  )</span>
<span id="cb16-304"><a href="#cb16-304"></a>                ),</span>
<span id="cb16-305"><a href="#cb16-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb16-306"><a href="#cb16-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb16-307"><a href="#cb16-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-308"><a href="#cb16-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-309"><a href="#cb16-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb16-310"><a href="#cb16-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb16-311"><a href="#cb16-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb16-312"><a href="#cb16-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb16-313"><a href="#cb16-313"></a>                )</span>
<span id="cb16-314"><a href="#cb16-314"></a>              )</span>
<span id="cb16-315"><a href="#cb16-315"></a>            )</span>
<span id="cb16-316"><a href="#cb16-316"></a>          ),</span>
<span id="cb16-317"><a href="#cb16-317"></a>          <span class="fu">column</span>(</span>
<span id="cb16-318"><a href="#cb16-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb16-319"><a href="#cb16-319"></a>            <span class="fu">box</span>(</span>
<span id="cb16-320"><a href="#cb16-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb16-321"><a href="#cb16-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-322"><a href="#cb16-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-323"><a href="#cb16-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb16-324"><a href="#cb16-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb16-325"><a href="#cb16-325"></a>            )</span>
<span id="cb16-326"><a href="#cb16-326"></a>          )</span>
<span id="cb16-327"><a href="#cb16-327"></a>        )</span>
<span id="cb16-328"><a href="#cb16-328"></a>      ),</span>
<span id="cb16-329"><a href="#cb16-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb16-330"><a href="#cb16-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb16-331"><a href="#cb16-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb16-332"><a href="#cb16-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb16-333"><a href="#cb16-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb16-334"><a href="#cb16-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb16-335"><a href="#cb16-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb16-336"><a href="#cb16-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb16-337"><a href="#cb16-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb16-338"><a href="#cb16-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb16-339"><a href="#cb16-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-340"><a href="#cb16-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb16-341"><a href="#cb16-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-342"><a href="#cb16-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb16-343"><a href="#cb16-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb16-344"><a href="#cb16-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb16-345"><a href="#cb16-345"></a>            ),</span>
<span id="cb16-346"><a href="#cb16-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-347"><a href="#cb16-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb16-348"><a href="#cb16-348"></a>          )</span>
<span id="cb16-349"><a href="#cb16-349"></a>        ),</span>
<span id="cb16-350"><a href="#cb16-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb16-351"><a href="#cb16-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb16-352"><a href="#cb16-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb16-353"><a href="#cb16-353"></a>      ),</span>
<span id="cb16-354"><a href="#cb16-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb16-355"><a href="#cb16-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb16-356"><a href="#cb16-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb16-357"><a href="#cb16-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb16-358"><a href="#cb16-358"></a>          <span class="fu">column</span>(</span>
<span id="cb16-359"><a href="#cb16-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb16-360"><a href="#cb16-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb16-361"><a href="#cb16-361"></a>            <span class="fu">box</span>(</span>
<span id="cb16-362"><a href="#cb16-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-363"><a href="#cb16-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb16-364"><a href="#cb16-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-365"><a href="#cb16-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb16-366"><a href="#cb16-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb16-367"><a href="#cb16-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb16-368"><a href="#cb16-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb16-369"><a href="#cb16-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-370"><a href="#cb16-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb16-371"><a href="#cb16-371"></a>              ),</span>
<span id="cb16-372"><a href="#cb16-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb16-373"><a href="#cb16-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb16-374"><a href="#cb16-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb16-375"><a href="#cb16-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb16-376"><a href="#cb16-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb16-377"><a href="#cb16-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-378"><a href="#cb16-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-379"><a href="#cb16-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb16-380"><a href="#cb16-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb16-381"><a href="#cb16-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb16-382"><a href="#cb16-382"></a>                ),</span>
<span id="cb16-383"><a href="#cb16-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-384"><a href="#cb16-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb16-385"><a href="#cb16-385"></a>              ),</span>
<span id="cb16-386"><a href="#cb16-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb16-387"><a href="#cb16-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb16-388"><a href="#cb16-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb16-389"><a href="#cb16-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-390"><a href="#cb16-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-391"><a href="#cb16-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb16-392"><a href="#cb16-392"></a>              ),</span>
<span id="cb16-393"><a href="#cb16-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb16-394"><a href="#cb16-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb16-395"><a href="#cb16-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb16-396"><a href="#cb16-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb16-397"><a href="#cb16-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb16-398"><a href="#cb16-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb16-399"><a href="#cb16-399"></a>              )</span>
<span id="cb16-400"><a href="#cb16-400"></a>            ),</span>
<span id="cb16-401"><a href="#cb16-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb16-402"><a href="#cb16-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb16-403"><a href="#cb16-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-404"><a href="#cb16-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb16-405"><a href="#cb16-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb16-406"><a href="#cb16-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb16-407"><a href="#cb16-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-408"><a href="#cb16-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb16-409"><a href="#cb16-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-410"><a href="#cb16-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb16-411"><a href="#cb16-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb16-412"><a href="#cb16-412"></a>              ),</span>
<span id="cb16-413"><a href="#cb16-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb16-414"><a href="#cb16-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-415"><a href="#cb16-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb16-416"><a href="#cb16-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb16-417"><a href="#cb16-417"></a>              ),</span>
<span id="cb16-418"><a href="#cb16-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb16-419"><a href="#cb16-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-420"><a href="#cb16-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb16-421"><a href="#cb16-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb16-422"><a href="#cb16-422"></a>              )</span>
<span id="cb16-423"><a href="#cb16-423"></a>            )</span>
<span id="cb16-424"><a href="#cb16-424"></a>          ),</span>
<span id="cb16-425"><a href="#cb16-425"></a>          <span class="fu">column</span>(</span>
<span id="cb16-426"><a href="#cb16-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb16-427"><a href="#cb16-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb16-428"><a href="#cb16-428"></a>            <span class="fu">box</span>(</span>
<span id="cb16-429"><a href="#cb16-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-430"><a href="#cb16-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb16-431"><a href="#cb16-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-432"><a href="#cb16-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb16-433"><a href="#cb16-433"></a>            ),</span>
<span id="cb16-434"><a href="#cb16-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb16-435"><a href="#cb16-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb16-436"><a href="#cb16-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-437"><a href="#cb16-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb16-438"><a href="#cb16-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb16-439"><a href="#cb16-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-440"><a href="#cb16-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb16-441"><a href="#cb16-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-442"><a href="#cb16-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb16-443"><a href="#cb16-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb16-444"><a href="#cb16-444"></a>              ),</span>
<span id="cb16-445"><a href="#cb16-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-446"><a href="#cb16-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb16-447"><a href="#cb16-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb16-448"><a href="#cb16-448"></a>              ),</span>
<span id="cb16-449"><a href="#cb16-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb16-450"><a href="#cb16-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb16-451"><a href="#cb16-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb16-452"><a href="#cb16-452"></a>              )</span>
<span id="cb16-453"><a href="#cb16-453"></a>            )</span>
<span id="cb16-454"><a href="#cb16-454"></a>          )</span>
<span id="cb16-455"><a href="#cb16-455"></a>        )</span>
<span id="cb16-456"><a href="#cb16-456"></a>      ),</span>
<span id="cb16-457"><a href="#cb16-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb16-458"><a href="#cb16-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb16-459"><a href="#cb16-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb16-460"><a href="#cb16-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb16-461"><a href="#cb16-461"></a>          <span class="fu">column</span>(</span>
<span id="cb16-462"><a href="#cb16-462"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb16-463"><a href="#cb16-463"></a>            <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="cb16-464"><a href="#cb16-464"></a>            <span class="fu">box</span>(</span>
<span id="cb16-465"><a href="#cb16-465"></a>              <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="cb16-466"><a href="#cb16-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-467"><a href="#cb16-467"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-468"><a href="#cb16-468"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb16-469"><a href="#cb16-469"></a>                <span class="st">"tab_map_select"</span>,</span>
<span id="cb16-470"><a href="#cb16-470"></a>                <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="cb16-471"><a href="#cb16-471"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="cb16-472"><a href="#cb16-472"></a>              ),</span>
<span id="cb16-473"><a href="#cb16-473"></a>              <span class="fu">uiOutput</span>(<span class="st">"tab_map_desc"</span>)</span>
<span id="cb16-474"><a href="#cb16-474"></a>            ),</span>
<span id="cb16-475"><a href="#cb16-475"></a>            <span class="fu">box</span>(</span>
<span id="cb16-476"><a href="#cb16-476"></a>              <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="cb16-477"><a href="#cb16-477"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-478"><a href="#cb16-478"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-479"><a href="#cb16-479"></a>              <span class="fu">radioButtons</span>(</span>
<span id="cb16-480"><a href="#cb16-480"></a>                <span class="st">"tab_map_aggr"</span>,</span>
<span id="cb16-481"><a href="#cb16-481"></a>                <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="cb16-482"><a href="#cb16-482"></a>                <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="cb16-483"><a href="#cb16-483"></a>                <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="cb16-484"><a href="#cb16-484"></a>              ),</span>
<span id="cb16-485"><a href="#cb16-485"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb16-486"><a href="#cb16-486"></a>                <span class="st">"tab_map_pal"</span>,</span>
<span id="cb16-487"><a href="#cb16-487"></a>                <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="cb16-488"><a href="#cb16-488"></a>                <span class="at">choices =</span> pals,</span>
<span id="cb16-489"><a href="#cb16-489"></a>                <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="cb16-490"><a href="#cb16-490"></a>              ) <span class="co"># end input</span></span>
<span id="cb16-491"><a href="#cb16-491"></a>            ) <span class="co"># end box</span></span>
<span id="cb16-492"><a href="#cb16-492"></a>          ), <span class="co"># end column</span></span>
<span id="cb16-493"><a href="#cb16-493"></a>          <span class="fu">column</span>(</span>
<span id="cb16-494"><a href="#cb16-494"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb16-495"><a href="#cb16-495"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb16-496"><a href="#cb16-496"></a>            <span class="fu">box</span>(</span>
<span id="cb16-497"><a href="#cb16-497"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb16-498"><a href="#cb16-498"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb16-499"><a href="#cb16-499"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-500"><a href="#cb16-500"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-501"><a href="#cb16-501"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb16-502"><a href="#cb16-502"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb16-503"><a href="#cb16-503"></a>            ) <span class="co"># end box</span></span>
<span id="cb16-504"><a href="#cb16-504"></a>          ) <span class="co"># end column</span></span>
<span id="cb16-505"><a href="#cb16-505"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb16-506"><a href="#cb16-506"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb16-507"><a href="#cb16-507"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb16-508"><a href="#cb16-508"></a>  ),</span>
<span id="cb16-509"><a href="#cb16-509"></a>  </span>
<span id="cb16-510"><a href="#cb16-510"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb16-511"><a href="#cb16-511"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb16-512"><a href="#cb16-512"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb16-513"><a href="#cb16-513"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb16-514"><a href="#cb16-514"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb16-515"><a href="#cb16-515"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb16-516"><a href="#cb16-516"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb16-517"><a href="#cb16-517"></a>    )</span>
<span id="cb16-518"><a href="#cb16-518"></a>  ),</span>
<span id="cb16-519"><a href="#cb16-519"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb16-520"><a href="#cb16-520"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb16-521"><a href="#cb16-521"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb16-522"><a href="#cb16-522"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb16-523"><a href="#cb16-523"></a>  )  </span>
<span id="cb16-524"><a href="#cb16-524"></a>)</span>
<span id="cb16-525"><a href="#cb16-525"></a></span>
<span id="cb16-526"><a href="#cb16-526"></a></span>
<span id="cb16-527"><a href="#cb16-527"></a></span>
<span id="cb16-528"><a href="#cb16-528"></a><span class="co"># 4 Server ----</span></span>
<span id="cb16-529"><a href="#cb16-529"></a></span>
<span id="cb16-530"><a href="#cb16-530"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb16-531"><a href="#cb16-531"></a>  </span>
<span id="cb16-532"><a href="#cb16-532"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb16-533"><a href="#cb16-533"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb16-534"><a href="#cb16-534"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-535"><a href="#cb16-535"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb16-536"><a href="#cb16-536"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb16-537"><a href="#cb16-537"></a>    </span>
<span id="cb16-538"><a href="#cb16-538"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb16-539"><a href="#cb16-539"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb16-540"><a href="#cb16-540"></a>    }</span>
<span id="cb16-541"><a href="#cb16-541"></a>    </span>
<span id="cb16-542"><a href="#cb16-542"></a>    data_table</span>
<span id="cb16-543"><a href="#cb16-543"></a>  })</span>
<span id="cb16-544"><a href="#cb16-544"></a>  </span>
<span id="cb16-545"><a href="#cb16-545"></a>  </span>
<span id="cb16-546"><a href="#cb16-546"></a>  <span class="do">### Create table----</span></span>
<span id="cb16-547"><a href="#cb16-547"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-548"><a href="#cb16-548"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb16-549"><a href="#cb16-549"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb16-550"><a href="#cb16-550"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb16-551"><a href="#cb16-551"></a>      tab,</span>
<span id="cb16-552"><a href="#cb16-552"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb16-553"><a href="#cb16-553"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb16-554"><a href="#cb16-554"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb16-555"><a href="#cb16-555"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb16-556"><a href="#cb16-556"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb16-557"><a href="#cb16-557"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-558"><a href="#cb16-558"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb16-559"><a href="#cb16-559"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb16-560"><a href="#cb16-560"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-561"><a href="#cb16-561"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-562"><a href="#cb16-562"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb16-563"><a href="#cb16-563"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb16-564"><a href="#cb16-564"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb16-565"><a href="#cb16-565"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb16-566"><a href="#cb16-566"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb16-567"><a href="#cb16-567"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb16-568"><a href="#cb16-568"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb16-569"><a href="#cb16-569"></a><span class="st">  </span></span>
<span id="cb16-570"><a href="#cb16-570"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb16-571"><a href="#cb16-571"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb16-572"><a href="#cb16-572"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb16-573"><a href="#cb16-573"></a><span class="st">            );</span></span>
<span id="cb16-574"><a href="#cb16-574"></a><span class="st">          }</span></span>
<span id="cb16-575"><a href="#cb16-575"></a><span class="st">        "</span>))</span>
<span id="cb16-576"><a href="#cb16-576"></a>        )</span>
<span id="cb16-577"><a href="#cb16-577"></a>      )</span>
<span id="cb16-578"><a href="#cb16-578"></a>    )</span>
<span id="cb16-579"><a href="#cb16-579"></a>  })</span>
<span id="cb16-580"><a href="#cb16-580"></a>  </span>
<span id="cb16-581"><a href="#cb16-581"></a>  <span class="do">### Render table----</span></span>
<span id="cb16-582"><a href="#cb16-582"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-583"><a href="#cb16-583"></a>  </span>
<span id="cb16-584"><a href="#cb16-584"></a>  </span>
<span id="cb16-585"><a href="#cb16-585"></a>  </span>
<span id="cb16-586"><a href="#cb16-586"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb16-587"><a href="#cb16-587"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb16-588"><a href="#cb16-588"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-589"><a href="#cb16-589"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb16-590"><a href="#cb16-590"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb16-591"><a href="#cb16-591"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb16-592"><a href="#cb16-592"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb16-593"><a href="#cb16-593"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb16-594"><a href="#cb16-594"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb16-595"><a href="#cb16-595"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb16-596"><a href="#cb16-596"></a>    </span>
<span id="cb16-597"><a href="#cb16-597"></a>    <span class="fu">list</span>(</span>
<span id="cb16-598"><a href="#cb16-598"></a>      <span class="at">x =</span> x,</span>
<span id="cb16-599"><a href="#cb16-599"></a>      <span class="at">y =</span> y,</span>
<span id="cb16-600"><a href="#cb16-600"></a>      <span class="at">data =</span> dt,</span>
<span id="cb16-601"><a href="#cb16-601"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb16-602"><a href="#cb16-602"></a>      <span class="at">model =</span> mod</span>
<span id="cb16-603"><a href="#cb16-603"></a>    )</span>
<span id="cb16-604"><a href="#cb16-604"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb16-605"><a href="#cb16-605"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-606"><a href="#cb16-606"></a>  </span>
<span id="cb16-607"><a href="#cb16-607"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb16-608"><a href="#cb16-608"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb16-609"><a href="#cb16-609"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-610"><a href="#cb16-610"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb16-611"><a href="#cb16-611"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb16-612"><a href="#cb16-612"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb16-613"><a href="#cb16-613"></a>      params<span class="sc">$</span>data,</span>
<span id="cb16-614"><a href="#cb16-614"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb16-615"><a href="#cb16-615"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb16-616"><a href="#cb16-616"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb16-617"><a href="#cb16-617"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb16-618"><a href="#cb16-618"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb16-619"><a href="#cb16-619"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb16-620"><a href="#cb16-620"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb16-621"><a href="#cb16-621"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb16-622"><a href="#cb16-622"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb16-623"><a href="#cb16-623"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb16-624"><a href="#cb16-624"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb16-625"><a href="#cb16-625"></a>            ))</span>
<span id="cb16-626"><a href="#cb16-626"></a>        }</span>
<span id="cb16-627"><a href="#cb16-627"></a>      )</span>
<span id="cb16-628"><a href="#cb16-628"></a>    )</span>
<span id="cb16-629"><a href="#cb16-629"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-630"><a href="#cb16-630"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-631"><a href="#cb16-631"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-632"><a href="#cb16-632"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-633"><a href="#cb16-633"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-634"><a href="#cb16-634"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-635"><a href="#cb16-635"></a>  })</span>
<span id="cb16-636"><a href="#cb16-636"></a>  </span>
<span id="cb16-637"><a href="#cb16-637"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb16-638"><a href="#cb16-638"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-639"><a href="#cb16-639"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-640"><a href="#cb16-640"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb16-641"><a href="#cb16-641"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb16-642"><a href="#cb16-642"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb16-643"><a href="#cb16-643"></a>    </span>
<span id="cb16-644"><a href="#cb16-644"></a>    </span>
<span id="cb16-645"><a href="#cb16-645"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb16-646"><a href="#cb16-646"></a>    </span>
<span id="cb16-647"><a href="#cb16-647"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-648"><a href="#cb16-648"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-649"><a href="#cb16-649"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-650"><a href="#cb16-650"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-651"><a href="#cb16-651"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-652"><a href="#cb16-652"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-653"><a href="#cb16-653"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-654"><a href="#cb16-654"></a>  })</span>
<span id="cb16-655"><a href="#cb16-655"></a>  </span>
<span id="cb16-656"><a href="#cb16-656"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb16-657"><a href="#cb16-657"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-658"><a href="#cb16-658"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-659"><a href="#cb16-659"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb16-660"><a href="#cb16-660"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb16-661"><a href="#cb16-661"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb16-662"><a href="#cb16-662"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb16-663"><a href="#cb16-663"></a>    </span>
<span id="cb16-664"><a href="#cb16-664"></a>    </span>
<span id="cb16-665"><a href="#cb16-665"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb16-666"><a href="#cb16-666"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb16-667"><a href="#cb16-667"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb16-668"><a href="#cb16-668"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb16-669"><a href="#cb16-669"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb16-670"><a href="#cb16-670"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb16-671"><a href="#cb16-671"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb16-672"><a href="#cb16-672"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb16-673"><a href="#cb16-673"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb16-674"><a href="#cb16-674"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb16-675"><a href="#cb16-675"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb16-676"><a href="#cb16-676"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb16-677"><a href="#cb16-677"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-678"><a href="#cb16-678"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-679"><a href="#cb16-679"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb16-680"><a href="#cb16-680"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb16-681"><a href="#cb16-681"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb16-682"><a href="#cb16-682"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb16-683"><a href="#cb16-683"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb16-684"><a href="#cb16-684"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb16-685"><a href="#cb16-685"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-686"><a href="#cb16-686"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-687"><a href="#cb16-687"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb16-688"><a href="#cb16-688"></a>      </span>
<span id="cb16-689"><a href="#cb16-689"></a>    }</span>
<span id="cb16-690"><a href="#cb16-690"></a>    </span>
<span id="cb16-691"><a href="#cb16-691"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-692"><a href="#cb16-692"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-693"><a href="#cb16-693"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-694"><a href="#cb16-694"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-695"><a href="#cb16-695"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-696"><a href="#cb16-696"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-697"><a href="#cb16-697"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-698"><a href="#cb16-698"></a>  })</span>
<span id="cb16-699"><a href="#cb16-699"></a>  </span>
<span id="cb16-700"><a href="#cb16-700"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb16-701"><a href="#cb16-701"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb16-702"><a href="#cb16-702"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-703"><a href="#cb16-703"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb16-704"><a href="#cb16-704"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb16-705"><a href="#cb16-705"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb16-706"><a href="#cb16-706"></a>    ))</span>
<span id="cb16-707"><a href="#cb16-707"></a>  })</span>
<span id="cb16-708"><a href="#cb16-708"></a>  </span>
<span id="cb16-709"><a href="#cb16-709"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb16-710"><a href="#cb16-710"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-711"><a href="#cb16-711"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-712"><a href="#cb16-712"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb16-713"><a href="#cb16-713"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-714"><a href="#cb16-714"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-715"><a href="#cb16-715"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-716"><a href="#cb16-716"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-717"><a href="#cb16-717"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-718"><a href="#cb16-718"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-719"><a href="#cb16-719"></a>  })</span>
<span id="cb16-720"><a href="#cb16-720"></a>  </span>
<span id="cb16-721"><a href="#cb16-721"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb16-722"><a href="#cb16-722"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-723"><a href="#cb16-723"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-724"><a href="#cb16-724"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-725"><a href="#cb16-725"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-726"><a href="#cb16-726"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-727"><a href="#cb16-727"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-728"><a href="#cb16-728"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb16-729"><a href="#cb16-729"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-730"><a href="#cb16-730"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-731"><a href="#cb16-731"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-732"><a href="#cb16-732"></a>  })</span>
<span id="cb16-733"><a href="#cb16-733"></a>  </span>
<span id="cb16-734"><a href="#cb16-734"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb16-735"><a href="#cb16-735"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb16-736"><a href="#cb16-736"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb16-737"><a href="#cb16-737"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb16-738"><a href="#cb16-738"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb16-739"><a href="#cb16-739"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb16-740"><a href="#cb16-740"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb16-741"><a href="#cb16-741"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb16-742"><a href="#cb16-742"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb16-743"><a href="#cb16-743"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb16-744"><a href="#cb16-744"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-745"><a href="#cb16-745"></a>  })</span>
<span id="cb16-746"><a href="#cb16-746"></a>  </span>
<span id="cb16-747"><a href="#cb16-747"></a>  </span>
<span id="cb16-748"><a href="#cb16-748"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb16-749"><a href="#cb16-749"></a>  </span>
<span id="cb16-750"><a href="#cb16-750"></a>  <span class="co"># Render description of selected variable</span></span>
<span id="cb16-751"><a href="#cb16-751"></a>  output<span class="sc">$</span>tab_map_desc <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb16-752"><a href="#cb16-752"></a>    <span class="fu">HTML</span>(variable_desc[[input<span class="sc">$</span>tab_map_select]]<span class="sc">$</span>desc)</span>
<span id="cb16-753"><a href="#cb16-753"></a>  })</span>
<span id="cb16-754"><a href="#cb16-754"></a>  </span>
<span id="cb16-755"><a href="#cb16-755"></a>  <span class="co"># Select polygon based on aggregation level</span></span>
<span id="cb16-756"><a href="#cb16-756"></a>  poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-757"><a href="#cb16-757"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="cb16-758"><a href="#cb16-758"></a>      data_guerry_region</span>
<span id="cb16-759"><a href="#cb16-759"></a>    } <span class="cf">else</span> {</span>
<span id="cb16-760"><a href="#cb16-760"></a>      data_guerry</span>
<span id="cb16-761"><a href="#cb16-761"></a>    }</span>
<span id="cb16-762"><a href="#cb16-762"></a>  })</span>
<span id="cb16-763"><a href="#cb16-763"></a>  </span>
<span id="cb16-764"><a href="#cb16-764"></a>  <span class="co"># Select palette based on input</span></span>
<span id="cb16-765"><a href="#cb16-765"></a>  palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-766"><a href="#cb16-766"></a>    pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="cb16-767"><a href="#cb16-767"></a>    <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="cb16-768"><a href="#cb16-768"></a>      pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="cb16-769"><a href="#cb16-769"></a>    }</span>
<span id="cb16-770"><a href="#cb16-770"></a>    pal</span>
<span id="cb16-771"><a href="#cb16-771"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb16-772"><a href="#cb16-772"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>tab_map_pal)</span>
<span id="cb16-773"><a href="#cb16-773"></a>  </span>
<span id="cb16-774"><a href="#cb16-774"></a>  <span class="co"># Compile parameters for leaflet rendering</span></span>
<span id="cb16-775"><a href="#cb16-775"></a>  params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb16-776"><a href="#cb16-776"></a>    poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="cb16-777"><a href="#cb16-777"></a>    pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb16-778"><a href="#cb16-778"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="cb16-779"><a href="#cb16-779"></a>    </span>
<span id="cb16-780"><a href="#cb16-780"></a>    values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="cb16-781"><a href="#cb16-781"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="cb16-782"><a href="#cb16-782"></a>    </span>
<span id="cb16-783"><a href="#cb16-783"></a>    <span class="fu">list</span>(</span>
<span id="cb16-784"><a href="#cb16-784"></a>      <span class="at">poly =</span> poly,</span>
<span id="cb16-785"><a href="#cb16-785"></a>      <span class="at">var =</span> var,</span>
<span id="cb16-786"><a href="#cb16-786"></a>      <span class="at">pal =</span> pal,</span>
<span id="cb16-787"><a href="#cb16-787"></a>      <span class="at">values =</span> values</span>
<span id="cb16-788"><a href="#cb16-788"></a>    )</span>
<span id="cb16-789"><a href="#cb16-789"></a>  })</span>
<span id="cb16-790"><a href="#cb16-790"></a>  </span>
<span id="cb16-791"><a href="#cb16-791"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="cb16-792"><a href="#cb16-792"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb16-793"><a href="#cb16-793"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="cb16-794"><a href="#cb16-794"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="cb16-795"><a href="#cb16-795"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-796"><a href="#cb16-796"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-797"><a href="#cb16-797"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-798"><a href="#cb16-798"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-799"><a href="#cb16-799"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="cb16-800"><a href="#cb16-800"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-801"><a href="#cb16-801"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-802"><a href="#cb16-802"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb16-803"><a href="#cb16-803"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="cb16-804"><a href="#cb16-804"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb16-805"><a href="#cb16-805"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb16-806"><a href="#cb16-806"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb16-807"><a href="#cb16-807"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-808"><a href="#cb16-808"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb16-809"><a href="#cb16-809"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb16-810"><a href="#cb16-810"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb16-811"><a href="#cb16-811"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-812"><a href="#cb16-812"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb16-813"><a href="#cb16-813"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-814"><a href="#cb16-814"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb16-815"><a href="#cb16-815"></a>        )</span>
<span id="cb16-816"><a href="#cb16-816"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb16-817"><a href="#cb16-817"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb16-818"><a href="#cb16-818"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb16-819"><a href="#cb16-819"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="cb16-820"><a href="#cb16-820"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="cb16-821"><a href="#cb16-821"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb16-822"><a href="#cb16-822"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="cb16-823"><a href="#cb16-823"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="cb16-824"><a href="#cb16-824"></a>      )</span>
<span id="cb16-825"><a href="#cb16-825"></a>  })</span>
<span id="cb16-826"><a href="#cb16-826"></a>}</span>
<span id="cb16-827"><a href="#cb16-827"></a></span>
<span id="cb16-828"><a href="#cb16-828"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="appendix-add-hover-labels" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Appendix: Add hover labels</h1>
<ul>
<li>Unlike Plotly, Leaflet does not automatically provide labels for data points
<ul>
<li>Bad news: You have to do it on your own</li>
<li>Good news: You have more freedom in designing hover labels</li>
</ul></li>
</ul>
<section id="how-to-add-labels" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="how-to-add-labels"><span class="header-section-number">7.1</span> How to add labels</h2>
<ul>
<li>Adding labels is itself not a difficult task: You can just provide the values vector we use as data input</li>
<li>Labels then contain a single value with no information as to what you’re looking at</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>    <span class="fu">addPolygons</span>(</span>
<span id="cb17-3"><a href="#cb17-3"></a>        ..., <span class="co"># rest of the args</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>        <span class="at">label =</span> <span class="sc">~</span>values</span>
<span id="cb17-5"><a href="#cb17-5"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="advanced-label-layout-using-html" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="advanced-label-layout-using-html"><span class="header-section-number">7.2</span> Advanced label layout using HTML</h2>
<ul>
<li>This is <em>enough</em>, but not very pretty and it doesn’t provide potentially important metadata like region names</li>
<li>In our app, we use a table layout containing information about region, department and variable value</li>
<li>You can create generic HTML tables using the <code>table</code> tag (<code>tags$table</code>) together with the <code>tr</code> (table row, <code>tags$tr</code>) and <code>td</code> (table data, <code>tags$td</code>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1">1</button><span id="annotated-cell-20-1" class="code-annotation-target"><a href="#annotated-cell-20-1"></a>tags<span class="sc">$</span><span class="fu">table</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2">2</button><span id="annotated-cell-20-2" class="code-annotation-target"><a href="#annotated-cell-20-2"></a>    tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="3">3</button><span id="annotated-cell-20-3" class="code-annotation-target"><a href="#annotated-cell-20-3"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 1"</span>),</span>
<span id="annotated-cell-20-4"><a href="#annotated-cell-20-4"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 2"</span>),</span>
<span id="annotated-cell-20-5"><a href="#annotated-cell-20-5"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 3"</span>)</span>
<span id="annotated-cell-20-6"><a href="#annotated-cell-20-6"></a>    ),</span>
<span id="annotated-cell-20-7"><a href="#annotated-cell-20-7"></a>    tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-20-8"><a href="#annotated-cell-20-8"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 4"</span>),</span>
<span id="annotated-cell-20-9"><a href="#annotated-cell-20-9"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 5"</span>),</span>
<span id="annotated-cell-20-10"><a href="#annotated-cell-20-10"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 6"</span>)</span>
<span id="annotated-cell-20-11"><a href="#annotated-cell-20-11"></a>    ),</span>
<span id="annotated-cell-20-12"><a href="#annotated-cell-20-12"></a>    tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-20-13"><a href="#annotated-cell-20-13"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 7"</span>),</span>
<span id="annotated-cell-20-14"><a href="#annotated-cell-20-14"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 8"</span>),</span>
<span id="annotated-cell-20-15"><a href="#annotated-cell-20-15"></a>        tags<span class="sc">$</span><span class="fu">td</span>(<span class="st">"Cell 9"</span>)</span>
<span id="annotated-cell-20-16"><a href="#annotated-cell-20-16"></a>    )</span>
<span id="annotated-cell-20-17"><a href="#annotated-cell-20-17"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="1" data-code-annotation="1">Define the table environment</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="2,7,12" data-code-annotation="2">Define a table row</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="3,4,5,8,9,10,13,14,15" data-code-annotation="3">Define three data cells</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td>Cell 1</td>
<td>Cell 2</td>
<td>Cell 3</td>
</tr>
<tr class="even">
<td>Cell 4</td>
<td>Cell 5</td>
<td>Cell 6</td>
</tr>
<tr class="odd">
<td>Cell 7</td>
<td>Cell 8</td>
<td>Cell 9</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><img src="https://vertex-academy.com/tutorials/wp-content/uploads/2016/08/table.png" class="img-fluid"></p>
<ul>
<li>In the following chunk we use <code>mapply()</code> to map region, department and variable value into a nicely aligned grid:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-21"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-21-1"><a href="#annotated-cell-21-1"></a>params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-21-2"><a href="#annotated-cell-21-2"></a>  poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="annotated-cell-21-3"><a href="#annotated-cell-21-3"></a>  pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="annotated-cell-21-4"><a href="#annotated-cell-21-4"></a>  var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="annotated-cell-21-5"><a href="#annotated-cell-21-5"></a></span>
<span id="annotated-cell-21-6"><a href="#annotated-cell-21-6"></a>  values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="annotated-cell-21-7"><a href="#annotated-cell-21-7"></a>  pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="annotated-cell-21-8"><a href="#annotated-cell-21-8"></a>  </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="1">1</button><span id="annotated-cell-21-9" class="code-annotation-target"><a href="#annotated-cell-21-9"></a>  reg <span class="ot">&lt;-</span> poly[[<span class="st">"Region"</span>]]</span>
<span id="annotated-cell-21-10"><a href="#annotated-cell-21-10"></a>  dep <span class="ot">&lt;-</span> poly[[<span class="st">"Department"</span>]]</span>
<span id="annotated-cell-21-11"><a href="#annotated-cell-21-11"></a>  val <span class="ot">&lt;-</span> poly[[var]]</span>
<span id="annotated-cell-21-12"><a href="#annotated-cell-21-12"></a>  </span>
<span id="annotated-cell-21-13"><a href="#annotated-cell-21-13"></a>  <span class="co"># If aggregated on region level, department will be NULL</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="2">2</button><span id="annotated-cell-21-14" class="code-annotation-target"><a href="#annotated-cell-21-14"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(dep)) {</span>
<span id="annotated-cell-21-15"><a href="#annotated-cell-21-15"></a>    dep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(poly))</span>
<span id="annotated-cell-21-16"><a href="#annotated-cell-21-16"></a>  }</span>
<span id="annotated-cell-21-17"><a href="#annotated-cell-21-17"></a></span>
<span id="annotated-cell-21-18"><a href="#annotated-cell-21-18"></a>  <span class="co"># Create labels that are nicely aligned in a grid</span></span>
<span id="annotated-cell-21-19"><a href="#annotated-cell-21-19"></a>  <span class="co"># If aggregated on region level, omit department name (because it is NULL)</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="3">3</button><span id="annotated-cell-21-20" class="code-annotation-target"><a href="#annotated-cell-21-20"></a>  labels <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="annotated-cell-21-21"><a href="#annotated-cell-21-21"></a>    <span class="cf">function</span>(reg, dep, val) {</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="4">4</button><span id="annotated-cell-21-22" class="code-annotation-target"><a href="#annotated-cell-21-22"></a>      <span class="fu">HTML</span>(<span class="fu">as.character</span>(tags<span class="sc">$</span><span class="fu">table</span>(</span>
<span id="annotated-cell-21-23"><a href="#annotated-cell-21-23"></a>        <span class="co"># Add region row</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="5">5</button><span id="annotated-cell-21-24" class="code-annotation-target"><a href="#annotated-cell-21-24"></a>        tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-21-25"><a href="#annotated-cell-21-25"></a>          <span class="at">style =</span> <span class="st">"line-height: 10px"</span>, <span class="co"># more compact layout</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="6">6</button><span id="annotated-cell-21-26" class="code-annotation-target"><a href="#annotated-cell-21-26"></a>          tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Region: "</span>)),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="7">7</button><span id="annotated-cell-21-27" class="code-annotation-target"><a href="#annotated-cell-21-27"></a>          tags<span class="sc">$</span><span class="fu">td</span>(reg)</span>
<span id="annotated-cell-21-28"><a href="#annotated-cell-21-28"></a>        ),</span>
<span id="annotated-cell-21-29"><a href="#annotated-cell-21-29"></a>        <span class="co"># Add department row if available</span></span>
<span id="annotated-cell-21-30"><a href="#annotated-cell-21-30"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(dep)) {</span>
<span id="annotated-cell-21-31"><a href="#annotated-cell-21-31"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-21-32"><a href="#annotated-cell-21-32"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="annotated-cell-21-33"><a href="#annotated-cell-21-33"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Department: "</span>)),</span>
<span id="annotated-cell-21-34"><a href="#annotated-cell-21-34"></a>            tags<span class="sc">$</span><span class="fu">td</span>(dep)</span>
<span id="annotated-cell-21-35"><a href="#annotated-cell-21-35"></a>          )</span>
<span id="annotated-cell-21-36"><a href="#annotated-cell-21-36"></a>        },</span>
<span id="annotated-cell-21-37"><a href="#annotated-cell-21-37"></a>        <span class="co"># Add value row</span></span>
<span id="annotated-cell-21-38"><a href="#annotated-cell-21-38"></a>        tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-21-39"><a href="#annotated-cell-21-39"></a>          <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="annotated-cell-21-40"><a href="#annotated-cell-21-40"></a>          tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="fu">paste0</span>(txts[[var]]<span class="sc">$</span>lgd, <span class="st">": "</span>))),</span>
<span id="annotated-cell-21-41"><a href="#annotated-cell-21-41"></a>          tags<span class="sc">$</span><span class="fu">td</span>(<span class="fu">round</span>(val, <span class="dv">2</span>))</span>
<span id="annotated-cell-21-42"><a href="#annotated-cell-21-42"></a>        )</span>
<span id="annotated-cell-21-43"><a href="#annotated-cell-21-43"></a>      )))</span>
<span id="annotated-cell-21-44"><a href="#annotated-cell-21-44"></a>    },</span>
<span id="annotated-cell-21-45"><a href="#annotated-cell-21-45"></a>    <span class="at">reg =</span> reg, <span class="at">dep =</span> dep, <span class="at">val =</span> val,</span>
<span id="annotated-cell-21-46"><a href="#annotated-cell-21-46"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-21-47"><a href="#annotated-cell-21-47"></a>    <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span></span>
<span id="annotated-cell-21-48"><a href="#annotated-cell-21-48"></a>  )</span>
<span id="annotated-cell-21-49"><a href="#annotated-cell-21-49"></a></span>
<span id="annotated-cell-21-50"><a href="#annotated-cell-21-50"></a>  <span class="fu">list</span>(</span>
<span id="annotated-cell-21-51"><a href="#annotated-cell-21-51"></a>    <span class="at">poly =</span> poly,</span>
<span id="annotated-cell-21-52"><a href="#annotated-cell-21-52"></a>    <span class="at">var =</span> var,</span>
<span id="annotated-cell-21-53"><a href="#annotated-cell-21-53"></a>    <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-21-54"><a href="#annotated-cell-21-54"></a>    <span class="at">values =</span> values,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="8">8</button><span id="annotated-cell-21-55" class="code-annotation-target"><a href="#annotated-cell-21-55"></a>    <span class="at">labels =</span> labels</span>
<span id="annotated-cell-21-56"><a href="#annotated-cell-21-56"></a>  )</span>
<span id="annotated-cell-21-57"><a href="#annotated-cell-21-57"></a>  </span>
<span id="annotated-cell-21-58"><a href="#annotated-cell-21-58"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="annotated-cell-21-59"><a href="#annotated-cell-21-59"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="annotated-cell-21-60"><a href="#annotated-cell-21-60"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="annotated-cell-21-61"><a href="#annotated-cell-21-61"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-62"><a href="#annotated-cell-21-62"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-63"><a href="#annotated-cell-21-63"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-64"><a href="#annotated-cell-21-64"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-65"><a href="#annotated-cell-21-65"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-66"><a href="#annotated-cell-21-66"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-21-67"><a href="#annotated-cell-21-67"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-68"><a href="#annotated-cell-21-68"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-69"><a href="#annotated-cell-21-69"></a>      <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-21-70"><a href="#annotated-cell-21-70"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-21-71"><a href="#annotated-cell-21-71"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-21-72"><a href="#annotated-cell-21-72"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-21-73"><a href="#annotated-cell-21-73"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-21-74"><a href="#annotated-cell-21-74"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-21" data-target-annotation="9">9</button><span id="annotated-cell-21-75" class="code-annotation-target"><a href="#annotated-cell-21-75"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="annotated-cell-21-76"><a href="#annotated-cell-21-76"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-21-77"><a href="#annotated-cell-21-77"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-21-78"><a href="#annotated-cell-21-78"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-21-79"><a href="#annotated-cell-21-79"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-21-80"><a href="#annotated-cell-21-80"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-21-81"><a href="#annotated-cell-21-81"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-21-82"><a href="#annotated-cell-21-82"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-21-83"><a href="#annotated-cell-21-83"></a>        )</span>
<span id="annotated-cell-21-84"><a href="#annotated-cell-21-84"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-21-85"><a href="#annotated-cell-21-85"></a>      <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-21-86"><a href="#annotated-cell-21-86"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-21-87"><a href="#annotated-cell-21-87"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-21-88"><a href="#annotated-cell-21-88"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-21-89"><a href="#annotated-cell-21-89"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-21-90"><a href="#annotated-cell-21-90"></a>        <span class="at">title =</span> txts[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-21-91"><a href="#annotated-cell-21-91"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> txts[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-21-92"><a href="#annotated-cell-21-92"></a>      )</span>
<span id="annotated-cell-21-93"><a href="#annotated-cell-21-93"></a>  })</span>
<span id="annotated-cell-21-94"><a href="#annotated-cell-21-94"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="9,10,11" data-code-annotation="1">Store all relevant information, this includes: the region names, the department names and the variable values</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="14,15,16" data-code-annotation="2">In case the map is aggregated, the department names are going to be <code>NULL</code>. To prevent errors down the line, we replace it with <code>NA</code> the same length as the other vectors.</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="20,21" data-code-annotation="3">Then, we apply a function to the three vectors parallely, so that we can work with all label values at the same time</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="22" data-code-annotation="4">Create a table environment</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="24,31,38" data-code-annotation="5">Create three rows, one for each vector: regions, departments and values</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="26,33,40" data-code-annotation="6">The first cell is the left-hand side (e.g.&nbsp;“Department” or “Region”)</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="27,34,41" data-code-annotation="7">The second cell is the right-hand side (e.g.&nbsp;the department name)</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="55" data-code-annotation="8">Add the newly created labels to the <code>params()</code> list</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="75" data-code-annotation="9">Don’t forget to pass the labels to the leaflet maps using the <code>labels</code> parameter!</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_04.gif" class="img-fluid"></p>
</section>
<section id="full-code-4" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="full-code-4"><span class="header-section-number">7.3</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including a reactive Leaflet map with pretty hover labels</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb18-20"><a href="#cb18-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb18-23"><a href="#cb18-23"></a></span>
<span id="cb18-24"><a href="#cb18-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-26"><a href="#cb18-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb18-27"><a href="#cb18-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb18-28"><a href="#cb18-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb18-29"><a href="#cb18-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb18-30"><a href="#cb18-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb18-31"><a href="#cb18-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb18-32"><a href="#cb18-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb18-33"><a href="#cb18-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb18-34"><a href="#cb18-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb18-35"><a href="#cb18-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb18-36"><a href="#cb18-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb18-37"><a href="#cb18-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb18-38"><a href="#cb18-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb18-39"><a href="#cb18-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb18-40"><a href="#cb18-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb18-41"><a href="#cb18-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb18-42"><a href="#cb18-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb18-43"><a href="#cb18-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb18-44"><a href="#cb18-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb18-45"><a href="#cb18-45"></a>)</span>
<span id="cb18-46"><a href="#cb18-46"></a></span>
<span id="cb18-47"><a href="#cb18-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-48"><a href="#cb18-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb18-49"><a href="#cb18-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb18-50"><a href="#cb18-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb18-51"><a href="#cb18-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb18-52"><a href="#cb18-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-53"><a href="#cb18-53"></a>  ),</span>
<span id="cb18-54"><a href="#cb18-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb18-55"><a href="#cb18-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb18-56"><a href="#cb18-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb18-57"><a href="#cb18-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb18-58"><a href="#cb18-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-59"><a href="#cb18-59"></a>  ),</span>
<span id="cb18-60"><a href="#cb18-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb18-61"><a href="#cb18-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb18-62"><a href="#cb18-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb18-63"><a href="#cb18-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb18-64"><a href="#cb18-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb18-65"><a href="#cb18-65"></a>  ),</span>
<span id="cb18-66"><a href="#cb18-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb18-67"><a href="#cb18-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb18-68"><a href="#cb18-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb18-69"><a href="#cb18-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb18-70"><a href="#cb18-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-71"><a href="#cb18-71"></a>  ),</span>
<span id="cb18-72"><a href="#cb18-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb18-73"><a href="#cb18-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb18-74"><a href="#cb18-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb18-75"><a href="#cb18-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb18-76"><a href="#cb18-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-77"><a href="#cb18-77"></a>  ),</span>
<span id="cb18-78"><a href="#cb18-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb18-79"><a href="#cb18-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb18-80"><a href="#cb18-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb18-81"><a href="#cb18-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb18-82"><a href="#cb18-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-83"><a href="#cb18-83"></a>  ),</span>
<span id="cb18-84"><a href="#cb18-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb18-85"><a href="#cb18-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb18-86"><a href="#cb18-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb18-87"><a href="#cb18-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb18-88"><a href="#cb18-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-89"><a href="#cb18-89"></a>  ),</span>
<span id="cb18-90"><a href="#cb18-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb18-91"><a href="#cb18-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb18-92"><a href="#cb18-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb18-93"><a href="#cb18-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb18-94"><a href="#cb18-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-95"><a href="#cb18-95"></a>  ),</span>
<span id="cb18-96"><a href="#cb18-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb18-97"><a href="#cb18-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb18-98"><a href="#cb18-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb18-99"><a href="#cb18-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb18-100"><a href="#cb18-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-101"><a href="#cb18-101"></a>  ),</span>
<span id="cb18-102"><a href="#cb18-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb18-103"><a href="#cb18-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb18-104"><a href="#cb18-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb18-105"><a href="#cb18-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb18-106"><a href="#cb18-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb18-107"><a href="#cb18-107"></a>  ),</span>
<span id="cb18-108"><a href="#cb18-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb18-109"><a href="#cb18-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb18-110"><a href="#cb18-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb18-111"><a href="#cb18-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb18-112"><a href="#cb18-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-113"><a href="#cb18-113"></a>  ),</span>
<span id="cb18-114"><a href="#cb18-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb18-115"><a href="#cb18-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb18-116"><a href="#cb18-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb18-117"><a href="#cb18-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb18-118"><a href="#cb18-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-119"><a href="#cb18-119"></a>  ),</span>
<span id="cb18-120"><a href="#cb18-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb18-121"><a href="#cb18-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb18-122"><a href="#cb18-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb18-123"><a href="#cb18-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb18-124"><a href="#cb18-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-125"><a href="#cb18-125"></a>  ),</span>
<span id="cb18-126"><a href="#cb18-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb18-127"><a href="#cb18-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb18-128"><a href="#cb18-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb18-129"><a href="#cb18-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb18-130"><a href="#cb18-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-131"><a href="#cb18-131"></a>  ),</span>
<span id="cb18-132"><a href="#cb18-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb18-133"><a href="#cb18-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb18-134"><a href="#cb18-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb18-135"><a href="#cb18-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb18-136"><a href="#cb18-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-137"><a href="#cb18-137"></a>  ),</span>
<span id="cb18-138"><a href="#cb18-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb18-139"><a href="#cb18-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb18-140"><a href="#cb18-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb18-141"><a href="#cb18-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb18-142"><a href="#cb18-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-143"><a href="#cb18-143"></a>  ),</span>
<span id="cb18-144"><a href="#cb18-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb18-145"><a href="#cb18-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb18-146"><a href="#cb18-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb18-147"><a href="#cb18-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb18-148"><a href="#cb18-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb18-149"><a href="#cb18-149"></a>  ),</span>
<span id="cb18-150"><a href="#cb18-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb18-151"><a href="#cb18-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb18-152"><a href="#cb18-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb18-153"><a href="#cb18-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb18-154"><a href="#cb18-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb18-155"><a href="#cb18-155"></a>  ),</span>
<span id="cb18-156"><a href="#cb18-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb18-157"><a href="#cb18-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb18-158"><a href="#cb18-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb18-159"><a href="#cb18-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb18-160"><a href="#cb18-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb18-161"><a href="#cb18-161"></a>  )</span>
<span id="cb18-162"><a href="#cb18-162"></a>)</span>
<span id="cb18-163"><a href="#cb18-163"></a></span>
<span id="cb18-164"><a href="#cb18-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb18-165"><a href="#cb18-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-166"><a href="#cb18-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-167"><a href="#cb18-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-168"><a href="#cb18-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb18-169"><a href="#cb18-169"></a>    Region,</span>
<span id="cb18-170"><a href="#cb18-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb18-171"><a href="#cb18-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb18-172"><a href="#cb18-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb18-173"><a href="#cb18-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb18-174"><a href="#cb18-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb18-175"><a href="#cb18-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb18-176"><a href="#cb18-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-177"><a href="#cb18-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb18-178"><a href="#cb18-178"></a></span>
<span id="cb18-179"><a href="#cb18-179"></a></span>
<span id="cb18-180"><a href="#cb18-180"></a></span>
<span id="cb18-181"><a href="#cb18-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb18-182"><a href="#cb18-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb18-183"><a href="#cb18-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-184"><a href="#cb18-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb18-185"><a href="#cb18-185"></a></span>
<span id="cb18-186"><a href="#cb18-186"></a></span>
<span id="cb18-187"><a href="#cb18-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb18-188"><a href="#cb18-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb18-189"><a href="#cb18-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb18-190"><a href="#cb18-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb18-191"><a href="#cb18-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb18-192"><a href="#cb18-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb18-193"><a href="#cb18-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb18-194"><a href="#cb18-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb18-195"><a href="#cb18-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb18-196"><a href="#cb18-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb18-197"><a href="#cb18-197"></a>      }</span>
<span id="cb18-198"><a href="#cb18-198"></a>    }</span>
<span id="cb18-199"><a href="#cb18-199"></a>  ))</span>
<span id="cb18-200"><a href="#cb18-200"></a></span>
<span id="cb18-201"><a href="#cb18-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb18-202"><a href="#cb18-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb18-203"><a href="#cb18-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-204"><a href="#cb18-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb18-205"><a href="#cb18-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-206"><a href="#cb18-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb18-207"><a href="#cb18-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb18-208"><a href="#cb18-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb18-209"><a href="#cb18-209"></a>)</span>
<span id="cb18-210"><a href="#cb18-210"></a></span>
<span id="cb18-211"><a href="#cb18-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb18-212"><a href="#cb18-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb18-213"><a href="#cb18-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-214"><a href="#cb18-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb18-215"><a href="#cb18-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb18-216"><a href="#cb18-216"></a>)</span>
<span id="cb18-217"><a href="#cb18-217"></a></span>
<span id="cb18-218"><a href="#cb18-218"></a></span>
<span id="cb18-219"><a href="#cb18-219"></a></span>
<span id="cb18-220"><a href="#cb18-220"></a></span>
<span id="cb18-221"><a href="#cb18-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb18-222"><a href="#cb18-222"></a></span>
<span id="cb18-223"><a href="#cb18-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb18-224"><a href="#cb18-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb18-225"><a href="#cb18-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb18-226"><a href="#cb18-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb18-227"><a href="#cb18-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb18-228"><a href="#cb18-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb18-229"><a href="#cb18-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb18-230"><a href="#cb18-230"></a>    )</span>
<span id="cb18-231"><a href="#cb18-231"></a>  ),</span>
<span id="cb18-232"><a href="#cb18-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb18-233"><a href="#cb18-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb18-234"><a href="#cb18-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb18-235"><a href="#cb18-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb18-236"><a href="#cb18-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb18-237"><a href="#cb18-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb18-238"><a href="#cb18-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb18-239"><a href="#cb18-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb18-240"><a href="#cb18-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb18-241"><a href="#cb18-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb18-242"><a href="#cb18-242"></a>    ),</span>
<span id="cb18-243"><a href="#cb18-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-244"><a href="#cb18-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-245"><a href="#cb18-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-246"><a href="#cb18-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb18-247"><a href="#cb18-247"></a>  ),</span>
<span id="cb18-248"><a href="#cb18-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb18-249"><a href="#cb18-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb18-250"><a href="#cb18-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb18-251"><a href="#cb18-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb18-252"><a href="#cb18-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb18-253"><a href="#cb18-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb18-254"><a href="#cb18-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb18-255"><a href="#cb18-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb18-256"><a href="#cb18-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb18-257"><a href="#cb18-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb18-258"><a href="#cb18-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb18-259"><a href="#cb18-259"></a>        ),</span>
<span id="cb18-260"><a href="#cb18-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb18-261"><a href="#cb18-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb18-262"><a href="#cb18-262"></a>          <span class="fu">column</span>(</span>
<span id="cb18-263"><a href="#cb18-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb18-264"><a href="#cb18-264"></a>            <span class="fu">box</span>(</span>
<span id="cb18-265"><a href="#cb18-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb18-266"><a href="#cb18-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-267"><a href="#cb18-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-268"><a href="#cb18-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb18-269"><a href="#cb18-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb18-270"><a href="#cb18-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb18-271"><a href="#cb18-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb18-272"><a href="#cb18-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb18-273"><a href="#cb18-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb18-274"><a href="#cb18-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb18-275"><a href="#cb18-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb18-276"><a href="#cb18-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb18-277"><a href="#cb18-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb18-278"><a href="#cb18-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb18-279"><a href="#cb18-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb18-280"><a href="#cb18-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb18-281"><a href="#cb18-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb18-282"><a href="#cb18-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb18-283"><a href="#cb18-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb18-284"><a href="#cb18-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb18-285"><a href="#cb18-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb18-286"><a href="#cb18-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb18-287"><a href="#cb18-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb18-288"><a href="#cb18-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb18-289"><a href="#cb18-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb18-290"><a href="#cb18-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb18-291"><a href="#cb18-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb18-292"><a href="#cb18-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb18-293"><a href="#cb18-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-294"><a href="#cb18-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-295"><a href="#cb18-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb18-296"><a href="#cb18-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb18-297"><a href="#cb18-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb18-298"><a href="#cb18-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb18-299"><a href="#cb18-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb18-300"><a href="#cb18-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb18-301"><a href="#cb18-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb18-302"><a href="#cb18-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb18-303"><a href="#cb18-303"></a>                  )</span>
<span id="cb18-304"><a href="#cb18-304"></a>                ),</span>
<span id="cb18-305"><a href="#cb18-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb18-306"><a href="#cb18-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb18-307"><a href="#cb18-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-308"><a href="#cb18-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-309"><a href="#cb18-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb18-310"><a href="#cb18-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb18-311"><a href="#cb18-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb18-312"><a href="#cb18-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb18-313"><a href="#cb18-313"></a>                )</span>
<span id="cb18-314"><a href="#cb18-314"></a>              )</span>
<span id="cb18-315"><a href="#cb18-315"></a>            )</span>
<span id="cb18-316"><a href="#cb18-316"></a>          ),</span>
<span id="cb18-317"><a href="#cb18-317"></a>          <span class="fu">column</span>(</span>
<span id="cb18-318"><a href="#cb18-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb18-319"><a href="#cb18-319"></a>            <span class="fu">box</span>(</span>
<span id="cb18-320"><a href="#cb18-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb18-321"><a href="#cb18-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-322"><a href="#cb18-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-323"><a href="#cb18-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb18-324"><a href="#cb18-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb18-325"><a href="#cb18-325"></a>            )</span>
<span id="cb18-326"><a href="#cb18-326"></a>          )</span>
<span id="cb18-327"><a href="#cb18-327"></a>        )</span>
<span id="cb18-328"><a href="#cb18-328"></a>      ),</span>
<span id="cb18-329"><a href="#cb18-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb18-330"><a href="#cb18-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb18-331"><a href="#cb18-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb18-332"><a href="#cb18-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb18-333"><a href="#cb18-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb18-334"><a href="#cb18-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb18-335"><a href="#cb18-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb18-336"><a href="#cb18-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb18-337"><a href="#cb18-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb18-338"><a href="#cb18-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb18-339"><a href="#cb18-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-340"><a href="#cb18-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb18-341"><a href="#cb18-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-342"><a href="#cb18-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb18-343"><a href="#cb18-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb18-344"><a href="#cb18-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb18-345"><a href="#cb18-345"></a>            ),</span>
<span id="cb18-346"><a href="#cb18-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-347"><a href="#cb18-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb18-348"><a href="#cb18-348"></a>          )</span>
<span id="cb18-349"><a href="#cb18-349"></a>        ),</span>
<span id="cb18-350"><a href="#cb18-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb18-351"><a href="#cb18-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb18-352"><a href="#cb18-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb18-353"><a href="#cb18-353"></a>      ),</span>
<span id="cb18-354"><a href="#cb18-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb18-355"><a href="#cb18-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb18-356"><a href="#cb18-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb18-357"><a href="#cb18-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb18-358"><a href="#cb18-358"></a>          <span class="fu">column</span>(</span>
<span id="cb18-359"><a href="#cb18-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb18-360"><a href="#cb18-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb18-361"><a href="#cb18-361"></a>            <span class="fu">box</span>(</span>
<span id="cb18-362"><a href="#cb18-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-363"><a href="#cb18-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb18-364"><a href="#cb18-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-365"><a href="#cb18-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb18-366"><a href="#cb18-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb18-367"><a href="#cb18-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb18-368"><a href="#cb18-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb18-369"><a href="#cb18-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-370"><a href="#cb18-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb18-371"><a href="#cb18-371"></a>              ),</span>
<span id="cb18-372"><a href="#cb18-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb18-373"><a href="#cb18-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb18-374"><a href="#cb18-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb18-375"><a href="#cb18-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb18-376"><a href="#cb18-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb18-377"><a href="#cb18-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-378"><a href="#cb18-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-379"><a href="#cb18-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb18-380"><a href="#cb18-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb18-381"><a href="#cb18-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb18-382"><a href="#cb18-382"></a>                ),</span>
<span id="cb18-383"><a href="#cb18-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-384"><a href="#cb18-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb18-385"><a href="#cb18-385"></a>              ),</span>
<span id="cb18-386"><a href="#cb18-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb18-387"><a href="#cb18-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb18-388"><a href="#cb18-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb18-389"><a href="#cb18-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-390"><a href="#cb18-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-391"><a href="#cb18-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb18-392"><a href="#cb18-392"></a>              ),</span>
<span id="cb18-393"><a href="#cb18-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb18-394"><a href="#cb18-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb18-395"><a href="#cb18-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb18-396"><a href="#cb18-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb18-397"><a href="#cb18-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb18-398"><a href="#cb18-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb18-399"><a href="#cb18-399"></a>              )</span>
<span id="cb18-400"><a href="#cb18-400"></a>            ),</span>
<span id="cb18-401"><a href="#cb18-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb18-402"><a href="#cb18-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb18-403"><a href="#cb18-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-404"><a href="#cb18-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb18-405"><a href="#cb18-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb18-406"><a href="#cb18-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb18-407"><a href="#cb18-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-408"><a href="#cb18-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb18-409"><a href="#cb18-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-410"><a href="#cb18-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb18-411"><a href="#cb18-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb18-412"><a href="#cb18-412"></a>              ),</span>
<span id="cb18-413"><a href="#cb18-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb18-414"><a href="#cb18-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-415"><a href="#cb18-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb18-416"><a href="#cb18-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb18-417"><a href="#cb18-417"></a>              ),</span>
<span id="cb18-418"><a href="#cb18-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb18-419"><a href="#cb18-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-420"><a href="#cb18-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb18-421"><a href="#cb18-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb18-422"><a href="#cb18-422"></a>              )</span>
<span id="cb18-423"><a href="#cb18-423"></a>            )</span>
<span id="cb18-424"><a href="#cb18-424"></a>          ),</span>
<span id="cb18-425"><a href="#cb18-425"></a>          <span class="fu">column</span>(</span>
<span id="cb18-426"><a href="#cb18-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb18-427"><a href="#cb18-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb18-428"><a href="#cb18-428"></a>            <span class="fu">box</span>(</span>
<span id="cb18-429"><a href="#cb18-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-430"><a href="#cb18-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb18-431"><a href="#cb18-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-432"><a href="#cb18-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb18-433"><a href="#cb18-433"></a>            ),</span>
<span id="cb18-434"><a href="#cb18-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb18-435"><a href="#cb18-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb18-436"><a href="#cb18-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-437"><a href="#cb18-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb18-438"><a href="#cb18-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb18-439"><a href="#cb18-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-440"><a href="#cb18-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb18-441"><a href="#cb18-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-442"><a href="#cb18-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb18-443"><a href="#cb18-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb18-444"><a href="#cb18-444"></a>              ),</span>
<span id="cb18-445"><a href="#cb18-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-446"><a href="#cb18-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb18-447"><a href="#cb18-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb18-448"><a href="#cb18-448"></a>              ),</span>
<span id="cb18-449"><a href="#cb18-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb18-450"><a href="#cb18-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb18-451"><a href="#cb18-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb18-452"><a href="#cb18-452"></a>              )</span>
<span id="cb18-453"><a href="#cb18-453"></a>            )</span>
<span id="cb18-454"><a href="#cb18-454"></a>          )</span>
<span id="cb18-455"><a href="#cb18-455"></a>        )</span>
<span id="cb18-456"><a href="#cb18-456"></a>      ),</span>
<span id="cb18-457"><a href="#cb18-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb18-458"><a href="#cb18-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb18-459"><a href="#cb18-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb18-460"><a href="#cb18-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb18-461"><a href="#cb18-461"></a>          <span class="fu">column</span>(</span>
<span id="cb18-462"><a href="#cb18-462"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb18-463"><a href="#cb18-463"></a>            <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="cb18-464"><a href="#cb18-464"></a>            <span class="fu">box</span>(</span>
<span id="cb18-465"><a href="#cb18-465"></a>              <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="cb18-466"><a href="#cb18-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-467"><a href="#cb18-467"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-468"><a href="#cb18-468"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb18-469"><a href="#cb18-469"></a>                <span class="st">"tab_map_select"</span>,</span>
<span id="cb18-470"><a href="#cb18-470"></a>                <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="cb18-471"><a href="#cb18-471"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="cb18-472"><a href="#cb18-472"></a>              ),</span>
<span id="cb18-473"><a href="#cb18-473"></a>              <span class="fu">uiOutput</span>(<span class="st">"tab_map_desc"</span>)</span>
<span id="cb18-474"><a href="#cb18-474"></a>            ),</span>
<span id="cb18-475"><a href="#cb18-475"></a>            <span class="fu">box</span>(</span>
<span id="cb18-476"><a href="#cb18-476"></a>              <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="cb18-477"><a href="#cb18-477"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-478"><a href="#cb18-478"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-479"><a href="#cb18-479"></a>              <span class="fu">radioButtons</span>(</span>
<span id="cb18-480"><a href="#cb18-480"></a>                <span class="st">"tab_map_aggr"</span>,</span>
<span id="cb18-481"><a href="#cb18-481"></a>                <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="cb18-482"><a href="#cb18-482"></a>                <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="cb18-483"><a href="#cb18-483"></a>                <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="cb18-484"><a href="#cb18-484"></a>              ),</span>
<span id="cb18-485"><a href="#cb18-485"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb18-486"><a href="#cb18-486"></a>                <span class="st">"tab_map_pal"</span>,</span>
<span id="cb18-487"><a href="#cb18-487"></a>                <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="cb18-488"><a href="#cb18-488"></a>                <span class="at">choices =</span> pals,</span>
<span id="cb18-489"><a href="#cb18-489"></a>                <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="cb18-490"><a href="#cb18-490"></a>              ) <span class="co"># end input</span></span>
<span id="cb18-491"><a href="#cb18-491"></a>            ) <span class="co"># end box</span></span>
<span id="cb18-492"><a href="#cb18-492"></a>          ), <span class="co"># end column</span></span>
<span id="cb18-493"><a href="#cb18-493"></a>          <span class="fu">column</span>(</span>
<span id="cb18-494"><a href="#cb18-494"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb18-495"><a href="#cb18-495"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb18-496"><a href="#cb18-496"></a>            <span class="fu">box</span>(</span>
<span id="cb18-497"><a href="#cb18-497"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb18-498"><a href="#cb18-498"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb18-499"><a href="#cb18-499"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-500"><a href="#cb18-500"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-501"><a href="#cb18-501"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb18-502"><a href="#cb18-502"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb18-503"><a href="#cb18-503"></a>            ) <span class="co"># end box</span></span>
<span id="cb18-504"><a href="#cb18-504"></a>          ) <span class="co"># end column</span></span>
<span id="cb18-505"><a href="#cb18-505"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb18-506"><a href="#cb18-506"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb18-507"><a href="#cb18-507"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb18-508"><a href="#cb18-508"></a>  ),</span>
<span id="cb18-509"><a href="#cb18-509"></a>  </span>
<span id="cb18-510"><a href="#cb18-510"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb18-511"><a href="#cb18-511"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb18-512"><a href="#cb18-512"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb18-513"><a href="#cb18-513"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb18-514"><a href="#cb18-514"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb18-515"><a href="#cb18-515"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb18-516"><a href="#cb18-516"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb18-517"><a href="#cb18-517"></a>    )</span>
<span id="cb18-518"><a href="#cb18-518"></a>  ),</span>
<span id="cb18-519"><a href="#cb18-519"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb18-520"><a href="#cb18-520"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb18-521"><a href="#cb18-521"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb18-522"><a href="#cb18-522"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb18-523"><a href="#cb18-523"></a>  )  </span>
<span id="cb18-524"><a href="#cb18-524"></a>)</span>
<span id="cb18-525"><a href="#cb18-525"></a></span>
<span id="cb18-526"><a href="#cb18-526"></a></span>
<span id="cb18-527"><a href="#cb18-527"></a></span>
<span id="cb18-528"><a href="#cb18-528"></a><span class="co"># 4 Server ----</span></span>
<span id="cb18-529"><a href="#cb18-529"></a></span>
<span id="cb18-530"><a href="#cb18-530"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb18-531"><a href="#cb18-531"></a>  </span>
<span id="cb18-532"><a href="#cb18-532"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb18-533"><a href="#cb18-533"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb18-534"><a href="#cb18-534"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-535"><a href="#cb18-535"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb18-536"><a href="#cb18-536"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb18-537"><a href="#cb18-537"></a>    </span>
<span id="cb18-538"><a href="#cb18-538"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb18-539"><a href="#cb18-539"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb18-540"><a href="#cb18-540"></a>    }</span>
<span id="cb18-541"><a href="#cb18-541"></a>    </span>
<span id="cb18-542"><a href="#cb18-542"></a>    data_table</span>
<span id="cb18-543"><a href="#cb18-543"></a>  })</span>
<span id="cb18-544"><a href="#cb18-544"></a>  </span>
<span id="cb18-545"><a href="#cb18-545"></a>  </span>
<span id="cb18-546"><a href="#cb18-546"></a>  <span class="do">### Create table----</span></span>
<span id="cb18-547"><a href="#cb18-547"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-548"><a href="#cb18-548"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb18-549"><a href="#cb18-549"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb18-550"><a href="#cb18-550"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb18-551"><a href="#cb18-551"></a>      tab,</span>
<span id="cb18-552"><a href="#cb18-552"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb18-553"><a href="#cb18-553"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb18-554"><a href="#cb18-554"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb18-555"><a href="#cb18-555"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb18-556"><a href="#cb18-556"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb18-557"><a href="#cb18-557"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-558"><a href="#cb18-558"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb18-559"><a href="#cb18-559"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb18-560"><a href="#cb18-560"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-561"><a href="#cb18-561"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-562"><a href="#cb18-562"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb18-563"><a href="#cb18-563"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb18-564"><a href="#cb18-564"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb18-565"><a href="#cb18-565"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb18-566"><a href="#cb18-566"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb18-567"><a href="#cb18-567"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb18-568"><a href="#cb18-568"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb18-569"><a href="#cb18-569"></a><span class="st">  </span></span>
<span id="cb18-570"><a href="#cb18-570"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb18-571"><a href="#cb18-571"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb18-572"><a href="#cb18-572"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb18-573"><a href="#cb18-573"></a><span class="st">            );</span></span>
<span id="cb18-574"><a href="#cb18-574"></a><span class="st">          }</span></span>
<span id="cb18-575"><a href="#cb18-575"></a><span class="st">        "</span>))</span>
<span id="cb18-576"><a href="#cb18-576"></a>        )</span>
<span id="cb18-577"><a href="#cb18-577"></a>      )</span>
<span id="cb18-578"><a href="#cb18-578"></a>    )</span>
<span id="cb18-579"><a href="#cb18-579"></a>  })</span>
<span id="cb18-580"><a href="#cb18-580"></a>  </span>
<span id="cb18-581"><a href="#cb18-581"></a>  <span class="do">### Render table----</span></span>
<span id="cb18-582"><a href="#cb18-582"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-583"><a href="#cb18-583"></a>  </span>
<span id="cb18-584"><a href="#cb18-584"></a>  </span>
<span id="cb18-585"><a href="#cb18-585"></a>  </span>
<span id="cb18-586"><a href="#cb18-586"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb18-587"><a href="#cb18-587"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb18-588"><a href="#cb18-588"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-589"><a href="#cb18-589"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb18-590"><a href="#cb18-590"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb18-591"><a href="#cb18-591"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb18-592"><a href="#cb18-592"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb18-593"><a href="#cb18-593"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb18-594"><a href="#cb18-594"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb18-595"><a href="#cb18-595"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb18-596"><a href="#cb18-596"></a>    </span>
<span id="cb18-597"><a href="#cb18-597"></a>    <span class="fu">list</span>(</span>
<span id="cb18-598"><a href="#cb18-598"></a>      <span class="at">x =</span> x,</span>
<span id="cb18-599"><a href="#cb18-599"></a>      <span class="at">y =</span> y,</span>
<span id="cb18-600"><a href="#cb18-600"></a>      <span class="at">data =</span> dt,</span>
<span id="cb18-601"><a href="#cb18-601"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb18-602"><a href="#cb18-602"></a>      <span class="at">model =</span> mod</span>
<span id="cb18-603"><a href="#cb18-603"></a>    )</span>
<span id="cb18-604"><a href="#cb18-604"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb18-605"><a href="#cb18-605"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-606"><a href="#cb18-606"></a>  </span>
<span id="cb18-607"><a href="#cb18-607"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb18-608"><a href="#cb18-608"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb18-609"><a href="#cb18-609"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-610"><a href="#cb18-610"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb18-611"><a href="#cb18-611"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb18-612"><a href="#cb18-612"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb18-613"><a href="#cb18-613"></a>      params<span class="sc">$</span>data,</span>
<span id="cb18-614"><a href="#cb18-614"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb18-615"><a href="#cb18-615"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb18-616"><a href="#cb18-616"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb18-617"><a href="#cb18-617"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb18-618"><a href="#cb18-618"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb18-619"><a href="#cb18-619"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb18-620"><a href="#cb18-620"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb18-621"><a href="#cb18-621"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb18-622"><a href="#cb18-622"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb18-623"><a href="#cb18-623"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb18-624"><a href="#cb18-624"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb18-625"><a href="#cb18-625"></a>            ))</span>
<span id="cb18-626"><a href="#cb18-626"></a>        }</span>
<span id="cb18-627"><a href="#cb18-627"></a>      )</span>
<span id="cb18-628"><a href="#cb18-628"></a>    )</span>
<span id="cb18-629"><a href="#cb18-629"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-630"><a href="#cb18-630"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-631"><a href="#cb18-631"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-632"><a href="#cb18-632"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-633"><a href="#cb18-633"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-634"><a href="#cb18-634"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-635"><a href="#cb18-635"></a>  })</span>
<span id="cb18-636"><a href="#cb18-636"></a>  </span>
<span id="cb18-637"><a href="#cb18-637"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb18-638"><a href="#cb18-638"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb18-639"><a href="#cb18-639"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-640"><a href="#cb18-640"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb18-641"><a href="#cb18-641"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb18-642"><a href="#cb18-642"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb18-643"><a href="#cb18-643"></a>    </span>
<span id="cb18-644"><a href="#cb18-644"></a>    </span>
<span id="cb18-645"><a href="#cb18-645"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb18-646"><a href="#cb18-646"></a>    </span>
<span id="cb18-647"><a href="#cb18-647"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-648"><a href="#cb18-648"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb18-649"><a href="#cb18-649"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-650"><a href="#cb18-650"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-651"><a href="#cb18-651"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-652"><a href="#cb18-652"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-653"><a href="#cb18-653"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-654"><a href="#cb18-654"></a>  })</span>
<span id="cb18-655"><a href="#cb18-655"></a>  </span>
<span id="cb18-656"><a href="#cb18-656"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb18-657"><a href="#cb18-657"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb18-658"><a href="#cb18-658"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-659"><a href="#cb18-659"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb18-660"><a href="#cb18-660"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb18-661"><a href="#cb18-661"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb18-662"><a href="#cb18-662"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb18-663"><a href="#cb18-663"></a>    </span>
<span id="cb18-664"><a href="#cb18-664"></a>    </span>
<span id="cb18-665"><a href="#cb18-665"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb18-666"><a href="#cb18-666"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb18-667"><a href="#cb18-667"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb18-668"><a href="#cb18-668"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb18-669"><a href="#cb18-669"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb18-670"><a href="#cb18-670"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb18-671"><a href="#cb18-671"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb18-672"><a href="#cb18-672"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb18-673"><a href="#cb18-673"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb18-674"><a href="#cb18-674"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb18-675"><a href="#cb18-675"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb18-676"><a href="#cb18-676"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb18-677"><a href="#cb18-677"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-678"><a href="#cb18-678"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-679"><a href="#cb18-679"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-680"><a href="#cb18-680"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb18-681"><a href="#cb18-681"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb18-682"><a href="#cb18-682"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb18-683"><a href="#cb18-683"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb18-684"><a href="#cb18-684"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb18-685"><a href="#cb18-685"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-686"><a href="#cb18-686"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-687"><a href="#cb18-687"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb18-688"><a href="#cb18-688"></a>      </span>
<span id="cb18-689"><a href="#cb18-689"></a>    }</span>
<span id="cb18-690"><a href="#cb18-690"></a>    </span>
<span id="cb18-691"><a href="#cb18-691"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-692"><a href="#cb18-692"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb18-693"><a href="#cb18-693"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-694"><a href="#cb18-694"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-695"><a href="#cb18-695"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-696"><a href="#cb18-696"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-697"><a href="#cb18-697"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-698"><a href="#cb18-698"></a>  })</span>
<span id="cb18-699"><a href="#cb18-699"></a>  </span>
<span id="cb18-700"><a href="#cb18-700"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb18-701"><a href="#cb18-701"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb18-702"><a href="#cb18-702"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-703"><a href="#cb18-703"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb18-704"><a href="#cb18-704"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb18-705"><a href="#cb18-705"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb18-706"><a href="#cb18-706"></a>    ))</span>
<span id="cb18-707"><a href="#cb18-707"></a>  })</span>
<span id="cb18-708"><a href="#cb18-708"></a>  </span>
<span id="cb18-709"><a href="#cb18-709"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb18-710"><a href="#cb18-710"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb18-711"><a href="#cb18-711"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-712"><a href="#cb18-712"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb18-713"><a href="#cb18-713"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-714"><a href="#cb18-714"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-715"><a href="#cb18-715"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-716"><a href="#cb18-716"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-717"><a href="#cb18-717"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-718"><a href="#cb18-718"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-719"><a href="#cb18-719"></a>  })</span>
<span id="cb18-720"><a href="#cb18-720"></a>  </span>
<span id="cb18-721"><a href="#cb18-721"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb18-722"><a href="#cb18-722"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb18-723"><a href="#cb18-723"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-724"><a href="#cb18-724"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-725"><a href="#cb18-725"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-726"><a href="#cb18-726"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-727"><a href="#cb18-727"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-728"><a href="#cb18-728"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb18-729"><a href="#cb18-729"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-730"><a href="#cb18-730"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-731"><a href="#cb18-731"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-732"><a href="#cb18-732"></a>  })</span>
<span id="cb18-733"><a href="#cb18-733"></a>  </span>
<span id="cb18-734"><a href="#cb18-734"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb18-735"><a href="#cb18-735"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb18-736"><a href="#cb18-736"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb18-737"><a href="#cb18-737"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb18-738"><a href="#cb18-738"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb18-739"><a href="#cb18-739"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb18-740"><a href="#cb18-740"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb18-741"><a href="#cb18-741"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb18-742"><a href="#cb18-742"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb18-743"><a href="#cb18-743"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb18-744"><a href="#cb18-744"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-745"><a href="#cb18-745"></a>  })</span>
<span id="cb18-746"><a href="#cb18-746"></a>  </span>
<span id="cb18-747"><a href="#cb18-747"></a>  </span>
<span id="cb18-748"><a href="#cb18-748"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb18-749"><a href="#cb18-749"></a>  </span>
<span id="cb18-750"><a href="#cb18-750"></a>  <span class="co"># Render description of selected variable</span></span>
<span id="cb18-751"><a href="#cb18-751"></a>  output<span class="sc">$</span>tab_map_desc <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb18-752"><a href="#cb18-752"></a>    <span class="fu">HTML</span>(variable_desc[[input<span class="sc">$</span>tab_map_select]]<span class="sc">$</span>desc)</span>
<span id="cb18-753"><a href="#cb18-753"></a>  })</span>
<span id="cb18-754"><a href="#cb18-754"></a>  </span>
<span id="cb18-755"><a href="#cb18-755"></a>  <span class="co"># Select polygon based on aggregation level</span></span>
<span id="cb18-756"><a href="#cb18-756"></a>  poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-757"><a href="#cb18-757"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="cb18-758"><a href="#cb18-758"></a>      data_guerry_region</span>
<span id="cb18-759"><a href="#cb18-759"></a>    } <span class="cf">else</span> {</span>
<span id="cb18-760"><a href="#cb18-760"></a>      data_guerry</span>
<span id="cb18-761"><a href="#cb18-761"></a>    }</span>
<span id="cb18-762"><a href="#cb18-762"></a>  })</span>
<span id="cb18-763"><a href="#cb18-763"></a>  </span>
<span id="cb18-764"><a href="#cb18-764"></a>  <span class="co"># Select palette based on input</span></span>
<span id="cb18-765"><a href="#cb18-765"></a>  palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-766"><a href="#cb18-766"></a>    pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="cb18-767"><a href="#cb18-767"></a>    <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="cb18-768"><a href="#cb18-768"></a>      pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="cb18-769"><a href="#cb18-769"></a>    }</span>
<span id="cb18-770"><a href="#cb18-770"></a>    pal</span>
<span id="cb18-771"><a href="#cb18-771"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb18-772"><a href="#cb18-772"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>tab_map_pal)</span>
<span id="cb18-773"><a href="#cb18-773"></a>  </span>
<span id="cb18-774"><a href="#cb18-774"></a>  <span class="co"># Compile parameters for leaflet rendering</span></span>
<span id="cb18-775"><a href="#cb18-775"></a>  params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb18-776"><a href="#cb18-776"></a>    poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="cb18-777"><a href="#cb18-777"></a>    pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb18-778"><a href="#cb18-778"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="cb18-779"><a href="#cb18-779"></a>    </span>
<span id="cb18-780"><a href="#cb18-780"></a>    values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="cb18-781"><a href="#cb18-781"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="cb18-782"><a href="#cb18-782"></a>    </span>
<span id="cb18-783"><a href="#cb18-783"></a>    reg <span class="ot">&lt;-</span> poly[[<span class="st">"Region"</span>]]</span>
<span id="cb18-784"><a href="#cb18-784"></a>    dep <span class="ot">&lt;-</span> poly[[<span class="st">"Department"</span>]]</span>
<span id="cb18-785"><a href="#cb18-785"></a>    val <span class="ot">&lt;-</span> poly[[var]]</span>
<span id="cb18-786"><a href="#cb18-786"></a>    </span>
<span id="cb18-787"><a href="#cb18-787"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(dep)) {</span>
<span id="cb18-788"><a href="#cb18-788"></a>      dep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(poly))</span>
<span id="cb18-789"><a href="#cb18-789"></a>    }</span>
<span id="cb18-790"><a href="#cb18-790"></a>    </span>
<span id="cb18-791"><a href="#cb18-791"></a>    <span class="co"># Create labels that are nicely aligned in a grid</span></span>
<span id="cb18-792"><a href="#cb18-792"></a>    labels <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb18-793"><a href="#cb18-793"></a>      <span class="cf">function</span>(reg, dep, val) {</span>
<span id="cb18-794"><a href="#cb18-794"></a>        <span class="fu">HTML</span>(<span class="fu">as.character</span>(tags<span class="sc">$</span><span class="fu">table</span>(</span>
<span id="cb18-795"><a href="#cb18-795"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb18-796"><a href="#cb18-796"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb18-797"><a href="#cb18-797"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Region: "</span>)),</span>
<span id="cb18-798"><a href="#cb18-798"></a>            tags<span class="sc">$</span><span class="fu">td</span>(reg)</span>
<span id="cb18-799"><a href="#cb18-799"></a>          ),</span>
<span id="cb18-800"><a href="#cb18-800"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(dep)) {</span>
<span id="cb18-801"><a href="#cb18-801"></a>            tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb18-802"><a href="#cb18-802"></a>              <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb18-803"><a href="#cb18-803"></a>              tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Department: "</span>)),</span>
<span id="cb18-804"><a href="#cb18-804"></a>              tags<span class="sc">$</span><span class="fu">td</span>(dep)</span>
<span id="cb18-805"><a href="#cb18-805"></a>            )</span>
<span id="cb18-806"><a href="#cb18-806"></a>          },</span>
<span id="cb18-807"><a href="#cb18-807"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb18-808"><a href="#cb18-808"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb18-809"><a href="#cb18-809"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="fu">paste0</span>(variable_desc[[var]]<span class="sc">$</span>lgd, <span class="st">": "</span>))),</span>
<span id="cb18-810"><a href="#cb18-810"></a>            tags<span class="sc">$</span><span class="fu">td</span>(<span class="fu">round</span>(val, <span class="dv">2</span>))</span>
<span id="cb18-811"><a href="#cb18-811"></a>          )</span>
<span id="cb18-812"><a href="#cb18-812"></a>        )))</span>
<span id="cb18-813"><a href="#cb18-813"></a>      },</span>
<span id="cb18-814"><a href="#cb18-814"></a>      <span class="at">reg =</span> reg, <span class="at">dep =</span> dep, <span class="at">val =</span> val,</span>
<span id="cb18-815"><a href="#cb18-815"></a>      <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-816"><a href="#cb18-816"></a>      <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span></span>
<span id="cb18-817"><a href="#cb18-817"></a>    )</span>
<span id="cb18-818"><a href="#cb18-818"></a>    </span>
<span id="cb18-819"><a href="#cb18-819"></a>    <span class="fu">list</span>(</span>
<span id="cb18-820"><a href="#cb18-820"></a>      <span class="at">poly =</span> poly,</span>
<span id="cb18-821"><a href="#cb18-821"></a>      <span class="at">var =</span> var,</span>
<span id="cb18-822"><a href="#cb18-822"></a>      <span class="at">pal =</span> pal,</span>
<span id="cb18-823"><a href="#cb18-823"></a>      <span class="at">values =</span> values,</span>
<span id="cb18-824"><a href="#cb18-824"></a>      <span class="at">labels =</span> labels</span>
<span id="cb18-825"><a href="#cb18-825"></a>    )</span>
<span id="cb18-826"><a href="#cb18-826"></a>  })</span>
<span id="cb18-827"><a href="#cb18-827"></a>  </span>
<span id="cb18-828"><a href="#cb18-828"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="cb18-829"><a href="#cb18-829"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb18-830"><a href="#cb18-830"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="cb18-831"><a href="#cb18-831"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="cb18-832"><a href="#cb18-832"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-833"><a href="#cb18-833"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-834"><a href="#cb18-834"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-835"><a href="#cb18-835"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-836"><a href="#cb18-836"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="cb18-837"><a href="#cb18-837"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-838"><a href="#cb18-838"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-839"><a href="#cb18-839"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb18-840"><a href="#cb18-840"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="cb18-841"><a href="#cb18-841"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb18-842"><a href="#cb18-842"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb18-843"><a href="#cb18-843"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb18-844"><a href="#cb18-844"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-845"><a href="#cb18-845"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="cb18-846"><a href="#cb18-846"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb18-847"><a href="#cb18-847"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb18-848"><a href="#cb18-848"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb18-849"><a href="#cb18-849"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb18-850"><a href="#cb18-850"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb18-851"><a href="#cb18-851"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-852"><a href="#cb18-852"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb18-853"><a href="#cb18-853"></a>        )</span>
<span id="cb18-854"><a href="#cb18-854"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb18-855"><a href="#cb18-855"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb18-856"><a href="#cb18-856"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb18-857"><a href="#cb18-857"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="cb18-858"><a href="#cb18-858"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="cb18-859"><a href="#cb18-859"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb18-860"><a href="#cb18-860"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="cb18-861"><a href="#cb18-861"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="cb18-862"><a href="#cb18-862"></a>      )</span>
<span id="cb18-863"><a href="#cb18-863"></a>  })</span>
<span id="cb18-864"><a href="#cb18-864"></a>}</span>
<span id="cb18-865"><a href="#cb18-865"></a></span>
<span id="cb18-866"><a href="#cb18-866"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="appendix-add-proxies" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Appendix: Add proxies</h1>
<ul>
<li>The map already looks quite polished!</li>
<li>One more problem: Map updates!</li>
<li>Map re-renders every time an input is invalidated:
<ul>
<li>Everything needs to be redrawn = slow for large datasets</li>
<li>Map view resets with every update:</li>
</ul></li>
</ul>
<p><img src="resources/06_05.gif" class="img-fluid"></p>
<section id="what-are-proxies" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="what-are-proxies"><span class="header-section-number">8.1</span> What are proxies?</h2>
<ul>
<li>Solution: Proxies</li>
<li>Proxy objects are representations of existing widgets that can manipulate widgets in place</li>
</ul>
</section>
<section id="proxies-in-shiny-extensions" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="proxies-in-shiny-extensions"><span class="header-section-number">8.2</span> Proxies in Shiny extensions</h2>
<ul>
<li>Many Shiny extensions provide proxy functions:
<ul>
<li><a href="https://rdrr.io/cran/DT/man/proxy.html"><code>DT::dataTableProxy()</code></a></li>
<li><a href="https://rdrr.io/cran/plotly/man/plotlyProxy.html"><code>plotly::plotlyProxy()</code></a></li>
<li><a href="https://rdrr.io/cran/leaflet/man/leafletProxy.html"><code>leaflet::leafletProxy()</code></a></li>
</ul></li>
</ul>
</section>
<section id="proxy-workflow" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="proxy-workflow"><span class="header-section-number">8.3</span> Proxy workflow</h2>
<ol type="1">
<li>Initialize an isolated output widget (i.e., no dependencies) / <code>output$tab_map_map</code></li>
<li>Create an observer that updates input dependencies / <code>observe()</code></li>
<li>Invalidate an input</li>
<li>Remove existing features and add new ones</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/proxies.svg" class="img-fluid figure-img"></p>
<figcaption>Reactive graph for proxies</figcaption>
</figure>
</div>
</section>
<section id="isolate-reactive-objects" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="isolate-reactive-objects"><span class="header-section-number">8.4</span> Isolate reactive objects</h2>
<ul>
<li>To create an isolated output widget, we use the <code>isolate()</code> function from Shiny
<ul>
<li>The <code>params()</code> reactive is executed only <em>once</em>, but does take a dependency</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-23"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-23-1"><a href="#annotated-cell-23-1"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="annotated-cell-23-2"><a href="#annotated-cell-23-2"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-23" data-target-annotation="1">1</button><span id="annotated-cell-23-3" class="code-annotation-target"><a href="#annotated-cell-23-3"></a>    params <span class="ot">&lt;-</span> <span class="fu">isolate</span>(<span class="fu">params</span>())</span>
<span id="annotated-cell-23-4"><a href="#annotated-cell-23-4"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-5"><a href="#annotated-cell-23-5"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-6"><a href="#annotated-cell-23-6"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-7"><a href="#annotated-cell-23-7"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-8"><a href="#annotated-cell-23-8"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-9"><a href="#annotated-cell-23-9"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-23-10"><a href="#annotated-cell-23-10"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-11"><a href="#annotated-cell-23-11"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-12"><a href="#annotated-cell-23-12"></a>      <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-23-13"><a href="#annotated-cell-23-13"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-23-14"><a href="#annotated-cell-23-14"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-23-15"><a href="#annotated-cell-23-15"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-23-16"><a href="#annotated-cell-23-16"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-23-17"><a href="#annotated-cell-23-17"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-23-18"><a href="#annotated-cell-23-18"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="annotated-cell-23-19"><a href="#annotated-cell-23-19"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-23-20"><a href="#annotated-cell-23-20"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-23-21"><a href="#annotated-cell-23-21"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-23-22"><a href="#annotated-cell-23-22"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-23-23"><a href="#annotated-cell-23-23"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-23-24"><a href="#annotated-cell-23-24"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-23-25"><a href="#annotated-cell-23-25"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-23-26"><a href="#annotated-cell-23-26"></a>        )</span>
<span id="annotated-cell-23-27"><a href="#annotated-cell-23-27"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-23-28"><a href="#annotated-cell-23-28"></a>      <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-23-29"><a href="#annotated-cell-23-29"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-23-30"><a href="#annotated-cell-23-30"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-23-31"><a href="#annotated-cell-23-31"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-23-32"><a href="#annotated-cell-23-32"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-23-33"><a href="#annotated-cell-23-33"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-23-34"><a href="#annotated-cell-23-34"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-23-35"><a href="#annotated-cell-23-35"></a>      )</span>
<span id="annotated-cell-23-36"><a href="#annotated-cell-23-36"></a>  })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="3" data-code-annotation="1">Most of the code remains the same. However, we isolate the call to <code>params()</code> to prevent the rendering function to execute every time <code>params()</code> is invalidated. No dependency is taken!</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="implement-proxies" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="implement-proxies"><span class="header-section-number">8.5</span> Implement proxies</h2>
<ul>
<li>Instead, we create an observer that updates the map layers <em>in place</em></li>
<li>First, all existing features that are to be changed are cleared</li>
<li>Second, new features are added in the usual piping manner</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-24"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1">1</button><span id="annotated-cell-24-1" class="code-annotation-target"><a href="#annotated-cell-24-1"></a>  <span class="fu">observe</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="2">2</button><span id="annotated-cell-24-2" class="code-annotation-target"><a href="#annotated-cell-24-2"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="3">3</button><span id="annotated-cell-24-3" class="code-annotation-target"><a href="#annotated-cell-24-3"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>, <span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="4">4</button><span id="annotated-cell-24-4" class="code-annotation-target"><a href="#annotated-cell-24-4"></a>      <span class="fu">clearShapes</span>() <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-24-5"><a href="#annotated-cell-24-5"></a>      <span class="fu">clearControls</span>() <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="5">5</button><span id="annotated-cell-24-6" class="code-annotation-target"><a href="#annotated-cell-24-6"></a>      <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-24-7"><a href="#annotated-cell-24-7"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-24-8"><a href="#annotated-cell-24-8"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-24-9"><a href="#annotated-cell-24-9"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-24-10"><a href="#annotated-cell-24-10"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-24-12"><a href="#annotated-cell-24-12"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-24-14"><a href="#annotated-cell-24-14"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-24-15"><a href="#annotated-cell-24-15"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-24-16"><a href="#annotated-cell-24-16"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-24-17"><a href="#annotated-cell-24-17"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-24-18"><a href="#annotated-cell-24-18"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-24-19"><a href="#annotated-cell-24-19"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-24-20"><a href="#annotated-cell-24-20"></a>        )</span>
<span id="annotated-cell-24-21"><a href="#annotated-cell-24-21"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-24-22"><a href="#annotated-cell-24-22"></a>      <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-24-23"><a href="#annotated-cell-24-23"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-24-24"><a href="#annotated-cell-24-24"></a>        <span class="at">na.label =</span> <span class="st">"No data"</span>,</span>
<span id="annotated-cell-24-25"><a href="#annotated-cell-24-25"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-24-26"><a href="#annotated-cell-24-26"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-24-27"><a href="#annotated-cell-24-27"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-24-28"><a href="#annotated-cell-24-28"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-24-29"><a href="#annotated-cell-24-29"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-24-30"><a href="#annotated-cell-24-30"></a>      )</span>
<span id="annotated-cell-24-31"><a href="#annotated-cell-24-31"></a>  })</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="1" data-code-annotation="1">Proxies work with observers. There is no need to use a rendering function as the widget is re-rendered but an existing widget is updated.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="2" data-code-annotation="2"><code>params()</code> can be called without isolation here!</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="3" data-code-annotation="3">Create a leaflet proxy. Proxies update map values without re-rendering the entire map, thus increasing performance.</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="4,5" data-code-annotation="4">Remove existing layers because we don’t want to stack layers infinitely</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31" data-code-annotation="5">Add new layers in the same way you would with a normal leaflet map</span>
</dd>
</dl>
</div>
</div>
</section>
<section id="what-changed" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="what-changed"><span class="header-section-number">8.6</span> What changed?</h2>
<ul>
<li>The output now:
<ul>
<li>Does not re-render from scratch - saving time and resources</li>
<li>Does not reset the map - making exploration more seamless</li>
</ul></li>
</ul>
<p><img src="resources/06_06.gif" class="img-fluid"></p>
</section>
<section id="full-code-5" class="level2" data-number="8.7">
<h2 data-number="8.7" class="anchored" data-anchor-id="full-code-5"><span class="header-section-number">8.7</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including a reactive Leaflet proxies</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="fu">library</span>(fresh)</span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="fu">library</span>(waiter)</span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="fu">library</span>(sf)</span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="fu">library</span>(viridis)</span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb19-14"><a href="#cb19-14"></a><span class="fu">library</span>(plotly)</span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-16"><a href="#cb19-16"></a><span class="fu">library</span>(GGally)</span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="fu">library</span>(parameters)</span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="fu">library</span>(performance)</span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb19-21"><a href="#cb19-21"></a></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="cb19-23"><a href="#cb19-23"></a></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="cb19-25"><a href="#cb19-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-26"><a href="#cb19-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="cb19-27"><a href="#cb19-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="cb19-28"><a href="#cb19-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="cb19-29"><a href="#cb19-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="cb19-30"><a href="#cb19-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="cb19-31"><a href="#cb19-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="cb19-32"><a href="#cb19-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="cb19-33"><a href="#cb19-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="cb19-34"><a href="#cb19-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="cb19-35"><a href="#cb19-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="cb19-36"><a href="#cb19-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="cb19-37"><a href="#cb19-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="cb19-38"><a href="#cb19-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="cb19-39"><a href="#cb19-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="cb19-40"><a href="#cb19-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="cb19-41"><a href="#cb19-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="cb19-42"><a href="#cb19-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="cb19-43"><a href="#cb19-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="cb19-44"><a href="#cb19-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="cb19-45"><a href="#cb19-45"></a>)</span>
<span id="cb19-46"><a href="#cb19-46"></a></span>
<span id="cb19-47"><a href="#cb19-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-48"><a href="#cb19-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="cb19-49"><a href="#cb19-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="cb19-50"><a href="#cb19-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="cb19-51"><a href="#cb19-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb19-52"><a href="#cb19-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-53"><a href="#cb19-53"></a>  ),</span>
<span id="cb19-54"><a href="#cb19-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="cb19-55"><a href="#cb19-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="cb19-56"><a href="#cb19-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="cb19-57"><a href="#cb19-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="cb19-58"><a href="#cb19-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-59"><a href="#cb19-59"></a>  ),</span>
<span id="cb19-60"><a href="#cb19-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="cb19-61"><a href="#cb19-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb19-62"><a href="#cb19-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="cb19-63"><a href="#cb19-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="cb19-64"><a href="#cb19-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb19-65"><a href="#cb19-65"></a>  ),</span>
<span id="cb19-66"><a href="#cb19-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="cb19-67"><a href="#cb19-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="cb19-68"><a href="#cb19-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="cb19-69"><a href="#cb19-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="cb19-70"><a href="#cb19-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-71"><a href="#cb19-71"></a>  ),</span>
<span id="cb19-72"><a href="#cb19-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="cb19-73"><a href="#cb19-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="cb19-74"><a href="#cb19-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="cb19-75"><a href="#cb19-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="cb19-76"><a href="#cb19-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-77"><a href="#cb19-77"></a>  ),</span>
<span id="cb19-78"><a href="#cb19-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="cb19-79"><a href="#cb19-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="cb19-80"><a href="#cb19-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="cb19-81"><a href="#cb19-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="cb19-82"><a href="#cb19-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-83"><a href="#cb19-83"></a>  ),</span>
<span id="cb19-84"><a href="#cb19-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="cb19-85"><a href="#cb19-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb19-86"><a href="#cb19-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb19-87"><a href="#cb19-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="cb19-88"><a href="#cb19-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-89"><a href="#cb19-89"></a>  ),</span>
<span id="cb19-90"><a href="#cb19-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="cb19-91"><a href="#cb19-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="cb19-92"><a href="#cb19-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="cb19-93"><a href="#cb19-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="cb19-94"><a href="#cb19-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-95"><a href="#cb19-95"></a>  ),</span>
<span id="cb19-96"><a href="#cb19-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="cb19-97"><a href="#cb19-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="cb19-98"><a href="#cb19-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="cb19-99"><a href="#cb19-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="cb19-100"><a href="#cb19-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-101"><a href="#cb19-101"></a>  ),</span>
<span id="cb19-102"><a href="#cb19-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="cb19-103"><a href="#cb19-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="cb19-104"><a href="#cb19-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb19-105"><a href="#cb19-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="cb19-106"><a href="#cb19-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="cb19-107"><a href="#cb19-107"></a>  ),</span>
<span id="cb19-108"><a href="#cb19-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="cb19-109"><a href="#cb19-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="cb19-110"><a href="#cb19-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="cb19-111"><a href="#cb19-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="cb19-112"><a href="#cb19-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-113"><a href="#cb19-113"></a>  ),</span>
<span id="cb19-114"><a href="#cb19-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="cb19-115"><a href="#cb19-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="cb19-116"><a href="#cb19-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="cb19-117"><a href="#cb19-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="cb19-118"><a href="#cb19-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-119"><a href="#cb19-119"></a>  ),</span>
<span id="cb19-120"><a href="#cb19-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="cb19-121"><a href="#cb19-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="cb19-122"><a href="#cb19-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="cb19-123"><a href="#cb19-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="cb19-124"><a href="#cb19-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-125"><a href="#cb19-125"></a>  ),</span>
<span id="cb19-126"><a href="#cb19-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="cb19-127"><a href="#cb19-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="cb19-128"><a href="#cb19-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="cb19-129"><a href="#cb19-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="cb19-130"><a href="#cb19-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-131"><a href="#cb19-131"></a>  ),</span>
<span id="cb19-132"><a href="#cb19-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="cb19-133"><a href="#cb19-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb19-134"><a href="#cb19-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="cb19-135"><a href="#cb19-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="cb19-136"><a href="#cb19-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-137"><a href="#cb19-137"></a>  ),</span>
<span id="cb19-138"><a href="#cb19-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="cb19-139"><a href="#cb19-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="cb19-140"><a href="#cb19-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="cb19-141"><a href="#cb19-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="cb19-142"><a href="#cb19-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-143"><a href="#cb19-143"></a>  ),</span>
<span id="cb19-144"><a href="#cb19-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="cb19-145"><a href="#cb19-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="cb19-146"><a href="#cb19-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="cb19-147"><a href="#cb19-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="cb19-148"><a href="#cb19-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="cb19-149"><a href="#cb19-149"></a>  ),</span>
<span id="cb19-150"><a href="#cb19-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="cb19-151"><a href="#cb19-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="cb19-152"><a href="#cb19-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="cb19-153"><a href="#cb19-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="cb19-154"><a href="#cb19-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="cb19-155"><a href="#cb19-155"></a>  ),</span>
<span id="cb19-156"><a href="#cb19-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="cb19-157"><a href="#cb19-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="cb19-158"><a href="#cb19-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="cb19-159"><a href="#cb19-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="cb19-160"><a href="#cb19-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="cb19-161"><a href="#cb19-161"></a>  )</span>
<span id="cb19-162"><a href="#cb19-162"></a>)</span>
<span id="cb19-163"><a href="#cb19-163"></a></span>
<span id="cb19-164"><a href="#cb19-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="cb19-165"><a href="#cb19-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-166"><a href="#cb19-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-167"><a href="#cb19-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-168"><a href="#cb19-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="cb19-169"><a href="#cb19-169"></a>    Region,</span>
<span id="cb19-170"><a href="#cb19-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="cb19-171"><a href="#cb19-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="cb19-172"><a href="#cb19-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="cb19-173"><a href="#cb19-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="cb19-174"><a href="#cb19-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="cb19-175"><a href="#cb19-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb19-176"><a href="#cb19-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-177"><a href="#cb19-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="cb19-178"><a href="#cb19-178"></a></span>
<span id="cb19-179"><a href="#cb19-179"></a></span>
<span id="cb19-180"><a href="#cb19-180"></a></span>
<span id="cb19-181"><a href="#cb19-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="cb19-182"><a href="#cb19-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="cb19-183"><a href="#cb19-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-184"><a href="#cb19-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="cb19-185"><a href="#cb19-185"></a></span>
<span id="cb19-186"><a href="#cb19-186"></a></span>
<span id="cb19-187"><a href="#cb19-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="cb19-188"><a href="#cb19-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="cb19-189"><a href="#cb19-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb19-190"><a href="#cb19-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb19-191"><a href="#cb19-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="cb19-192"><a href="#cb19-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb19-193"><a href="#cb19-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="cb19-194"><a href="#cb19-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="cb19-195"><a href="#cb19-195"></a>      } <span class="cf">else</span> {</span>
<span id="cb19-196"><a href="#cb19-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="cb19-197"><a href="#cb19-197"></a>      }</span>
<span id="cb19-198"><a href="#cb19-198"></a>    }</span>
<span id="cb19-199"><a href="#cb19-199"></a>  ))</span>
<span id="cb19-200"><a href="#cb19-200"></a></span>
<span id="cb19-201"><a href="#cb19-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="cb19-202"><a href="#cb19-202"></a><span class="do">## Used for mapping</span></span>
<span id="cb19-203"><a href="#cb19-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb19-204"><a href="#cb19-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="cb19-205"><a href="#cb19-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-206"><a href="#cb19-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="cb19-207"><a href="#cb19-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="cb19-208"><a href="#cb19-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="cb19-209"><a href="#cb19-209"></a>)</span>
<span id="cb19-210"><a href="#cb19-210"></a></span>
<span id="cb19-211"><a href="#cb19-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="cb19-212"><a href="#cb19-212"></a><span class="do">## Used for modelling</span></span>
<span id="cb19-213"><a href="#cb19-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-214"><a href="#cb19-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="cb19-215"><a href="#cb19-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="cb19-216"><a href="#cb19-216"></a>)</span>
<span id="cb19-217"><a href="#cb19-217"></a></span>
<span id="cb19-218"><a href="#cb19-218"></a></span>
<span id="cb19-219"><a href="#cb19-219"></a></span>
<span id="cb19-220"><a href="#cb19-220"></a></span>
<span id="cb19-221"><a href="#cb19-221"></a><span class="co"># 3 UI ----</span></span>
<span id="cb19-222"><a href="#cb19-222"></a></span>
<span id="cb19-223"><a href="#cb19-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="cb19-224"><a href="#cb19-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb19-225"><a href="#cb19-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="cb19-226"><a href="#cb19-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="cb19-227"><a href="#cb19-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="cb19-228"><a href="#cb19-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="cb19-229"><a href="#cb19-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="cb19-230"><a href="#cb19-230"></a>    )</span>
<span id="cb19-231"><a href="#cb19-231"></a>  ),</span>
<span id="cb19-232"><a href="#cb19-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="cb19-233"><a href="#cb19-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="cb19-234"><a href="#cb19-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="cb19-235"><a href="#cb19-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="cb19-236"><a href="#cb19-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="cb19-237"><a href="#cb19-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="cb19-238"><a href="#cb19-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="cb19-239"><a href="#cb19-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="cb19-240"><a href="#cb19-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="cb19-241"><a href="#cb19-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb19-242"><a href="#cb19-242"></a>    ),</span>
<span id="cb19-243"><a href="#cb19-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-244"><a href="#cb19-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-245"><a href="#cb19-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-246"><a href="#cb19-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb19-247"><a href="#cb19-247"></a>  ),</span>
<span id="cb19-248"><a href="#cb19-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="cb19-249"><a href="#cb19-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="cb19-250"><a href="#cb19-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="cb19-251"><a href="#cb19-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="cb19-252"><a href="#cb19-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb19-253"><a href="#cb19-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="cb19-254"><a href="#cb19-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="cb19-255"><a href="#cb19-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="cb19-256"><a href="#cb19-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="cb19-257"><a href="#cb19-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="cb19-258"><a href="#cb19-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="cb19-259"><a href="#cb19-259"></a>        ),</span>
<span id="cb19-260"><a href="#cb19-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb19-261"><a href="#cb19-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="cb19-262"><a href="#cb19-262"></a>          <span class="fu">column</span>(</span>
<span id="cb19-263"><a href="#cb19-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb19-264"><a href="#cb19-264"></a>            <span class="fu">box</span>(</span>
<span id="cb19-265"><a href="#cb19-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="cb19-266"><a href="#cb19-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-267"><a href="#cb19-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-268"><a href="#cb19-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="cb19-269"><a href="#cb19-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="cb19-270"><a href="#cb19-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="cb19-271"><a href="#cb19-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="cb19-272"><a href="#cb19-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="cb19-273"><a href="#cb19-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="cb19-274"><a href="#cb19-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="cb19-275"><a href="#cb19-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="cb19-276"><a href="#cb19-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="cb19-277"><a href="#cb19-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="cb19-278"><a href="#cb19-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="cb19-279"><a href="#cb19-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="cb19-280"><a href="#cb19-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="cb19-281"><a href="#cb19-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="cb19-282"><a href="#cb19-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="cb19-283"><a href="#cb19-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="cb19-284"><a href="#cb19-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="cb19-285"><a href="#cb19-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="cb19-286"><a href="#cb19-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="cb19-287"><a href="#cb19-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="cb19-288"><a href="#cb19-288"></a>              <span class="fu">hr</span>(),</span>
<span id="cb19-289"><a href="#cb19-289"></a>              <span class="fu">accordion</span>(</span>
<span id="cb19-290"><a href="#cb19-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="cb19-291"><a href="#cb19-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb19-292"><a href="#cb19-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="cb19-293"><a href="#cb19-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-294"><a href="#cb19-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-295"><a href="#cb19-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="cb19-296"><a href="#cb19-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="cb19-297"><a href="#cb19-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="cb19-298"><a href="#cb19-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="cb19-299"><a href="#cb19-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="cb19-300"><a href="#cb19-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="cb19-301"><a href="#cb19-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="cb19-302"><a href="#cb19-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="cb19-303"><a href="#cb19-303"></a>                  )</span>
<span id="cb19-304"><a href="#cb19-304"></a>                ),</span>
<span id="cb19-305"><a href="#cb19-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="cb19-306"><a href="#cb19-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="cb19-307"><a href="#cb19-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-308"><a href="#cb19-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-309"><a href="#cb19-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="cb19-310"><a href="#cb19-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="cb19-311"><a href="#cb19-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="cb19-312"><a href="#cb19-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="cb19-313"><a href="#cb19-313"></a>                )</span>
<span id="cb19-314"><a href="#cb19-314"></a>              )</span>
<span id="cb19-315"><a href="#cb19-315"></a>            )</span>
<span id="cb19-316"><a href="#cb19-316"></a>          ),</span>
<span id="cb19-317"><a href="#cb19-317"></a>          <span class="fu">column</span>(</span>
<span id="cb19-318"><a href="#cb19-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb19-319"><a href="#cb19-319"></a>            <span class="fu">box</span>(</span>
<span id="cb19-320"><a href="#cb19-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="cb19-321"><a href="#cb19-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-322"><a href="#cb19-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-323"><a href="#cb19-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="cb19-324"><a href="#cb19-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="cb19-325"><a href="#cb19-325"></a>            )</span>
<span id="cb19-326"><a href="#cb19-326"></a>          )</span>
<span id="cb19-327"><a href="#cb19-327"></a>        )</span>
<span id="cb19-328"><a href="#cb19-328"></a>      ),</span>
<span id="cb19-329"><a href="#cb19-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="cb19-330"><a href="#cb19-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb19-331"><a href="#cb19-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="cb19-332"><a href="#cb19-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb19-333"><a href="#cb19-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="cb19-334"><a href="#cb19-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="cb19-335"><a href="#cb19-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="cb19-336"><a href="#cb19-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="cb19-337"><a href="#cb19-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb19-338"><a href="#cb19-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="cb19-339"><a href="#cb19-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-340"><a href="#cb19-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb19-341"><a href="#cb19-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-342"><a href="#cb19-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb19-343"><a href="#cb19-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb19-344"><a href="#cb19-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="cb19-345"><a href="#cb19-345"></a>            ),</span>
<span id="cb19-346"><a href="#cb19-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-347"><a href="#cb19-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="cb19-348"><a href="#cb19-348"></a>          )</span>
<span id="cb19-349"><a href="#cb19-349"></a>        ),</span>
<span id="cb19-350"><a href="#cb19-350"></a>        <span class="fu">hr</span>(),</span>
<span id="cb19-351"><a href="#cb19-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="cb19-352"><a href="#cb19-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="cb19-353"><a href="#cb19-353"></a>      ),</span>
<span id="cb19-354"><a href="#cb19-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="cb19-355"><a href="#cb19-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb19-356"><a href="#cb19-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="cb19-357"><a href="#cb19-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb19-358"><a href="#cb19-358"></a>          <span class="fu">column</span>(</span>
<span id="cb19-359"><a href="#cb19-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb19-360"><a href="#cb19-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb19-361"><a href="#cb19-361"></a>            <span class="fu">box</span>(</span>
<span id="cb19-362"><a href="#cb19-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-363"><a href="#cb19-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="cb19-364"><a href="#cb19-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-365"><a href="#cb19-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb19-366"><a href="#cb19-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="cb19-367"><a href="#cb19-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="cb19-368"><a href="#cb19-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb19-369"><a href="#cb19-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-370"><a href="#cb19-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="cb19-371"><a href="#cb19-371"></a>              ),</span>
<span id="cb19-372"><a href="#cb19-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="cb19-373"><a href="#cb19-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="cb19-374"><a href="#cb19-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="cb19-375"><a href="#cb19-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="cb19-376"><a href="#cb19-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="cb19-377"><a href="#cb19-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-378"><a href="#cb19-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-379"><a href="#cb19-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="cb19-380"><a href="#cb19-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="cb19-381"><a href="#cb19-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="cb19-382"><a href="#cb19-382"></a>                ),</span>
<span id="cb19-383"><a href="#cb19-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-384"><a href="#cb19-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="cb19-385"><a href="#cb19-385"></a>              ),</span>
<span id="cb19-386"><a href="#cb19-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="cb19-387"><a href="#cb19-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="cb19-388"><a href="#cb19-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="cb19-389"><a href="#cb19-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-390"><a href="#cb19-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-391"><a href="#cb19-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="cb19-392"><a href="#cb19-392"></a>              ),</span>
<span id="cb19-393"><a href="#cb19-393"></a>              <span class="fu">hr</span>(),</span>
<span id="cb19-394"><a href="#cb19-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="cb19-395"><a href="#cb19-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="cb19-396"><a href="#cb19-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="cb19-397"><a href="#cb19-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="cb19-398"><a href="#cb19-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="cb19-399"><a href="#cb19-399"></a>              )</span>
<span id="cb19-400"><a href="#cb19-400"></a>            ),</span>
<span id="cb19-401"><a href="#cb19-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="cb19-402"><a href="#cb19-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb19-403"><a href="#cb19-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-404"><a href="#cb19-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb19-405"><a href="#cb19-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="cb19-406"><a href="#cb19-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb19-407"><a href="#cb19-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-408"><a href="#cb19-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="cb19-409"><a href="#cb19-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-410"><a href="#cb19-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="cb19-411"><a href="#cb19-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="cb19-412"><a href="#cb19-412"></a>              ),</span>
<span id="cb19-413"><a href="#cb19-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="cb19-414"><a href="#cb19-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-415"><a href="#cb19-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="cb19-416"><a href="#cb19-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="cb19-417"><a href="#cb19-417"></a>              ),</span>
<span id="cb19-418"><a href="#cb19-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="cb19-419"><a href="#cb19-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-420"><a href="#cb19-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="cb19-421"><a href="#cb19-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="cb19-422"><a href="#cb19-422"></a>              )</span>
<span id="cb19-423"><a href="#cb19-423"></a>            )</span>
<span id="cb19-424"><a href="#cb19-424"></a>          ),</span>
<span id="cb19-425"><a href="#cb19-425"></a>          <span class="fu">column</span>(</span>
<span id="cb19-426"><a href="#cb19-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb19-427"><a href="#cb19-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="cb19-428"><a href="#cb19-428"></a>            <span class="fu">box</span>(</span>
<span id="cb19-429"><a href="#cb19-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-430"><a href="#cb19-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="cb19-431"><a href="#cb19-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-432"><a href="#cb19-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="cb19-433"><a href="#cb19-433"></a>            ),</span>
<span id="cb19-434"><a href="#cb19-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="cb19-435"><a href="#cb19-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="cb19-436"><a href="#cb19-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-437"><a href="#cb19-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="cb19-438"><a href="#cb19-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="cb19-439"><a href="#cb19-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-440"><a href="#cb19-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb19-441"><a href="#cb19-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-442"><a href="#cb19-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="cb19-443"><a href="#cb19-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="cb19-444"><a href="#cb19-444"></a>              ),</span>
<span id="cb19-445"><a href="#cb19-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-446"><a href="#cb19-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="cb19-447"><a href="#cb19-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="cb19-448"><a href="#cb19-448"></a>              ),</span>
<span id="cb19-449"><a href="#cb19-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="cb19-450"><a href="#cb19-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="cb19-451"><a href="#cb19-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="cb19-452"><a href="#cb19-452"></a>              )</span>
<span id="cb19-453"><a href="#cb19-453"></a>            )</span>
<span id="cb19-454"><a href="#cb19-454"></a>          )</span>
<span id="cb19-455"><a href="#cb19-455"></a>        )</span>
<span id="cb19-456"><a href="#cb19-456"></a>      ),</span>
<span id="cb19-457"><a href="#cb19-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="cb19-458"><a href="#cb19-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="cb19-459"><a href="#cb19-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="cb19-460"><a href="#cb19-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="cb19-461"><a href="#cb19-461"></a>          <span class="fu">column</span>(</span>
<span id="cb19-462"><a href="#cb19-462"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="cb19-463"><a href="#cb19-463"></a>            <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="cb19-464"><a href="#cb19-464"></a>            <span class="fu">box</span>(</span>
<span id="cb19-465"><a href="#cb19-465"></a>              <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="cb19-466"><a href="#cb19-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-467"><a href="#cb19-467"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-468"><a href="#cb19-468"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb19-469"><a href="#cb19-469"></a>                <span class="st">"tab_map_select"</span>,</span>
<span id="cb19-470"><a href="#cb19-470"></a>                <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="cb19-471"><a href="#cb19-471"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="cb19-472"><a href="#cb19-472"></a>              ),</span>
<span id="cb19-473"><a href="#cb19-473"></a>              <span class="fu">uiOutput</span>(<span class="st">"tab_map_desc"</span>)</span>
<span id="cb19-474"><a href="#cb19-474"></a>            ),</span>
<span id="cb19-475"><a href="#cb19-475"></a>            <span class="fu">box</span>(</span>
<span id="cb19-476"><a href="#cb19-476"></a>              <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="cb19-477"><a href="#cb19-477"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-478"><a href="#cb19-478"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-479"><a href="#cb19-479"></a>              <span class="fu">radioButtons</span>(</span>
<span id="cb19-480"><a href="#cb19-480"></a>                <span class="st">"tab_map_aggr"</span>,</span>
<span id="cb19-481"><a href="#cb19-481"></a>                <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="cb19-482"><a href="#cb19-482"></a>                <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="cb19-483"><a href="#cb19-483"></a>                <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="cb19-484"><a href="#cb19-484"></a>              ),</span>
<span id="cb19-485"><a href="#cb19-485"></a>              <span class="fu">selectInput</span>(</span>
<span id="cb19-486"><a href="#cb19-486"></a>                <span class="st">"tab_map_pal"</span>,</span>
<span id="cb19-487"><a href="#cb19-487"></a>                <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="cb19-488"><a href="#cb19-488"></a>                <span class="at">choices =</span> pals,</span>
<span id="cb19-489"><a href="#cb19-489"></a>                <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="cb19-490"><a href="#cb19-490"></a>              ) <span class="co"># end input</span></span>
<span id="cb19-491"><a href="#cb19-491"></a>            ) <span class="co"># end box</span></span>
<span id="cb19-492"><a href="#cb19-492"></a>          ), <span class="co"># end column</span></span>
<span id="cb19-493"><a href="#cb19-493"></a>          <span class="fu">column</span>(</span>
<span id="cb19-494"><a href="#cb19-494"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="cb19-495"><a href="#cb19-495"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb19-496"><a href="#cb19-496"></a>            <span class="fu">box</span>(</span>
<span id="cb19-497"><a href="#cb19-497"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="cb19-498"><a href="#cb19-498"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb19-499"><a href="#cb19-499"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-500"><a href="#cb19-500"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-501"><a href="#cb19-501"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="cb19-502"><a href="#cb19-502"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="cb19-503"><a href="#cb19-503"></a>            ) <span class="co"># end box</span></span>
<span id="cb19-504"><a href="#cb19-504"></a>          ) <span class="co"># end column</span></span>
<span id="cb19-505"><a href="#cb19-505"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="cb19-506"><a href="#cb19-506"></a>      ) <span class="co"># end tabItem</span></span>
<span id="cb19-507"><a href="#cb19-507"></a>    ) <span class="co"># end tabItems</span></span>
<span id="cb19-508"><a href="#cb19-508"></a>  ),</span>
<span id="cb19-509"><a href="#cb19-509"></a>  </span>
<span id="cb19-510"><a href="#cb19-510"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="cb19-511"><a href="#cb19-511"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="cb19-512"><a href="#cb19-512"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="cb19-513"><a href="#cb19-513"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="cb19-514"><a href="#cb19-514"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="cb19-515"><a href="#cb19-515"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="cb19-516"><a href="#cb19-516"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="cb19-517"><a href="#cb19-517"></a>    )</span>
<span id="cb19-518"><a href="#cb19-518"></a>  ),</span>
<span id="cb19-519"><a href="#cb19-519"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="cb19-520"><a href="#cb19-520"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="cb19-521"><a href="#cb19-521"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="cb19-522"><a href="#cb19-522"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="cb19-523"><a href="#cb19-523"></a>  )  </span>
<span id="cb19-524"><a href="#cb19-524"></a>)</span>
<span id="cb19-525"><a href="#cb19-525"></a></span>
<span id="cb19-526"><a href="#cb19-526"></a></span>
<span id="cb19-527"><a href="#cb19-527"></a></span>
<span id="cb19-528"><a href="#cb19-528"></a><span class="co"># 4 Server ----</span></span>
<span id="cb19-529"><a href="#cb19-529"></a></span>
<span id="cb19-530"><a href="#cb19-530"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb19-531"><a href="#cb19-531"></a>  </span>
<span id="cb19-532"><a href="#cb19-532"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="cb19-533"><a href="#cb19-533"></a>  <span class="do">### Variable selection ----</span></span>
<span id="cb19-534"><a href="#cb19-534"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-535"><a href="#cb19-535"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="cb19-536"><a href="#cb19-536"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="cb19-537"><a href="#cb19-537"></a>    </span>
<span id="cb19-538"><a href="#cb19-538"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="cb19-539"><a href="#cb19-539"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="cb19-540"><a href="#cb19-540"></a>    }</span>
<span id="cb19-541"><a href="#cb19-541"></a>    </span>
<span id="cb19-542"><a href="#cb19-542"></a>    data_table</span>
<span id="cb19-543"><a href="#cb19-543"></a>  })</span>
<span id="cb19-544"><a href="#cb19-544"></a>  </span>
<span id="cb19-545"><a href="#cb19-545"></a>  </span>
<span id="cb19-546"><a href="#cb19-546"></a>  <span class="do">### Create table----</span></span>
<span id="cb19-547"><a href="#cb19-547"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-548"><a href="#cb19-548"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="cb19-549"><a href="#cb19-549"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb19-550"><a href="#cb19-550"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb19-551"><a href="#cb19-551"></a>      tab,</span>
<span id="cb19-552"><a href="#cb19-552"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="cb19-553"><a href="#cb19-553"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="cb19-554"><a href="#cb19-554"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="cb19-555"><a href="#cb19-555"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="cb19-556"><a href="#cb19-556"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="cb19-557"><a href="#cb19-557"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-558"><a href="#cb19-558"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb19-559"><a href="#cb19-559"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="cb19-560"><a href="#cb19-560"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-561"><a href="#cb19-561"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-562"><a href="#cb19-562"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb19-563"><a href="#cb19-563"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="cb19-564"><a href="#cb19-564"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="cb19-565"><a href="#cb19-565"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="cb19-566"><a href="#cb19-566"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb19-567"><a href="#cb19-567"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="cb19-568"><a href="#cb19-568"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="cb19-569"><a href="#cb19-569"></a><span class="st">  </span></span>
<span id="cb19-570"><a href="#cb19-570"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="cb19-571"><a href="#cb19-571"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="cb19-572"><a href="#cb19-572"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="cb19-573"><a href="#cb19-573"></a><span class="st">            );</span></span>
<span id="cb19-574"><a href="#cb19-574"></a><span class="st">          }</span></span>
<span id="cb19-575"><a href="#cb19-575"></a><span class="st">        "</span>))</span>
<span id="cb19-576"><a href="#cb19-576"></a>        )</span>
<span id="cb19-577"><a href="#cb19-577"></a>      )</span>
<span id="cb19-578"><a href="#cb19-578"></a>    )</span>
<span id="cb19-579"><a href="#cb19-579"></a>  })</span>
<span id="cb19-580"><a href="#cb19-580"></a>  </span>
<span id="cb19-581"><a href="#cb19-581"></a>  <span class="do">### Render table----</span></span>
<span id="cb19-582"><a href="#cb19-582"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-583"><a href="#cb19-583"></a>  </span>
<span id="cb19-584"><a href="#cb19-584"></a>  </span>
<span id="cb19-585"><a href="#cb19-585"></a>  </span>
<span id="cb19-586"><a href="#cb19-586"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="cb19-587"><a href="#cb19-587"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="cb19-588"><a href="#cb19-588"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-589"><a href="#cb19-589"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="cb19-590"><a href="#cb19-590"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="cb19-591"><a href="#cb19-591"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="cb19-592"><a href="#cb19-592"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="cb19-593"><a href="#cb19-593"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="cb19-594"><a href="#cb19-594"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="cb19-595"><a href="#cb19-595"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="cb19-596"><a href="#cb19-596"></a>    </span>
<span id="cb19-597"><a href="#cb19-597"></a>    <span class="fu">list</span>(</span>
<span id="cb19-598"><a href="#cb19-598"></a>      <span class="at">x =</span> x,</span>
<span id="cb19-599"><a href="#cb19-599"></a>      <span class="at">y =</span> y,</span>
<span id="cb19-600"><a href="#cb19-600"></a>      <span class="at">data =</span> dt,</span>
<span id="cb19-601"><a href="#cb19-601"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="cb19-602"><a href="#cb19-602"></a>      <span class="at">model =</span> mod</span>
<span id="cb19-603"><a href="#cb19-603"></a>    )</span>
<span id="cb19-604"><a href="#cb19-604"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb19-605"><a href="#cb19-605"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-606"><a href="#cb19-606"></a>  </span>
<span id="cb19-607"><a href="#cb19-607"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="cb19-608"><a href="#cb19-608"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="cb19-609"><a href="#cb19-609"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-610"><a href="#cb19-610"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb19-611"><a href="#cb19-611"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb19-612"><a href="#cb19-612"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="cb19-613"><a href="#cb19-613"></a>      params<span class="sc">$</span>data,</span>
<span id="cb19-614"><a href="#cb19-614"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="cb19-615"><a href="#cb19-615"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb19-616"><a href="#cb19-616"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="cb19-617"><a href="#cb19-617"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="cb19-618"><a href="#cb19-618"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="cb19-619"><a href="#cb19-619"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="cb19-620"><a href="#cb19-620"></a>                <span class="st">"Department: "</span>, </span>
<span id="cb19-621"><a href="#cb19-621"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb19-622"><a href="#cb19-622"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb19-623"><a href="#cb19-623"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb19-624"><a href="#cb19-624"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb19-625"><a href="#cb19-625"></a>            ))</span>
<span id="cb19-626"><a href="#cb19-626"></a>        }</span>
<span id="cb19-627"><a href="#cb19-627"></a>      )</span>
<span id="cb19-628"><a href="#cb19-628"></a>    )</span>
<span id="cb19-629"><a href="#cb19-629"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-630"><a href="#cb19-630"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-631"><a href="#cb19-631"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-632"><a href="#cb19-632"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-633"><a href="#cb19-633"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-634"><a href="#cb19-634"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-635"><a href="#cb19-635"></a>  })</span>
<span id="cb19-636"><a href="#cb19-636"></a>  </span>
<span id="cb19-637"><a href="#cb19-637"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="cb19-638"><a href="#cb19-638"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb19-639"><a href="#cb19-639"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-640"><a href="#cb19-640"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb19-641"><a href="#cb19-641"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="cb19-642"><a href="#cb19-642"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb19-643"><a href="#cb19-643"></a>    </span>
<span id="cb19-644"><a href="#cb19-644"></a>    </span>
<span id="cb19-645"><a href="#cb19-645"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="cb19-646"><a href="#cb19-646"></a>    </span>
<span id="cb19-647"><a href="#cb19-647"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-648"><a href="#cb19-648"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb19-649"><a href="#cb19-649"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-650"><a href="#cb19-650"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-651"><a href="#cb19-651"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-652"><a href="#cb19-652"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-653"><a href="#cb19-653"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-654"><a href="#cb19-654"></a>  })</span>
<span id="cb19-655"><a href="#cb19-655"></a>  </span>
<span id="cb19-656"><a href="#cb19-656"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="cb19-657"><a href="#cb19-657"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb19-658"><a href="#cb19-658"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-659"><a href="#cb19-659"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="cb19-660"><a href="#cb19-660"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="cb19-661"><a href="#cb19-661"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="cb19-662"><a href="#cb19-662"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="cb19-663"><a href="#cb19-663"></a>    </span>
<span id="cb19-664"><a href="#cb19-664"></a>    </span>
<span id="cb19-665"><a href="#cb19-665"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb19-666"><a href="#cb19-666"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="cb19-667"><a href="#cb19-667"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="cb19-668"><a href="#cb19-668"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="cb19-669"><a href="#cb19-669"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="cb19-670"><a href="#cb19-670"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="cb19-671"><a href="#cb19-671"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="cb19-672"><a href="#cb19-672"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="cb19-673"><a href="#cb19-673"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb19-674"><a href="#cb19-674"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb19-675"><a href="#cb19-675"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb19-676"><a href="#cb19-676"></a>        <span class="fu">theme_light</span>()</span>
<span id="cb19-677"><a href="#cb19-677"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-678"><a href="#cb19-678"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-679"><a href="#cb19-679"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb19-680"><a href="#cb19-680"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="cb19-681"><a href="#cb19-681"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="cb19-682"><a href="#cb19-682"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="cb19-683"><a href="#cb19-683"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="cb19-684"><a href="#cb19-684"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="cb19-685"><a href="#cb19-685"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-686"><a href="#cb19-686"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-687"><a href="#cb19-687"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="cb19-688"><a href="#cb19-688"></a>      </span>
<span id="cb19-689"><a href="#cb19-689"></a>    }</span>
<span id="cb19-690"><a href="#cb19-690"></a>    </span>
<span id="cb19-691"><a href="#cb19-691"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-692"><a href="#cb19-692"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb19-693"><a href="#cb19-693"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-694"><a href="#cb19-694"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-695"><a href="#cb19-695"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-696"><a href="#cb19-696"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-697"><a href="#cb19-697"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-698"><a href="#cb19-698"></a>  })</span>
<span id="cb19-699"><a href="#cb19-699"></a>  </span>
<span id="cb19-700"><a href="#cb19-700"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="cb19-701"><a href="#cb19-701"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb19-702"><a href="#cb19-702"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-703"><a href="#cb19-703"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="cb19-704"><a href="#cb19-704"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="cb19-705"><a href="#cb19-705"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="cb19-706"><a href="#cb19-706"></a>    ))</span>
<span id="cb19-707"><a href="#cb19-707"></a>  })</span>
<span id="cb19-708"><a href="#cb19-708"></a>  </span>
<span id="cb19-709"><a href="#cb19-709"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="cb19-710"><a href="#cb19-710"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb19-711"><a href="#cb19-711"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-712"><a href="#cb19-712"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="cb19-713"><a href="#cb19-713"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-714"><a href="#cb19-714"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-715"><a href="#cb19-715"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-716"><a href="#cb19-716"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-717"><a href="#cb19-717"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-718"><a href="#cb19-718"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-719"><a href="#cb19-719"></a>  })</span>
<span id="cb19-720"><a href="#cb19-720"></a>  </span>
<span id="cb19-721"><a href="#cb19-721"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="cb19-722"><a href="#cb19-722"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb19-723"><a href="#cb19-723"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-724"><a href="#cb19-724"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-725"><a href="#cb19-725"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-726"><a href="#cb19-726"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-727"><a href="#cb19-727"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-728"><a href="#cb19-728"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="cb19-729"><a href="#cb19-729"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-730"><a href="#cb19-730"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-731"><a href="#cb19-731"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-732"><a href="#cb19-732"></a>  })</span>
<span id="cb19-733"><a href="#cb19-733"></a>  </span>
<span id="cb19-734"><a href="#cb19-734"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="cb19-735"><a href="#cb19-735"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="cb19-736"><a href="#cb19-736"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="cb19-737"><a href="#cb19-737"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="cb19-738"><a href="#cb19-738"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb19-739"><a href="#cb19-739"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="cb19-740"><a href="#cb19-740"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="cb19-741"><a href="#cb19-741"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="cb19-742"><a href="#cb19-742"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="cb19-743"><a href="#cb19-743"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="cb19-744"><a href="#cb19-744"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-745"><a href="#cb19-745"></a>  })</span>
<span id="cb19-746"><a href="#cb19-746"></a>  </span>
<span id="cb19-747"><a href="#cb19-747"></a>  </span>
<span id="cb19-748"><a href="#cb19-748"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="cb19-749"><a href="#cb19-749"></a>  </span>
<span id="cb19-750"><a href="#cb19-750"></a>  <span class="co"># Render description of selected variable</span></span>
<span id="cb19-751"><a href="#cb19-751"></a>  output<span class="sc">$</span>tab_map_desc <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="cb19-752"><a href="#cb19-752"></a>    <span class="fu">HTML</span>(variable_desc[[input<span class="sc">$</span>tab_map_select]]<span class="sc">$</span>desc)</span>
<span id="cb19-753"><a href="#cb19-753"></a>  })</span>
<span id="cb19-754"><a href="#cb19-754"></a>  </span>
<span id="cb19-755"><a href="#cb19-755"></a>  <span class="co"># Select polygon based on aggregation level</span></span>
<span id="cb19-756"><a href="#cb19-756"></a>  poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-757"><a href="#cb19-757"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="cb19-758"><a href="#cb19-758"></a>      data_guerry_region</span>
<span id="cb19-759"><a href="#cb19-759"></a>    } <span class="cf">else</span> {</span>
<span id="cb19-760"><a href="#cb19-760"></a>      data_guerry</span>
<span id="cb19-761"><a href="#cb19-761"></a>    }</span>
<span id="cb19-762"><a href="#cb19-762"></a>  })</span>
<span id="cb19-763"><a href="#cb19-763"></a>  </span>
<span id="cb19-764"><a href="#cb19-764"></a>  <span class="co"># Select palette based on input</span></span>
<span id="cb19-765"><a href="#cb19-765"></a>  palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-766"><a href="#cb19-766"></a>    pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="cb19-767"><a href="#cb19-767"></a>    <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="cb19-768"><a href="#cb19-768"></a>      pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="cb19-769"><a href="#cb19-769"></a>    }</span>
<span id="cb19-770"><a href="#cb19-770"></a>    pal</span>
<span id="cb19-771"><a href="#cb19-771"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="cb19-772"><a href="#cb19-772"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>tab_map_pal)</span>
<span id="cb19-773"><a href="#cb19-773"></a>  </span>
<span id="cb19-774"><a href="#cb19-774"></a>  <span class="co"># Compile parameters for leaflet rendering</span></span>
<span id="cb19-775"><a href="#cb19-775"></a>  params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb19-776"><a href="#cb19-776"></a>    poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="cb19-777"><a href="#cb19-777"></a>    pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb19-778"><a href="#cb19-778"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="cb19-779"><a href="#cb19-779"></a>    </span>
<span id="cb19-780"><a href="#cb19-780"></a>    values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="cb19-781"><a href="#cb19-781"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="cb19-782"><a href="#cb19-782"></a>    </span>
<span id="cb19-783"><a href="#cb19-783"></a>    reg <span class="ot">&lt;-</span> poly[[<span class="st">"Region"</span>]]</span>
<span id="cb19-784"><a href="#cb19-784"></a>    dep <span class="ot">&lt;-</span> poly[[<span class="st">"Department"</span>]]</span>
<span id="cb19-785"><a href="#cb19-785"></a>    val <span class="ot">&lt;-</span> poly[[var]]</span>
<span id="cb19-786"><a href="#cb19-786"></a>    </span>
<span id="cb19-787"><a href="#cb19-787"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(dep)) {</span>
<span id="cb19-788"><a href="#cb19-788"></a>      dep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(poly))</span>
<span id="cb19-789"><a href="#cb19-789"></a>    }</span>
<span id="cb19-790"><a href="#cb19-790"></a>    </span>
<span id="cb19-791"><a href="#cb19-791"></a>    <span class="co"># Create labels that are nicely aligned in a grid</span></span>
<span id="cb19-792"><a href="#cb19-792"></a>    labels <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb19-793"><a href="#cb19-793"></a>      <span class="cf">function</span>(reg, dep, val) {</span>
<span id="cb19-794"><a href="#cb19-794"></a>        <span class="fu">HTML</span>(<span class="fu">as.character</span>(tags<span class="sc">$</span><span class="fu">table</span>(</span>
<span id="cb19-795"><a href="#cb19-795"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb19-796"><a href="#cb19-796"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb19-797"><a href="#cb19-797"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Region: "</span>)),</span>
<span id="cb19-798"><a href="#cb19-798"></a>            tags<span class="sc">$</span><span class="fu">td</span>(reg)</span>
<span id="cb19-799"><a href="#cb19-799"></a>          ),</span>
<span id="cb19-800"><a href="#cb19-800"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(dep)) {</span>
<span id="cb19-801"><a href="#cb19-801"></a>            tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb19-802"><a href="#cb19-802"></a>              <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb19-803"><a href="#cb19-803"></a>              tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Department: "</span>)),</span>
<span id="cb19-804"><a href="#cb19-804"></a>              tags<span class="sc">$</span><span class="fu">td</span>(dep)</span>
<span id="cb19-805"><a href="#cb19-805"></a>            )</span>
<span id="cb19-806"><a href="#cb19-806"></a>          },</span>
<span id="cb19-807"><a href="#cb19-807"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="cb19-808"><a href="#cb19-808"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="cb19-809"><a href="#cb19-809"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="fu">paste0</span>(variable_desc[[var]]<span class="sc">$</span>lgd, <span class="st">": "</span>))),</span>
<span id="cb19-810"><a href="#cb19-810"></a>            tags<span class="sc">$</span><span class="fu">td</span>(<span class="fu">round</span>(val, <span class="dv">2</span>))</span>
<span id="cb19-811"><a href="#cb19-811"></a>          )</span>
<span id="cb19-812"><a href="#cb19-812"></a>        )))</span>
<span id="cb19-813"><a href="#cb19-813"></a>      },</span>
<span id="cb19-814"><a href="#cb19-814"></a>      <span class="at">reg =</span> reg, <span class="at">dep =</span> dep, <span class="at">val =</span> val,</span>
<span id="cb19-815"><a href="#cb19-815"></a>      <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-816"><a href="#cb19-816"></a>      <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span></span>
<span id="cb19-817"><a href="#cb19-817"></a>    )</span>
<span id="cb19-818"><a href="#cb19-818"></a>    </span>
<span id="cb19-819"><a href="#cb19-819"></a>    <span class="fu">list</span>(</span>
<span id="cb19-820"><a href="#cb19-820"></a>      <span class="at">poly =</span> poly,</span>
<span id="cb19-821"><a href="#cb19-821"></a>      <span class="at">var =</span> var,</span>
<span id="cb19-822"><a href="#cb19-822"></a>      <span class="at">pal =</span> pal,</span>
<span id="cb19-823"><a href="#cb19-823"></a>      <span class="at">values =</span> values,</span>
<span id="cb19-824"><a href="#cb19-824"></a>      <span class="at">labels =</span> labels</span>
<span id="cb19-825"><a href="#cb19-825"></a>    )</span>
<span id="cb19-826"><a href="#cb19-826"></a>  })</span>
<span id="cb19-827"><a href="#cb19-827"></a>  </span>
<span id="cb19-828"><a href="#cb19-828"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="cb19-829"><a href="#cb19-829"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="cb19-830"><a href="#cb19-830"></a>    <span class="co"># Isolate call to params() to prevent render function to be executed</span></span>
<span id="cb19-831"><a href="#cb19-831"></a>    <span class="co"># every time params() is invalidated. No dependency is made.</span></span>
<span id="cb19-832"><a href="#cb19-832"></a>    params <span class="ot">&lt;-</span> <span class="fu">isolate</span>(<span class="fu">params</span>())</span>
<span id="cb19-833"><a href="#cb19-833"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="cb19-834"><a href="#cb19-834"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-835"><a href="#cb19-835"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-836"><a href="#cb19-836"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-837"><a href="#cb19-837"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-838"><a href="#cb19-838"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="cb19-839"><a href="#cb19-839"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-840"><a href="#cb19-840"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-841"><a href="#cb19-841"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb19-842"><a href="#cb19-842"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="cb19-843"><a href="#cb19-843"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb19-844"><a href="#cb19-844"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb19-845"><a href="#cb19-845"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb19-846"><a href="#cb19-846"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-847"><a href="#cb19-847"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="cb19-848"><a href="#cb19-848"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb19-849"><a href="#cb19-849"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb19-850"><a href="#cb19-850"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb19-851"><a href="#cb19-851"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-852"><a href="#cb19-852"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb19-853"><a href="#cb19-853"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-854"><a href="#cb19-854"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb19-855"><a href="#cb19-855"></a>        )</span>
<span id="cb19-856"><a href="#cb19-856"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb19-857"><a href="#cb19-857"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb19-858"><a href="#cb19-858"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb19-859"><a href="#cb19-859"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="cb19-860"><a href="#cb19-860"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="cb19-861"><a href="#cb19-861"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb19-862"><a href="#cb19-862"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="cb19-863"><a href="#cb19-863"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="cb19-864"><a href="#cb19-864"></a>      )</span>
<span id="cb19-865"><a href="#cb19-865"></a>  })</span>
<span id="cb19-866"><a href="#cb19-866"></a>  </span>
<span id="cb19-867"><a href="#cb19-867"></a>  <span class="co"># Create a leaflet proxy. Proxies update map values without re-rendering the</span></span>
<span id="cb19-868"><a href="#cb19-868"></a>  <span class="co"># entire map, thus increasing performance.</span></span>
<span id="cb19-869"><a href="#cb19-869"></a>  <span class="fu">observe</span>({</span>
<span id="cb19-870"><a href="#cb19-870"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="cb19-871"><a href="#cb19-871"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>, <span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="cb19-872"><a href="#cb19-872"></a>      <span class="fu">clearShapes</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-873"><a href="#cb19-873"></a>      <span class="fu">clearControls</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-874"><a href="#cb19-874"></a>      <span class="fu">addPolygons</span>(</span>
<span id="cb19-875"><a href="#cb19-875"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="cb19-876"><a href="#cb19-876"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb19-877"><a href="#cb19-877"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="cb19-878"><a href="#cb19-878"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb19-879"><a href="#cb19-879"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-880"><a href="#cb19-880"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="cb19-881"><a href="#cb19-881"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="cb19-882"><a href="#cb19-882"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb19-883"><a href="#cb19-883"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb19-884"><a href="#cb19-884"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="cb19-885"><a href="#cb19-885"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="cb19-886"><a href="#cb19-886"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-887"><a href="#cb19-887"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="cb19-888"><a href="#cb19-888"></a>        )</span>
<span id="cb19-889"><a href="#cb19-889"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb19-890"><a href="#cb19-890"></a>      <span class="fu">addLegend</span>(</span>
<span id="cb19-891"><a href="#cb19-891"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="cb19-892"><a href="#cb19-892"></a>        <span class="at">na.label =</span> <span class="st">"No data"</span>,</span>
<span id="cb19-893"><a href="#cb19-893"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="cb19-894"><a href="#cb19-894"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="cb19-895"><a href="#cb19-895"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb19-896"><a href="#cb19-896"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="cb19-897"><a href="#cb19-897"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="cb19-898"><a href="#cb19-898"></a>      )</span>
<span id="cb19-899"><a href="#cb19-899"></a>  })</span>
<span id="cb19-900"><a href="#cb19-900"></a>}</span>
<span id="cb19-901"><a href="#cb19-901"></a></span>
<span id="cb19-902"><a href="#cb19-902"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="appendix-access-shiny-events-on-maps" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Appendix: Access Shiny events on maps</h1>
<ul>
<li>Currently the user can interact with the Leaflet map in various ways: zoom, pan, hover, …</li>
<li>The Shiny programmer has no way of accessing what happens on the map after it is rendered</li>
<li>Solution: <strong>reactive events!</strong></li>
<li>Many Shiny extensions like Leaflet allow you to observe events that happen on the map</li>
</ul>
<section id="leaflet-events" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="leaflet-events"><span class="header-section-number">9.1</span> Leaflet events</h2>
<ul>
<li>Leaflet events are accessed like so:</li>
</ul>
<div style="font-size: 20px;">
<p><code style="color: red;">input$&lt;Map ID&gt;</code><code style="color: green;">_&lt;Object type&gt;</code><code style="color: blue;">_&lt;Event type&gt;</code></p>
</div>
<ul>
<li>Map ID refers to the ID given to the Leaflet widget, in our case this is <code>map_exp</code></li>
</ul>
</section>
<section id="leaflet-object-types" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="leaflet-object-types"><span class="header-section-number">9.2</span> Leaflet object types</h2>
<ul>
<li>Object type refers to a geometry type, can be one of:
<ul>
<li><code>marker</code> for points</li>
<li><code>shape</code> for polygons and lines</li>
<li><code>geojson</code> and <code>topojson</code> for data that was passed in GeoJSON or TopoJSON format</li>
</ul></li>
</ul>
</section>
<section id="leaflet-event-types" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="leaflet-event-types"><span class="header-section-number">9.3</span> Leaflet event types</h2>
<ul>
<li>Event type refers to the action that is performed on the geometry, one of:
<ul>
<li><code>click</code></li>
<li><code>mouseover</code></li>
<li><code>mouseout</code></li>
</ul></li>
</ul>
</section>
<section id="other-events" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="other-events"><span class="header-section-number">9.4</span> Other events</h2>
<ul>
<li>Additionally, Leaflet has some more general events:
<ul>
<li><code>input$&lt;Map ID&gt;_click</code> triggers when the background of the map is clicked</li>
<li><code>input$&lt;Map ID&gt;_bounds</code> provides the bounding box of the current view</li>
<li><code>input$&lt;Map ID&gt;_zoom</code> provides the current zoom level</li>
<li><code>input$&lt;Map ID&gt;_center</code> provides the center point of the current view</li>
</ul></li>
<li><strong>Question:</strong> When does <code>input$tab_map_map_marker_click</code> trigger?</li>
</ul>
</section>
<section id="events-in-practice" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="events-in-practice"><span class="header-section-number">9.5</span> Events in practice</h2>
<ul>
<li>The output of these Leaflet events usually contain an ID, Latitude and Longitude:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>input<span class="sc">$</span>tab_map_map_shape_click</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$id
NULL

$.nonce
[1] 0.05045395

$lat
[1] 49.0032

$lng
[1] -1.140568</code></pre>
</div>
</div>
</section>
<section id="clear-objects" class="level2" data-number="9.6">
<h2 data-number="9.6" class="anchored" data-anchor-id="clear-objects"><span class="header-section-number">9.6</span> Clear objects</h2>
<ul>
<li>In the following code chunk, we add a marker whenever we click on a polygon on the Leaflet map
<ol type="1">
<li>Capture the click input</li>
<li>Remove previous markers</li>
<li>Add a new marker using the click coordinates</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-27"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-27-1"><a href="#annotated-cell-27-1"></a><span class="fu">observe</span>({</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="1">1</button><span id="annotated-cell-27-2" class="code-annotation-target"><a href="#annotated-cell-27-2"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_shape_click</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="2">2</button><span id="annotated-cell-27-3" class="code-annotation-target"><a href="#annotated-cell-27-3"></a>    <span class="fu">req</span>(click)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="3">3</button><span id="annotated-cell-27-4" class="code-annotation-target"><a href="#annotated-cell-27-4"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="4">4</button><span id="annotated-cell-27-5" class="code-annotation-target"><a href="#annotated-cell-27-5"></a>        <span class="fu">clearMarkers</span>() <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-27" data-target-annotation="5">5</button><span id="annotated-cell-27-6" class="code-annotation-target"><a href="#annotated-cell-27-6"></a>        <span class="fu">addMarkers</span>(<span class="at">lng =</span> click<span class="sc">$</span>lng, <span class="at">lat =</span> click<span class="sc">$</span>lat)</span>
<span id="annotated-cell-27-7"><a href="#annotated-cell-27-7"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-27" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="2" data-code-annotation="1">Store event object. The event is invalidated when a user clicks on a shape in the <code>tab_map_map</code> leaflet widget</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="3" data-code-annotation="2">Cancel the observer when the click object is not “truthy” (see <code>?isTruthy</code>). If nothing is clicked, the observer should not be run.</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="4" data-code-annotation="3">Create a Leaflet proxy</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="5" data-code-annotation="4">Clear the previous marker</span>
</dd>
<dt data-target-cell="annotated-cell-27" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-27" data-code-lines="6" data-code-annotation="5">Add a new marker</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_07.gif" class="img-fluid"></p>
<ul>
<li>Here, we remove all markers in order to add a new one, but we can also be more careful in deleting elements
<ul>
<li><code>leaflet::clear</code> functions remove all elements of a geometry type</li>
<li><code>leaflet::remove</code> functions remove one element by layer ID</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>leaflet::remove</code> functions need a layer ID to work! You can set them using the <code>layerId</code> argument in <code>leaflet::add</code> functions, e.g.&nbsp;<code>leaflet::addMarkers(..., layerId = "marker1")</code></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1"></a><span class="co"># Add a new marker</span></span>
<span id="annotated-cell-28-2"><a href="#annotated-cell-28-2"></a><span class="fu">observe</span>({</span>
<span id="annotated-cell-28-3"><a href="#annotated-cell-28-3"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_shape_click</span>
<span id="annotated-cell-28-4"><a href="#annotated-cell-28-4"></a>    <span class="fu">req</span>(click)</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1">1</button><span id="annotated-cell-28-5" class="code-annotation-target"><a href="#annotated-cell-28-5"></a>    id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(click<span class="sc">$</span>lng, click<span class="sc">$</span>lat)</span>
<span id="annotated-cell-28-6"><a href="#annotated-cell-28-6"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="2">2</button><span id="annotated-cell-28-7" class="code-annotation-target"><a href="#annotated-cell-28-7"></a>        <span class="fu">addMarkers</span>(<span class="at">lng =</span> click<span class="sc">$</span>lng, <span class="at">lat =</span> click<span class="sc">$</span>lat, <span class="at">layerId =</span> id)</span>
<span id="annotated-cell-28-8"><a href="#annotated-cell-28-8"></a>})</span>
<span id="annotated-cell-28-9"><a href="#annotated-cell-28-9"></a></span>
<span id="annotated-cell-28-10"><a href="#annotated-cell-28-10"></a><span class="co"># Delete an existing marker</span></span>
<span id="annotated-cell-28-11"><a href="#annotated-cell-28-11"></a><span class="fu">observe</span>({</span>
<span id="annotated-cell-28-12"><a href="#annotated-cell-28-12"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_marker_click</span>
<span id="annotated-cell-28-13"><a href="#annotated-cell-28-13"></a>    <span class="fu">req</span>(click)</span>
<span id="annotated-cell-28-14"><a href="#annotated-cell-28-14"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>) <span class="sc">%&gt;%</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="3">3</button><span id="annotated-cell-28-15" class="code-annotation-target"><a href="#annotated-cell-28-15"></a>        <span class="fu">removeMarker</span>(click<span class="sc">$</span>id)</span>
<span id="annotated-cell-28-16"><a href="#annotated-cell-28-16"></a>})</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="5" data-code-annotation="1">Generate an ID from long/lat so we know exactly what element we are talking about</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="7" data-code-annotation="2">Pass the generated ID to a marker that we add</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="15" data-code-annotation="3">When clicking on a new marker again, we can know exactly what marker to delete and do not need to delete everything</span>
</dd>
</dl>
</div>
</div>
<p><img src="resources/06_08.gif" class="img-fluid"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bonus for the daring
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>You can create your own input events with a little bit of JavaScript!</li>
<li>In the code chunk below, we add a “mousemove” event, that triggers every time the mouse is moved on the Leaflet map</li>
<li>Note the use of <code>htmlwidgets::onRender()</code> to execute a piece of JavaScript when the Leaflet widget renders</li>
<li>Note the use of <code>Shiny.onInputChange</code> to create input events</li>
<li>Further reading: <a href="https://shiny.posit.co/r/articles/build/communicating-with-js/">Joe Cheng - “Communicating with Shiny via JavaScript”</a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>({</span>
<span id="cb22-2"><a href="#cb22-2"></a>    <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>        htmlwidgets<span class="sc">::</span><span class="fu">onRender</span>(<span class="st">"function(el, x) {</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">      this.on('mousemove', function(e) {</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="st">        var lng = e.latlng.lng;</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="st">        var lat = e.latlng.lat;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="st">        var coord = [lng, lat];            // capture long and lat</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="st">        Shiny.onInputChange('tab_map_map', coord)   // send coordinates to Shiny</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="st">      });</span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="st">      this.on('mouseout', function(e) {</span></span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="st">        Shiny.onInputChange('tab_map_map', null)    // reset coordinates when mouse leaves map</span></span>
<span id="cb22-12"><a href="#cb22-12"></a><span class="st">      })</span></span>
<span id="cb22-13"><a href="#cb22-13"></a><span class="st">    }"</span>)</span>
<span id="cb22-14"><a href="#cb22-14"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="full-code-6" class="level2" data-number="9.7">
<h2 data-number="9.7" class="anchored" data-anchor-id="full-code-6"><span class="header-section-number">9.7</span> Full code</h2>
<div class="cell">
<details class="code-fold">
<summary>Full code including Shiny events</summary>
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy"><code class="sourceCode r"><span id="annotated-cell-29-1"><a href="#annotated-cell-29-1"></a><span class="fu">library</span>(shiny)</span>
<span id="annotated-cell-29-2"><a href="#annotated-cell-29-2"></a><span class="fu">library</span>(htmltools)</span>
<span id="annotated-cell-29-3"><a href="#annotated-cell-29-3"></a><span class="fu">library</span>(bs4Dash)</span>
<span id="annotated-cell-29-4"><a href="#annotated-cell-29-4"></a><span class="fu">library</span>(fresh)</span>
<span id="annotated-cell-29-5"><a href="#annotated-cell-29-5"></a><span class="fu">library</span>(waiter)</span>
<span id="annotated-cell-29-6"><a href="#annotated-cell-29-6"></a><span class="fu">library</span>(shinyWidgets)</span>
<span id="annotated-cell-29-7"><a href="#annotated-cell-29-7"></a><span class="fu">library</span>(Guerry)</span>
<span id="annotated-cell-29-8"><a href="#annotated-cell-29-8"></a><span class="fu">library</span>(sf)</span>
<span id="annotated-cell-29-9"><a href="#annotated-cell-29-9"></a><span class="fu">library</span>(tidyr)</span>
<span id="annotated-cell-29-10"><a href="#annotated-cell-29-10"></a><span class="fu">library</span>(dplyr)</span>
<span id="annotated-cell-29-11"><a href="#annotated-cell-29-11"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="annotated-cell-29-12"><a href="#annotated-cell-29-12"></a><span class="fu">library</span>(viridis)</span>
<span id="annotated-cell-29-13"><a href="#annotated-cell-29-13"></a><span class="fu">library</span>(leaflet)</span>
<span id="annotated-cell-29-14"><a href="#annotated-cell-29-14"></a><span class="fu">library</span>(plotly)</span>
<span id="annotated-cell-29-15"><a href="#annotated-cell-29-15"></a><span class="fu">library</span>(ggplot2)</span>
<span id="annotated-cell-29-16"><a href="#annotated-cell-29-16"></a><span class="fu">library</span>(GGally)</span>
<span id="annotated-cell-29-17"><a href="#annotated-cell-29-17"></a><span class="fu">library</span>(datawizard)</span>
<span id="annotated-cell-29-18"><a href="#annotated-cell-29-18"></a><span class="fu">library</span>(parameters)</span>
<span id="annotated-cell-29-19"><a href="#annotated-cell-29-19"></a><span class="fu">library</span>(performance)</span>
<span id="annotated-cell-29-20"><a href="#annotated-cell-29-20"></a><span class="fu">library</span>(modelsummary)</span>
<span id="annotated-cell-29-21"><a href="#annotated-cell-29-21"></a></span>
<span id="annotated-cell-29-22"><a href="#annotated-cell-29-22"></a><span class="co"># 1 Data preparation ----</span></span>
<span id="annotated-cell-29-23"><a href="#annotated-cell-29-23"></a></span>
<span id="annotated-cell-29-24"><a href="#annotated-cell-29-24"></a><span class="do">## Load &amp; clean data ----</span></span>
<span id="annotated-cell-29-25"><a href="#annotated-cell-29-25"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-26"><a href="#annotated-cell-29-26"></a>  <span class="at">Crime_pers =</span> <span class="st">"Crime against persons"</span>,  </span>
<span id="annotated-cell-29-27"><a href="#annotated-cell-29-27"></a>  <span class="at">Crime_prop =</span>  <span class="st">"Crime against property"</span>,  </span>
<span id="annotated-cell-29-28"><a href="#annotated-cell-29-28"></a>  <span class="at">Literacy =</span> <span class="st">"Literacy"</span>,  </span>
<span id="annotated-cell-29-29"><a href="#annotated-cell-29-29"></a>  <span class="at">Donations =</span> <span class="st">"Donations to the poor"</span>,  </span>
<span id="annotated-cell-29-30"><a href="#annotated-cell-29-30"></a>  <span class="at">Infants =</span> <span class="st">"Illegitimate births"</span>,  </span>
<span id="annotated-cell-29-31"><a href="#annotated-cell-29-31"></a>  <span class="at">Suicides =</span> <span class="st">"Suicides"</span>,  </span>
<span id="annotated-cell-29-32"><a href="#annotated-cell-29-32"></a>  <span class="at">Wealth =</span> <span class="st">"Tax / capita"</span>,  </span>
<span id="annotated-cell-29-33"><a href="#annotated-cell-29-33"></a>  <span class="at">Commerce =</span> <span class="st">"Commerce &amp; Industry"</span>,  </span>
<span id="annotated-cell-29-34"><a href="#annotated-cell-29-34"></a>  <span class="at">Clergy =</span> <span class="st">"Clergy"</span>,  </span>
<span id="annotated-cell-29-35"><a href="#annotated-cell-29-35"></a>  <span class="at">Crime_parents =</span> <span class="st">"Crime against parents"</span>,  </span>
<span id="annotated-cell-29-36"><a href="#annotated-cell-29-36"></a>  <span class="at">Infanticide =</span> <span class="st">"Infanticides"</span>,  </span>
<span id="annotated-cell-29-37"><a href="#annotated-cell-29-37"></a>  <span class="at">Donation_clergy =</span> <span class="st">"Donations to the clergy"</span>,  </span>
<span id="annotated-cell-29-38"><a href="#annotated-cell-29-38"></a>  <span class="at">Lottery =</span> <span class="st">"Wager on Royal Lottery"</span>,  </span>
<span id="annotated-cell-29-39"><a href="#annotated-cell-29-39"></a>  <span class="at">Desertion =</span> <span class="st">"Military desertion"</span>,  </span>
<span id="annotated-cell-29-40"><a href="#annotated-cell-29-40"></a>  <span class="at">Instruction =</span> <span class="st">"Instruction"</span>,  </span>
<span id="annotated-cell-29-41"><a href="#annotated-cell-29-41"></a>  <span class="at">Prostitutes =</span> <span class="st">"Prostitutes"</span>,  </span>
<span id="annotated-cell-29-42"><a href="#annotated-cell-29-42"></a>  <span class="at">Distance =</span> <span class="st">"Distance to paris"</span>,  </span>
<span id="annotated-cell-29-43"><a href="#annotated-cell-29-43"></a>  <span class="at">Area =</span> <span class="st">"Area"</span>,  </span>
<span id="annotated-cell-29-44"><a href="#annotated-cell-29-44"></a>  <span class="at">Pop1831 =</span> <span class="st">"Population"</span></span>
<span id="annotated-cell-29-45"><a href="#annotated-cell-29-45"></a>)</span>
<span id="annotated-cell-29-46"><a href="#annotated-cell-29-46"></a></span>
<span id="annotated-cell-29-47"><a href="#annotated-cell-29-47"></a>variable_desc <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-48"><a href="#annotated-cell-29-48"></a>  <span class="at">Crime_pers =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-49"><a href="#annotated-cell-29-49"></a>    <span class="at">title =</span> <span class="st">"Crime against persons"</span>,</span>
<span id="annotated-cell-29-50"><a href="#annotated-cell-29-50"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against persons:"</span>), <span class="st">"Population per crime against persons"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1825-1830"</span>))),</span>
<span id="annotated-cell-29-51"><a href="#annotated-cell-29-51"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="annotated-cell-29-52"><a href="#annotated-cell-29-52"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-53"><a href="#annotated-cell-29-53"></a>  ),</span>
<span id="annotated-cell-29-54"><a href="#annotated-cell-29-54"></a>  <span class="at">Crime_prop =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-55"><a href="#annotated-cell-29-55"></a>    <span class="at">title =</span> <span class="st">"Crime against property"</span>,</span>
<span id="annotated-cell-29-56"><a href="#annotated-cell-29-56"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against property:"</span>), <span class="st">"Population per crime against property"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Compte général, 1825-1830"</span>))),</span>
<span id="annotated-cell-29-57"><a href="#annotated-cell-29-57"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per crime"</span>,</span>
<span id="annotated-cell-29-58"><a href="#annotated-cell-29-58"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-59"><a href="#annotated-cell-29-59"></a>  ),</span>
<span id="annotated-cell-29-60"><a href="#annotated-cell-29-60"></a>  <span class="at">Literacy =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-61"><a href="#annotated-cell-29-61"></a>    <span class="at">title =</span> <span class="st">"Literacy"</span>,</span>
<span id="annotated-cell-29-62"><a href="#annotated-cell-29-62"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Percent Read &amp; Write:"</span>), <span class="st">"Percent of military conscripts who can read and write"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833)"</span>))),</span>
<span id="annotated-cell-29-63"><a href="#annotated-cell-29-63"></a>    <span class="at">lgd =</span> <span class="st">"Literacy"</span>,</span>
<span id="annotated-cell-29-64"><a href="#annotated-cell-29-64"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="annotated-cell-29-65"><a href="#annotated-cell-29-65"></a>  ),</span>
<span id="annotated-cell-29-66"><a href="#annotated-cell-29-66"></a>  <span class="at">Donations =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-67"><a href="#annotated-cell-29-67"></a>    <span class="at">title =</span> <span class="st">"Donations to the poor"</span>,</span>
<span id="annotated-cell-29-68"><a href="#annotated-cell-29-68"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the poor"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bulletin des lois"</span>))),</span>
<span id="annotated-cell-29-69"><a href="#annotated-cell-29-69"></a>    <span class="at">lgd =</span> <span class="st">"Donations"</span>,</span>
<span id="annotated-cell-29-70"><a href="#annotated-cell-29-70"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-71"><a href="#annotated-cell-29-71"></a>  ),</span>
<span id="annotated-cell-29-72"><a href="#annotated-cell-29-72"></a>  <span class="at">Infants =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-73"><a href="#annotated-cell-29-73"></a>    <span class="at">title =</span> <span class="st">"Illegitimate births"</span>,</span>
<span id="annotated-cell-29-74"><a href="#annotated-cell-29-74"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per illegitimate birth"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Bureau des Longitudes, 1817-1821"</span>))),</span>
<span id="annotated-cell-29-75"><a href="#annotated-cell-29-75"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per birth"</span>,</span>
<span id="annotated-cell-29-76"><a href="#annotated-cell-29-76"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-77"><a href="#annotated-cell-29-77"></a>  ),</span>
<span id="annotated-cell-29-78"><a href="#annotated-cell-29-78"></a>  <span class="at">Suicides =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-79"><a href="#annotated-cell-29-79"></a>    <span class="at">title =</span> <span class="st">"Suicides"</span>,</span>
<span id="annotated-cell-29-80"><a href="#annotated-cell-29-80"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population per suicide"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A2 in Guerry (1833). Compte général, 1827-1830"</span>))),</span>
<span id="annotated-cell-29-81"><a href="#annotated-cell-29-81"></a>    <span class="at">lgd =</span> <span class="st">"Pop. per suicide"</span>,</span>
<span id="annotated-cell-29-82"><a href="#annotated-cell-29-82"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-83"><a href="#annotated-cell-29-83"></a>  ),</span>
<span id="annotated-cell-29-84"><a href="#annotated-cell-29-84"></a>  <span class="at">Wealth =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-85"><a href="#annotated-cell-29-85"></a>    <span class="at">title =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="annotated-cell-29-86"><a href="#annotated-cell-29-86"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita tax on personal property:"</span>), <span class="st">"A ranked index based on taxes on personal and movable property per inhabitant"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="annotated-cell-29-87"><a href="#annotated-cell-29-87"></a>    <span class="at">lgd =</span> <span class="st">"Tax / capita"</span>,</span>
<span id="annotated-cell-29-88"><a href="#annotated-cell-29-88"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-89"><a href="#annotated-cell-29-89"></a>  ),</span>
<span id="annotated-cell-29-90"><a href="#annotated-cell-29-90"></a>  <span class="at">Commerce =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-91"><a href="#annotated-cell-29-91"></a>    <span class="at">title =</span> <span class="st">"Commerce &amp; Industry"</span>,</span>
<span id="annotated-cell-29-92"><a href="#annotated-cell-29-92"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Commerce &amp; Industry:"</span>), <span class="st">"Commerce and Industry, measured by the rank of the number of patents / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833)"</span>))),</span>
<span id="annotated-cell-29-93"><a href="#annotated-cell-29-93"></a>    <span class="at">lgd =</span> <span class="st">"Patents / capita"</span>,</span>
<span id="annotated-cell-29-94"><a href="#annotated-cell-29-94"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-95"><a href="#annotated-cell-29-95"></a>  ),</span>
<span id="annotated-cell-29-96"><a href="#annotated-cell-29-96"></a>  <span class="at">Clergy =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-97"><a href="#annotated-cell-29-97"></a>    <span class="at">title =</span> <span class="st">"Clergy"</span>,</span>
<span id="annotated-cell-29-98"><a href="#annotated-cell-29-98"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distribution of clergy:"</span>), <span class="st">"Distribution of clergy, measured by the rank of the number of Catholic priests in active service / population"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Almanach officiel du clergy, 1829"</span>))),</span>
<span id="annotated-cell-29-99"><a href="#annotated-cell-29-99"></a>    <span class="at">lgd =</span> <span class="st">"Priests / capita"</span>,</span>
<span id="annotated-cell-29-100"><a href="#annotated-cell-29-100"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-101"><a href="#annotated-cell-29-101"></a>  ),</span>
<span id="annotated-cell-29-102"><a href="#annotated-cell-29-102"></a>  <span class="at">Crime_parents =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-103"><a href="#annotated-cell-29-103"></a>    <span class="at">title =</span> <span class="st">"Crime against parents"</span>,</span>
<span id="annotated-cell-29-104"><a href="#annotated-cell-29-104"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Crime against parents:"</span>), <span class="st">"Crimes against parents, measured by the rank of the ratio of crimes against parents to all crimes \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="annotated-cell-29-105"><a href="#annotated-cell-29-105"></a>    <span class="at">lgd =</span> <span class="st">"Share of crimes"</span>,</span>
<span id="annotated-cell-29-106"><a href="#annotated-cell-29-106"></a>    <span class="at">unit =</span> <span class="st">" %"</span></span>
<span id="annotated-cell-29-107"><a href="#annotated-cell-29-107"></a>  ),</span>
<span id="annotated-cell-29-108"><a href="#annotated-cell-29-108"></a>  <span class="at">Infanticide =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-109"><a href="#annotated-cell-29-109"></a>    <span class="at">title =</span> <span class="st">"Infanticides"</span>,</span>
<span id="annotated-cell-29-110"><a href="#annotated-cell-29-110"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Infanticides per capita:"</span>), <span class="st">"Ranked ratio of number of infanticides to population \u2013 Average for the years 1825-1830"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte général"</span>))),</span>
<span id="annotated-cell-29-111"><a href="#annotated-cell-29-111"></a>    <span class="at">lgd =</span> <span class="st">"Infanticides / capita"</span>,</span>
<span id="annotated-cell-29-112"><a href="#annotated-cell-29-112"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-113"><a href="#annotated-cell-29-113"></a>  ),</span>
<span id="annotated-cell-29-114"><a href="#annotated-cell-29-114"></a>  <span class="at">Donation_clergy =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-115"><a href="#annotated-cell-29-115"></a>    <span class="at">title =</span> <span class="st">"Donations to the clergy"</span>,</span>
<span id="annotated-cell-29-116"><a href="#annotated-cell-29-116"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Donations to the clergy:"</span>), <span class="st">"Ranked ratios of the number of bequests and donations inter vivios to population \u2013 Average for the years 1815-1824"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Bull. des lois, ordunn. d’autorisation"</span>))),</span>
<span id="annotated-cell-29-117"><a href="#annotated-cell-29-117"></a>    <span class="at">lgd =</span> <span class="st">"Donations / capita"</span>,</span>
<span id="annotated-cell-29-118"><a href="#annotated-cell-29-118"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-119"><a href="#annotated-cell-29-119"></a>  ),</span>
<span id="annotated-cell-29-120"><a href="#annotated-cell-29-120"></a>  <span class="at">Lottery =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-121"><a href="#annotated-cell-29-121"></a>    <span class="at">title =</span> <span class="st">"Wager on Royal Lottery"</span>,</span>
<span id="annotated-cell-29-122"><a href="#annotated-cell-29-122"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Per capita wager on Royal Lottery:"</span>), <span class="st">"Ranked ratio of the proceeds bet on the royal lottery to population \u2013 Average for the years 1822-1826"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte rendu par le ministre des finances"</span>))),</span>
<span id="annotated-cell-29-123"><a href="#annotated-cell-29-123"></a>    <span class="at">lgd =</span> <span class="st">"Wager / capita"</span>,</span>
<span id="annotated-cell-29-124"><a href="#annotated-cell-29-124"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-125"><a href="#annotated-cell-29-125"></a>  ),</span>
<span id="annotated-cell-29-126"><a href="#annotated-cell-29-126"></a>  <span class="at">Desertion =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-127"><a href="#annotated-cell-29-127"></a>    <span class="at">title =</span> <span class="st">"Military desertion"</span>,</span>
<span id="annotated-cell-29-128"><a href="#annotated-cell-29-128"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Military desertion:"</span>), <span class="st">"Military disertion, ratio of the number of young soldiers accused of desertion to the force of the military contingent, minus the deficit produced by the insufficiency of available billets\u2013 Average of the years 1825-1827"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Table A1 in Guerry (1833). Compte du ministère du guerre, 1829 état V"</span>))),</span>
<span id="annotated-cell-29-129"><a href="#annotated-cell-29-129"></a>    <span class="at">lgd =</span> <span class="st">"No. of desertions"</span>,</span>
<span id="annotated-cell-29-130"><a href="#annotated-cell-29-130"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-131"><a href="#annotated-cell-29-131"></a>  ),</span>
<span id="annotated-cell-29-132"><a href="#annotated-cell-29-132"></a>  <span class="at">Instruction =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-133"><a href="#annotated-cell-29-133"></a>    <span class="at">title =</span> <span class="st">"Instruction"</span>,</span>
<span id="annotated-cell-29-134"><a href="#annotated-cell-29-134"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Instruction:"</span>), <span class="st">"Ranks recorded from Guerry's map of Instruction. Note: this is inversely related to literacy (as defined here)"</span>)),</span>
<span id="annotated-cell-29-135"><a href="#annotated-cell-29-135"></a>    <span class="at">lgd =</span> <span class="st">"Instruction"</span>,</span>
<span id="annotated-cell-29-136"><a href="#annotated-cell-29-136"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-137"><a href="#annotated-cell-29-137"></a>  ),</span>
<span id="annotated-cell-29-138"><a href="#annotated-cell-29-138"></a>  <span class="at">Prostitutes =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-139"><a href="#annotated-cell-29-139"></a>    <span class="at">title =</span> <span class="st">"Prostitutes"</span>,</span>
<span id="annotated-cell-29-140"><a href="#annotated-cell-29-140"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Prostitutes in Paris:"</span>), <span class="st">"Number of prostitutes registered in Paris from 1816 to 1834, classified by the department of their birth"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Parent-Duchatelet (1836), De la prostitution en Paris"</span>))),</span>
<span id="annotated-cell-29-141"><a href="#annotated-cell-29-141"></a>    <span class="at">lgd =</span> <span class="st">"No. of prostitutes"</span>,</span>
<span id="annotated-cell-29-142"><a href="#annotated-cell-29-142"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-143"><a href="#annotated-cell-29-143"></a>  ),</span>
<span id="annotated-cell-29-144"><a href="#annotated-cell-29-144"></a>  <span class="at">Distance =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-145"><a href="#annotated-cell-29-145"></a>    <span class="at">title =</span> <span class="st">"Distance to paris"</span>,</span>
<span id="annotated-cell-29-146"><a href="#annotated-cell-29-146"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Distance to Paris (km):"</span>), <span class="st">"Distance of each department centroid to the centroid of the Seine (Paris)"</span>, <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Calculated from department centroids"</span>))),</span>
<span id="annotated-cell-29-147"><a href="#annotated-cell-29-147"></a>    <span class="at">lgd =</span> <span class="st">"Distance"</span>,</span>
<span id="annotated-cell-29-148"><a href="#annotated-cell-29-148"></a>    <span class="at">unit =</span> <span class="st">" km"</span></span>
<span id="annotated-cell-29-149"><a href="#annotated-cell-29-149"></a>  ),</span>
<span id="annotated-cell-29-150"><a href="#annotated-cell-29-150"></a>  <span class="at">Area =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-151"><a href="#annotated-cell-29-151"></a>    <span class="at">title =</span> <span class="st">"Area"</span>,</span>
<span id="annotated-cell-29-152"><a href="#annotated-cell-29-152"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Area (1000 km\u00b2)"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Angeville (1836)"</span>))),</span>
<span id="annotated-cell-29-153"><a href="#annotated-cell-29-153"></a>    <span class="at">lgd =</span> <span class="st">"Area"</span>,</span>
<span id="annotated-cell-29-154"><a href="#annotated-cell-29-154"></a>    <span class="at">unit =</span> <span class="st">" km\u00b2"</span></span>
<span id="annotated-cell-29-155"><a href="#annotated-cell-29-155"></a>  ),</span>
<span id="annotated-cell-29-156"><a href="#annotated-cell-29-156"></a>  <span class="at">Pop1831 =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-157"><a href="#annotated-cell-29-157"></a>    <span class="at">title =</span> <span class="st">"Population"</span>,</span>
<span id="annotated-cell-29-158"><a href="#annotated-cell-29-158"></a>    <span class="at">desc =</span> <span class="fu">as.character</span>(<span class="fu">p</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Population in 1831, in 1000s"</span>), <span class="fu">hr</span>(), <span class="fu">helpText</span>(<span class="st">"Source: Taken from Angeville (1836), Essai sur la Statistique de la Population français"</span>))),</span>
<span id="annotated-cell-29-159"><a href="#annotated-cell-29-159"></a>    <span class="at">lgd =</span> <span class="st">"Population (in 1000s)"</span>,</span>
<span id="annotated-cell-29-160"><a href="#annotated-cell-29-160"></a>    <span class="at">unit =</span> <span class="st">""</span></span>
<span id="annotated-cell-29-161"><a href="#annotated-cell-29-161"></a>  )</span>
<span id="annotated-cell-29-162"><a href="#annotated-cell-29-162"></a>)</span>
<span id="annotated-cell-29-163"><a href="#annotated-cell-29-163"></a></span>
<span id="annotated-cell-29-164"><a href="#annotated-cell-29-164"></a>data_guerry <span class="ot">&lt;-</span> Guerry<span class="sc">::</span>gfrance85 <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-165"><a href="#annotated-cell-29-165"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-166"><a href="#annotated-cell-29-166"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-167"><a href="#annotated-cell-29-167"></a>  <span class="fu">st_as_sf</span>(<span class="at">crs =</span> <span class="dv">27572</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-168"><a href="#annotated-cell-29-168"></a>  <span class="fu">mutate</span>(<span class="at">Region =</span> <span class="fu">case_match</span>(</span>
<span id="annotated-cell-29-169"><a href="#annotated-cell-29-169"></a>    Region,</span>
<span id="annotated-cell-29-170"><a href="#annotated-cell-29-170"></a>    <span class="st">"C"</span> <span class="sc">~</span> <span class="st">"Central"</span>,</span>
<span id="annotated-cell-29-171"><a href="#annotated-cell-29-171"></a>    <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"East"</span>,</span>
<span id="annotated-cell-29-172"><a href="#annotated-cell-29-172"></a>    <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"North"</span>,</span>
<span id="annotated-cell-29-173"><a href="#annotated-cell-29-173"></a>    <span class="st">"S"</span> <span class="sc">~</span> <span class="st">"South"</span>,</span>
<span id="annotated-cell-29-174"><a href="#annotated-cell-29-174"></a>    <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"West"</span></span>
<span id="annotated-cell-29-175"><a href="#annotated-cell-29-175"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-176"><a href="#annotated-cell-29-176"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"COUNT"</span>, <span class="st">"dept"</span>, <span class="st">"AVE_ID_GEO"</span>, <span class="st">"CODE_DEPT"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-177"><a href="#annotated-cell-29-177"></a>  <span class="fu">select</span>(Region<span class="sc">:</span>Department, <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)))</span>
<span id="annotated-cell-29-178"><a href="#annotated-cell-29-178"></a></span>
<span id="annotated-cell-29-179"><a href="#annotated-cell-29-179"></a></span>
<span id="annotated-cell-29-180"><a href="#annotated-cell-29-180"></a></span>
<span id="annotated-cell-29-181"><a href="#annotated-cell-29-181"></a><span class="do">## Prep data (Tab: Tabulate data) ----</span></span>
<span id="annotated-cell-29-182"><a href="#annotated-cell-29-182"></a>data_guerry_tabulate <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-29-183"><a href="#annotated-cell-29-183"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="annotated-cell-29-184"><a href="#annotated-cell-29-184"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)), round, <span class="dv">2</span>))</span>
<span id="annotated-cell-29-185"><a href="#annotated-cell-29-185"></a></span>
<span id="annotated-cell-29-186"><a href="#annotated-cell-29-186"></a></span>
<span id="annotated-cell-29-187"><a href="#annotated-cell-29-187"></a><span class="do">## Prep data (Tab: Map data) ----</span></span>
<span id="annotated-cell-29-188"><a href="#annotated-cell-29-188"></a>data_guerry_region <span class="ot">&lt;-</span> data_guerry <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-189"><a href="#annotated-cell-29-189"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-190"><a href="#annotated-cell-29-190"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="annotated-cell-29-191"><a href="#annotated-cell-29-191"></a>    <span class="at">.cols =</span> <span class="fu">all_of</span>(<span class="fu">names</span>(variable_names)),</span>
<span id="annotated-cell-29-192"><a href="#annotated-cell-29-192"></a>    <span class="cf">function</span>(x) {</span>
<span id="annotated-cell-29-193"><a href="#annotated-cell-29-193"></a>      <span class="cf">if</span> (<span class="fu">cur_column</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Area"</span>, <span class="st">"Pop1831"</span>)) {</span>
<span id="annotated-cell-29-194"><a href="#annotated-cell-29-194"></a>        <span class="fu">sum</span>(x)</span>
<span id="annotated-cell-29-195"><a href="#annotated-cell-29-195"></a>      } <span class="cf">else</span> {</span>
<span id="annotated-cell-29-196"><a href="#annotated-cell-29-196"></a>        <span class="fu">mean</span>(x)</span>
<span id="annotated-cell-29-197"><a href="#annotated-cell-29-197"></a>      }</span>
<span id="annotated-cell-29-198"><a href="#annotated-cell-29-198"></a>    }</span>
<span id="annotated-cell-29-199"><a href="#annotated-cell-29-199"></a>  ))</span>
<span id="annotated-cell-29-200"><a href="#annotated-cell-29-200"></a></span>
<span id="annotated-cell-29-201"><a href="#annotated-cell-29-201"></a><span class="do">## Prepare palettes ----</span></span>
<span id="annotated-cell-29-202"><a href="#annotated-cell-29-202"></a><span class="do">## Used for mapping</span></span>
<span id="annotated-cell-29-203"><a href="#annotated-cell-29-203"></a>pals <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-204"><a href="#annotated-cell-29-204"></a>  <span class="at">Sequential =</span> RColorBrewer<span class="sc">::</span>brewer.pal.info <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-205"><a href="#annotated-cell-29-205"></a>    <span class="fu">filter</span>(category <span class="sc">%in%</span> <span class="st">"seq"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-206"><a href="#annotated-cell-29-206"></a>    <span class="fu">row.names</span>(),</span>
<span id="annotated-cell-29-207"><a href="#annotated-cell-29-207"></a>  <span class="at">Viridis =</span> <span class="fu">c</span>(<span class="st">"Magma"</span>, <span class="st">"Inferno"</span>, <span class="st">"Plasma"</span>, <span class="st">"Viridis"</span>,</span>
<span id="annotated-cell-29-208"><a href="#annotated-cell-29-208"></a>              <span class="st">"Cividis"</span>, <span class="st">"Rocket"</span>, <span class="st">"Mako"</span>, <span class="st">"Turbo"</span>)</span>
<span id="annotated-cell-29-209"><a href="#annotated-cell-29-209"></a>)</span>
<span id="annotated-cell-29-210"><a href="#annotated-cell-29-210"></a></span>
<span id="annotated-cell-29-211"><a href="#annotated-cell-29-211"></a><span class="do">## Prepare modebar clean-up ----</span></span>
<span id="annotated-cell-29-212"><a href="#annotated-cell-29-212"></a><span class="do">## Used for modelling</span></span>
<span id="annotated-cell-29-213"><a href="#annotated-cell-29-213"></a>plotly_buttons <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-29-214"><a href="#annotated-cell-29-214"></a>  <span class="st">"sendDataToCloud"</span>, <span class="st">"zoom2d"</span>, <span class="st">"select2d"</span>, <span class="st">"lasso2d"</span>, <span class="st">"autoScale2d"</span>,</span>
<span id="annotated-cell-29-215"><a href="#annotated-cell-29-215"></a>  <span class="st">"hoverClosestCartesian"</span>, <span class="st">"hoverCompareCartesian"</span>, <span class="st">"resetScale2d"</span></span>
<span id="annotated-cell-29-216"><a href="#annotated-cell-29-216"></a>)</span>
<span id="annotated-cell-29-217"><a href="#annotated-cell-29-217"></a></span>
<span id="annotated-cell-29-218"><a href="#annotated-cell-29-218"></a></span>
<span id="annotated-cell-29-219"><a href="#annotated-cell-29-219"></a></span>
<span id="annotated-cell-29-220"><a href="#annotated-cell-29-220"></a></span>
<span id="annotated-cell-29-221"><a href="#annotated-cell-29-221"></a><span class="co"># 3 UI ----</span></span>
<span id="annotated-cell-29-222"><a href="#annotated-cell-29-222"></a></span>
<span id="annotated-cell-29-223"><a href="#annotated-cell-29-223"></a>ui <span class="ot">&lt;-</span> <span class="fu">dashboardPage</span>(</span>
<span id="annotated-cell-29-224"><a href="#annotated-cell-29-224"></a>  <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="annotated-cell-29-225"><a href="#annotated-cell-29-225"></a>  <span class="do">## 3.1 Header ----</span></span>
<span id="annotated-cell-29-226"><a href="#annotated-cell-29-226"></a>  <span class="at">header =</span> <span class="fu">dashboardHeader</span>(</span>
<span id="annotated-cell-29-227"><a href="#annotated-cell-29-227"></a>    <span class="at">title =</span> <span class="fu">tagList</span>(</span>
<span id="annotated-cell-29-228"><a href="#annotated-cell-29-228"></a>      <span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../workshop-logo.png"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">35</span>),</span>
<span id="annotated-cell-29-229"><a href="#annotated-cell-29-229"></a>      <span class="fu">span</span>(<span class="st">"The Guerry Dashboard"</span>, <span class="at">class =</span> <span class="st">"brand-text"</span>)</span>
<span id="annotated-cell-29-230"><a href="#annotated-cell-29-230"></a>    )</span>
<span id="annotated-cell-29-231"><a href="#annotated-cell-29-231"></a>  ),</span>
<span id="annotated-cell-29-232"><a href="#annotated-cell-29-232"></a>  <span class="do">## 3.2 Sidebar ----</span></span>
<span id="annotated-cell-29-233"><a href="#annotated-cell-29-233"></a>  <span class="at">sidebar =</span> <span class="fu">dashboardSidebar</span>(</span>
<span id="annotated-cell-29-234"><a href="#annotated-cell-29-234"></a>    <span class="at">id =</span> <span class="st">"sidebar"</span>,</span>
<span id="annotated-cell-29-235"><a href="#annotated-cell-29-235"></a>    <span class="fu">sidebarMenu</span>(</span>
<span id="annotated-cell-29-236"><a href="#annotated-cell-29-236"></a>      <span class="at">id =</span> <span class="st">"sidebarMenu"</span>,</span>
<span id="annotated-cell-29-237"><a href="#annotated-cell-29-237"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_intro"</span>, <span class="at">text =</span> <span class="st">"Introduction"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"home"</span>)),</span>
<span id="annotated-cell-29-238"><a href="#annotated-cell-29-238"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>, <span class="at">text =</span> <span class="st">"Tabulate data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"table"</span>)),</span>
<span id="annotated-cell-29-239"><a href="#annotated-cell-29-239"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_model"</span>, <span class="at">text =</span> <span class="st">"Model data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"chart-line"</span>)),</span>
<span id="annotated-cell-29-240"><a href="#annotated-cell-29-240"></a>      <span class="fu">menuItem</span>(<span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="at">text =</span> <span class="st">"Map data"</span>, <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"map"</span>)),</span>
<span id="annotated-cell-29-241"><a href="#annotated-cell-29-241"></a>      <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-29-242"><a href="#annotated-cell-29-242"></a>    ),</span>
<span id="annotated-cell-29-243"><a href="#annotated-cell-29-243"></a>    <span class="at">minified =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-244"><a href="#annotated-cell-29-244"></a>    <span class="at">collapsed =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-245"><a href="#annotated-cell-29-245"></a>    <span class="at">fixed =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-246"><a href="#annotated-cell-29-246"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="annotated-cell-29-247"><a href="#annotated-cell-29-247"></a>  ),</span>
<span id="annotated-cell-29-248"><a href="#annotated-cell-29-248"></a>  <span class="do">## 3.3 Body ----</span></span>
<span id="annotated-cell-29-249"><a href="#annotated-cell-29-249"></a>  <span class="at">body =</span> <span class="fu">dashboardBody</span>(</span>
<span id="annotated-cell-29-250"><a href="#annotated-cell-29-250"></a>    <span class="fu">tabItems</span>(</span>
<span id="annotated-cell-29-251"><a href="#annotated-cell-29-251"></a>      <span class="do">### 3.1.1 Tab: Introduction ----</span></span>
<span id="annotated-cell-29-252"><a href="#annotated-cell-29-252"></a>      <span class="fu">tabItem</span>(</span>
<span id="annotated-cell-29-253"><a href="#annotated-cell-29-253"></a>        <span class="at">tabName =</span> <span class="st">"tab_intro"</span>,</span>
<span id="annotated-cell-29-254"><a href="#annotated-cell-29-254"></a>        <span class="fu">jumbotron</span>(</span>
<span id="annotated-cell-29-255"><a href="#annotated-cell-29-255"></a>          <span class="at">title =</span> <span class="st">"The Guerry Dashboard"</span>,</span>
<span id="annotated-cell-29-256"><a href="#annotated-cell-29-256"></a>          <span class="at">lead =</span> <span class="st">"A Shiny app to explore the classic Guerry dataset."</span>,</span>
<span id="annotated-cell-29-257"><a href="#annotated-cell-29-257"></a>          <span class="at">status =</span> <span class="st">"info"</span>,</span>
<span id="annotated-cell-29-258"><a href="#annotated-cell-29-258"></a>          <span class="at">btnName =</span> <span class="cn">NULL</span></span>
<span id="annotated-cell-29-259"><a href="#annotated-cell-29-259"></a>        ),</span>
<span id="annotated-cell-29-260"><a href="#annotated-cell-29-260"></a>        <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-29-261"><a href="#annotated-cell-29-261"></a>          <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">1</span>),</span>
<span id="annotated-cell-29-262"><a href="#annotated-cell-29-262"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-263"><a href="#annotated-cell-29-263"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="annotated-cell-29-264"><a href="#annotated-cell-29-264"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-265"><a href="#annotated-cell-29-265"></a>              <span class="at">title =</span> <span class="st">"About"</span>,</span>
<span id="annotated-cell-29-266"><a href="#annotated-cell-29-266"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-267"><a href="#annotated-cell-29-267"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-268"><a href="#annotated-cell-29-268"></a>              <span class="fu">blockQuote</span>(<span class="fu">HTML</span>(<span class="st">"André-Michel Guerry was a French lawyer and</span></span>
<span id="annotated-cell-29-269"><a href="#annotated-cell-29-269"></a><span class="st">                          amateur statistician. Together with Adolphe</span></span>
<span id="annotated-cell-29-270"><a href="#annotated-cell-29-270"></a><span class="st">                          Quetelet he may be regarded as the founder of</span></span>
<span id="annotated-cell-29-271"><a href="#annotated-cell-29-271"></a><span class="st">                          moral statistics which led to the development</span></span>
<span id="annotated-cell-29-272"><a href="#annotated-cell-29-272"></a><span class="st">                          of criminology, sociology and ultimately,</span></span>
<span id="annotated-cell-29-273"><a href="#annotated-cell-29-273"></a><span class="st">                          modern social science. &lt;br&gt;— Wikipedia: &lt;a href='https://en.wikipedia.org/wiki/Andr%C3%A9-Michel_Guerry'&gt;André-Michel Guerry&lt;/a&gt;"</span>),</span>
<span id="annotated-cell-29-274"><a href="#annotated-cell-29-274"></a>                         <span class="at">color =</span> <span class="st">"primary"</span>),</span>
<span id="annotated-cell-29-275"><a href="#annotated-cell-29-275"></a>              <span class="fu">p</span>(<span class="fu">HTML</span>(<span class="st">"Andre-Michel Guerry (1833) was the first to </span></span>
<span id="annotated-cell-29-276"><a href="#annotated-cell-29-276"></a><span class="st">              systematically collect and analyze social data </span></span>
<span id="annotated-cell-29-277"><a href="#annotated-cell-29-277"></a><span class="st">               on such things as crime, literacy and suicide </span></span>
<span id="annotated-cell-29-278"><a href="#annotated-cell-29-278"></a><span class="st">               with the view to determining social laws and the </span></span>
<span id="annotated-cell-29-279"><a href="#annotated-cell-29-279"></a><span class="st">               relations among these variables. The Guerry data </span></span>
<span id="annotated-cell-29-280"><a href="#annotated-cell-29-280"></a><span class="st">               frame comprises a collection of 'moral variables' </span></span>
<span id="annotated-cell-29-281"><a href="#annotated-cell-29-281"></a><span class="st">               (cf. &lt;i&gt;&lt;a href='https://en.wikipedia.org/wiki/Moral_statistics'&gt;moral statistics&lt;/a&gt;&lt;/i&gt;) </span></span>
<span id="annotated-cell-29-282"><a href="#annotated-cell-29-282"></a><span class="st">               on the 86 departments of France around 1830. </span></span>
<span id="annotated-cell-29-283"><a href="#annotated-cell-29-283"></a><span class="st">               A few additional variables have been added </span></span>
<span id="annotated-cell-29-284"><a href="#annotated-cell-29-284"></a><span class="st">               from other sources. In total the data frame has </span></span>
<span id="annotated-cell-29-285"><a href="#annotated-cell-29-285"></a><span class="st">               86 observations (the departments of France) on 23 variables &lt;i&gt;(Source: &lt;code&gt;?Guerry&lt;/code&gt;)&lt;/i&gt;. </span></span>
<span id="annotated-cell-29-286"><a href="#annotated-cell-29-286"></a><span class="st">               In this app, we aim to explore Guerry’s data</span></span>
<span id="annotated-cell-29-287"><a href="#annotated-cell-29-287"></a><span class="st">                using spatial exploration and regression modelling."</span>)),</span>
<span id="annotated-cell-29-288"><a href="#annotated-cell-29-288"></a>              <span class="fu">hr</span>(),</span>
<span id="annotated-cell-29-289"><a href="#annotated-cell-29-289"></a>              <span class="fu">accordion</span>(</span>
<span id="annotated-cell-29-290"><a href="#annotated-cell-29-290"></a>                <span class="at">id =</span> <span class="st">"accord"</span>,</span>
<span id="annotated-cell-29-291"><a href="#annotated-cell-29-291"></a>                <span class="fu">accordionItem</span>(</span>
<span id="annotated-cell-29-292"><a href="#annotated-cell-29-292"></a>                  <span class="at">title =</span> <span class="st">"References"</span>,</span>
<span id="annotated-cell-29-293"><a href="#annotated-cell-29-293"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-294"><a href="#annotated-cell-29-294"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-295"><a href="#annotated-cell-29-295"></a>                  <span class="st">"The following sources are referenced in this app:"</span>,</span>
<span id="annotated-cell-29-296"><a href="#annotated-cell-29-296"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(</span>
<span id="annotated-cell-29-297"><a href="#annotated-cell-29-297"></a>                    <span class="at">class =</span> <span class="st">"list-style: none"</span>,</span>
<span id="annotated-cell-29-298"><a href="#annotated-cell-29-298"></a>                    <span class="at">style =</span> <span class="st">"margin-left: -30px;"</span>,</span>
<span id="annotated-cell-29-299"><a href="#annotated-cell-29-299"></a>                    <span class="fu">p</span>(<span class="st">"Angeville, A. (1836). Essai sur la Statistique de la Population française Paris: F. Doufour."</span>),</span>
<span id="annotated-cell-29-300"><a href="#annotated-cell-29-300"></a>                    <span class="fu">p</span>(<span class="st">"Guerry, A.-M. (1833). Essai sur la statistique morale de la France Paris: Crochard. English translation: Hugh P. Whitt and Victor W. Reinking, Lewiston, N.Y. : Edwin Mellen Press, 2002."</span>),</span>
<span id="annotated-cell-29-301"><a href="#annotated-cell-29-301"></a>                    <span class="fu">p</span>(<span class="st">"Parent-Duchatelet, A. (1836). De la prostitution dans la ville de Paris, 3rd ed, 1857, p. 32, 36"</span>),</span>
<span id="annotated-cell-29-302"><a href="#annotated-cell-29-302"></a>                    <span class="fu">p</span>(<span class="st">"Palsky, G. (2008). Connections and exchanges in European thematic cartography. The case of 19th century choropleth maps. Belgeo 3-4, 413-426."</span>)</span>
<span id="annotated-cell-29-303"><a href="#annotated-cell-29-303"></a>                  )</span>
<span id="annotated-cell-29-304"><a href="#annotated-cell-29-304"></a>                ),</span>
<span id="annotated-cell-29-305"><a href="#annotated-cell-29-305"></a>                <span class="fu">accordionItem</span>(</span>
<span id="annotated-cell-29-306"><a href="#annotated-cell-29-306"></a>                  <span class="at">title =</span> <span class="st">"Details"</span>,</span>
<span id="annotated-cell-29-307"><a href="#annotated-cell-29-307"></a>                  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-308"><a href="#annotated-cell-29-308"></a>                  <span class="at">solidHeader =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-309"><a href="#annotated-cell-29-309"></a>                  <span class="fu">p</span>(<span class="st">"This app was created as part of a Shiny workshop held in July 2023"</span>),</span>
<span id="annotated-cell-29-310"><a href="#annotated-cell-29-310"></a>                  <span class="fu">p</span>(<span class="st">"Last update: June 2023"</span>),</span>
<span id="annotated-cell-29-311"><a href="#annotated-cell-29-311"></a>                  <span class="fu">p</span>(<span class="st">"Further information about the data can be found"</span>,</span>
<span id="annotated-cell-29-312"><a href="#annotated-cell-29-312"></a>                    <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://www.datavis.ca/gallery/guerry/guerrydat.html"</span>))</span>
<span id="annotated-cell-29-313"><a href="#annotated-cell-29-313"></a>                )</span>
<span id="annotated-cell-29-314"><a href="#annotated-cell-29-314"></a>              )</span>
<span id="annotated-cell-29-315"><a href="#annotated-cell-29-315"></a>            )</span>
<span id="annotated-cell-29-316"><a href="#annotated-cell-29-316"></a>          ),</span>
<span id="annotated-cell-29-317"><a href="#annotated-cell-29-317"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-318"><a href="#annotated-cell-29-318"></a>            <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="annotated-cell-29-319"><a href="#annotated-cell-29-319"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-320"><a href="#annotated-cell-29-320"></a>              <span class="at">title =</span> <span class="st">"André Michel Guerry"</span>,</span>
<span id="annotated-cell-29-321"><a href="#annotated-cell-29-321"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-322"><a href="#annotated-cell-29-322"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-323"><a href="#annotated-cell-29-323"></a>              tags<span class="sc">$</span><span class="fu">img</span>(<span class="at">src =</span> <span class="st">"../guerry.jpg"</span>, <span class="at">width =</span> <span class="st">"100%"</span>),</span>
<span id="annotated-cell-29-324"><a href="#annotated-cell-29-324"></a>              <span class="fu">p</span>(<span class="st">"Source: Palsky (2008)"</span>)</span>
<span id="annotated-cell-29-325"><a href="#annotated-cell-29-325"></a>            )</span>
<span id="annotated-cell-29-326"><a href="#annotated-cell-29-326"></a>          )</span>
<span id="annotated-cell-29-327"><a href="#annotated-cell-29-327"></a>        )</span>
<span id="annotated-cell-29-328"><a href="#annotated-cell-29-328"></a>      ),</span>
<span id="annotated-cell-29-329"><a href="#annotated-cell-29-329"></a>      <span class="do">### 3.3.2 Tab: Tabulate data ----</span></span>
<span id="annotated-cell-29-330"><a href="#annotated-cell-29-330"></a>      <span class="fu">tabItem</span>(</span>
<span id="annotated-cell-29-331"><a href="#annotated-cell-29-331"></a>        <span class="at">tabName =</span> <span class="st">"tab_tabulate"</span>,</span>
<span id="annotated-cell-29-332"><a href="#annotated-cell-29-332"></a>        <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-29-333"><a href="#annotated-cell-29-333"></a>          <span class="do">#### Inputs(s) ----</span></span>
<span id="annotated-cell-29-334"><a href="#annotated-cell-29-334"></a>          <span class="fu">pickerInput</span>(</span>
<span id="annotated-cell-29-335"><a href="#annotated-cell-29-335"></a>            <span class="st">"tab_tabulate_select"</span>,</span>
<span id="annotated-cell-29-336"><a href="#annotated-cell-29-336"></a>            <span class="at">label =</span> <span class="st">"Filter variables"</span>,</span>
<span id="annotated-cell-29-337"><a href="#annotated-cell-29-337"></a>            <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="annotated-cell-29-338"><a href="#annotated-cell-29-338"></a>            <span class="at">options =</span> <span class="fu">pickerOptions</span>(</span>
<span id="annotated-cell-29-339"><a href="#annotated-cell-29-339"></a>              <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-340"><a href="#annotated-cell-29-340"></a>              <span class="at">windowPadding =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="annotated-cell-29-341"><a href="#annotated-cell-29-341"></a>              <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-342"><a href="#annotated-cell-29-342"></a>              <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="annotated-cell-29-343"><a href="#annotated-cell-29-343"></a>              <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="annotated-cell-29-344"><a href="#annotated-cell-29-344"></a>              <span class="at">noneSelectedText =</span> <span class="st">"No filters applied"</span></span>
<span id="annotated-cell-29-345"><a href="#annotated-cell-29-345"></a>            ),</span>
<span id="annotated-cell-29-346"><a href="#annotated-cell-29-346"></a>            <span class="at">inline =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-347"><a href="#annotated-cell-29-347"></a>            <span class="at">multiple =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-29-348"><a href="#annotated-cell-29-348"></a>          )</span>
<span id="annotated-cell-29-349"><a href="#annotated-cell-29-349"></a>        ),</span>
<span id="annotated-cell-29-350"><a href="#annotated-cell-29-350"></a>        <span class="fu">hr</span>(),</span>
<span id="annotated-cell-29-351"><a href="#annotated-cell-29-351"></a>        <span class="do">#### Output(s) (Data table) ----</span></span>
<span id="annotated-cell-29-352"><a href="#annotated-cell-29-352"></a>        DT<span class="sc">::</span><span class="fu">dataTableOutput</span>(<span class="st">"tab_tabulate_table"</span>)</span>
<span id="annotated-cell-29-353"><a href="#annotated-cell-29-353"></a>      ),</span>
<span id="annotated-cell-29-354"><a href="#annotated-cell-29-354"></a>      <span class="do">### 3.3.3 Tab: Model data ----</span></span>
<span id="annotated-cell-29-355"><a href="#annotated-cell-29-355"></a>      <span class="fu">tabItem</span>(</span>
<span id="annotated-cell-29-356"><a href="#annotated-cell-29-356"></a>        <span class="at">tabName =</span> <span class="st">"tab_model"</span>,</span>
<span id="annotated-cell-29-357"><a href="#annotated-cell-29-357"></a>        <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-29-358"><a href="#annotated-cell-29-358"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-359"><a href="#annotated-cell-29-359"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="annotated-cell-29-360"><a href="#annotated-cell-29-360"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="annotated-cell-29-361"><a href="#annotated-cell-29-361"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-362"><a href="#annotated-cell-29-362"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-363"><a href="#annotated-cell-29-363"></a>              <span class="at">title =</span> <span class="st">"Select variables"</span>,</span>
<span id="annotated-cell-29-364"><a href="#annotated-cell-29-364"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-365"><a href="#annotated-cell-29-365"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="annotated-cell-29-366"><a href="#annotated-cell-29-366"></a>                <span class="st">"model_x"</span>,</span>
<span id="annotated-cell-29-367"><a href="#annotated-cell-29-367"></a>                <span class="at">label =</span> <span class="st">"Select a dependent variable"</span>,</span>
<span id="annotated-cell-29-368"><a href="#annotated-cell-29-368"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="annotated-cell-29-369"><a href="#annotated-cell-29-369"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(<span class="at">liveSearch =</span> <span class="cn">TRUE</span>),</span>
<span id="annotated-cell-29-370"><a href="#annotated-cell-29-370"></a>                <span class="at">selected =</span> <span class="st">"Literacy"</span></span>
<span id="annotated-cell-29-371"><a href="#annotated-cell-29-371"></a>              ),</span>
<span id="annotated-cell-29-372"><a href="#annotated-cell-29-372"></a>              shinyWidgets<span class="sc">::</span><span class="fu">pickerInput</span>(</span>
<span id="annotated-cell-29-373"><a href="#annotated-cell-29-373"></a>                <span class="st">"model_y"</span>,</span>
<span id="annotated-cell-29-374"><a href="#annotated-cell-29-374"></a>                <span class="at">label =</span> <span class="st">"Select independent variables"</span>,</span>
<span id="annotated-cell-29-375"><a href="#annotated-cell-29-375"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names),</span>
<span id="annotated-cell-29-376"><a href="#annotated-cell-29-376"></a>                <span class="at">options =</span> shinyWidgets<span class="sc">::</span><span class="fu">pickerOptions</span>(</span>
<span id="annotated-cell-29-377"><a href="#annotated-cell-29-377"></a>                  <span class="at">actionsBox =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-378"><a href="#annotated-cell-29-378"></a>                  <span class="at">liveSearch =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-379"><a href="#annotated-cell-29-379"></a>                  <span class="at">selectedTextFormat =</span> <span class="st">"count"</span>,</span>
<span id="annotated-cell-29-380"><a href="#annotated-cell-29-380"></a>                  <span class="at">countSelectedText =</span> <span class="st">"{0} variables selected"</span>,</span>
<span id="annotated-cell-29-381"><a href="#annotated-cell-29-381"></a>                  <span class="at">noneSelectedText =</span> <span class="st">"No variables selected"</span></span>
<span id="annotated-cell-29-382"><a href="#annotated-cell-29-382"></a>                ),</span>
<span id="annotated-cell-29-383"><a href="#annotated-cell-29-383"></a>                <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-384"><a href="#annotated-cell-29-384"></a>                <span class="at">selected =</span> <span class="st">"Commerce"</span></span>
<span id="annotated-cell-29-385"><a href="#annotated-cell-29-385"></a>              ),</span>
<span id="annotated-cell-29-386"><a href="#annotated-cell-29-386"></a>              shinyWidgets<span class="sc">::</span><span class="fu">prettyCheckbox</span>(</span>
<span id="annotated-cell-29-387"><a href="#annotated-cell-29-387"></a>                <span class="st">"model_std"</span>,</span>
<span id="annotated-cell-29-388"><a href="#annotated-cell-29-388"></a>                <span class="at">label =</span> <span class="st">"Standardize variables?"</span>,</span>
<span id="annotated-cell-29-389"><a href="#annotated-cell-29-389"></a>                <span class="at">value =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-390"><a href="#annotated-cell-29-390"></a>                <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-391"><a href="#annotated-cell-29-391"></a>                <span class="at">shape =</span> <span class="st">"curve"</span></span>
<span id="annotated-cell-29-392"><a href="#annotated-cell-29-392"></a>              ),</span>
<span id="annotated-cell-29-393"><a href="#annotated-cell-29-393"></a>              <span class="fu">hr</span>(),</span>
<span id="annotated-cell-29-394"><a href="#annotated-cell-29-394"></a>              <span class="fu">actionButton</span>(</span>
<span id="annotated-cell-29-395"><a href="#annotated-cell-29-395"></a>                <span class="st">"refresh"</span>,</span>
<span id="annotated-cell-29-396"><a href="#annotated-cell-29-396"></a>                <span class="at">label =</span> <span class="st">"Apply changes"</span>,</span>
<span id="annotated-cell-29-397"><a href="#annotated-cell-29-397"></a>                <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"refresh"</span>),</span>
<span id="annotated-cell-29-398"><a href="#annotated-cell-29-398"></a>                <span class="at">flat =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-29-399"><a href="#annotated-cell-29-399"></a>              )</span>
<span id="annotated-cell-29-400"><a href="#annotated-cell-29-400"></a>            ),</span>
<span id="annotated-cell-29-401"><a href="#annotated-cell-29-401"></a>            <span class="do">#### Outputs(s) ----</span></span>
<span id="annotated-cell-29-402"><a href="#annotated-cell-29-402"></a>            <span class="fu">tabBox</span>(</span>
<span id="annotated-cell-29-403"><a href="#annotated-cell-29-403"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-404"><a href="#annotated-cell-29-404"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="annotated-cell-29-405"><a href="#annotated-cell-29-405"></a>              <span class="at">title =</span> <span class="st">"Model analysis"</span>,</span>
<span id="annotated-cell-29-406"><a href="#annotated-cell-29-406"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="annotated-cell-29-407"><a href="#annotated-cell-29-407"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-408"><a href="#annotated-cell-29-408"></a>              <span class="do">##### Tabpanel: Coefficient plot ----</span></span>
<span id="annotated-cell-29-409"><a href="#annotated-cell-29-409"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-410"><a href="#annotated-cell-29-410"></a>                <span class="at">title =</span> <span class="st">"Plot: Coefficients"</span>,</span>
<span id="annotated-cell-29-411"><a href="#annotated-cell-29-411"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"coefficientplot"</span>)</span>
<span id="annotated-cell-29-412"><a href="#annotated-cell-29-412"></a>              ),</span>
<span id="annotated-cell-29-413"><a href="#annotated-cell-29-413"></a>              <span class="do">##### Tabpanel: Scatterplot ----</span></span>
<span id="annotated-cell-29-414"><a href="#annotated-cell-29-414"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-415"><a href="#annotated-cell-29-415"></a>                <span class="at">title =</span> <span class="st">"Plot: Scatterplot"</span>,</span>
<span id="annotated-cell-29-416"><a href="#annotated-cell-29-416"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"scatterplot"</span>)</span>
<span id="annotated-cell-29-417"><a href="#annotated-cell-29-417"></a>              ),</span>
<span id="annotated-cell-29-418"><a href="#annotated-cell-29-418"></a>              <span class="do">##### Tabpanel: Table: Regression ----</span></span>
<span id="annotated-cell-29-419"><a href="#annotated-cell-29-419"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-420"><a href="#annotated-cell-29-420"></a>                <span class="at">title =</span> <span class="st">"Table: Model"</span>,</span>
<span id="annotated-cell-29-421"><a href="#annotated-cell-29-421"></a>                <span class="fu">htmlOutput</span>(<span class="st">"tableregression"</span>)</span>
<span id="annotated-cell-29-422"><a href="#annotated-cell-29-422"></a>              )</span>
<span id="annotated-cell-29-423"><a href="#annotated-cell-29-423"></a>            )</span>
<span id="annotated-cell-29-424"><a href="#annotated-cell-29-424"></a>          ),</span>
<span id="annotated-cell-29-425"><a href="#annotated-cell-29-425"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-426"><a href="#annotated-cell-29-426"></a>            <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="annotated-cell-29-427"><a href="#annotated-cell-29-427"></a>            <span class="do">##### Box: Pair diagramm ----</span></span>
<span id="annotated-cell-29-428"><a href="#annotated-cell-29-428"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-429"><a href="#annotated-cell-29-429"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-430"><a href="#annotated-cell-29-430"></a>              <span class="at">title =</span> <span class="st">"Pair diagram"</span>,</span>
<span id="annotated-cell-29-431"><a href="#annotated-cell-29-431"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-432"><a href="#annotated-cell-29-432"></a>              plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"pairplot"</span>)</span>
<span id="annotated-cell-29-433"><a href="#annotated-cell-29-433"></a>            ),</span>
<span id="annotated-cell-29-434"><a href="#annotated-cell-29-434"></a>            <span class="do">##### TabBox: Model diagnostics ----</span></span>
<span id="annotated-cell-29-435"><a href="#annotated-cell-29-435"></a>            <span class="fu">tabBox</span>(</span>
<span id="annotated-cell-29-436"><a href="#annotated-cell-29-436"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-437"><a href="#annotated-cell-29-437"></a>              <span class="at">type =</span> <span class="st">"tabs"</span>,</span>
<span id="annotated-cell-29-438"><a href="#annotated-cell-29-438"></a>              <span class="at">title =</span> <span class="st">"Model diagnostics"</span>,</span>
<span id="annotated-cell-29-439"><a href="#annotated-cell-29-439"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-440"><a href="#annotated-cell-29-440"></a>              <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="annotated-cell-29-441"><a href="#annotated-cell-29-441"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-442"><a href="#annotated-cell-29-442"></a>                <span class="at">title =</span> <span class="st">"Normality"</span>,</span>
<span id="annotated-cell-29-443"><a href="#annotated-cell-29-443"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"normality"</span>)</span>
<span id="annotated-cell-29-444"><a href="#annotated-cell-29-444"></a>              ),</span>
<span id="annotated-cell-29-445"><a href="#annotated-cell-29-445"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-446"><a href="#annotated-cell-29-446"></a>                <span class="at">title =</span> <span class="st">"Outliers"</span>,</span>
<span id="annotated-cell-29-447"><a href="#annotated-cell-29-447"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"outliers"</span>)</span>
<span id="annotated-cell-29-448"><a href="#annotated-cell-29-448"></a>              ),</span>
<span id="annotated-cell-29-449"><a href="#annotated-cell-29-449"></a>              <span class="fu">tabPanel</span>(</span>
<span id="annotated-cell-29-450"><a href="#annotated-cell-29-450"></a>                <span class="at">title =</span> <span class="st">"Heteroskedasticity"</span>,</span>
<span id="annotated-cell-29-451"><a href="#annotated-cell-29-451"></a>                plotly<span class="sc">::</span><span class="fu">plotlyOutput</span>(<span class="st">"heteroskedasticity"</span>)</span>
<span id="annotated-cell-29-452"><a href="#annotated-cell-29-452"></a>              )</span>
<span id="annotated-cell-29-453"><a href="#annotated-cell-29-453"></a>            )</span>
<span id="annotated-cell-29-454"><a href="#annotated-cell-29-454"></a>          )</span>
<span id="annotated-cell-29-455"><a href="#annotated-cell-29-455"></a>        )</span>
<span id="annotated-cell-29-456"><a href="#annotated-cell-29-456"></a>      ),</span>
<span id="annotated-cell-29-457"><a href="#annotated-cell-29-457"></a>      <span class="do">### 3.3.4 Tab: Map data ----</span></span>
<span id="annotated-cell-29-458"><a href="#annotated-cell-29-458"></a>      <span class="fu">tabItem</span>(</span>
<span id="annotated-cell-29-459"><a href="#annotated-cell-29-459"></a>        <span class="at">tabName =</span> <span class="st">"tab_map"</span>, <span class="co"># must correspond to related menuItem name</span></span>
<span id="annotated-cell-29-460"><a href="#annotated-cell-29-460"></a>        <span class="fu">fluidRow</span>(</span>
<span id="annotated-cell-29-461"><a href="#annotated-cell-29-461"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-462"><a href="#annotated-cell-29-462"></a>            <span class="do">#### Inputs(s) ----</span></span>
<span id="annotated-cell-29-463"><a href="#annotated-cell-29-463"></a>            <span class="at">width =</span> <span class="dv">4</span>, <span class="co"># must be between 1 and 12</span></span>
<span id="annotated-cell-29-464"><a href="#annotated-cell-29-464"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-465"><a href="#annotated-cell-29-465"></a>              <span class="at">title =</span> <span class="st">"Data selection"</span>,</span>
<span id="annotated-cell-29-466"><a href="#annotated-cell-29-466"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-467"><a href="#annotated-cell-29-467"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-468"><a href="#annotated-cell-29-468"></a>              <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-29-469"><a href="#annotated-cell-29-469"></a>                <span class="st">"tab_map_select"</span>,</span>
<span id="annotated-cell-29-470"><a href="#annotated-cell-29-470"></a>                <span class="at">label =</span> <span class="st">"Select a variable"</span>,</span>
<span id="annotated-cell-29-471"><a href="#annotated-cell-29-471"></a>                <span class="at">choices =</span> <span class="fu">setNames</span>(<span class="fu">names</span>(variable_names), variable_names)</span>
<span id="annotated-cell-29-472"><a href="#annotated-cell-29-472"></a>              ),</span>
<span id="annotated-cell-29-473"><a href="#annotated-cell-29-473"></a>              <span class="fu">uiOutput</span>(<span class="st">"tab_map_desc"</span>)</span>
<span id="annotated-cell-29-474"><a href="#annotated-cell-29-474"></a>            ),</span>
<span id="annotated-cell-29-475"><a href="#annotated-cell-29-475"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-476"><a href="#annotated-cell-29-476"></a>              <span class="at">title =</span> <span class="st">"Map configuration"</span>,</span>
<span id="annotated-cell-29-477"><a href="#annotated-cell-29-477"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-478"><a href="#annotated-cell-29-478"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-479"><a href="#annotated-cell-29-479"></a>              <span class="fu">radioButtons</span>(</span>
<span id="annotated-cell-29-480"><a href="#annotated-cell-29-480"></a>                <span class="st">"tab_map_aggr"</span>,</span>
<span id="annotated-cell-29-481"><a href="#annotated-cell-29-481"></a>                <span class="at">label =</span> <span class="st">"Aggregation level"</span>,</span>
<span id="annotated-cell-29-482"><a href="#annotated-cell-29-482"></a>                <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Departments"</span>, <span class="st">"Regions"</span>),</span>
<span id="annotated-cell-29-483"><a href="#annotated-cell-29-483"></a>                <span class="at">selected =</span> <span class="st">"Departments"</span></span>
<span id="annotated-cell-29-484"><a href="#annotated-cell-29-484"></a>              ),</span>
<span id="annotated-cell-29-485"><a href="#annotated-cell-29-485"></a>              <span class="fu">selectInput</span>(</span>
<span id="annotated-cell-29-486"><a href="#annotated-cell-29-486"></a>                <span class="st">"tab_map_pal"</span>,</span>
<span id="annotated-cell-29-487"><a href="#annotated-cell-29-487"></a>                <span class="at">label =</span> <span class="st">"Color palette"</span>,</span>
<span id="annotated-cell-29-488"><a href="#annotated-cell-29-488"></a>                <span class="at">choices =</span> pals,</span>
<span id="annotated-cell-29-489"><a href="#annotated-cell-29-489"></a>                <span class="at">selected =</span> <span class="st">"Reds"</span></span>
<span id="annotated-cell-29-490"><a href="#annotated-cell-29-490"></a>              ) <span class="co"># end input</span></span>
<span id="annotated-cell-29-491"><a href="#annotated-cell-29-491"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-29-492"><a href="#annotated-cell-29-492"></a>          ), <span class="co"># end column</span></span>
<span id="annotated-cell-29-493"><a href="#annotated-cell-29-493"></a>          <span class="fu">column</span>(</span>
<span id="annotated-cell-29-494"><a href="#annotated-cell-29-494"></a>            <span class="do">#### Output(s) ----</span></span>
<span id="annotated-cell-29-495"><a href="#annotated-cell-29-495"></a>            <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="annotated-cell-29-496"><a href="#annotated-cell-29-496"></a>            <span class="fu">box</span>(</span>
<span id="annotated-cell-29-497"><a href="#annotated-cell-29-497"></a>              <span class="at">id =</span> <span class="st">"tab_map_box"</span>,</span>
<span id="annotated-cell-29-498"><a href="#annotated-cell-29-498"></a>              <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="annotated-cell-29-499"><a href="#annotated-cell-29-499"></a>              <span class="at">headerBorder =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-500"><a href="#annotated-cell-29-500"></a>              <span class="at">collapsible =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-501"><a href="#annotated-cell-29-501"></a>              <span class="at">width =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-29-502"><a href="#annotated-cell-29-502"></a>              leaflet<span class="sc">::</span><span class="fu">leafletOutput</span>(<span class="st">"tab_map_map"</span>, <span class="at">height =</span> <span class="st">"800px"</span>, <span class="at">width =</span> <span class="st">"100%"</span>)</span>
<span id="annotated-cell-29-503"><a href="#annotated-cell-29-503"></a>            ) <span class="co"># end box</span></span>
<span id="annotated-cell-29-504"><a href="#annotated-cell-29-504"></a>          ) <span class="co"># end column</span></span>
<span id="annotated-cell-29-505"><a href="#annotated-cell-29-505"></a>        ) <span class="co"># end fluidRow</span></span>
<span id="annotated-cell-29-506"><a href="#annotated-cell-29-506"></a>      ) <span class="co"># end tabItem</span></span>
<span id="annotated-cell-29-507"><a href="#annotated-cell-29-507"></a>    ) <span class="co"># end tabItems</span></span>
<span id="annotated-cell-29-508"><a href="#annotated-cell-29-508"></a>  ),</span>
<span id="annotated-cell-29-509"><a href="#annotated-cell-29-509"></a>  </span>
<span id="annotated-cell-29-510"><a href="#annotated-cell-29-510"></a>  <span class="do">## 3.4 Footer (bottom)----</span></span>
<span id="annotated-cell-29-511"><a href="#annotated-cell-29-511"></a>  <span class="at">footer =</span> <span class="fu">dashboardFooter</span>(</span>
<span id="annotated-cell-29-512"><a href="#annotated-cell-29-512"></a>    <span class="at">left =</span> <span class="fu">span</span>(</span>
<span id="annotated-cell-29-513"><a href="#annotated-cell-29-513"></a>      <span class="st">"This dashboard was created by Jonas Lieth and Paul Bauer. Find the source code"</span>,</span>
<span id="annotated-cell-29-514"><a href="#annotated-cell-29-514"></a>      <span class="fu">a</span>(<span class="st">"here."</span>, <span class="at">href =</span> <span class="st">"https://github.com/paulcbauer/shiny_workshop/tree/main/shinyapps/guerry"</span>),</span>
<span id="annotated-cell-29-515"><a href="#annotated-cell-29-515"></a>      <span class="st">"It is based on data from the"</span>,</span>
<span id="annotated-cell-29-516"><a href="#annotated-cell-29-516"></a>      <span class="fu">a</span>(<span class="st">"Guerry R package."</span>, <span class="at">href =</span> <span class="st">"https://cran.r-project.org/web/packages/Guerry/index.html"</span>)</span>
<span id="annotated-cell-29-517"><a href="#annotated-cell-29-517"></a>    )</span>
<span id="annotated-cell-29-518"><a href="#annotated-cell-29-518"></a>  ),</span>
<span id="annotated-cell-29-519"><a href="#annotated-cell-29-519"></a>  <span class="do">## 3.5 Controlbar (top)----</span></span>
<span id="annotated-cell-29-520"><a href="#annotated-cell-29-520"></a>  <span class="at">controlbar =</span> <span class="fu">dashboardControlbar</span>(</span>
<span id="annotated-cell-29-521"><a href="#annotated-cell-29-521"></a>    <span class="fu">div</span>(<span class="at">class =</span> <span class="st">"p-3"</span>, <span class="fu">skinSelector</span>()),</span>
<span id="annotated-cell-29-522"><a href="#annotated-cell-29-522"></a>    <span class="at">skin =</span> <span class="st">"light"</span></span>
<span id="annotated-cell-29-523"><a href="#annotated-cell-29-523"></a>  )  </span>
<span id="annotated-cell-29-524"><a href="#annotated-cell-29-524"></a>)</span>
<span id="annotated-cell-29-525"><a href="#annotated-cell-29-525"></a></span>
<span id="annotated-cell-29-526"><a href="#annotated-cell-29-526"></a></span>
<span id="annotated-cell-29-527"><a href="#annotated-cell-29-527"></a></span>
<span id="annotated-cell-29-528"><a href="#annotated-cell-29-528"></a><span class="co"># 4 Server ----</span></span>
<span id="annotated-cell-29-529"><a href="#annotated-cell-29-529"></a></span>
<span id="annotated-cell-29-530"><a href="#annotated-cell-29-530"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="annotated-cell-29-531"><a href="#annotated-cell-29-531"></a>  </span>
<span id="annotated-cell-29-532"><a href="#annotated-cell-29-532"></a>  <span class="do">## 4.1 Tabulate data ----</span></span>
<span id="annotated-cell-29-533"><a href="#annotated-cell-29-533"></a>  <span class="do">### Variable selection ----</span></span>
<span id="annotated-cell-29-534"><a href="#annotated-cell-29-534"></a>  tab <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-535"><a href="#annotated-cell-29-535"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_tabulate_select</span>
<span id="annotated-cell-29-536"><a href="#annotated-cell-29-536"></a>    data_table <span class="ot">&lt;-</span> data_guerry_tabulate</span>
<span id="annotated-cell-29-537"><a href="#annotated-cell-29-537"></a>    </span>
<span id="annotated-cell-29-538"><a href="#annotated-cell-29-538"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var)) {</span>
<span id="annotated-cell-29-539"><a href="#annotated-cell-29-539"></a>      data_table <span class="ot">&lt;-</span> data_table[, var]</span>
<span id="annotated-cell-29-540"><a href="#annotated-cell-29-540"></a>    }</span>
<span id="annotated-cell-29-541"><a href="#annotated-cell-29-541"></a>    </span>
<span id="annotated-cell-29-542"><a href="#annotated-cell-29-542"></a>    data_table</span>
<span id="annotated-cell-29-543"><a href="#annotated-cell-29-543"></a>  })</span>
<span id="annotated-cell-29-544"><a href="#annotated-cell-29-544"></a>  </span>
<span id="annotated-cell-29-545"><a href="#annotated-cell-29-545"></a>  </span>
<span id="annotated-cell-29-546"><a href="#annotated-cell-29-546"></a>  <span class="do">### Create table----</span></span>
<span id="annotated-cell-29-547"><a href="#annotated-cell-29-547"></a>  dt <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-548"><a href="#annotated-cell-29-548"></a>    tab <span class="ot">&lt;-</span> <span class="fu">tab</span>()</span>
<span id="annotated-cell-29-549"><a href="#annotated-cell-29-549"></a>    ridx <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"Department"</span> <span class="sc">%in%</span> <span class="fu">names</span>(tab), <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="annotated-cell-29-550"><a href="#annotated-cell-29-550"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="annotated-cell-29-551"><a href="#annotated-cell-29-551"></a>      tab,</span>
<span id="annotated-cell-29-552"><a href="#annotated-cell-29-552"></a>      <span class="at">class =</span> <span class="st">"hover"</span>,</span>
<span id="annotated-cell-29-553"><a href="#annotated-cell-29-553"></a>      <span class="at">extensions =</span> <span class="fu">c</span>(<span class="st">"Buttons"</span>),</span>
<span id="annotated-cell-29-554"><a href="#annotated-cell-29-554"></a>      <span class="at">selection =</span> <span class="st">"none"</span>,</span>
<span id="annotated-cell-29-555"><a href="#annotated-cell-29-555"></a>      <span class="at">filter =</span> <span class="fu">list</span>(<span class="at">position =</span> <span class="st">"top"</span>, <span class="at">clear =</span> <span class="cn">FALSE</span>),</span>
<span id="annotated-cell-29-556"><a href="#annotated-cell-29-556"></a>      <span class="at">style =</span> <span class="st">"bootstrap4"</span>,</span>
<span id="annotated-cell-29-557"><a href="#annotated-cell-29-557"></a>      <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-558"><a href="#annotated-cell-29-558"></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-559"><a href="#annotated-cell-29-559"></a>        <span class="at">dom =</span> <span class="st">"Brtip"</span>,</span>
<span id="annotated-cell-29-560"><a href="#annotated-cell-29-560"></a>        <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-561"><a href="#annotated-cell-29-561"></a>        <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-562"><a href="#annotated-cell-29-562"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-563"><a href="#annotated-cell-29-563"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"copy"</span>, <span class="at">text =</span> <span class="st">"Copy to clipboard"</span>),</span>
<span id="annotated-cell-29-564"><a href="#annotated-cell-29-564"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"pdf"</span>, <span class="at">text =</span> <span class="st">"Save as PDF"</span>),</span>
<span id="annotated-cell-29-565"><a href="#annotated-cell-29-565"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"csv"</span>, <span class="at">text =</span> <span class="st">"Save as CSV"</span>),</span>
<span id="annotated-cell-29-566"><a href="#annotated-cell-29-566"></a>          <span class="fu">list</span>(<span class="at">extend =</span> <span class="st">"excel"</span>, <span class="at">text =</span> <span class="st">"Save as JSON"</span>, <span class="at">action =</span> DT<span class="sc">::</span><span class="fu">JS</span>(<span class="st">"</span></span>
<span id="annotated-cell-29-567"><a href="#annotated-cell-29-567"></a><span class="st">          function (e, dt, button, config) {</span></span>
<span id="annotated-cell-29-568"><a href="#annotated-cell-29-568"></a><span class="st">            var data = dt.buttons.exportData();</span></span>
<span id="annotated-cell-29-569"><a href="#annotated-cell-29-569"></a><span class="st">  </span></span>
<span id="annotated-cell-29-570"><a href="#annotated-cell-29-570"></a><span class="st">            $.fn.dataTable.fileSave(</span></span>
<span id="annotated-cell-29-571"><a href="#annotated-cell-29-571"></a><span class="st">              new Blob([JSON.stringify(data)]),</span></span>
<span id="annotated-cell-29-572"><a href="#annotated-cell-29-572"></a><span class="st">              'Shiny dashboard.json'</span></span>
<span id="annotated-cell-29-573"><a href="#annotated-cell-29-573"></a><span class="st">            );</span></span>
<span id="annotated-cell-29-574"><a href="#annotated-cell-29-574"></a><span class="st">          }</span></span>
<span id="annotated-cell-29-575"><a href="#annotated-cell-29-575"></a><span class="st">        "</span>))</span>
<span id="annotated-cell-29-576"><a href="#annotated-cell-29-576"></a>        )</span>
<span id="annotated-cell-29-577"><a href="#annotated-cell-29-577"></a>      )</span>
<span id="annotated-cell-29-578"><a href="#annotated-cell-29-578"></a>    )</span>
<span id="annotated-cell-29-579"><a href="#annotated-cell-29-579"></a>  })</span>
<span id="annotated-cell-29-580"><a href="#annotated-cell-29-580"></a>  </span>
<span id="annotated-cell-29-581"><a href="#annotated-cell-29-581"></a>  <span class="do">### Render table----</span></span>
<span id="annotated-cell-29-582"><a href="#annotated-cell-29-582"></a>  output<span class="sc">$</span>tab_tabulate_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>(<span class="fu">dt</span>(), <span class="at">server =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-583"><a href="#annotated-cell-29-583"></a>  </span>
<span id="annotated-cell-29-584"><a href="#annotated-cell-29-584"></a>  </span>
<span id="annotated-cell-29-585"><a href="#annotated-cell-29-585"></a>  </span>
<span id="annotated-cell-29-586"><a href="#annotated-cell-29-586"></a>  <span class="do">## 4.2 Model data ----</span></span>
<span id="annotated-cell-29-587"><a href="#annotated-cell-29-587"></a>  <span class="do">### Define &amp; estimate model ----</span></span>
<span id="annotated-cell-29-588"><a href="#annotated-cell-29-588"></a>  mparams <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-589"><a href="#annotated-cell-29-589"></a>    x <span class="ot">&lt;-</span> input<span class="sc">$</span>model_x</span>
<span id="annotated-cell-29-590"><a href="#annotated-cell-29-590"></a>    y <span class="ot">&lt;-</span> input<span class="sc">$</span>model_y</span>
<span id="annotated-cell-29-591"><a href="#annotated-cell-29-591"></a>    dt <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(x, y)]</span>
<span id="annotated-cell-29-592"><a href="#annotated-cell-29-592"></a>    dt_labels <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data_guerry)[<span class="fu">c</span>(<span class="st">"Department"</span>, <span class="st">"Region"</span>)]</span>
<span id="annotated-cell-29-593"><a href="#annotated-cell-29-593"></a>    <span class="cf">if</span> (input<span class="sc">$</span>model_std) dt <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">standardise</span>(dt)</span>
<span id="annotated-cell-29-594"><a href="#annotated-cell-29-594"></a>    form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(x, <span class="st">"~"</span>, <span class="fu">paste</span>(y, <span class="at">collapse =</span> <span class="st">" + "</span>)))</span>
<span id="annotated-cell-29-595"><a href="#annotated-cell-29-595"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(form, <span class="at">data =</span> dt)</span>
<span id="annotated-cell-29-596"><a href="#annotated-cell-29-596"></a>    </span>
<span id="annotated-cell-29-597"><a href="#annotated-cell-29-597"></a>    <span class="fu">list</span>(</span>
<span id="annotated-cell-29-598"><a href="#annotated-cell-29-598"></a>      <span class="at">x =</span> x,</span>
<span id="annotated-cell-29-599"><a href="#annotated-cell-29-599"></a>      <span class="at">y =</span> y,</span>
<span id="annotated-cell-29-600"><a href="#annotated-cell-29-600"></a>      <span class="at">data =</span> dt,</span>
<span id="annotated-cell-29-601"><a href="#annotated-cell-29-601"></a>      <span class="at">data_labels =</span> dt_labels,</span>
<span id="annotated-cell-29-602"><a href="#annotated-cell-29-602"></a>      <span class="at">model =</span> mod</span>
<span id="annotated-cell-29-603"><a href="#annotated-cell-29-603"></a>    )</span>
<span id="annotated-cell-29-604"><a href="#annotated-cell-29-604"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-605"><a href="#annotated-cell-29-605"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>refresh, <span class="at">ignoreNULL =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-606"><a href="#annotated-cell-29-606"></a>  </span>
<span id="annotated-cell-29-607"><a href="#annotated-cell-29-607"></a>  <span class="do">### Pair diagram ----</span></span>
<span id="annotated-cell-29-608"><a href="#annotated-cell-29-608"></a>  output<span class="sc">$</span>pairplot <span class="ot">&lt;-</span> plotly<span class="sc">::</span><span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-609"><a href="#annotated-cell-29-609"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-610"><a href="#annotated-cell-29-610"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="annotated-cell-29-611"><a href="#annotated-cell-29-611"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="annotated-cell-29-612"><a href="#annotated-cell-29-612"></a>    p <span class="ot">&lt;-</span> GGally<span class="sc">::</span><span class="fu">ggpairs</span>(</span>
<span id="annotated-cell-29-613"><a href="#annotated-cell-29-613"></a>      params<span class="sc">$</span>data,</span>
<span id="annotated-cell-29-614"><a href="#annotated-cell-29-614"></a>      <span class="at">axisLabels =</span> <span class="st">"none"</span>,</span>
<span id="annotated-cell-29-615"><a href="#annotated-cell-29-615"></a>      <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-29-616"><a href="#annotated-cell-29-616"></a>        <span class="at">continuous =</span> <span class="cf">function</span>(data, mapping, ...) {</span>
<span id="annotated-cell-29-617"><a href="#annotated-cell-29-617"></a>          <span class="fu">ggplot</span>(data, mapping) <span class="sc">+</span></span>
<span id="annotated-cell-29-618"><a href="#annotated-cell-29-618"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">geom_point</span>(</span>
<span id="annotated-cell-29-619"><a href="#annotated-cell-29-619"></a>              <span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(</span>
<span id="annotated-cell-29-620"><a href="#annotated-cell-29-620"></a>                <span class="st">"Department: "</span>, </span>
<span id="annotated-cell-29-621"><a href="#annotated-cell-29-621"></a>                dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="annotated-cell-29-622"><a href="#annotated-cell-29-622"></a>                <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="annotated-cell-29-623"><a href="#annotated-cell-29-623"></a>                dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="annotated-cell-29-624"><a href="#annotated-cell-29-624"></a>              <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="annotated-cell-29-625"><a href="#annotated-cell-29-625"></a>            ))</span>
<span id="annotated-cell-29-626"><a href="#annotated-cell-29-626"></a>        }</span>
<span id="annotated-cell-29-627"><a href="#annotated-cell-29-627"></a>      )</span>
<span id="annotated-cell-29-628"><a href="#annotated-cell-29-628"></a>    )</span>
<span id="annotated-cell-29-629"><a href="#annotated-cell-29-629"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-630"><a href="#annotated-cell-29-630"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-631"><a href="#annotated-cell-29-631"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-632"><a href="#annotated-cell-29-632"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-633"><a href="#annotated-cell-29-633"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-634"><a href="#annotated-cell-29-634"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-635"><a href="#annotated-cell-29-635"></a>  })</span>
<span id="annotated-cell-29-636"><a href="#annotated-cell-29-636"></a>  </span>
<span id="annotated-cell-29-637"><a href="#annotated-cell-29-637"></a>  <span class="do">### Plot: Coefficientplot ----</span></span>
<span id="annotated-cell-29-638"><a href="#annotated-cell-29-638"></a>  output<span class="sc">$</span>coefficientplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-639"><a href="#annotated-cell-29-639"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-640"><a href="#annotated-cell-29-640"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="annotated-cell-29-641"><a href="#annotated-cell-29-641"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x</span>
<span id="annotated-cell-29-642"><a href="#annotated-cell-29-642"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="annotated-cell-29-643"><a href="#annotated-cell-29-643"></a>    </span>
<span id="annotated-cell-29-644"><a href="#annotated-cell-29-644"></a>    </span>
<span id="annotated-cell-29-645"><a href="#annotated-cell-29-645"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(parameters<span class="sc">::</span><span class="fu">model_parameters</span>(params<span class="sc">$</span>model))</span>
<span id="annotated-cell-29-646"><a href="#annotated-cell-29-646"></a>    </span>
<span id="annotated-cell-29-647"><a href="#annotated-cell-29-647"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-648"><a href="#annotated-cell-29-648"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-29-649"><a href="#annotated-cell-29-649"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-650"><a href="#annotated-cell-29-650"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-651"><a href="#annotated-cell-29-651"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-652"><a href="#annotated-cell-29-652"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-653"><a href="#annotated-cell-29-653"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-654"><a href="#annotated-cell-29-654"></a>  })</span>
<span id="annotated-cell-29-655"><a href="#annotated-cell-29-655"></a>  </span>
<span id="annotated-cell-29-656"><a href="#annotated-cell-29-656"></a>  <span class="do">### Plot: Scatterplot ----</span></span>
<span id="annotated-cell-29-657"><a href="#annotated-cell-29-657"></a>  output<span class="sc">$</span>scatterplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-658"><a href="#annotated-cell-29-658"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-659"><a href="#annotated-cell-29-659"></a>    dt <span class="ot">&lt;-</span> params<span class="sc">$</span>data</span>
<span id="annotated-cell-29-660"><a href="#annotated-cell-29-660"></a>    dt_labels <span class="ot">&lt;-</span> params<span class="sc">$</span>data_labels</span>
<span id="annotated-cell-29-661"><a href="#annotated-cell-29-661"></a>    x <span class="ot">&lt;-</span> params<span class="sc">$</span>x </span>
<span id="annotated-cell-29-662"><a href="#annotated-cell-29-662"></a>    y <span class="ot">&lt;-</span> params<span class="sc">$</span>y</span>
<span id="annotated-cell-29-663"><a href="#annotated-cell-29-663"></a>    </span>
<span id="annotated-cell-29-664"><a href="#annotated-cell-29-664"></a>    </span>
<span id="annotated-cell-29-665"><a href="#annotated-cell-29-665"></a>    <span class="cf">if</span> (<span class="fu">length</span>(y) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="annotated-cell-29-666"><a href="#annotated-cell-29-666"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(params<span class="sc">$</span>data, </span>
<span id="annotated-cell-29-667"><a href="#annotated-cell-29-667"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> .data[[params<span class="sc">$</span>x]], </span>
<span id="annotated-cell-29-668"><a href="#annotated-cell-29-668"></a>                      <span class="at">y =</span> .data[[params<span class="sc">$</span>y]])) <span class="sc">+</span></span>
<span id="annotated-cell-29-669"><a href="#annotated-cell-29-669"></a>        <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">text =</span> <span class="fu">paste0</span>(<span class="st">"Department: "</span>, </span>
<span id="annotated-cell-29-670"><a href="#annotated-cell-29-670"></a>                                     dt_labels[[<span class="st">"Department"</span>]],</span>
<span id="annotated-cell-29-671"><a href="#annotated-cell-29-671"></a>                                     <span class="st">"&lt;br&gt;Region: "</span>, </span>
<span id="annotated-cell-29-672"><a href="#annotated-cell-29-672"></a>                                     dt_labels[[<span class="st">"Region"</span>]])),</span>
<span id="annotated-cell-29-673"><a href="#annotated-cell-29-673"></a>                   <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-29-674"><a href="#annotated-cell-29-674"></a>        <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="annotated-cell-29-675"><a href="#annotated-cell-29-675"></a>        <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="annotated-cell-29-676"><a href="#annotated-cell-29-676"></a>        <span class="fu">theme_light</span>()</span>
<span id="annotated-cell-29-677"><a href="#annotated-cell-29-677"></a>    } <span class="cf">else</span> {</span>
<span id="annotated-cell-29-678"><a href="#annotated-cell-29-678"></a>      p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-679"><a href="#annotated-cell-29-679"></a>        <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-680"><a href="#annotated-cell-29-680"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>, </span>
<span id="annotated-cell-29-681"><a href="#annotated-cell-29-681"></a>                 <span class="at">label =</span> <span class="st">"Cannot create scatterplot.</span><span class="sc">\n</span><span class="st">More than two variables selected."</span>, </span>
<span id="annotated-cell-29-682"><a href="#annotated-cell-29-682"></a>                 <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, </span>
<span id="annotated-cell-29-683"><a href="#annotated-cell-29-683"></a>                 <span class="at">size =</span> <span class="dv">5</span>, </span>
<span id="annotated-cell-29-684"><a href="#annotated-cell-29-684"></a>                 <span class="at">colour =</span> <span class="st">"red"</span>,</span>
<span id="annotated-cell-29-685"><a href="#annotated-cell-29-685"></a>                 <span class="at">hjust =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-29-686"><a href="#annotated-cell-29-686"></a>                 <span class="at">vjust =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="annotated-cell-29-687"><a href="#annotated-cell-29-687"></a>        <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span>
<span id="annotated-cell-29-688"><a href="#annotated-cell-29-688"></a>      </span>
<span id="annotated-cell-29-689"><a href="#annotated-cell-29-689"></a>    }</span>
<span id="annotated-cell-29-690"><a href="#annotated-cell-29-690"></a>    </span>
<span id="annotated-cell-29-691"><a href="#annotated-cell-29-691"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-692"><a href="#annotated-cell-29-692"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="annotated-cell-29-693"><a href="#annotated-cell-29-693"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-694"><a href="#annotated-cell-29-694"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-695"><a href="#annotated-cell-29-695"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-696"><a href="#annotated-cell-29-696"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-697"><a href="#annotated-cell-29-697"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-698"><a href="#annotated-cell-29-698"></a>  })</span>
<span id="annotated-cell-29-699"><a href="#annotated-cell-29-699"></a>  </span>
<span id="annotated-cell-29-700"><a href="#annotated-cell-29-700"></a>  <span class="do">### Table: Regression ----</span></span>
<span id="annotated-cell-29-701"><a href="#annotated-cell-29-701"></a>  output<span class="sc">$</span>tableregression <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="annotated-cell-29-702"><a href="#annotated-cell-29-702"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-703"><a href="#annotated-cell-29-703"></a>    <span class="fu">HTML</span>(<span class="fu">modelsummary</span>(</span>
<span id="annotated-cell-29-704"><a href="#annotated-cell-29-704"></a>      <span class="fu">dvnames</span>(<span class="fu">list</span>(params<span class="sc">$</span>model)),</span>
<span id="annotated-cell-29-705"><a href="#annotated-cell-29-705"></a>      <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|Log|Adj|RMSE"</span></span>
<span id="annotated-cell-29-706"><a href="#annotated-cell-29-706"></a>    ))</span>
<span id="annotated-cell-29-707"><a href="#annotated-cell-29-707"></a>  })</span>
<span id="annotated-cell-29-708"><a href="#annotated-cell-29-708"></a>  </span>
<span id="annotated-cell-29-709"><a href="#annotated-cell-29-709"></a>  <span class="do">### Plot: Normality residuals ----</span></span>
<span id="annotated-cell-29-710"><a href="#annotated-cell-29-710"></a>  output<span class="sc">$</span>normality <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-711"><a href="#annotated-cell-29-711"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-712"><a href="#annotated-cell-29-712"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_normality</span>(params<span class="sc">$</span>model))</span>
<span id="annotated-cell-29-713"><a href="#annotated-cell-29-713"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-714"><a href="#annotated-cell-29-714"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-715"><a href="#annotated-cell-29-715"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-716"><a href="#annotated-cell-29-716"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-717"><a href="#annotated-cell-29-717"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-718"><a href="#annotated-cell-29-718"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-719"><a href="#annotated-cell-29-719"></a>  })</span>
<span id="annotated-cell-29-720"><a href="#annotated-cell-29-720"></a>  </span>
<span id="annotated-cell-29-721"><a href="#annotated-cell-29-721"></a>  <span class="do">### Plot: Outliers ----</span></span>
<span id="annotated-cell-29-722"><a href="#annotated-cell-29-722"></a>  output<span class="sc">$</span>outliers <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-723"><a href="#annotated-cell-29-723"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-724"><a href="#annotated-cell-29-724"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_outliers</span>(params<span class="sc">$</span>model), <span class="at">show_labels =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-725"><a href="#annotated-cell-29-725"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-726"><a href="#annotated-cell-29-726"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-727"><a href="#annotated-cell-29-727"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-728"><a href="#annotated-cell-29-728"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="st">"Leverage"</span></span>
<span id="annotated-cell-29-729"><a href="#annotated-cell-29-729"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-730"><a href="#annotated-cell-29-730"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-731"><a href="#annotated-cell-29-731"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-732"><a href="#annotated-cell-29-732"></a>  })</span>
<span id="annotated-cell-29-733"><a href="#annotated-cell-29-733"></a>  </span>
<span id="annotated-cell-29-734"><a href="#annotated-cell-29-734"></a>  <span class="do">### Plot: Heteroskedasticity ----</span></span>
<span id="annotated-cell-29-735"><a href="#annotated-cell-29-735"></a>  output<span class="sc">$</span>heteroskedasticity <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>({</span>
<span id="annotated-cell-29-736"><a href="#annotated-cell-29-736"></a>    params <span class="ot">&lt;-</span> <span class="fu">mparams</span>()</span>
<span id="annotated-cell-29-737"><a href="#annotated-cell-29-737"></a>    p <span class="ot">&lt;-</span> <span class="fu">plot</span>(performance<span class="sc">::</span><span class="fu">check_heteroskedasticity</span>(params<span class="sc">$</span>model))</span>
<span id="annotated-cell-29-738"><a href="#annotated-cell-29-738"></a>    <span class="cf">if</span> (<span class="fu">isTRUE</span>(input<span class="sc">$</span>dark_mode)) p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="annotated-cell-29-739"><a href="#annotated-cell-29-739"></a>      <span class="fu">dark_theme_gray</span>() <span class="sc">+</span></span>
<span id="annotated-cell-29-740"><a href="#annotated-cell-29-740"></a>      <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#343a40"</span>))</span>
<span id="annotated-cell-29-741"><a href="#annotated-cell-29-741"></a>    p<span class="sc">$</span>labels<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="st">"Sqrt. |Std. residuals|"</span> <span class="co"># ggplotly doesn't support expressions</span></span>
<span id="annotated-cell-29-742"><a href="#annotated-cell-29-742"></a>    <span class="fu">ggplotly</span>(p) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-743"><a href="#annotated-cell-29-743"></a>      <span class="fu">config</span>(<span class="at">modeBarButtonsToRemove =</span> plotly_buttons,</span>
<span id="annotated-cell-29-744"><a href="#annotated-cell-29-744"></a>             <span class="at">displaylogo =</span> <span class="cn">FALSE</span>)</span>
<span id="annotated-cell-29-745"><a href="#annotated-cell-29-745"></a>  })</span>
<span id="annotated-cell-29-746"><a href="#annotated-cell-29-746"></a>  </span>
<span id="annotated-cell-29-747"><a href="#annotated-cell-29-747"></a>  </span>
<span id="annotated-cell-29-748"><a href="#annotated-cell-29-748"></a>  <span class="do">## 4.3 Map data ----</span></span>
<span id="annotated-cell-29-749"><a href="#annotated-cell-29-749"></a>  </span>
<span id="annotated-cell-29-750"><a href="#annotated-cell-29-750"></a>  <span class="co"># Render description of selected variable</span></span>
<span id="annotated-cell-29-751"><a href="#annotated-cell-29-751"></a>  output<span class="sc">$</span>tab_map_desc <span class="ot">&lt;-</span> <span class="fu">renderUI</span>({</span>
<span id="annotated-cell-29-752"><a href="#annotated-cell-29-752"></a>    <span class="fu">HTML</span>(variable_desc[[input<span class="sc">$</span>tab_map_select]]<span class="sc">$</span>desc)</span>
<span id="annotated-cell-29-753"><a href="#annotated-cell-29-753"></a>  })</span>
<span id="annotated-cell-29-754"><a href="#annotated-cell-29-754"></a>  </span>
<span id="annotated-cell-29-755"><a href="#annotated-cell-29-755"></a>  <span class="co"># Select polygon based on aggregation level</span></span>
<span id="annotated-cell-29-756"><a href="#annotated-cell-29-756"></a>  poly <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-757"><a href="#annotated-cell-29-757"></a>    <span class="cf">if</span> (<span class="fu">identical</span>(input<span class="sc">$</span>tab_map_aggr, <span class="st">"Regions"</span>)) {</span>
<span id="annotated-cell-29-758"><a href="#annotated-cell-29-758"></a>      data_guerry_region</span>
<span id="annotated-cell-29-759"><a href="#annotated-cell-29-759"></a>    } <span class="cf">else</span> {</span>
<span id="annotated-cell-29-760"><a href="#annotated-cell-29-760"></a>      data_guerry</span>
<span id="annotated-cell-29-761"><a href="#annotated-cell-29-761"></a>    }</span>
<span id="annotated-cell-29-762"><a href="#annotated-cell-29-762"></a>  })</span>
<span id="annotated-cell-29-763"><a href="#annotated-cell-29-763"></a>  </span>
<span id="annotated-cell-29-764"><a href="#annotated-cell-29-764"></a>  <span class="co"># Select palette based on input</span></span>
<span id="annotated-cell-29-765"><a href="#annotated-cell-29-765"></a>  palette <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-766"><a href="#annotated-cell-29-766"></a>    pal <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_pal</span>
<span id="annotated-cell-29-767"><a href="#annotated-cell-29-767"></a>    <span class="cf">if</span> (pal <span class="sc">%in%</span> pals<span class="sc">$</span>Viridis) {</span>
<span id="annotated-cell-29-768"><a href="#annotated-cell-29-768"></a>      pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis_pal</span>(<span class="at">option =</span> <span class="fu">tolower</span>(pal))(<span class="dv">5</span>)</span>
<span id="annotated-cell-29-769"><a href="#annotated-cell-29-769"></a>    }</span>
<span id="annotated-cell-29-770"><a href="#annotated-cell-29-770"></a>    pal</span>
<span id="annotated-cell-29-771"><a href="#annotated-cell-29-771"></a>  }) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-772"><a href="#annotated-cell-29-772"></a>    <span class="fu">bindEvent</span>(input<span class="sc">$</span>tab_map_pal)</span>
<span id="annotated-cell-29-773"><a href="#annotated-cell-29-773"></a>  </span>
<span id="annotated-cell-29-774"><a href="#annotated-cell-29-774"></a>  <span class="co"># Compile parameters for leaflet rendering</span></span>
<span id="annotated-cell-29-775"><a href="#annotated-cell-29-775"></a>  params <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="annotated-cell-29-776"><a href="#annotated-cell-29-776"></a>    poly <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(<span class="fu">poly</span>(), <span class="dv">4326</span>)</span>
<span id="annotated-cell-29-777"><a href="#annotated-cell-29-777"></a>    pal <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="annotated-cell-29-778"><a href="#annotated-cell-29-778"></a>    var <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_select</span>
<span id="annotated-cell-29-779"><a href="#annotated-cell-29-779"></a>    </span>
<span id="annotated-cell-29-780"><a href="#annotated-cell-29-780"></a>    values <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~"</span>, var))</span>
<span id="annotated-cell-29-781"><a href="#annotated-cell-29-781"></a>    pal <span class="ot">&lt;-</span> <span class="fu">colorNumeric</span>(<span class="at">palette =</span> pal, <span class="at">domain =</span> <span class="cn">NULL</span>)</span>
<span id="annotated-cell-29-782"><a href="#annotated-cell-29-782"></a>    </span>
<span id="annotated-cell-29-783"><a href="#annotated-cell-29-783"></a>    reg <span class="ot">&lt;-</span> poly[[<span class="st">"Region"</span>]]</span>
<span id="annotated-cell-29-784"><a href="#annotated-cell-29-784"></a>    dep <span class="ot">&lt;-</span> poly[[<span class="st">"Department"</span>]]</span>
<span id="annotated-cell-29-785"><a href="#annotated-cell-29-785"></a>    val <span class="ot">&lt;-</span> poly[[var]]</span>
<span id="annotated-cell-29-786"><a href="#annotated-cell-29-786"></a>    </span>
<span id="annotated-cell-29-787"><a href="#annotated-cell-29-787"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(dep)) {</span>
<span id="annotated-cell-29-788"><a href="#annotated-cell-29-788"></a>      dep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(poly))</span>
<span id="annotated-cell-29-789"><a href="#annotated-cell-29-789"></a>    }</span>
<span id="annotated-cell-29-790"><a href="#annotated-cell-29-790"></a>    </span>
<span id="annotated-cell-29-791"><a href="#annotated-cell-29-791"></a>    <span class="co"># Create labels that are nicely aligned in a grid</span></span>
<span id="annotated-cell-29-792"><a href="#annotated-cell-29-792"></a>    labels <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="annotated-cell-29-793"><a href="#annotated-cell-29-793"></a>      <span class="cf">function</span>(reg, dep, val) {</span>
<span id="annotated-cell-29-794"><a href="#annotated-cell-29-794"></a>        <span class="fu">HTML</span>(<span class="fu">as.character</span>(tags<span class="sc">$</span><span class="fu">table</span>(</span>
<span id="annotated-cell-29-795"><a href="#annotated-cell-29-795"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-29-796"><a href="#annotated-cell-29-796"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="annotated-cell-29-797"><a href="#annotated-cell-29-797"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Region: "</span>)),</span>
<span id="annotated-cell-29-798"><a href="#annotated-cell-29-798"></a>            tags<span class="sc">$</span><span class="fu">td</span>(reg)</span>
<span id="annotated-cell-29-799"><a href="#annotated-cell-29-799"></a>          ),</span>
<span id="annotated-cell-29-800"><a href="#annotated-cell-29-800"></a>          <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(dep)) {</span>
<span id="annotated-cell-29-801"><a href="#annotated-cell-29-801"></a>            tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-29-802"><a href="#annotated-cell-29-802"></a>              <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="annotated-cell-29-803"><a href="#annotated-cell-29-803"></a>              tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="st">"Department: "</span>)),</span>
<span id="annotated-cell-29-804"><a href="#annotated-cell-29-804"></a>              tags<span class="sc">$</span><span class="fu">td</span>(dep)</span>
<span id="annotated-cell-29-805"><a href="#annotated-cell-29-805"></a>            )</span>
<span id="annotated-cell-29-806"><a href="#annotated-cell-29-806"></a>          },</span>
<span id="annotated-cell-29-807"><a href="#annotated-cell-29-807"></a>          tags<span class="sc">$</span><span class="fu">tr</span>(</span>
<span id="annotated-cell-29-808"><a href="#annotated-cell-29-808"></a>            <span class="at">style =</span> <span class="st">"line-height: 10px"</span>,</span>
<span id="annotated-cell-29-809"><a href="#annotated-cell-29-809"></a>            tags<span class="sc">$</span><span class="fu">td</span>(tags<span class="sc">$</span><span class="fu">b</span>(<span class="fu">paste0</span>(variable_desc[[var]]<span class="sc">$</span>lgd, <span class="st">": "</span>))),</span>
<span id="annotated-cell-29-810"><a href="#annotated-cell-29-810"></a>            tags<span class="sc">$</span><span class="fu">td</span>(<span class="fu">round</span>(val, <span class="dv">2</span>))</span>
<span id="annotated-cell-29-811"><a href="#annotated-cell-29-811"></a>          )</span>
<span id="annotated-cell-29-812"><a href="#annotated-cell-29-812"></a>        )))</span>
<span id="annotated-cell-29-813"><a href="#annotated-cell-29-813"></a>      },</span>
<span id="annotated-cell-29-814"><a href="#annotated-cell-29-814"></a>      <span class="at">reg =</span> reg, <span class="at">dep =</span> dep, <span class="at">val =</span> val,</span>
<span id="annotated-cell-29-815"><a href="#annotated-cell-29-815"></a>      <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-29-816"><a href="#annotated-cell-29-816"></a>      <span class="at">USE.NAMES =</span> <span class="cn">FALSE</span></span>
<span id="annotated-cell-29-817"><a href="#annotated-cell-29-817"></a>    )</span>
<span id="annotated-cell-29-818"><a href="#annotated-cell-29-818"></a>    </span>
<span id="annotated-cell-29-819"><a href="#annotated-cell-29-819"></a>    <span class="fu">list</span>(</span>
<span id="annotated-cell-29-820"><a href="#annotated-cell-29-820"></a>      <span class="at">poly =</span> poly,</span>
<span id="annotated-cell-29-821"><a href="#annotated-cell-29-821"></a>      <span class="at">var =</span> var,</span>
<span id="annotated-cell-29-822"><a href="#annotated-cell-29-822"></a>      <span class="at">pal =</span> pal,</span>
<span id="annotated-cell-29-823"><a href="#annotated-cell-29-823"></a>      <span class="at">values =</span> values,</span>
<span id="annotated-cell-29-824"><a href="#annotated-cell-29-824"></a>      <span class="at">labels =</span> labels</span>
<span id="annotated-cell-29-825"><a href="#annotated-cell-29-825"></a>    )</span>
<span id="annotated-cell-29-826"><a href="#annotated-cell-29-826"></a>  })</span>
<span id="annotated-cell-29-827"><a href="#annotated-cell-29-827"></a>  </span>
<span id="annotated-cell-29-828"><a href="#annotated-cell-29-828"></a>  <span class="co"># Render leaflet for the first time</span></span>
<span id="annotated-cell-29-829"><a href="#annotated-cell-29-829"></a>  output<span class="sc">$</span>tab_map_map <span class="ot">&lt;-</span> leaflet<span class="sc">::</span><span class="fu">renderLeaflet</span>({</span>
<span id="annotated-cell-29-830"><a href="#annotated-cell-29-830"></a>    <span class="co"># Isolate call to params() to prevent render function to be executed</span></span>
<span id="annotated-cell-29-831"><a href="#annotated-cell-29-831"></a>    <span class="co"># every time params() is invalidated. No dependency is made.</span></span>
<span id="annotated-cell-29-832"><a href="#annotated-cell-29-832"></a>    params <span class="ot">&lt;-</span> <span class="fu">isolate</span>(<span class="fu">params</span>())</span>
<span id="annotated-cell-29-833"><a href="#annotated-cell-29-833"></a>    <span class="fu">leaflet</span>(<span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-834"><a href="#annotated-cell-29-834"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenStreetMap.France"</span>, <span class="at">group =</span> <span class="st">"OSM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-835"><a href="#annotated-cell-29-835"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"OpenTopoMap"</span>, <span class="at">group =</span> <span class="st">"OTM"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-836"><a href="#annotated-cell-29-836"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"Stamen.TonerLite"</span>, <span class="at">group =</span> <span class="st">"Stamen Toner"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-837"><a href="#annotated-cell-29-837"></a>      <span class="fu">addProviderTiles</span>(<span class="st">"GeoportailFrance.orthos"</span>, <span class="at">group =</span> <span class="st">"Orthophotos"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-838"><a href="#annotated-cell-29-838"></a>      <span class="fu">addLayersControl</span>(<span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">"OSM"</span>, <span class="st">"OTM"</span>,</span>
<span id="annotated-cell-29-839"><a href="#annotated-cell-29-839"></a>                                      <span class="st">"Stamen Toner"</span>, <span class="st">"Orthophotos"</span>)) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-840"><a href="#annotated-cell-29-840"></a>      <span class="fu">setView</span>(<span class="at">lng =</span> <span class="dv">3</span>, <span class="at">lat =</span> <span class="dv">47</span>, <span class="at">zoom =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-841"><a href="#annotated-cell-29-841"></a>      <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-29-842"><a href="#annotated-cell-29-842"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-29-843"><a href="#annotated-cell-29-843"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-29-844"><a href="#annotated-cell-29-844"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-29-845"><a href="#annotated-cell-29-845"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-29-846"><a href="#annotated-cell-29-846"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-29-847"><a href="#annotated-cell-29-847"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="annotated-cell-29-848"><a href="#annotated-cell-29-848"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-29-849"><a href="#annotated-cell-29-849"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-29-850"><a href="#annotated-cell-29-850"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-29-851"><a href="#annotated-cell-29-851"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-29-852"><a href="#annotated-cell-29-852"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-29-853"><a href="#annotated-cell-29-853"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-854"><a href="#annotated-cell-29-854"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-29-855"><a href="#annotated-cell-29-855"></a>        )</span>
<span id="annotated-cell-29-856"><a href="#annotated-cell-29-856"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-857"><a href="#annotated-cell-29-857"></a>      <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-29-858"><a href="#annotated-cell-29-858"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-29-859"><a href="#annotated-cell-29-859"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-29-860"><a href="#annotated-cell-29-860"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-29-861"><a href="#annotated-cell-29-861"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-29-862"><a href="#annotated-cell-29-862"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-29-863"><a href="#annotated-cell-29-863"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-29-864"><a href="#annotated-cell-29-864"></a>      )</span>
<span id="annotated-cell-29-865"><a href="#annotated-cell-29-865"></a>  })</span>
<span id="annotated-cell-29-866"><a href="#annotated-cell-29-866"></a>  </span>
<span id="annotated-cell-29-867"><a href="#annotated-cell-29-867"></a>  <span class="co"># Create a leaflet proxy. Proxies update map values without re-rendering the</span></span>
<span id="annotated-cell-29-868"><a href="#annotated-cell-29-868"></a>  <span class="co"># entire map, thus increasing performance.</span></span>
<span id="annotated-cell-29-869"><a href="#annotated-cell-29-869"></a>  <span class="fu">observe</span>({</span>
<span id="annotated-cell-29-870"><a href="#annotated-cell-29-870"></a>    params <span class="ot">&lt;-</span> <span class="fu">params</span>()</span>
<span id="annotated-cell-29-871"><a href="#annotated-cell-29-871"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>, <span class="at">data =</span> params<span class="sc">$</span>poly) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-872"><a href="#annotated-cell-29-872"></a>      <span class="fu">clearShapes</span>() <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-873"><a href="#annotated-cell-29-873"></a>      <span class="fu">clearControls</span>() <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-874"><a href="#annotated-cell-29-874"></a>      <span class="fu">addPolygons</span>(</span>
<span id="annotated-cell-29-875"><a href="#annotated-cell-29-875"></a>        <span class="at">fillColor =</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">"~params$pal("</span>, params<span class="sc">$</span>var, <span class="st">")"</span>)),</span>
<span id="annotated-cell-29-876"><a href="#annotated-cell-29-876"></a>        <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="annotated-cell-29-877"><a href="#annotated-cell-29-877"></a>        <span class="at">weight =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-29-878"><a href="#annotated-cell-29-878"></a>        <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-29-879"><a href="#annotated-cell-29-879"></a>        <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-29-880"><a href="#annotated-cell-29-880"></a>        <span class="at">label =</span> params<span class="sc">$</span>labels,</span>
<span id="annotated-cell-29-881"><a href="#annotated-cell-29-881"></a>        <span class="at">highlightOptions =</span> <span class="fu">highlightOptions</span>(</span>
<span id="annotated-cell-29-882"><a href="#annotated-cell-29-882"></a>          <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="annotated-cell-29-883"><a href="#annotated-cell-29-883"></a>          <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="annotated-cell-29-884"><a href="#annotated-cell-29-884"></a>          <span class="at">opacity =</span> <span class="fl">0.5</span>,</span>
<span id="annotated-cell-29-885"><a href="#annotated-cell-29-885"></a>          <span class="at">fillOpacity =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-29-886"><a href="#annotated-cell-29-886"></a>          <span class="at">bringToFront =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-29-887"><a href="#annotated-cell-29-887"></a>          <span class="at">sendToBack =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-29-888"><a href="#annotated-cell-29-888"></a>        )</span>
<span id="annotated-cell-29-889"><a href="#annotated-cell-29-889"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-890"><a href="#annotated-cell-29-890"></a>      <span class="fu">addLegend</span>(</span>
<span id="annotated-cell-29-891"><a href="#annotated-cell-29-891"></a>        <span class="at">position =</span> <span class="st">"bottomright"</span>,</span>
<span id="annotated-cell-29-892"><a href="#annotated-cell-29-892"></a>        <span class="at">na.label =</span> <span class="st">"No data"</span>,</span>
<span id="annotated-cell-29-893"><a href="#annotated-cell-29-893"></a>        <span class="at">pal =</span> params<span class="sc">$</span>pal,</span>
<span id="annotated-cell-29-894"><a href="#annotated-cell-29-894"></a>        <span class="at">values =</span> params<span class="sc">$</span>values,</span>
<span id="annotated-cell-29-895"><a href="#annotated-cell-29-895"></a>        <span class="at">opacity =</span> <span class="fl">0.9</span>,</span>
<span id="annotated-cell-29-896"><a href="#annotated-cell-29-896"></a>        <span class="at">title =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>lgd,</span>
<span id="annotated-cell-29-897"><a href="#annotated-cell-29-897"></a>        <span class="at">labFormat =</span> <span class="fu">labelFormat</span>(<span class="at">suffix =</span> variable_desc[[params<span class="sc">$</span>var]]<span class="sc">$</span>unit)</span>
<span id="annotated-cell-29-898"><a href="#annotated-cell-29-898"></a>      )</span>
<span id="annotated-cell-29-899"><a href="#annotated-cell-29-899"></a>  })</span>
<span id="annotated-cell-29-900"><a href="#annotated-cell-29-900"></a>  </span>
<span id="annotated-cell-29-901"><a href="#annotated-cell-29-901"></a>  </span>
<span id="annotated-cell-29-902"><a href="#annotated-cell-29-902"></a>  <span class="co"># Add a new marker</span></span>
<span id="annotated-cell-29-903"><a href="#annotated-cell-29-903"></a>  <span class="fu">observe</span>({</span>
<span id="annotated-cell-29-904"><a href="#annotated-cell-29-904"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_shape_click</span>
<span id="annotated-cell-29-905"><a href="#annotated-cell-29-905"></a>    <span class="fu">req</span>(click)</span>
<span id="annotated-cell-29-906"><a href="#annotated-cell-29-906"></a>    id <span class="ot">&lt;-</span> <span class="fu">paste0</span>(click<span class="sc">$</span>lng, click<span class="sc">$</span>lat)</span>
<span id="annotated-cell-29-907"><a href="#annotated-cell-29-907"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-908"><a href="#annotated-cell-29-908"></a>      <span class="fu">addMarkers</span>(<span class="at">lng =</span> click<span class="sc">$</span>lng, <span class="at">lat =</span> click<span class="sc">$</span>lat, <span class="at">layerId =</span> id)</span>
<span id="annotated-cell-29-909"><a href="#annotated-cell-29-909"></a>  })</span>
<span id="annotated-cell-29-910"><a href="#annotated-cell-29-910"></a>  </span>
<span id="annotated-cell-29-911"><a href="#annotated-cell-29-911"></a>  <span class="co"># Delete an existing marker</span></span>
<span id="annotated-cell-29-912"><a href="#annotated-cell-29-912"></a>  <span class="fu">observe</span>({</span>
<span id="annotated-cell-29-913"><a href="#annotated-cell-29-913"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_marker_click</span>
<span id="annotated-cell-29-914"><a href="#annotated-cell-29-914"></a>    <span class="fu">req</span>(click)</span>
<span id="annotated-cell-29-915"><a href="#annotated-cell-29-915"></a>    <span class="fu">leafletProxy</span>(<span class="st">"tab_map_map"</span>) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-29-916"><a href="#annotated-cell-29-916"></a>      <span class="fu">removeMarker</span>(click<span class="sc">$</span>id)</span>
<span id="annotated-cell-29-917"><a href="#annotated-cell-29-917"></a>  })</span>
<span id="annotated-cell-29-918"><a href="#annotated-cell-29-918"></a>}</span>
<span id="annotated-cell-29-919"><a href="#annotated-cell-29-919"></a></span>
<span id="annotated-cell-29-920"><a href="#annotated-cell-29-920"></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercises-3" class="level2" data-number="9.8">
<h2 data-number="9.8" class="anchored" data-anchor-id="exercises-3"><span class="header-section-number">9.8</span> Exercises</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 9
</div>
</div>
<div class="callout-body-container callout-body">
<p>When does the event <code>input$map_shape_mouseout</code> send information to the server?</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A Leaflet input event is structured as follows: <code>input$&lt;mapid&gt;_&lt;geometry type&gt;_&lt;event type&gt;</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>map_exp</code> refers to the target leaflet map</p>
<p><code>shape</code> refers to the target map object (in this case a polygon or a line)</p>
<p><code>mouseout</code> refers to the event type</p>
<p><code>input$map_exp_shape_mouseout</code> triggers whenever we move out of the boundaries of a polygon on the Leaflet map with the ID <code>map_exp</code></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise 10
</div>
</div>
<div class="callout-body-container callout-body">
<p>Print the current mouse coordinates to the console every time a polygon on the map is clicked.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can access click coordinates using the map event <code>input$tab_map_map_shape_click</code></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-36-contents" aria-controls="callout-36" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-36" class="callout-36-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To capture the the mouse coordinates we need to access the Leaflet event <code>input$tab_map_map_shape_click</code>. Printing to the console is done in an observer as it triggers side effects and does not create a reactive object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">observe</span>({</span>
<span id="cb23-2"><a href="#cb23-2"></a>    click <span class="ot">&lt;-</span> input<span class="sc">$</span>tab_map_map_shape_click</span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(</span>
<span id="cb23-4"><a href="#cb23-4"></a>        <span class="st">"Click on tab_map_map detected"</span>,</span>
<span id="cb23-5"><a href="#cb23-5"></a>        <span class="fu">paste</span>(<span class="st">"Lon:"</span>, click<span class="sc">$</span>lng),</span>
<span id="cb23-6"><a href="#cb23-6"></a>        <span class="fu">paste</span>(<span class="st">"Lat:"</span>, click<span class="sc">$</span>lat),</span>
<span id="cb23-7"><a href="#cb23-7"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb23-8"><a href="#cb23-8"></a>        <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>    ))</span>
<span id="cb23-10"><a href="#cb23-10"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/bookdown\.org\/paul\/shiny_workshop\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/paulcbauer/shiny_workshop/edit/main/06-mapping.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/paulcbauer/shiny_workshop/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>