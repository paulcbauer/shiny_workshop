---
title: "Prototyping"
---

```{r include=FALSE}
pacman::p_load(
	shiny,
	htmltools,
	bs4Dash,
	fresh,
	waiter,
	shinyWidgets,
	Guerry,
	sf,
	tidyr,
	dplyr,
	RColorBrewer,
	viridis,
	leaflet,
	plotly,
	jsonlite
)

guerry <- Guerry::gfrance85 %>%
  st_as_sf() %>% # convert sp to the newer sf format
  as_tibble() %>%
  st_as_sf(crs = 27572) %>% # set the correct coordinate reference system
  mutate(Region = case_match(
    Region,
    "C" ~ "Central",
    "E" ~ "East",
    "N" ~ "North",
    "S" ~ "South",
    "W" ~ "West"
  ))

variables <- guerry %>%
  st_drop_geometry() %>%
  select(where(is.numeric) & !all_of(c("COUNT", "dept", "AVE_ID_GEO"))) %>%
  names()

guerry_region <- guerry %>%
  group_by(Region) %>%
  summarise(across(
  .cols = all_of(variables),
  function(x) {
    if (cur_column() %in% c("Area", "Pop1831")) {
      sum(x)
    } else {
      mean(x)
    }
  }
 ))
  
txts <- read_json("shinyapps/guerry/app_labels.json", simplifyVector = TRUE)
```

## Learning outcomes

You will learn how to:

-   Work with spatial data

-   Create interactive maps in Shiny using Leaflet

-   Use Shiny events and proxies

## Interactive maps

-   Mapping is a type of data visualization based on *spatial data*

-   Classic cartography relies on generalization and interpretation

-   Interactive cartography removes many limitations such as generalization and map boundaries

![Generalization in OpenStreetMap at different scales](resources/generalization.gif)

-   Further resources:

    -   [Chapter 8](https://bookdown.org/robinlovelace/geocompr/adv-map.html) of Robin Lovelace's "Geocomputation with R"

    -   The documentation of [Leaflet for R](https://rstudio.github.io/leaflet/)

## The basics

-   Spatial data is the foundation of mapping, but what is it?

-   Spatial data is all data that can be explicitly linked to a spatial reference

-   Geography can describe the world in two ways:

    -   As spatially continuous processes (or as *raster data*)

    -   As an ensemble of individual elements (or as *vector data*)

-   Vector data is also called spatial geometries and can be divided into

    -   Points (e.g., individual events or places)

    -   Lines (e.g., streets, rivers)

    -   Polygons (e.g., buildings, districts)

![The real world described by layers of raster and vector data ([Source](https://saylordotorg.github.io/text_essentials-of-geographic-information-systems/s11-02-multiple-layer-analysis.html#campbell_1.0-ch07_s02_f01))](https://saylordotorg.github.io/text_essentials-of-geographic-information-systems/section_11/ca6ce94cdd2e09a1da8aa6ec22336835.jpg){width="440"}

```{r}
world <- ggplot2::map_data("world") %>%
    st_as_sf(coords = c("long", "lat"), crs = 4326) %>%
    group_by(group) %>%
    summarise(geometry = st_combine(geometry)) %>%
    st_cast("LINESTRING") %>%
    st_as_sfc()

world1 <- st_transform(world, "ESRI:54030") %>%
	ggplot() + geom_sf(fill = NA) + theme_void() + theme(
		strip.background = element_rect(fill = NA)
	)
world2 <- st_transform(world, 9753) %>%
	ggplot() + geom_sf(fill = NA) + theme_void() + theme(
		strip.background = element_rect(fill = NA)
	)

GGally::ggmatrix(
	list(world1, world2),
	nrow = 1,
	ncol = 3,
	xAxisLabels = c("Projected", "Geographic")
)
```

| Packages    | Interactive | High-end map design |
|-------------|-------------|---------------------|
| ggplot2     |             | (✓)                 |
| plotly      | ✓           |                     |
| leaflet     | ✓           | ✓                   |
| rbokeh      | ✓           |                     |
| tmap        | ✓           | ✓                   |
| cartography |             | ✓                   |
| mapsf       |             | ✓                   |
| sf          |             |                     |
| terra       |             |                     |
